var __reflect=this&&this.__reflect||function(t,i,e){t.__class__=i,e?e.push(i):e=[i],t.__types__=t.__types__?e.concat(t.__types__):e},__extends=this&&this.__extends||function(t,i){function e(){this.constructor=t}for(var s in i)i.hasOwnProperty(s)&&(t[s]=i[s]);e.prototype=i.prototype,t.prototype=new e},__awaiter=this&&this.__awaiter||function(t,i,e,s){return new(e||(e=Promise))(function(h,a){function n(t){try{r(s.next(t))}catch(i){a(i)}}function o(t){try{r(s["throw"](t))}catch(i){a(i)}}function r(t){t.done?h(t.value):new e(function(i){i(t.value)}).then(n,o)}r((s=s.apply(t,i||[])).next())})},__generator=this&&this.__generator||function(t,i){function e(t){return function(i){return s([t,i])}}function s(e){if(h)throw new TypeError("Generator is already executing.");for(;r;)try{if(h=1,a&&(n=a[2&e[0]?"return":e[0]?"throw":"next"])&&!(n=n.call(a,e[1])).done)return n;switch(a=0,n&&(e=[0,n.value]),e[0]){case 0:case 1:n=e;break;case 4:return r.label++,{value:e[1],done:!1};case 5:r.label++,a=e[1],e=[0];continue;case 7:e=r.ops.pop(),r.trys.pop();continue;default:if(n=r.trys,!(n=n.length>0&&n[n.length-1])&&(6===e[0]||2===e[0])){r=0;continue}if(3===e[0]&&(!n||e[1]>n[0]&&e[1]<n[3])){r.label=e[1];break}if(6===e[0]&&r.label<n[1]){r.label=n[1],n=e;break}if(n&&r.label<n[2]){r.label=n[2],r.ops.push(e);break}n[2]&&r.ops.pop(),r.trys.pop();continue}e=i.call(t,r)}catch(s){e=[6,s],a=0}finally{h=n=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}var h,a,n,o,r={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:e(0),"throw":e(1),"return":e(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o},miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.exact=!0,t.touchEnabled=!1,t.touchChildren=!1,t._direction8=1,t._action=null,t.createBody(),t}return __extends(e,i),e.prototype.createBody=function(){this.partCont=GObj.create(egret.DisplayObjectContainer),this.addChild(this.partCont),this.touchEnabled=this.touchChildren=!1,this.part=GObj.create(t.IAvatarPart),this.part.setPart(AvatarConsts.PART_BODY),this.partCont.addChild(this.part),this.part.setCallBack(this.partComplete,this)},e.prototype.setActOverCallBack=function(t,i){this.actOverBack=t,this.actOverThis=i},e.prototype.partComplete=function(t){t&&t.jsonObj&&(this._playInterval=this._setInterval||t.jsonObj.frameTime||GConfig.PLAY_AVATAR_INTERVAL,this.isRunFirst&&this.run())},e.prototype.setCenter=function(t){this.part.center=t},e.prototype.updatePart=function(t,i){this.setFrameGap(i),this._model=t,this.part.setModel(t)},e.prototype.setFrameGap=function(t){return t>0?(this._setInterval=t,void(this._playInterval=this._setInterval)):void(this._setInterval=0)},e.prototype.run=function(){if(this.part.frameSize>0){var t=$GApp.timer,i=(t-this.part.startTime)/(this._playInterval||GConfig.PLAY_AVATAR_INTERVAL);this.part.setFrame(i),!this._actionOver&&this.part.frame+1>=this.part.frameSize&&this.actionOver(this._action)}this.part&&this.part.loading()},e.prototype.actionOver=function(t){this._actionOver=!0,this.actOverBack&&this.actOverBack.call(this.actOverThis,t)},e.prototype.setDirection=function(t){this._direction8!=t&&(this._direction8=t,this.partCont.scaleX=AvatarHelp.direction2mirror(this._direction8),this.part.setDirection(AvatarHelp.direction2res(this._direction8)))},e.prototype.setAction=function(t,i){this.setFrameGap(i),this._action=t,this._actionOver=!1,this.part.setAction(t)},e.prototype.addChildTo=function(t,i){this.partCont&&(i>=0?this.partCont.addChildAt(t,i):this.partCont.addChild(t))},e.prototype.removeMe=function(){this.parent&&this.parent.removeChild(this)},e.prototype.autoRun=function(){this.isAuto||(this.isAuto=!0,EnterFrameManager.instance.registeRender(this.run,this))},e.prototype.unAutoRun=function(){this.isAuto&&(this.isAuto=!1,EnterFrameManager.instance.unRegisteRender(this.run,this))},e.prototype.dispose=function(){this.unAutoRun(),GObj.disposeObject(this.partCont),this.partCont=null,GObj.disposeObject(this.part),this.part=null,this.actOverBack=null,this.actOverThis=null},e}(egret.DisplayObjectContainer);t.IAvatarView=i,__reflect(i.prototype,"miniGame.IAvatarView")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.scaleZ=1,t}return __extends(e,i),e.prototype.setAngle=function(t){this._isMove&&t!=this.angle&&(this.angle=t,this.speedx=this.speed*GMath.cos(t),this.speedy=this.speed*GMath.sin(t))},e.prototype.getAngle=function(){return null!=this.angle?this.angle:90},e.prototype.move=function(){this._isMove&&(this.x+=this.speedx*this.scaleZ||0,this.y+=this.speedy*this.scaleZ||0)},e.prototype.run=function(){i.prototype.run.call(this),this.move(),this.shadowMove()},e.prototype.died=function(){this._isDie=!0,this._isMove=!1},e.prototype.isDie=function(){return this._isDie},e.prototype.setSpeed=function(t){this.speed=t},e.prototype.speedX=function(){return this.speedx||0},e.prototype.speedY=function(){return this.speedy||0},e.prototype.setMoveArea=function(t,i,e,s){},e.prototype.getShadow=function(){return this.shadow||(this.shadow=GObj.create(t.IShadow),this.shadow.setOutSrc("shadow",FileConst.png,"chapter")),this.shadow.setTarget(this,this.shadowScal||1,this.shadowGap||10),this.shadow},e.prototype.shadowMove=function(){this.shadow&&this.shadow.move()},e.prototype.removeMe=function(){i.prototype.removeMe.call(this),this.shadow&&this.shadow.removeMe()},e.prototype.dispose=function(){this._isDie=!0,GObj.disposeObject(this.shadow),this.shadow=null,i.prototype.dispose.call(this)},e}(t.IAvatarView);t.IAvatarViewCtr=i,__reflect(i.prototype,"miniGame.IAvatarViewCtr")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.touchChildren=!1,t.touchEnabled=!1,t._effectCount=0,t._startTime=0,t.layer=GObj.create(egret.DisplayObjectContainer),t.addChild(t.layer),t.bitMap=GObj.create(egret.Bitmap),t.layer.addChild(t.bitMap),t}return __extends(e,i),e.prototype.setCompleteBack=function(t,i){this.showBack=t,this.showThis=i},e.prototype.setLoadCompleteBack=function(t,i){this.loadBack=t,this.loadThis=i},e.prototype.start=function(t,i,e,s,h){void 0===i&&(i=0),void 0===e&&(e=100),t&&(this._playInterval=!e||0>=e?100:e,this.isLoop=!(i>0),this.loop=i,this.isOver=!1,this.frame=-1,this.dir=h?h:AvatarConsts.B_B,this.startLoad((s?s+"effect/":IMiniGameConfig.effectPath)+t))},e.prototype.stop=function(){this.bitMap&&(this.bitMap.texture=null),this.isRun=!1,this.isOver=!0,this.unAutoRun()},e.prototype.stopOne=function(){this.isLoop=!1,this.loop=0},e.prototype.startLoad=function(i){this._key&&t.IMiniGameMgr.ins.destoryMovieByKey(this._key),this._key=i,this._effectCount=0,this.rotation=0,t.IMiniGameMgr.ins.getMovie(this._key,this.loadComplete,this)},e.prototype.loadComplete=function(t){if(this.isDestory)return void this.dispose();if(t&&this._key==t.key){var i=t.getBySkillByDir(this.dir);if(!i)return void GObj.disposeObject(this);this._effect=i.items[0];var e=this._effect;if(!e)return void GObj.disposeObject(this);if(this._effectCount=e.length,this._effectCount<=0)return void GObj.disposeObject(this);this._playInterval=t.ftime||this._playInterval,this.isRun=!0,this._startTime=$GApp.timer,e.bm?this.layer.blendMode=e.bm:this.layer.blendMode=egret.BlendMode.NORMAL,this.layer.rotation=this._effect.angle||0,this.layer.scaleX=this._effect.sx||1,this.layer.scaleY=this._effect.sy||1,this.layer.alpha=this._effect.alpha||1,this.layer.x=this._effect.x,this.layer.y=this._effect.y}this.loadBack&&this.loadBack.call(this.loadThis)},e.prototype.showComplete=function(){this.isLoop||--this.loop<=0&&(this.isLast||(this.bitMap.texture=null),this.isRun=!1,this.isOver=!0,this.unAutoRun()),this.showBack&&this.showBack.call(this.showThis)},e.prototype.run=function(){if(this.isRun&&this._effectCount>0&&this.parent){var t=this._effect;if(t){var i=Math.floor(($GApp.timer-this._startTime)/this._playInterval)%this._effectCount;if(i==this.frame)return;this.frame=i;var e=t.ttfs[i];this.bitMap.texture=e.ttr,this.bitMap.x=e.offX,this.bitMap.y=e.offY,i==t.ttfs.length-1&&this.showComplete()}}},e.prototype.autoRun=function(){this.isAuto||(this.isAuto=!0,EnterFrameManager.instance.registeEnterFrame2(this.run,this))},e.prototype.unAutoRun=function(){this.isAuto&&(this.isAuto=!1,EnterFrameManager.instance.unRegisteEnterFrame2(this.run,this))},e.prototype.removeMe=function(){this.parent&&this.parent.removeChild(this),this.stop()},e.prototype.dispose=function(){this.isDestory||(this.isDestory=!0,egret.Tween.removeTweens(this),this.unAutoRun(),t.IMiniGameMgr.ins.destoryMovieByKey(this._key),GObj.disposeObject(this.bitMap),this.bitMap=null,GObj.disposeObject(this.layer),this.layer=null,this.showBack=null,this.showThis=null,this.loadBack=null,this.loadThis=null)},e}(egret.DisplayObjectContainer);t.IMovie=i,__reflect(i.prototype,"miniGame.IMovie")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.second=0,DispatcherManager.addListener(IMiniGameEvent.IMiniGameResultBack,t.onResultBack,t),t}return __extends(e,i),e.prototype.initSkins=function(){},e.prototype.setData=function(t){for(var i=[],e=1;e<arguments.length;e++)i[e-1]=arguments[e]},e.prototype.onCloseClick=function(t){IMiniGameMain.curMiniGame.gameData.backMain?DispatcherManager.dispatch(IMiniGameEvent.IMiniCloseTools):this.parent&&(this.second=0,DispatcherManager.removeListener(HGEvent.HEARTBEAT,this.heartbeat,this),this.cueImg&&(egret.Tween.removeTweens(this.cueImg),GObj.disposeObject(this.cueImg),this.cueImg=null),this.parent.removeChild(this),DispatcherManager.dispatch(IMiniGameEvent.IMiniGameExit,null!=t))},e.prototype.outCloseClick=function(t){this.onCloseClick(t)},e.prototype.onResultBack=function(t){return 3==t?void IMiniGameMain.curMiniGame.getGameView():2==t?(this.onCloseClick(!0),void DispatcherManager.dispatch(IMiniGameEvent.IMiniCloseTools)):4==t?void this.onCloseClick(!0):void this.onCloseClick()},e.prototype.createCue=function(){var i=this;this.cueImg||(this.cueImg=GObj.create(t.ImageOutside),this.cueImg.touchEnabled=!1,this.addChild(this.cueImg)),this.cueImg&&!this.cueImg.visible&&(this.visible=!0),this.exitBtn.width>0?this.setCuePos():this.exitBtn.iconDisplay.loadCompleteCall(function(){i.setCuePos()},this)},e.prototype.startHeartbeat=function(){var t=IMiniGameMain.curMiniGame.gameData;t.gameCue&&DispatcherManager.addListener(HGEvent.HEARTBEAT,this.heartbeat,this)},e.prototype.heartbeat=function(){this.second++,this.second>=IMiniGameMain.curMiniGame.gameData.gameCue&&(DispatcherManager.removeListener(HGEvent.HEARTBEAT,this.heartbeat,this),this.second=0,this.createCue())},e.prototype.setCuePos=function(){var t,i=this,e=this.exitBtn.left<250||this.exitBtn.horizontalCenter<0||this.exitBtn.right>250||this.exitBtn.x>0&&this.exitBtn.x<250;IMiniGameMain.curMiniGame.configData.showChapter?(t=e?"chapter/left":"chapter/right",this.cueImg.setOutSrc(t)):(t=e?"left":"right",this.cueImg.setOutSrc(t,FileConst.png,"chapter")),egret.Tween.removeTweens(this.cueImg),this.cueImg.touchEnabled=!1,this.cueImg.width>0?(this.cueImg.anchorOffsetY=this.cueImg.height/2,this.setCuePos2()):this.cueImg.loadCompleteCall(function(){i.cueImg.anchorOffsetY=i.cueImg.height/2,i.setCuePos2()},this)},e.prototype.setCuePos2=function(){var t=this.exitBtn.left<250||this.exitBtn.horizontalCenter<0||this.exitBtn.right>250||this.exitBtn.x>0&&this.exitBtn.x<250;this.exitBtn.right>=0?(this.cueImg.right=this.exitBtn.right+this.exitBtn.width+10,egret.Tween.get(this.cueImg,{loop:!0}).to({right:this.cueImg.right-15},500).to({right:this.cueImg.right},500)):this.exitBtn.left>=0?(this.cueImg.left=this.exitBtn.left+this.exitBtn.width+10,egret.Tween.get(this.cueImg,{loop:!0}).to({left:this.cueImg.left+15},500).to({left:this.cueImg.left},500)):this.exitBtn.horizontalCenter?(this.cueImg.horizontalCenter=t?this.exitBtn.horizontalCenter+this.exitBtn.width/2+10+this.cueImg.width/2:this.exitBtn.horizontalCenter-this.exitBtn.width/2-this.cueImg.width/2-10,egret.Tween.get(this.cueImg,{loop:!0}).to({horizontalCenter:this.cueImg.horizontalCenter+15},500).to({horizontalCenter:this.cueImg.horizontalCenter},500)):(this.cueImg.x=t?this.exitBtn.x+this.exitBtn.width+10:this.exitBtn.x- -this.cueImg.width,egret.Tween.get(this.cueImg,{loop:!0}).to({x:this.cueImg.x-15},500).to({x:this.cueImg.x},500)),this.exitBtn.bottom>=0?this.cueImg.y=this.cueImg.parent.height-this.exitBtn.bottom-this.exitBtn.height/2:this.exitBtn.top>=0?this.cueImg.y=this.exitBtn.top+this.exitBtn.height/2:this.cueImg.y=this.exitBtn.y+this.exitBtn.height/2,this.cueImg.visible=this.exitBtn.visible},e.prototype.dispose=function(){this.second=0,this.cueImg&&(egret.Tween.removeTweens(this.cueImg),GObj.disposeObject(this.cueImg),this.cueImg=null),DispatcherManager.removeListener(HGEvent.HEARTBEAT,this.heartbeat,this),DispatcherManager.removeListener(IMiniGameEvent.IMiniGameResultBack,this.onResultBack,this)},e}(eui.Component);t.IBaseView=i,__reflect(i.prototype,"miniGame.IBaseView")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.skinName=t.getSkin(),t}return __extends(e,i),e.prototype.getSkin=function(){var i=this,e=GObj.create(eui.Skin);e.skinParts=["mcDisplay"];var s=GObj.create(t.ImageOutside);s.touchEnabled=!1,s.loadCompleteCall(function(){i.width=i.iconDisplay.iconWidth,i.height=i.iconDisplay.iconHeight},this),s.horizontalCenter=0,s.verticalCenter=0,this.iconDisplay=s;var h=GObj.create(eui.Label);return h.touchEnabled=!1,h.horizontalCenter=0,h.verticalCenter=0,h.size=24,h.textColor=2054448,h.text="",this.labelDisplay=h,e.icon=s,e.label=h,e.elementsContent=[s],e.states=[new eui.State("up",[]),new eui.State("down",[new eui.SetProperty("label","scaleX",.92),new eui.SetProperty("label","scaleY",.92),new eui.SetProperty("icon","scaleX",.92),new eui.SetProperty("icon","scaleY",.92)]),new eui.State("disabled",[])],e},Object.defineProperty(e.prototype,"label",{set:function(t){this.labelDisplay&&(this.labelDisplay.parent||this.addChild(this.labelDisplay),this.labelDisplay.text=t,this.labelDisplay.size=[0,0,0,0,0,22,18,14,12][t.length]||22)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"icon",{set:function(t){this.iconDisplay&&(this.iconDisplay.source=t)},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){GObj.disposeObject(this.iconDisplay),this.iconDisplay=null,GObj.disposeObject(this.labelDisplay),this.labelDisplay=null},e}(eui.Button);t.IBaseBtn=i,__reflect(i.prototype,"miniGame.IBaseBtn")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(t){function i(){return t.call(this)||this}return __extends(i,t),i.prototype.run=function(){this.isStop||(t.prototype.run.call(this),this._times>0&&this._actionOver&&0==this.part.frame&&(this._actionOver=!1))},i.prototype.actionOver=function(i){t.prototype.actionOver.call(this,i),i==AvatarConsts.ACTION_DIE&&(this.isStop=!0,this.part.setFrame(this.part.frameSize-1)),this._times>0&&0==--this._times&&this.setAction(this._backAct)},i.prototype.setAction=function(i,e,s){t.prototype.setAction.call(this,i),this.isStop=!1,this._times=e||0,this._backAct=s||AvatarConsts.ACTION_STAND},i.prototype.dispose=function(){t.prototype.dispose.call(this)},i}(t.IAvatarViewCtr);t.IAvatarViewExt=i,__reflect(i.prototype,"miniGame.IAvatarViewExt")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.touchEnabled=!1,t.touchChildren=!1,t.exact=!0,t.maps={},t.file="bitmap",t._path=IMiniGameMain.getCommonPath(),t.setLayout(),t}return __extends(e,i),Object.defineProperty(e.prototype,"key",{get:function(){return this._key},set:function(t){this._key=t,this.setFileAndBitName()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"file",{get:function(){return this._file},set:function(t){this._file=t,this.setFileAndBitName()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"gap",{get:function(){return this._gap},set:function(t){this._gap=t,this.setGap(t)},enumerable:!0,configurable:!0}),e.prototype.setLayout=function(){this.layout||(this.layout=GObj.create(eui.HorizontalLayout),this.layout.verticalAlign=egret.VerticalAlign.MIDDLE)},e.prototype.setPath=function(t){this._key=t,this.setFileAndBitName()},e.prototype.setLoadPath=function(t){this._path=t||IMiniGameMain.getCommonPath()},e.prototype.setFileAndBitName=function(){this._key&&this._file&&t.IMiniGameMgr.ins.loadSheet(this._path+this._file,this.loadSuccess,this)},e.prototype.loadSuccess=function(){this.updateView()},e.prototype.setGap=function(t){this._gap=t,this.layout.gap=t},e.prototype.removeMe=function(){this.parent&&this.parent.removeChild(this)},e.prototype.setString=function(t){this.curNum=t,this.updateView()},e.prototype.setNumber=function(t,i,e){return void 0===i&&(i=0),void 0===e&&(e=1),this.curNum=this.targetNum||0,this.targetNum=t,i>0&&this.curNum>0?(this.changeGap=GApp.timer,egret.Tween.removeTweens(this),this.scaleY=1,void egret.Tween.get(this,{onChange:this.setNumberMove,onChangeObj:this}).to({curNum:t,scaleY:e},i).to({scaleY:1},90).call(this.setNumberMove)):(this.curNum=t,void this.updateView())},e.prototype.setNumberMove=function(t){GApp.timer-this.changeGap>60&&(this.changeGap=GApp.timer,this.updateView())},e.prototype.updateView=function(){if(t.IMiniGameMgr.ins.checkSheets(this._path+this.file)){this.removeChildren();var i=this.curNum;"string"!=typeof i&&(i=Math.floor(+this.curNum).toString());for(var e,s=i.length,h=0;s>h;h++)e=this.getImgByIdx(h),e.texture=t.IMiniGameMgr.ins.getImageByKey(this._path+this.file,this.key+"_"+i[h]+"_png"),this.addChild(e)}},e.prototype.getImgByIdx=function(t){var i=this.maps[t];return i||(i=GObj.create(eui.Image),this.maps[t]=i),i},e.prototype.dispose=function(){egret.Tween.removeTweens(this);for(var t in this.maps)this.maps[t]&&(this.maps[t].texture=null),GObj.disposeObject(this.maps[t]),delete this.maps[t];this.maps=null},e}(eui.Group);t.IBitNumMap=i,__reflect(i.prototype,"miniGame.IBitNumMap")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(t){function i(){return t.call(this)||this}return __extends(i,t),i.prototype.setOutSrc=function(t,i,e){void 0===i&&(i=FileConst.png),t&&(t=IMiniGameMain.getIcon(t,i,e)),this.source=t},Object.defineProperty(i.prototype,"source",{get:function(){return this._src},set:function(t){this.$setSource(t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"icon",{get:function(){return this._src},set:function(t){this.$setSource(t)},enumerable:!0,configurable:!0}),i.prototype.$setSource=function(t){return this._src==t?void(this._fun&&this._fun.call(this._thisObj)):(this._src&&typeof this._src==GConst.TOF_STR&&GApp.iconCache.clearIcon(this._src,this.iconCompleteHandler,this),this._source=null,this._src=t,this.texture=null,void(t&&(typeof t==GConst.TOF_STR?t.indexOf(PATH.res)>-1?GApp.iconCache.getIcon(t,this.iconCompleteHandler,this):(this._source=t,this.$stage?this.parseSource():(this.sourceChanged=!0,this.invalidateProperties())):this.$setTexture(t))))},Object.defineProperty(i.prototype,"iconTexture",{get:function(){return this.texture},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"iconWidth",{get:function(){return this.texture?this.texture.textureWidth:0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"iconHeight",{get:function(){return this.texture?this.texture.textureHeight:0},enumerable:!0,configurable:!0}),i.prototype.iconCompleteHandler=function(t,i){this._src==i&&(this.texture=t,this.loadOver(),this._fun&&(this._arg?this._fun.call(this._thisObj,this._arg):this._fun.call(this._thisObj)))},i.prototype.loadOver=function(){},i.prototype.loadCompleteCall=function(t,i,e){this._fun=t,this._thisObj=i,this._arg=e},i.prototype.removeMe=function(){this.parent&&this.parent.removeChild(this)},i.prototype.dispose=function(){this._src&&typeof this._src==GConst.TOF_STR&&GApp.iconCache.clearIcon(this._src,this.iconCompleteHandler,this),this._fun=null,this._thisObj=null,this._arg=null,this._src=null,this.texture=null,this.parent&&this.parent.removeChild(this),this.$parent=null},i}(eui.Image);t.ImageOutside=i,__reflect(i.prototype,"miniGame.ImageOutside")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(){function i(t){this.gameData=t,this.updateFunny(this.gameData.funny),this.addEvent(),IMiniGameMain.getConfig("game"+IMiniGameMain.curMiniGameType,this.loadConfigComplete,this)}return i.prototype.getChapterView=function(){return this.chapterView||(this.chapterView=GObj.create(t.IMiniGameChapter)),this.chapterView},i.prototype.getGameView=function(){},i.prototype.getCurGameData=function(t,i){if(t||(t=this.gameData.chapter),i||(i=this.gameData.section),this.configData&&this.configData.chapters){for(var e=0,s=this.configData.chapters;e<s.length;e++){var h=s[e];if(h.chapterId==t){for(var a=0,n=h.stages;a<n.length;a++){var o=n[a];if(o.stageId==i)return o}break}}return this.gameData.chapter=1,this.gameData.section=1,this.configData.chapters[0].stages[0]}return null},i.prototype.getMiniGameView=function(){if(!this.configData)return null;if(this.configData.showChapter)return this.getChapterView(),this.chapterView.setData(this.gameData,this.configData.chapters),this.chapterView;if(this.gameData&&this.gameData.funny){var t=this.gameData.funny.bagList[0];if(t&&2==t.status)return App.msgtip.show(IMiniGameLanguage.c_8),null}return this.gameView||this.getGameView(),this.gameView},i.prototype.loadConfigComplete=function(t){this.configData=t,this.readSkins=t.readSkins||0,DispatcherManager.dispatch(IMiniGameEvent.IMiniGameLoaded,{kind:IMiniGameMain.curMiniGameType,result:IMiniGameResultType.type_3})},i.prototype.addEvent=function(){DispatcherManager.addListener(IMiniGameEvent.IMiniGameExit,this.onExitBtnClick,this),DispatcherManager.addListener(IMiniGameEvent.IMiniGameChapterExit,this.onChapterExitBtnClick,this),DispatcherManager.addListener(IMiniGameEvent.IMiniCloseTools,this.closeGame,this)},i.prototype.removeEvent=function(){DispatcherManager.removeListener(IMiniGameEvent.IMiniGameExit,this.onExitBtnClick,this),DispatcherManager.removeListener(IMiniGameEvent.IMiniGameChapterExit,this.onChapterExitBtnClick,this),DispatcherManager.removeListener(IMiniGameEvent.IMiniCloseTools,this.closeGame,this)},i.prototype.onExitBtnClick=function(t){if(!this.configData.showChapter&&this.gameData.funny){var i=this.gameData.funny.bagList[0];if(t){if(i&&-1==i.conditionList[0].p6)return void DispatcherManager.dispatch(IMiniGameEvent.IMiniCloseTools)}else i&&2!=i.status&&IMiniGameMain.reqSocket(4,i.id)}var e=IMiniGameResultType.type_4;e=t?IMiniGameResultType.type_2:this.gameData.isMust?IMiniGameResultType.type_4:IMiniGameResultType.type_1,DispatcherManager.dispatch(IMiniGameEvent.IMiniGameOver,{kind:IMiniGameMain.curMiniGameType,result:e,funny:this.gameData.funny}),t&&!this.configData.showChapter&&this.onChapterExitBtnClick()},i.prototype.onChapterExitBtnClick=function(){DispatcherManager.dispatch(IMiniGameEvent.IMiniGameOver,{kind:IMiniGameMain.curMiniGameType,result:IMiniGameResultType.type_2}),this.closeGame()},i.prototype.updateFunny=function(t){if(this.gameData&&(this.gameData.funny=t,usable(t.backname)))try{var i=JSON.parse(t.backname);i.backGame&&(this.gameData.backGame=i.backGame)}catch(e){console.error("IMiniGameBaseCtr updateFunny error!",e)}},i.prototype.closeGame=function(){IMiniGameMain.closeMiniGame()},i.prototype.dispose=function(){this.removeEvent(),IMiniGameMain.destoryConfig("game"+IMiniGameMain.curMiniGameType),GObj.disposeObject(this.gameView),this.gameView=null,GObj.disposeObject(this.chapterView),this.chapterView=null,this.gameData=null,this.configData=null,this.readSkins=null},i}();t.IMiniGameBaseCtr=i,__reflect(i.prototype,"miniGame.IMiniGameBaseCtr")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){return i.call(this)||this}return __extends(e,i),e.prototype.initSkins=function(){this.isInit||(this.isInit=!0,this.width=StageManager.stageWidth,this.height=StageManager.stageHeight,this.reSet(),this.pools={},this.sceneIn={},this.bgImgs=[],this.scaleFrame=.01,this.touchEnabled=!1,this.mapGrp=GObj.create(egret.DisplayObjectContainer),this.mapGrp.touchEnabled=!1,this.mapGrp.touchChildren=!1,this.addChild(this.mapGrp),this.bgGrp=GObj.create(egret.DisplayObjectContainer),this.bgGrp.touchEnabled=!1,this.bgGrp.touchChildren=!1,this.mapGrp.addChild(this.bgGrp),this.natureInfo=GObj.create(eui.Label),this.natureInfo.x=30,this.natureInfo.lineSpacing=5,this.natureInfo.visible=!1,this.natureInfo.touchEnabled=!1,this.addChild(this.natureInfo),this.addEvent())},e.prototype.reSet=function(){this.sysFrame=0,this.scaleVal=1,this.lastTime=GApp.timer,this.stopGap=this.lastTime,this.setOneFrame()},e.prototype.setOneFrame=function(t){this.oneFrame=t||Math.floor(1e3/IMiniGameMain.sysFrame()),this.oneFrame-=1},e.prototype.loadMapImg=function(i,e){var s=StageManager.stageWidth,h=StageManager.stageHeight;this.mapGrp.width=Math.max(e[0],s),this.mapGrp.height=Math.max(e[1],h);var a=e[2],n=e[3];this.horLoop=!!e[4],this.verLoop=!!e[5],this.imgW=e[0]/a,this.imgH=e[1]/n;var o=!!e[6],r=a,l=n;s+2*this.imgW>e[0]&&(r=a*(Math.floor((s+2*this.imgW)/e[0])+1)),h+2*this.imgH>e[1]&&(l=n*(Math.floor((h+2*this.imgH)/e[1])+1)),this.bgSmall||(this.bgSmall=GObj.create(t.ImageOutside),this.bgGrp.addChild(this.bgSmall)),this.bgSmall.width=e[0],this.bgSmall.height=e[1],this.bgSmall.setOutSrc("map"+i+"/small",FileConst.jpg);for(var p,c=0;l>c;c++)for(var u=0;r>u;u++)this.bgImgs[c]||(this.bgImgs[c]=[]),p=this.bgImgs[c][u],p||(p=GObj.create(t.ImageOutside),p.visible=!1,this.bgImgs[c][u]=p,this.bgGrp.addChild(p)),o?p.setOutSrc("map"+i+"/0_0",FileConst.jpg):p.setOutSrc("map"+i+"/"+c%n+"_"+u%a,FileConst.jpg),p.x=this.imgW*u,p.y=this.imgH*c;this.sideIdx=[0,0,r-1,l-1],this.minScale=Math.max((this.width+2*this.imgW)/this.mapGrp.width,(this.height+2*this.imgH)/this.mapGrp.height),this.minScale=+this.minScale.toFixed(2)},e.prototype.addEvent=function(){EnterFrameManager.instance.registeRender(this.checkRun,this)},e.prototype.removeEvent=function(){EnterFrameManager.instance.unRegisteRender(this.checkRun,this)},e.prototype.start=function(){this.isRunning=!0,this.isTime=!0,this.lastTime=GApp.timer-this.stopGap},e.prototype.stop=function(){this.stopGap=GApp.timer-this.lastTime,this.isRunning=!1,this.isTime=!1},e.prototype.checkRun=function(){return this.isTime&&(this.sysFrame++,this.isRunning)?(this.run(),this.checkNature(),this.scaleXYRun(),!1):void 0},e.prototype.run=function(){},e.prototype.checkNature=function(){if(GApp.timer<this.lastTime+1e3)return!1;var t=IMiniGameMain.sysFrame(),i=Math.min(t,this.sysFrame),e=GApp.timer-this.lastTime;return this.lastTime=GApp.timer,this.frameRate=Math.round(1e3*i/e),this.natureInfo.text="设备fps："+this.sysFrame+"\n运行fps:"+this.frameRate,this.natureInfo.y=this.height-this.natureInfo.height-10,this.sysFrame=0,!0},e.prototype.setCamera=function(){var t=this.cameraFollow,i=this.width,e=this.height,s=this.mapGrp.width,h=this.mapGrp.height,a=t.x-i/2,n=t.y-e/2;this.horLoop||(0>a?a=0:a>s-i&&(a=s-i)),this.verLoop||(n<IMiniGameMain.safeHeight?n=IMiniGameMain.safeHeight:n>h-e&&(n=h-e));var o=t.x,r=t.y;this.mapGrp.anchorOffsetX=o,this.mapGrp.anchorOffsetY=r,this.mapGrp.x=-a+o,this.mapGrp.y=-n+r,this.cameraX=a,this.cameraY=n,this.setLoopMap();for(var l,p=2*this.imgW,c=2*this.imgH,u=this.bgImgs.length,d=this.bgImgs[0].length,m=0;u>m;m++)for(var g=0;d>g;g++)l=this.bgImgs[m][g],l.visible=this.showAll||l.x>a-p&&l.x<a+i+this.imgW&&l.y>n-c&&l.y<n+e+this.imgH},e.prototype.setLoopMap=function(){var t,i=this.bgImgs,e=this.sideIdx[0],s=this.sideIdx[1],h=i[s][e],a=this.sideIdx[2],n=this.sideIdx[3],o=i[n][a];if(this.horLoop){if(this.cameraX<h.x+this.imgW){e-=1,0>e&&(e=i[s].length-1),this.sideIdx[0]=e;for(var r=0;r<i.length;r++)t=i[r][e],t.x=h.x-this.imgW}if(this.cameraX+this.width>o.x){a+=1,a>i[n].length-1&&(a=0),this.sideIdx[2]=a;for(var r=0;r<i.length;r++)t=i[r][a],t.x=o.x+this.imgW}}if(this.verLoop){if(this.cameraY<h.y+this.imgH){s-=1,0>s&&(s=i.length-1),this.sideIdx[1]=s;for(var r=0;r<i[s].length;r++)t=i[s][r],t.y=h.y-this.imgH}if(this.cameraY+this.height>o.y){n+=1,n>i.length-1&&(n=0),this.sideIdx[3]=n;for(var r=0;r<i[n].length;r++)t=i[n][r],t.y=o.y+this.imgH}}},e.prototype.setMoveArea=function(t){t.setMoveArea(this.horLoop?-(1/0):.1*this.width,this.verLoop?-(1/0):.1*this.height,this.horLoop?1/0:this.mapGrp.width,this.verLoop?1/0:this.mapGrp.height)},e.prototype.setScale=function(t){this.scaleVal!=t&&(t<this.minScale&&(t=this.minScale),this.scaleVal!=t&&(this.scaleVal=t,this.setCamera()))},e.prototype.scaleXYRun=function(){var t=Math.abs(this.scaleVal-this.mapGrp.scaleX);if(t<this.scaleFrame)return this.mapGrp.scaleX=this.scaleVal,void(this.mapGrp.scaleY=this.scaleVal);var i=this.scaleVal-this.mapGrp.scaleX,e=i/Math.abs(i);this.mapGrp.scaleX+=this.scaleFrame*e,this.mapGrp.scaleY=this.mapGrp.scaleX,this.showAll=this.mapGrp.scaleX<1},e.prototype.showOrHide=function(t){var i=this.width,e=this.height,s=t.width*t.scaleX,h=t.height*t.scaleY;t.visible=this.showAll||t.x>this.cameraX-s&&t.x<this.cameraX+i+s&&t.y>this.cameraY-h&&t.y<this.cameraY+e+h},e.prototype.getPoolByClass=function(t,i){var e=egret.getQualifiedClassName(t),s=this.pools[e]||[],h=s.pop()||GObj.create(t,i);return h},e.prototype.backPoolByObject=function(t){var i=egret.getQualifiedClassName(t),e=this.pools[i]||[];e.push(t),this.pools[i]=e},e.prototype.destoryPool=function(){if(this.pools){var t,i;for(var e in this.pools)if(t=this.pools[e]){for(;t.length>0;)i=t.pop(),GObj.disposeObject(i),i=null;t=null,delete this.pools[e]}this.pools={}}},e.prototype.getSceneInByClass=function(t,i){return!i&&(i=egret.getQualifiedClassName(t)),this.sceneIn[i]||[]},e.prototype.pushSceneInByObject=function(t,i){!i&&(i=egret.getQualifiedClassName(t));var e=this.sceneIn[i]||[];e.push(t),this.sceneIn[i]=e},e.prototype.backPoolAllObject=function(){if(this.sceneIn){var t,i;for(var e in this.sceneIn)if(t=this.sceneIn[e]){for(;t.length>0;)i=t.pop(),i&&(i.removeMe&&i.removeMe(),i.parent&&i.parent.removeChild(i),this.backPoolByObject(i));t=null,delete this.sceneIn[e]}this.sceneIn={}}},e.prototype.dispose=function(){if(!this.isDestory){this.isDestory=!0,GObj.disposeObject(this.mapGrp),this.mapGrp=null,GObj.disposeObject(this.bgGrp),this.bgGrp=null,GObj.disposeObject(this.bgSmall),this.bgSmall=null,GObj.disposeObject(this.rocker),this.rocker=null,GObj.disposeObject(this.natureInfo),this.natureInfo=null;for(var t=0,i=this.bgImgs;t<i.length;t++)for(var e=i[t],s=0,h=e;s<h.length;s++){var a=h[s];GObj.disposeObject(a)}this.backPoolAllObject(),this.destoryPool(),this.pools=null,this.sceneIn=null,this.sideIdx=null,this.bgImgs=null,this.cameraFollow=null}},e}(egret.DisplayObjectContainer);t.IMiniGameSecne=i,__reflect(i.prototype,"miniGame.IMiniGameSecne")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.touchEnabled=!1,t.touchChildren=!1,t._effectCount=0,t.startTime=0,t.layers=[],t.bitMaps=[],t}return __extends(e,i),e.prototype.setCompleteBack=function(t,i){this.callBack=t,this.thisObj=i},e.prototype.setLoadCompleteBack=function(t,i){this.loadBack=t,this.loadThis=i},e.prototype.start=function(t,i,e,s){void 0===i&&(i=0),void 0===e&&(e=100),this._playInterval=!e||0>=e?100:e,this.isLoop=!(i>0),this.loop=i,this.isOver=!1,this.isCompleteOne=!1,this.startLoad((s?s+"effect/":IMiniGameConfig.effectPath)+t)},e.prototype.stop=function(){if(this.bitMaps)for(var t=0,i=this.bitMaps;t<i.length;t++){var e=i[t];e.parent&&e.parent.removeChild(e)}this.isRun=!1,this.isOver=!0,this.oldKey=null,this.unAutoRun()},e.prototype.startLoad=function(i){this._key&&t.IMiniGameMgr.ins.destoryMovieByKey(this._key),this._effectCount=0,this.rotation=0,this._key=i,this.startLoop=!1,this.oldKey=null,t.IMiniGameMgr.ins.getMovie(this._key,this.loadComplete,this)},e.prototype.loadComplete=function(t){if(t&&this._key==t.key){if(this.oldKey!=t.key){this.oldKey=t.key;
var i=t.getBySkillByDir(AvatarConsts.B_B);if(!i)return void GObj.disposeObject(this);if(this._effect=i.items,!this._effect)return void GObj.disposeObject(this);if(this._effectCount=this._effect.length,this._effectCount<=0)return void GObj.disposeObject(this);this._playInterval=t.ftime||this._playInterval,this.startTime=$GApp.timer;for(var e,s,h,a=0;a<this._effectCount;a++)e=this.layers[a],e||(e=GObj.create(egret.DisplayObjectContainer)),s=this._effect[a],s.bm?e.blendMode=s.bm:e.blendMode=egret.BlendMode.NORMAL,e.rotation=s.angle||0,e.scaleX=s.sx||1,e.scaleY=s.sy||1,e.alpha=s.alpha||1,e.x=s.x,e.y=s.y,this.layers[a]=e,this.addChild(e),h=this.bitMaps[a],h||(h=GObj.create(egret.Bitmap)),e.addChild(h),this.bitMaps[a]=h}this.loadBack&&this.loadBack.call(this.loadBack,this.loadThis),this.isRun=!0,this.visible=!0}},e.prototype.showComplete=function(){if(!this.isLoop)if(--this.loop<=0){if(!this.isLast&&this.bitMaps)for(var t=0,i=this.bitMaps;t<i.length;t++){var e=i[t];e.texture=null}this.isRun=!1,this.isOver=!0,this.unAutoRun()}else this.startTime=$GApp.timer,this.isCompleteOne=!0;this.callBack&&this.callBack.call(this.thisObj)},e.prototype.run=function(){this.isRun&&this.update()},e.prototype.update=function(){if(!(this._effectCount<=0)){if(this.isCompleteOne){if(this.bitMaps&&this.bitMaps.length>1)for(var t=0,i=this.bitMaps;t<i.length;t++){var e=i[t];e.texture=null}this.isCompleteOne=!1}for(var s,h,a,n,o,r,l,p=1*($GApp.timer-this.startTime),c=this._effect.length,u=0,d=0;c>d;d++)if(a=this._effect[d],r=p-a.delay,!(0>r)){if(h=this.bitMaps[d],s=int(r/this._playInterval),a.time&&(n=this.layers[d])){var m=int(r%a.time/GConfig.FRAME_TIME);n.x=a.x+m*(a.movex||0),n.y=a.y+m*(a.movey||0)}l=a.length,(!this.isLoop||this.callBack)&&s>=l&&(!a.time||r>=a.time)&&(u++,this.loop<=1)?h.parent&&h.parent.removeChild(h):(o=a.ttfs[s%l],o&&(h.texture=o.ttr,h.x=o.offX,h.y=o.offY))}u>=c&&this.showComplete()}},e.prototype.autoRun=function(){this.isAuto||(this.isAuto=!0,EnterFrameManager.instance.registeRender(this.run,this))},e.prototype.unAutoRun=function(){this.isAuto&&(this.isAuto=!1,EnterFrameManager.instance.unRegisteRender(this.run,this))},e.prototype.removeMe=function(){this.parent&&this.parent.removeChild(this),this.unAutoRun()},e.prototype.dispose=function(){if(this.stop(),t.IMiniGameMgr.ins.destoryMovieByKey(this._key),this.bitMaps)for(var i=0,e=this.bitMaps;i<e.length;i++){var s=e[i];GObj.disposeObject(s)}if(this.layers)for(var h=0,a=this.layers;h<a.length;h++){var n=a[h];GObj.disposeObject(n)}this.bitMaps=null,this.layers=null,this.callBack=null,this.thisObj=null,this.loadBack=null,this.loadThis=null,this._key=null,this.oldKey=null},e}(egret.DisplayObjectContainer);t.IMovieMore=i,__reflect(i.prototype,"miniGame.IMovieMore")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(t){function i(){var i=t.call(this)||this;return i.initSkins(),i}return __extends(i,t),i.prototype.getIsCd=function(){return this.isCd},i.prototype.initSkins=function(){this.reset(),this.touchEnabled=!1,this.touchChildren=!1},i.prototype.getSkillType=function(){return this.skillType},i.prototype.setData=function(t){this.data=t,t&&(this.skillCd=1e3*t.skillCd)},i.prototype.run=function(){this.skillCd&&this.isCd&&(GApp.timer<this.lastTime+100||(this.lastTime=GApp.timer,this.cdTime+=100,this.cdTime>=this.skillCd&&this.cdFinish()))},i.prototype.enterCd=function(){this.isCd=!0},i.prototype.cdFinish=function(){this.isCd=!1,this.cdTime=0},i.prototype.getHitModel=function(){return this.data?this.data.hitmodel||"":""},i.prototype.setPlayer=function(t){},i.prototype.reset=function(){this.isCd=!1,this.skillCd=0,this.cdTime=0},i.prototype.dispose=function(){this.reset()},i}(eui.Component);t.IMiniGame10BaseSkill=i,__reflect(i.prototype,"miniGame.IMiniGame10BaseSkill")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(t){function i(){var i=t.call(this)||this;return i.showTrailing=!0,i.trailingType=3,i.point=GObj.create(egret.Point),i.point2=GObj.create(egret.Point),i.leng=35,i}return __extends(i,t),i.prototype.setData=function(t){t&&(this.reSet(),this.data=t,this.levelNum=this.data.idx,this.speed=this.data.fishSpeed||10,this.scaleX=this.scaleY=this.data.scaleXY,this.start(this.data.model,0),this.autoRun())},i.prototype.changeModel=function(t){this.start(t,0)},i.prototype.setSpeed=function(t){this.speed=t||3},i.prototype.getAngle=function(){return this.angle||0},i.prototype.reSet=function(){this.unAutoRun(),this.levelNum=null,this.data=null,this.angle=void 0,this.isRun=!1,this._isDie=!1,this._isMove=!1},i.prototype.initOver=function(){this.isRun=!0},i.prototype.run=function(){this.isRun&&t.prototype.run.call(this)},i.prototype.cancel=function(){this.isRun=!1,this._isMove=!1},i.prototype.isDie=function(){return this._isDie},i.prototype.setAngle=function(t){if(t!=this.angle){var i=this.speed||10;this.angle=Math.floor((t+360)%360),this.speedx=i*GMath.cos(t),this.speedy=i*GMath.sin(t),this.rotation=this.angle+90}},i.prototype.setMove=function(t){this._isMove!=t&&(this._isMove=t)},i.prototype.getMove=function(){return this._isMove},i.prototype.setDie=function(){this._isDie=!0,this.isRun=!1},i.prototype.setMoveArea=function(t,i,e,s){this.sx=t,this.sy=i,this.ex=e,this.ey=s},i.prototype.move=function(){this._isMove&&this.forceMove()},i.prototype.forceMove=function(){var t=this.x+(this.speedx||0),i=this.y+(this.speedy||0);t<this.sx?this.x=this.sx:t>this.ex?this.x=this.ex:this.x=t,i<this.sy?this.y=this.sy:i>this.ey?this.y=this.ey:this.y=i},i.prototype.getXYR=function(t){return this.parent&&this.parent.parent?(this.parent.localToGlobal(this.x,this.y,this.point),this.parent.parent.globalToLocal(this.point.x,this.point.y,this.point2),t||(t={}),t.angle=this.rotation+90,t.x=this.point2.x+this.height*GMath.cos(t.angle),t.y=this.point2.y+this.height*GMath.sin(t.angle),t):null},i.prototype.dispose=function(){this.reSet(),this.point=null,this.point2=null,t.prototype.dispose.call(this)},i}(t.IMovie);t.IMiniGame14Avatar=i,__reflect(i.prototype,"miniGame.IMiniGame14Avatar",["ITrailingVo","egret.DisplayObject"])}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(){function t(){}return t.prototype.init=function(){this.attUpHero={},this.attUpArms={},this.attSubBoss={},this.attSubEnemys={},this.pools={},this.arms={},this.skills={},this.equips={}},t.prototype.run=function(){},t.prototype.getOpenArmsArr=function(){var t=[];for(var i in this.arms)t.push(this.arms[i]);return t},t.prototype.getOpenSkillArr=function(){var t=[];for(var i in this.skills)t.push(this.skills[i]);return t},t.prototype.getOpenEquipArr=function(){var t=[];for(var i in this.equips)t.push(this.equips[i]);return t},t.prototype.getObjByClass=function(t,i){var e=egret.getQualifiedClassName(t),s=this.pools[e]||[],h=s.pop()||GObj.create(t,i);return h},t.prototype.backObjByClass=function(t){var i=egret.getQualifiedClassName(t),e=this.pools[i]||[];e.push(t),this.pools[i]=e},t.prototype.destoryPool=function(){var t,i;for(var e in this.pools)if(t=this.pools[e]){for(;t.length>0;)i=t.pop(),GObj.disposeObject(i),i=null;t=null,delete this.pools[e]}this.pools=null},t.prototype.upAddSub=function(t,i){for(var e in i)t[e]||(t[e]=0),t[e]+=i[e]},t.prototype.updateAtt=function(t,i){if(i.addBase){var e=t.level,s=t.addVal||{};for(var h in i.addBase)s[h]=i.addBase[h]+i.addPro[h]*e;t.addVal=s}},t.prototype.fixed2=function(t,i){return+t.toFixed(i||0)},t.prototype.addAttVal=function(t,i){switch(t){case 5:this.upAddSub(this.attUpHero,i);break;case 6:this.upAddSub(this.attUpArms,i);break;case 7:this.upAddSub(this.attUpHero,i),this.upAddSub(this.attUpArms,i);break;case 8:this.upAddSub(this.attSubBoss,i);break;case 9:this.upAddSub(this.attSubEnemys,i);break;case 10:this.upAddSub(this.attSubBoss,i),this.upAddSub(this.attSubEnemys,i)}},t.prototype.updateUpAtt=function(){for(var t in this.attUpArms)this.attUpArms[t]=0;for(t in this.attUpHero)this.attUpHero[t]=0;for(t in this.attSubBoss)this.attSubBoss[t]=0;for(t in this.attSubEnemys)this.attSubEnemys[t]=0;var i;for(t in this.skills)i=this.skills[t],this.addAttVal(i.kind,i.addVal);var e;for(t in this.equips)e=this.equips[t],this.addAttVal(e.kind,e.addVal);for(t in this.arms)this.updateArmsByobj(this.arms[t])},t.prototype.updateArmsByobj=function(t){var i;switch(t.kind){case 1:i=this.attUpHero;break;case 2:i=this.attSubBoss;break;case 3:i=this.attUpArms;break;case 4:i=this.attSubEnemys}var e=this.armsVo[t.id],s=t.level;t.atk=e.atk+e.atkPro*s,t.hp=e.hp+e.hpPro*s,t.speed=e.speed+e.speedPro*s,t.gold=e.gold+e.goldPro*s,e.cd>0&&(t.cd=e.cd+e.cdPro*s),t.atk*=1+(i.atk||0)/100,t.hp*=1+(i.hp||0)/100,t.speed*=1+(i.speed||0)/100,t.gold*=1+(i.gold||0)/100,t.cd*=1+(i.cd||0)/100,t.cd=Math.max(t.cd,this.minFrameGap),t.atk=this.fixed2(t.atk),t.hp=this.fixed2(t.hp),t.speed=this.fixed2(t.speed,3),t.gold=this.fixed2(t.gold),t.cd=this.fixed2(t.cd,3)},t.numToStr=function(t){},t.prototype.dispose=function(){if(this.arms){for(var t in this.arms)this.arms[t]=null;this.arms=null}if(this.skills){for(var t in this.skills)this.skills[t]=null;this.skills=null}if(this.equips){for(var t in this.equips)this.equips[t]=null;this.equips=null}this.destoryPool(),this.armsVo=null,this.skillsVo=null,this.equipsVo=null,this.attUpHero=null,this.attUpArms=null,this.attSubBoss=null,this.attSubEnemys=null},t}();t.IEndLessBase=i,__reflect(i.prototype,"miniGame.IEndLessBase")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(t){function i(){var i=t.call(this)||this;return i.backFrame=0,i}return __extends(i,t),i}(t.IAvatarViewCtr);t.IMiniGame17Avatar=i,__reflect(i.prototype,"miniGame.IMiniGame17Avatar")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.showHit=-1,t}return __extends(e,i),e.prototype.setSelected=function(){},e.prototype.setHit=function(t){this.hp-=t,this.updateBlood()||this.died()},e.prototype.updateBlood=function(){return this.hp<=0&&(this.hp=0,this.hpNum--,this.hpNum>0&&(this.hp=this.blood)),this.hp>0},e.prototype.hit=function(){this.addHitFliter()},e.prototype.addHitFliter=function(){if(t.IMiniGame19Consts.hitFilter>0){if(this.showHit>0)return void(this.showHit=t.IMiniGame19Consts.hitFilter);this.showHit=t.IMiniGame19Consts.hitFilter,this.filters=[IMiniGameMain.getRedFilter()]}},e.prototype.endHitFilter=function(){this.showHit<=0||--this.showHit<=0&&(this.filters=[])},e.prototype.run=function(){i.prototype.run.call(this),this.endHitFilter()},e.prototype.dispose=function(){i.prototype.dispose.call(this),this.filters=null},e}(t.IAvatarViewCtr);t.IMiniGame19Avatar=i,__reflect(i.prototype,"miniGame.IMiniGame19Avatar")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.showHit=-1,t.actPosY=0,t}return __extends(e,i),e.prototype.getActPosY=function(){return this.actPosY||(this.actPosY=this.partCont.height/2),this.actPosY},e.prototype.setSelected=function(){},e.prototype.setHit=function(t){var t=Math.min(t,this.hp);this.hp-=t,this.hp<=0&&(this.hp=0,this.died())},e.prototype.setScleaZ=function(t){this.z=this.y-t,this.updateZ()},e.prototype.updateZ=function(){if(!isNaN(this.z)){var t=this.z*(this.z<0?IMiniGameConfig.scaleZLess:IMiniGameConfig.scaleZLarge);this.scaleZ=1+t,this.scaleZ<0?this.scaleZ=.1:this.scaleZ>2&&(this.scaleZ=2),this.scaleX=this.scaleZ,this.scaleY=this.scaleZ}},e.prototype.hit=function(){this.isBoss&&this.addHitFliter()},e.prototype.addHitFliter=function(){if(t.IMiniGame4Consts.hitFilter>0){if(this.showHit>0)return void(this.showHit=t.IMiniGame4Consts.hitFilter);this.showHit=t.IMiniGame4Consts.hitFilter,this.filters=[IMiniGameMain.getRedFilter()]}},e.prototype.endHitFilter=function(){this.showHit<=0||--this.showHit<=0&&(this.filters=[])},e.prototype.run=function(){i.prototype.run.call(this),this.endHitFilter()},e.prototype.dispose=function(){i.prototype.dispose.call(this),this.filters=null},e}(t.IAvatarViewCtr);t.IMiniGame4Avatar=i,__reflect(i.prototype,"miniGame.IMiniGame4Avatar")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.initSkins(),t}return __extends(e,i),e.prototype.initSkins=function(){var i=this;this.touchEnabled=!1,this.touchChildren=!1,this.speed=t.IMiniGame6Consts.speed,this.weapons=[],this.weaponGrp=GObj.create(egret.DisplayObjectContainer),this.addChild(this.weaponGrp),this.body=GObj.create(t.ImageOutside),this.body.loadCompleteCall(function(){i.body.anchorOffsetX=i.body.iconWidth/2,i.body.anchorOffsetY=i.body.iconHeight/2},this),this.addChild(this.body),this.weapon=GObj.create(eui.Label),this.weapon.size=24,this.weapon.stroke=1,this.weapon.strokeColor=0,this.weapon.textAlign=egret.HorizontalAlign.CENTER,this.addChild(this.weapon),this.shield=GObj.create(t.IMiniGame6Shield),this.addChild(this.shield)},e.prototype.setData=function(i){i&&(this.reSet(),this.data=i,this.body.setOutSrc(i.model),this.maxWeapon=i.maxWeapon||t.IMiniGame6Consts.maxWeapon,this.speed=i.speed||t.IMiniGame6Consts.speed,this.weaponModel=i.weapon||"weapon_1",this.setRadiusAtt(i.radius),this.hitRadius=this.radius)},e.prototype.setRadiusAtt=function(t){this.radius=t,this.width=2*t,this.height=2*t,this.anchorOffsetX=t,this.anchorOffsetY=t,this.body.x=t,this.body.y=t,this.shield.x=t,this.shield.y=t,this.weaponGrp.x=t,this.weaponGrp.y=t,this.weapon.y=t-(this.body.iconHeight||t)/2-20,this.weapon.width=this.width},e.prototype.reSet=function(){this.isRun=!1,this.data=null,this.isAtk=void 0,this.angle=void 0,this.anchorOffsetX=0,this.anchorOffsetY=0,this.lockObj=null,this.isOver=!1,this._isDie=!1},e.prototype.setRadius=function(){var i=this.weapons.length;this.setRadiusAtt(this.data.radius+t.IMiniGame6Consts.addRadius*i),this.weaponLayout()},e.prototype.getWeapon=function(){var t=this.weapons;return this.weapons=[],this.weaponGrp.removeChildren(),t},e.prototype.addWeapon=function(t,i,e){this.weapons.indexOf(t)>-1||(t.setData(this.weaponModel),t.owner=this,t.visible=!0,this.weapons.push(t),t.x=0,t.y=0,i&&(e-=this.weaponGrp.rotation,t.x+=i*GMath.cos(e),t.y+=i*GMath.sin(e)))},e.prototype.weaponLayout=function(){if(void 0!=this.isAtk&&this.isRun){var t=this.weapons.length;if(0!=t){this.hitRadius=this.radius+this.weapons[0].getActDis();var i=360/t,e=0;this.weaponGrp.removeChildren();for(var s=0,h=this.weapons;s<h.length;s++){var a=h[s];this.weaponGrp.addChild(a),a.setOwnerData(this.isAtk,this.radius,e*i),e++}this.weapon.text=t+""}}},e.prototype.weaponRun=function(){if(0!=this.weapons.length)for(var t=0;t<this.weapons.length;t++)this.weapons[t].run()},e.prototype.dorpWeapon=function(t){var i=this.weapons.length;return t=Math.min(i,t),this.weapons.splice(i-t,t)},e.prototype.weaponNum=function(){return this.weapons.length},e.prototype.canGetWeapon=function(){return this.maxWeapon>this.weaponNum()},e.prototype.targetDis=function(t){return GMath.distance(this.x,this.y,t.x,t.y)},e.prototype.checkHit=function(t,i){return i<this.hitRadius+t.hitRadius+this.speed+t.speed},e.prototype.setAngle=function(t){this._isMove&&t!=this.angle&&(this.angle=Math.floor((t+360)%360),this.speedx=this.speed*GMath.cos(t),this.speedy=this.speed*GMath.sin(t))},e.prototype.setMove=function(t){this._isMove!=t&&(this._isMove=t,this.isAtk=this._isMove,this.setRadius())},e.prototype.setDie=function(){this._isDie=!0,this.isRun=!1},e.prototype.setMoveArea=function(t,i,e,s){this.sx=t+this.radius,this.sy=i+this.radius,this.ex=e-1.5*this.radius,this.ey=s-1.5*this.radius},e.prototype.move=function(){this._isMove&&this.forceMove()},e.prototype.forceMove=function(){var t=this.x+(this.speedx||0),i=this.y+(this.speedy||0);t<this.sx?this.x=this.sx:t>this.ex?this.x=this.ex:this.x=t,i<this.sy?this.y=this.sy:i>this.ey?this.y=this.ey:this.y=i},e.prototype.hitMove=function(t){void 0===t&&(t=6);for(var i=0;t>i;i++)this.forceMove()},e.prototype.run=function(){this.isRun&&(this.move(),this.weaponRun(),this.weaponGrp.rotation+=t.IMiniGame6Consts.rotation,this.shieldRun())},e.prototype.shieldRun=function(){return this.isOver?void(this.shield.visible=!1):(this.shield.visible=!this.isAtk,this.isAtk?void this.shield.reSet():void this.shield.run())},e.prototype.checkTargetHit=function(t){var i=this.targetDis(t),e=this.checkHit(t,i);if(e){var s=GMath.angle(this.x,this.y,t.x,t.y);return t.setAngle(s),t.hitMove(4),!0}return!1},e.prototype.isDie=function(){return this._isDie},e.prototype.initOver=function(){this.isRun=!0,this.isAtk=this._isMove,this.setRadius()},e.prototype.isDef=function(){return!this.isAtk},e.prototype.checkLockObj=function(t){this.lockObj==t&&(this.lockObj.targetObj=null,this.lockObj=null)},e.prototype.dispose=function(){this.reSet(),this.body.filters=null,GObj.disposeObject(this.shield),this.shield=null,GObj.disposeObject(this.body),this.body=null,GObj.disposeObject(this.weaponGrp),this.weaponGrp=null,GObj.disposeObject(this.weapon),this.weapon=null,this.weapons=null,this.data=null,this.lockObj=null},e}(egret.DisplayObjectContainer);t.IMiniGame6Avatar=i,__reflect(i.prototype,"miniGame.IMiniGame6Avatar",["IMiniGameAvatarVo"])}(miniGame||(miniGame={}));var IMiniGameMain=function(){function t(){}return t.getMiniGame=function(i){t.sysFrame()<60&&(t.frameRate=t.sysFrame(),egret.ticker.$setFrameRate(60)),App.sound.playEff||(App.sound.playEff=function(){},console.warn("请在soundManager中添加方法playEff，播放音效")),App.sound.playBgm||(App.sound.playBgm=function(){},console.warn("请在soundManager中添加方法playBgm，播放背景音乐")),t.curMiniGame&&t.closeMiniGame(),t.curMiniGameType=i.kind,IMiniGameConfig.avatarPath=PATH.res+"iminigame/game"+t.curMiniGameType+"/avatar/",IMiniGameConfig.effectPath=PATH.res+"iminigame/game"+t.curMiniGameType+"/effect/",i.funny&&(IMiniGameConfig.countDownExit=1e3*i.funny.p1,t.funnyId=i.funny.id);var e=Math.floor(i.kind/1e3);return miniGame["IMiniGame"+e]?t.curMiniGame=GObj.create(miniGame["IMiniGame"+e],i):console.error("找不到小游戏类型："+e),t.curMiniGame},t.prototype.updateFunny=function(i){t.curMiniGame&&t.curMiniGame.updateFunny(i)},t.closeMiniGame=function(){t.curMiniGame&&(t.playBgm(null),GObj.disposeObject(t.curMiniGame),t.curMiniGame=null,GObj.disposeObject(t.guideView),t.guideView=null,IMiniGameConfig.avatarPath=null,IMiniGameConfig.effectPath=null,t._grayFilter=null,t._redFilter=null,t.funnyId=null,miniGame.IMiniGameResult.dispose(),miniGame.IMiniGameMgr.destory(),t.frameRate&&(egret.ticker.$setFrameRate(t.frameRate),t.frameRate=null),DispatcherManager.dispatch(IMiniGameEvent.IMiniGameOver,{kind:t.curMiniGameType,result:IMiniGameResultType.type_6}))},t.getIcon=function(i,e,s){return void 0===e&&(e=FileConst.png),s?PATH.res+"iminigame/"+s+"/"+i+e:t.getCurGamePath()+i+e},t.getCurGamePath=function(){return PATH.res+"iminigame/game"+t.curMiniGameType+"/"},t.getBone=function(i){return PATH.res+"iminigame/game"+t.curMiniGameType+"/bone/"+i},t.getCommonSrc=function(i,e){return void 0===e&&(e=FileConst.png),t.getCommonPath()+i+e},t.getCommonPath=function(){return PATH.res+"iminigame/common/"},t.getConfig=function(t,i,e){var s=PATH.res+"iminigame/"+t+FileConst.json;RES.getResByUrl(s,i,e,RES.ResourceItem.TYPE_JSON)},t.destoryConfig=function(t){var i=PATH.res+"iminigame/"+t+FileConst.json;return RES.destroyRes(i)},t.getString=function(t){for(var i=[],e=1;e<arguments.length;e++)i[e-1]=arguments[e];var s=i.length;if(0>=s)return t;for(var h=0;s>h;++h)t=t.replace(/\{\}/i,i[h]);return t},t.getLanguage=function(i){var e=t.getLanguageObj();return e?e[i]:""},t.getLanguageObj=function(){var i=t.curMiniGame;return i&&i.configData&&i.configData.language?i.configData.language:null},t.getGuideView=function(){return t.guideView||(t.guideView=GObj.create(miniGame.IGuideView)),t.guideView},t.rmGuideView=function(){t.guideView&&t.guideView.removeMine()},t.reqSocket=function(i,e,s){s||(s={}),s.ACT_ID=t.funnyId,DispatcherManager.dispatch(IMiniGameEvent.IMiniGameSocket,i,t.curMiniGameType,e,s)},t.checkOpen=function(i,e){return null==i||null==e?!0:t.checkOpenFun?t.checkOpenFun(i,e):(console.warn("请设置 IMiniGameMain.checkOpenFun"),!0)},t.checkOpenTip=function(i,e){if(null!=i&&null!=e){if(t.checkOpenTipsFun)return void App.msgtip.show(t.checkOpenTipsFun(i,e));console.warn("请设置 IMiniGameMain.checkOpenTipsFun"),App.msgtip.show(IMiniGameLanguage.c_5)}},t.getGrayFilter=function(){if(null==this._grayFilter){var t=[];t=t.concat([.5,0,0,0,0]),t=t.concat([0,.5,0,0,0]),t=t.concat([0,0,.5,0,0]),t=t.concat([0,0,0,1,0]),this._grayFilter=new egret.ColorMatrixFilter(t)}return this._grayFilter},t.getRedFilter=function(){if(null==this._redFilter){var t=[];t=t.concat([1,0,0,0,100]),t=t.concat([0,0,0,0,0]),t=t.concat([0,0,0,0,0]),t=t.concat([0,0,0,1,0]),this._redFilter=new egret.ColorMatrixFilter(t)}return this._redFilter},t.playBgm=function(t){App.sound.playBgm(t)},t.playEff=function(t){App.sound.playEff(t)},t.parserHtml=function(t){if(!t)return[];var i=GObj.create(egret.HtmlTextParser);return i.parser(t)},t.sysFrame=function(){return egret.ticker.$frameRate||60},t.addToStage=function(t){var i=egret.lifecycle.stage;if(i){var e=i.numChildren,s=i.$children[e-1];return void(s&&s.$children?s.addChild(t):i.addChild(t))}console.warn("未获取当前舞台对象egret.lifecycle.stage")},t.numberToStr=function(t,i){return t>=Math.pow(10,8)?(t/Math.pow(10,8)).toFixed(i||0)+IMiniGameLanguage.c_22:t>=Math.pow(10,4)?(t/Math.pow(10,4)).toFixed(i||0)+IMiniGameLanguage.c_21:t+""},t.getTimeFormat=function(t){var i=Math.floor(t/60);i=i>=10?i:"0"+i;var e=t%60;return e=e>=10?e:"0"+e,i+":"+e||""},t.safeHeight=0,t}();__reflect(IMiniGameMain.prototype,"IMiniGameMain"),window.miniGame=miniGame,window.IMiniGameMain=IMiniGameMain;var IMiniGameResultType={type_0:0,type_1:1,type_2:2,type_3:3,type_4:4,type_5:5,type_6:6},IMiniGameLanguage={c_1:"请先通关上一章节",c_2:"请先通关上一关",c_3:"此关已通关",c_4:"领取奖励成功",c_5:"条件未达成",c_6:"{}秒后进入下一关",c_7:"{}秒后重新挑战",c_8:"游戏已通关",c_9:"下一关",c_10:"返回上一级",c_11:"معركة حاسمة",c_12:"انتقل تلقائيًا إلى هناك خلال {} ثانية",c_13:"重新开始",c_14:"跳过",c_15:"本关卡小关通关成功,{}秒后继续",c_16:"D{}C",c_17:"d{}g",c_18:"d{}p{}b",c_19:"+{}",c_20:"确认",c_21:"万",c_22:"亿",c_23:"D{}S",c_24:"{}_{}",c_25:"{}分{}秒",c_26:"D{}G",c_27:"{}F",l4_1:"尚未获得该技能",l4_2:"该技能在冷却中"},IMiniGameEvent=function(){function t(){}return t.IMiniGameLoaded="IMiniGameLoaded",t.IMiniGameSocket="IMiniGameSocket",t.IMiniGameSocketBack="IMiniGameSocketBack",t.IMiniGameOver="IMiniGameOver",t.IMiniCloseTools="IMiniCloseTools",t.IMiniGameExit="IMiniGameExit",t.IMiniGameChapterExit="IMiniGameChapterExit",t.IMiniGameResultBack="IMiniGameResultBack",t}();__reflect(IMiniGameEvent.prototype,"IMiniGameEvent");var IMiniGameConfig={result_win:"result_win",result_lose:"result_lose",countDownExit:6e4,avatarPath:"",effectPath:"",scaleZLess:.002,scaleZLarge:.001};window.IMiniGameEvent=IMiniGameEvent,window.IMiniGameResultType=IMiniGameResultType;var miniGame;!function(t){var i=function(i){function e(){return i.call(this)||this}return __extends(e,i),e.prototype.initSkins=function(){this.isInit||(this.isInit=!0,this.bgGrp=GObj.create(eui.Group),this.addChild(this.bgGrp),this.bgImg=GObj.create(t.ImageOutside),this.bgGrp.addChild(this.bgImg),this.bgBanner=GObj.create(t.ImageOutside),this.bgGrp.addChild(this.bgBanner),this.lineImg3=GObj.create(t.ImageOutside),this.bgGrp.addChild(this.lineImg3),this.lineImg2=GObj.create(t.ImageOutside),this.bgGrp.addChild(this.lineImg2),this.lineImg1=GObj.create(t.ImageOutside),this.bgGrp.addChild(this.lineImg1),this.lineImgs=[null,this.lineImg1,this.lineImg2,this.lineImg3],this.createSection(),this.bgGrp.addChild(this.section4),this.bgGrp.addChild(this.section3),this.bgGrp.addChild(this.section2),this.bgGrp.addChild(this.section1),this.sections=[this.section1,this.section2,this.section3,this.section4],this.scro=GObj.create(eui.Scroller),this.bgGrp.addChild(this.scro),this.listData=GObj.create(eui.ArrayCollection),this.chapterList=GObj.create(eui.List),this.chapterList.dataProvider=this.listData,this.scro.viewport=this.chapterList,this.exitBtn=GObj.create(t.IBaseBtn),this.exitBtn.icon=IMiniGameMain.getIcon("exit_btn",FileConst.png,"chapter"),this.bgGrp.addChild(this.exitBtn),this.setLayout(),this.initSrc(),this.updateView())},e.prototype.createSection=function(){this.section4=GObj.create(t.IMiniGameSectionItem),this.section3=GObj.create(t.IMiniGameSectionItem),this.section2=GObj.create(t.IMiniGameSectionItem),this.section1=GObj.create(t.IMiniGameSectionItem)},e.prototype.setLayout=function(){if(this.isInit){this.bgGrp.width=540,this.bgGrp.height=960,this.bgGrp.horizontalCenter=0,this.bgGrp.verticalCenter=0,this.bgBanner.horizontalCenter=0,this.bgBanner.bottom=0,this.lineImg3.horizontalCenter=0,this.lineImg3.y=221,this.lineImg2.scaleX=-1,this.lineImg2.horizontalCenter=0,this.lineImg2.y=384,this.lineImg1.horizontalCenter=0,this.lineImg1.y=545,this.scro.horizontalCenter=0,this.scro.bottom=5,this.scro.width=534,this.scro.height=122,this.exitBtn.left=20,this.exitBtn.bottom=140;var t=GObj.create(eui.HorizontalLayout);t.gap=-8,this.chapterList.layout=t}},e.prototype.initSrc=function(){this.horizontalCenter=0,this.width=StageManager.stageWidth,this.height=StageManager.stageHeight,this.curIdx=0,this.getRewardChapter=-1,this.lineImgs=[null,this.lineImg1,this.lineImg2,this.lineImg3],this.sections=[this.section1,this.section2,this.section3,this.section4],this.listData=GObj.create(eui.ArrayCollection),this.chapterList.dataProvider=this.listData,this.chapterList.itemRenderer=t.IMiniGameChapterItem,this.bgImg.setOutSrc("chapter/bg_1",FileConst.jpg),this.bgBanner.setOutSrc("chapter/bgBanner"),this.initEvent()},e.prototype.readSkins=function(){this.isInit||(this.isInit=!0,this.once(egret.Event.COMPLETE,this.loadSkinsOver,this),this.skinName=ResourcesUtil.getSkinPath("IMiniGameChapter"+IMiniGameMain.curMiniGame.readSkins))},e.prototype.loadSkinsOver=function(){this.initSrc(),this.exitBtn.icon=IMiniGameMain.getIcon("chapter/exit_btn"),this.updateView()},e.prototype.initEvent=function(){DispatcherManager.addListener(IMiniGameEvent.IMiniGameExit,this.onExitBtnClick,this),this.exitBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCloseClick,this),this.chapterList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onListClick,this);for(var t=0,i=this.sections;t<i.length;t++){var e=i[t];e.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSectionClick,this)}},e.prototype.removeEvent=function(){this.removeEventListener(egret.Event.COMPLETE,this.loadSkinsOver,this),DispatcherManager.removeListener(IMiniGameEvent.IMiniGameExit,this.onExitBtnClick,this),this.exitBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onCloseClick,this),this.chapterList.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onListClick,this);for(var t=0,i=this.sections;t<i.length;t++){var e=i[t];e.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSectionClick,this)}},e.prototype.onResultBack=function(t){2==t&&(this.onCloseClick(),DispatcherManager.dispatch(IMiniGameEvent.IMiniCloseTools))},e.prototype.setData=function(t,i){var e=this;!this.isCountDownBack&&!this.gameData&&t.isMust&&IMiniGameConfig.countDownExit>0&&(this.isCountDownBack=!0,ClockManager.setTimeout(function(){e.isCountDownBack=!1,e.exitBtn&&(e.exitBtn.visible=!0)},this,IMiniGameConfig.countDownExit));var s=t.funny?t.funny.actData.p3:0;t.chapter=Math.floor(s/4)+1,t.section=s+1,this.chapter=t.chapter,this.section=t.section,this.gameData=t,this.chapterData=i,this.isInit&&this.updateView(),IMiniGameMain.curMiniGame.readSkins?this.readSkins():this.initSkins()},e.prototype.updateView=function(){this.exitBtn.visible=!this.isCountDownBack,IMiniGameConfig.countDownExit<0&&(this.exitBtn.visible=!1),this.updateList(),this.updateSection()},e.prototype.updateList=function(){for(var t,i=this.chapterData,e=[],s=0,h=i;s<h.length;s++){var a=h[s];if(0!=a.show&&!(2==a.show&&a.chapterId>this.chapter)){a.open=a.chapterId<=this.chapter,a.isHave=!1;for(var n=0,o=a.stages;n<o.length;n++){var r=o[n];if(t=this.getRewardByIdx(a.chapterId,r.stageId),t&&1==t.status){a.isHave=!0;break}}e.push(a)}}if(e.sort(function(t,i){return t.chapterId-i.chapterId}),this.listData.replaceAll(e),this.getRewardChapter>=0)this.curIdx=this.getRewardChapter;else{this.curIdx=0;for(var l=0,p=e;l<p.length;l++){var a=p[l];if(a.chapterId==this.chapter){var c=a.stages[0];IMiniGameMain.checkOpen(c.condType,c.condVal)||this.curIdx--;break}this.curIdx++}this.curIdx>=e.length&&(this.curIdx=e.length-1)}this.chapterList.selectedIndex=this.curIdx},e.prototype.updateSection=function(){var t=this.chapterData[this.curIdx];if(t){var i,e,s,h=t.stages,a=0;this.lineImg1.setOutSrc(""),this.lineImg2.setOutSrc(""),this.lineImg3.setOutSrc("");for(var n=0,o=this.sections;n<o.length;n++){var r=o[n];r.visible=!1}for(var l,p=0,c=h;p<c.length;p++){var u=c[p];e=this.lineImgs[a],i=this.sections[a],s=u.stageId<=this.section,u.stageId==this.section&&(l=i),i.visible=!0,i.setData(t.chapterId,u,s),i.setReward(this.getRewardByIdx(t.chapterId,u.stageId)),IMiniGameMain.curMiniGame.readSkins?e&&e.setOutSrc(s?"chapter/ncs_path_2":"chapter/ncs_path_1"):e&&e.setOutSrc(s?"ncs_path_2":"ncs_path_1",FileConst.png,"chapter"),a++}if(l){var d=IMiniGameMain.getGuideView();d.playEffct(l.x+l.width/2,l.y+l.height/2),this.bgGrp.addChild(d)}else IMiniGameMain.rmGuideView()}},e.prototype.onListClick=function(t){var i=t.itemIndex;if(this.curIdx!=i){var e=t.item;if(this.chapter<e.chapterId)return this.chapterList.selectedIndex=this.curIdx,void App.msgtip.show(IMiniGameLanguage.c_1);var s=e.stages[0];if(!s||!IMiniGameMain.checkOpen(s.condType,s.condVal))return this.chapterList.selectedIndex=this.curIdx,void IMiniGameMain.checkOpenTip(s.condType,s.condVal);this.curIdx=i,this.updateSection(),this.getRewardChapter=-1}},e.prototype.onSectionClick=function(t){var i=t.target,e=i.sectionData;if(e.stageId>this.section)return void App.msgtip.show(IMiniGameLanguage.c_2);if(e.stageId<this.section)return i.isGetRweard?void App.msgtip.show(IMiniGameLanguage.c_3):(this.getRewardChapter=this.curIdx,App.msgtip.show(IMiniGameLanguage.c_4),void IMiniGameMain.reqSocket(4,i.giftId));if(!e||!IMiniGameMain.checkOpen(e.condType,e.condVal))return void IMiniGameMain.checkOpenTip(e.condType,e.condVal);if(e.stageId==this.section){IMiniGameMain.rmGuideView();var s=IMiniGameMain.curMiniGame.getGameView();this.addChild(s),this.bgGrp.visible=!1}},e.prototype.getRewardByIdx=function(t,i){if(!this.gameData)return null;var e,s=this.gameData.funny;if(s){for(var h=0,a=s.bagList;h<a.length;h++){var n=a[h];if(e=n.conditionList[0],e&&e.p1==t&&e.p2==i)return n}return{status:i<this.gameData.section?2:0}}},e.prototype.onCloseClick=function(){DispatcherManager.dispatch(IMiniGameEvent.IMiniGameChapterExit)},e.prototype.onExitBtnClick=function(){this.bgGrp.visible=!0},e.prototype.dispose=function(){!this.isDestory&&this.isInit&&(this.isDestory=!0,this.removeEvent(),GObj.disposeObject(this.bgImg),this.bgImg=null,GObj.disposeObject(this.bgBanner),this.bgBanner=null,GObj.disposeObject(this.exitBtn),this.exitBtn=null,GObj.disposeObject(this.lineImg1),this.lineImg1=null,GObj.disposeObject(this.lineImg2),this.lineImg2=null,GObj.disposeObject(this.lineImg3),this.lineImg3=null,GObj.disposeObject(this.section1),this.section1=null,GObj.disposeObject(this.section2),this.section2=null,GObj.disposeObject(this.section3),this.section3=null,GObj.disposeObject(this.section4),this.section4=null,this.stageScro&&(this.stageScro.stopAnimation(),this.stageScro.viewport=null,GObj.disposeObject(this.stageScro),this.stageScro=null),GObj.disposeObject(this.stageGrp),this.stageGrp=null,this.scro&&(this.scro.stopAnimation(),this.scro.viewport=null,GObj.disposeObject(this.scro),this.scro=null),this.chapterList&&(this.chapterList.dataProvider=null,GObj.disposeObject(this.chapterList),this.chapterList=null),this.listData=null,this.chapterList=null,this.gameData=null,this.lineImgs=null,this.sections=null,i.prototype.dispose.call(this))},e}(t.IBaseView);t.IMiniGameChapter=i,__reflect(i.prototype,"miniGame.IMiniGameChapter")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.once(egret.Event.REMOVED_FROM_STAGE,t.dispose,t),IMiniGameMain.curMiniGame.readSkins?(t.once(egret.Event.COMPLETE,t.loadSkinsOver,t),t.skinName=ResourcesUtil.getSkinPath("IMiniGameChapterItem"+IMiniGameMain.curMiniGame.readSkins)):t.initSkins(),t
}return __extends(e,i),e.prototype.initSkins=function(){this.isInit||(this.isInit=!0,this.width=188,this.height=122,this.moveGrp=GObj.create(eui.Group),this.moveGrp.width=this.width,this.moveGrp.height=this.height,this.addChild(this.moveGrp),this.bgImg=GObj.create(t.ImageOutside),this.bgImg.verticalCenter=7,this.bgImg.horizontalCenter=0,this.moveGrp.addChild(this.bgImg),this.selectImg=GObj.create(t.ImageOutside),this.selectImg.verticalCenter=0,this.selectImg.horizontalCenter=0,this.selectImg.setOutSrc("select",FileConst.png,"chapter"),this.moveGrp.addChild(this.selectImg),this.imgRed=GObj.create(t.ImageOutside),this.imgRed.right=10,this.imgRed.top=20,this.moveGrp.addChild(this.imgRed),this.setLayout(),this.skinName=this.getSkin())},e.prototype.loadSkinsOver=function(){this.isInit||(this.isInit=!0,this.selectImg.setOutSrc("chapter/select"),this.dataChanged())},e.prototype.getSkin=function(){var t=GObj.create(eui.Skin);return t.skinParts=["mcDisplay"],t.moveGrp=this.moveGrp,t.selectImg=this.selectImg,this.selectImg.visible=!1,t.elementsContent=[this.moveGrp],t.states=[new eui.State("up",[]),new eui.State("down",[new eui.SetProperty("moveGrp","y",-1)]),new eui.State("upAndSelected",[new eui.SetProperty("moveGrp","y",-2),new eui.SetProperty("selectImg","visible",!0)]),new eui.State("downAndSelected",[new eui.SetProperty("moveGrp","y",-1),new eui.SetProperty("selectImg","visible",!0)])],t},e.prototype.setLayout=function(){this.isInit&&(this.width=188,this.height=122,this.moveGrp.width=this.width,this.moveGrp.height=this.height,this.bgImg.verticalCenter=7,this.bgImg.horizontalCenter=0,this.selectImg.verticalCenter=0,this.selectImg.horizontalCenter=0,this.imgRed.right=10,this.imgRed.top=20)},e.prototype.dataChanged=function(){if(this.isInit&&this.data){i.prototype.dataChanged.call(this);var t=this.data;this.bgImg.setOutSrc("chapter/g"+t.chapterId),this.bgImg.filters=t.open?[]:[IMiniGameMain.getGrayFilter()],this.imgRed.setOutSrc(t.isHave?"redPoint":"",FileConst.png,"chapter")}},e.prototype.dispose=function(){this.bgImg&&(this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.dispose,this),this.removeEventListener(egret.Event.COMPLETE,this.loadSkinsOver,this),this.bgImg.filters=null,GObj.disposeObject(this.bgImg),this.bgImg=null,GObj.disposeObject(this.selectImg),this.selectImg=null,GObj.disposeObject(this.imgRed),this.imgRed=null)},e}(eui.ItemRenderer);t.IMiniGameChapterItem=i,__reflect(i.prototype,"miniGame.IMiniGameChapterItem")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return __extends(i,t),i.showResult=function(t,a,n,o,r,l,p){var c;switch(t){default:case IMiniGameResultType.type_0:i.lose||(i.lose=GObj.create(e)),i.lose.setData(a,n,o),c=i.lose;break;case IMiniGameResultType.type_1:i.win||(i.win=GObj.create(s)),i.win.setData(a,n,o,l,p),c=i.win;break;case IMiniGameResultType.type_5:i.minWin||(i.minWin=GObj.create(h)),i.minWin.setData(a,n,o,r),c=i.minWin}IMiniGameMain.addToStage(c)},i.dispose=function(){GObj.disposeObject(i.minWin),i.minWin=null,GObj.disposeObject(i.win),i.win=null,GObj.disposeObject(i.lose),i.lose=null},i}(eui.Component);t.IMiniGameResult=i,__reflect(i.prototype,"miniGame.IMiniGameResult");var e=function(i){function e(){var t=i.call(this)||this;return t.result=IMiniGameResultType.type_0,t}return __extends(e,i),e.prototype.initSkins=function(){this.isInit||(this.isInit=!0,this.horizontalCenter=0,this.verticalCenter=0,this.width=StageManager.stageWidth,this.height=StageManager.stageHeight,this.bgRect=GObj.create(eui.Rect),this.bgRect.touchEnabled=!1,this.bgRect.horizontalCenter=0,this.bgRect.verticalCenter=0,this.bgRect.alpha=.5,this.bgRect.width=this.width,this.bgRect.height=this.height,this.addChild(this.bgRect),this.eff=GObj.create(t.IMovie),this.eff.isLast=!0,this.eff.y=300,this.eff.x=this.width/2,this.addChild(this.eff),this.grp=GObj.create(eui.Group),this.grp.horizontalCenter=0,this.grp.y=this.eff.y+10,this.addChild(this.grp),this.bgReward=GObj.create(t.ImageOutside),this.bgReward.horizontalCenter=0,this.bgReward.setOutSrc("lose_bg_1",FileConst.png,"chapter"),this.grp.addChild(this.bgReward),this.btnBack=GObj.create(t.IBaseBtn),this.btnBack.x=37,this.btnBack.y=180,this.btnBack.icon=IMiniGameMain.getIcon("btn_2",FileConst.png,"chapter"),this.btnBack.labelDisplay.textColor=2054448,this.grp.addChild(this.btnBack),this.btnNext=GObj.create(t.IBaseBtn),this.btnNext.x=257,this.btnNext.y=180,this.btnNext.icon=IMiniGameMain.getIcon("btn_1",FileConst.png,"chapter"),this.btnNext.labelDisplay.textColor=7751207,this.grp.addChild(this.btnNext),this.labTime=GObj.create(eui.Label),this.labTime.horizontalCenter=0,this.labTime.y=280,this.labTime.size=22,this.labTime.textColor=16777215,this.grp.addChild(this.labTime),this.addEvent())},e.prototype.addEvent=function(){this.btnBack.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnBackClick,this),this.btnNext.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnNextClick,this)},e.prototype.removeEvent=function(){DispatcherManager.removeListener(HGEvent.HEARTBEAT,this.countDown,this),this.btnBack.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnBackClick,this),this.btnNext.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnNextClick,this)},e.prototype.countDown=function(){return this.time<1?void(this.autoBackGame?this.sendMsg(2):this.countDownOver()):void(this.labTime.text=IMiniGameMain.getString(this.timeText,this.time--))},e.prototype.countDownOver=function(){this.rmParent(),this.closeBack&&this.closeBack.call(this.thisObj,this.result)},e.prototype.rmParent=function(){DispatcherManager.removeListener(HGEvent.HEARTBEAT,this.countDown,this),this.parent&&this.parent.removeChild(this)},e.prototype.onBtnBackClick=function(){var t=IMiniGameMain.curMiniGame.configData.showChapter,i=this.checkBackGame()||this.checkStageLast()||!t;this.sendMsg(i?2:1)},e.prototype.checkBackGame=function(){var t=IMiniGameMain.curMiniGame.gameData;switch(t.backGame){case 2:case 3:return!t.isMust;case 4:return this.checkStageNum();case 5:if(!t.isMust)return this.checkStageNum();if(!this.nextStage)return!1;if(2==this.nextStage.stageId)return!0;break;case 6:return!0}return!1},e.prototype.checkStageNum=function(){var t=IMiniGameMain.curMiniGame.gameData;if(t.isMust)return!1;if(!this.nextStage)return!0;if(2==this.nextStage.stageId)return!0;var t=IMiniGameMain.curMiniGame.gameData,i=t.funny;return this.nextStage.stageId-1==i.p3},e.prototype.checkStageLast=function(){if(!this.nextStage)return!0;var t=IMiniGameMain.curMiniGame.gameData,i=t.funny;return this.nextStage.stageId-1==i.p3},e.prototype.sendMsg=function(t){DispatcherManager.dispatch(IMiniGameEvent.IMiniGameResultBack,t),this.rmParent()},e.prototype.onBtnNextClick=function(){this.countDownOver()},e.prototype.setData=function(t,i,e){this.closeBack=t,this.thisObj=i,this.time=e||3,this.initSkins(),this.setBtnNext(),this.showEff(),this.labTime.text="",DispatcherManager.removeListener(HGEvent.HEARTBEAT,this.countDown,this),DispatcherManager.addListener(HGEvent.HEARTBEAT,this.countDown,this)},e.prototype.showEff=function(){var i=this;this.lose||(this.lose=GObj.create(t.ImageOutside),this.addChild(this.lose)),this.lose.loadCompleteCall(function(){i.lose&&(i.lose.x=-i.lose.iconWidth,i.lose.y=100,egret.Tween.removeTweens(i.lose),egret.Tween.get(i.lose).to({x:i.width+i.lose.iconWidth},2e3))},this),this.lose.setOutSrc("lose",FileConst.png,"chapter"),this.eff.start(IMiniGameConfig.result_lose,1,100,IMiniGameMain.getCommonPath()),this.eff.autoRun()},e.prototype.setBtnNext=function(){this.btnNext.label=IMiniGameMain.getString(IMiniGameLanguage.c_13);var t=IMiniGameMain.curMiniGame.configData.showChapter;this.nextStage=this.checkHaveNext();var i=this.checkBackGame()||this.checkStageLast()||!t;this.btnBack.label=IMiniGameMain.getString(i?IMiniGameLanguage.c_11:IMiniGameLanguage.c_10);var e=IMiniGameMain.curMiniGame.gameData,s=!e.backGame&&IMiniGameMain.curMiniGame.configData.loseBackMain;this.autoBackGame=s||i||this.checkStageLast(),this.timeText=this.autoBackGame?IMiniGameLanguage.c_12:IMiniGameLanguage.c_7},e.prototype.checkHaveNext=function(){var t=IMiniGameMain.curMiniGame.configData,i=IMiniGameMain.curMiniGame.gameData,e=i.chapter,s=i.section,h=t.chapters[e-1],a=(s-1)%4,n=h.stages[a+1];return n||(h=t.chapters[e],h&&(n=h.stages[0])),n},e.prototype.dispose=function(){this.isInit&&(this.isDestory||(this.isDestory=!0,this.removeEvent(),GObj.disposeObject(this.bgRect),this.bgRect=null,GObj.disposeObject(this.grp),this.grp=null,GObj.disposeObject(this.bgReward),this.bgReward=null,GObj.disposeObject(this.bgRect),this.bgRect=null,GObj.disposeObject(this.btnBack),this.btnBack=null,GObj.disposeObject(this.btnNext),this.btnNext=null,this.lose&&(egret.Tween.removeTweens(this.lose),GObj.disposeObject(this.lose),this.lose=null),this.eff&&(this.eff.stop(),GObj.disposeObject(this.eff),this.eff=null),this.closeBack=null,this.thisObj=null,this.nextStage=null))},e}(eui.Component);__reflect(e.prototype,"IMiniGameLose");var s=function(i){function e(){var t=i.call(this)||this;return t.result=IMiniGameResultType.type_1,t}return __extends(e,i),e.prototype.initSkins=function(){if(!this.isInit){i.prototype.initSkins.call(this),this.rewards=[],this.grp.y=this.eff.y+50,this.bgReward.setOutSrc("win_bg_1",FileConst.png,"chapter"),this.bgFlag=GObj.create(t.ImageOutside),this.bgFlag.horizontalCenter=0,this.bgFlag.y=30,this.bgFlag.setOutSrc("win_bg_2",FileConst.png,"chapter"),this.grp.addChild(this.bgFlag),this.scro=GObj.create(eui.Scroller),this.scro.maxWidth=366,this.scro.height=90,this.scro.y=65,this.scro.horizontalCenter=0,this.scro.scrollPolicyV=eui.ScrollPolicy.OFF,this.grp.addChild(this.scro),this.rewardList=GObj.create(eui.Group),this.scro.viewport=this.rewardList;var e=GObj.create(eui.HorizontalLayout);e.gap=6,e.paddingTop=2,e.paddingLeft=2,this.rewardList.layout=e}},e.prototype.countDownOver=function(){this.onBtnNextClick()},e.prototype.onBtnBackClick=function(){this.rmParent();var t=this.checkBackGame()||this.checkStageLast()||!IMiniGameMain.curMiniGame.configData.showChapter;DispatcherManager.dispatch(IMiniGameEvent.IMiniGameResultBack,t?2:1)},e.prototype.checkBackGame=function(){var t=IMiniGameMain.curMiniGame.gameData;switch(t.backGame){case 1:case 3:return!t.isMust;case 4:return this.checkStageNum();case 5:if(!t.isMust)return this.checkStageNum();if(!this.nextStage)return!1;if(2==this.nextStage.stageId)return!0;break;case 6:return!0}return!1},e.prototype.onBtnNextClick=function(){this.rmParent(),this.nextStage?DispatcherManager.dispatch(IMiniGameEvent.IMiniGameResultBack,3,this.nextStage):DispatcherManager.dispatch(IMiniGameEvent.IMiniGameResultBack,2)},e.prototype.rmParent=function(){i.prototype.rmParent.call(this),this.autoGetReward()},e.prototype.setData=function(t,e,s,h,a){i.prototype.setData.call(this,t,e,s),this.codeP4Handler(h,a),this.setReward(),this.btnBack.horizontalCenter=this.btnNext.visible?void 0:0,this.btnBack.x=37,this.nextStage||(this.timeText=IMiniGameLanguage.c_12),this.autoGetReward()},e.prototype.codeP4Handler=function(t,i){this.extraGoodsArr=[];var e={};if(t&&i){var s=t.split(",");e[s[0]]=i,this.extraGoodsArr.push({extraTid:+s[1],extraNum:i})}this.codeP4=e},e.prototype.showEff=function(){this.eff.start(IMiniGameConfig.result_win,1,100,IMiniGameMain.getCommonPath()),this.eff.autoRun()},e.prototype.setReward=function(){this.rewardList.removeChildren();var t=IMiniGameMain.curMiniGame.gameData,i=t.funny;if(i){var e=i.bagList[0],s=e?e.rewardList:[];if(!s||0==s.length)return[];for(var h=this.extraGoodsArr.length,a=0;h>a;a++){for(var n=this.extraGoodsArr[a].extraTid,o=this.extraGoodsArr[a].extraNum,r=!1,l=s.length,p=0;l>p;p++){var c=s[a];c.tempId==n&&(r=!0,c.count+=o)}r||s.push({tempId:n,count:o})}for(var u,d,m=s.length,g=0;m>g;g++)d=this.getReward(g),u=d.data,u||(u=GObj.create(GoodsInfo)),u.tid=s[g].tempId,u.count=s[g].count,d.data=u,this.rewardList.addChild(d)}},e.prototype.getReward=function(t){var i=this.rewards[t];return i||(i=GObj.create(GoodsItemView),this.rewards.push(i)),i},e.prototype.setBtnNext=function(){var t=IMiniGameMain.curMiniGame.configData;if(this.nextStage=null,this.autoBackGame=!1,!t.showChapter)return this.timeText=IMiniGameLanguage.c_12,this.autoBackGame=!0,this.btnNext.visible=!1,void(this.btnBack.label=IMiniGameMain.getString(IMiniGameLanguage.c_11));this.timeText=IMiniGameLanguage.c_6;var i=this.checkHaveNext(),e=i?IMiniGameMain.checkOpen(i.condType,i.condVal):!1;this.nextStage=i,this.btnNext.visible=null!=i,this.btnNext.label=IMiniGameMain.getString(IMiniGameLanguage.c_9);var s=this.checkBackGame(),h=IMiniGameMain.curMiniGame.gameData,a=h.funny,n=a&&0!=a.p1&&0!=a.p3&&a.actData.p3==a.p3-1;(s||i&&!e||n)&&(n||!i||!e||6!=h.backGame&&5!=h.backGame&&4!=h.backGame?(this.nextStage=null,this.btnNext.visible=!1):(this.nextStage=i,this.btnNext.visible=!0),this.timeText=IMiniGameLanguage.c_12,this.autoBackGame=!0);var o=!this.nextStage||s?IMiniGameLanguage.c_11:IMiniGameLanguage.c_10;this.btnBack.label=IMiniGameMain.getString(o),this.checkStageLast()&&(this.timeText=IMiniGameLanguage.c_12,this.autoBackGame=!0)},e.prototype.autoGetReward=function(){if(IMiniGameMain.curMiniGame){var t=IMiniGameMain.curMiniGame.gameData,i=t.funny;if(i)for(var e,s=0,h=i.bagList;s<h.length;s++){var a=h[s];if(e=a.conditionList[0],e&&e.p1==t.chapter&&e.p2==t.section){2!=a.status&&IMiniGameMain.reqSocket(4,a.id,this.codeP4);break}}}},e.prototype.dispose=function(){if(this.isInit&&!this.isDestory){GObj.disposeObject(this.bgFlag),this.bgFlag=null,this.scro.stopAnimation(),this.scro.viewport=null,GObj.disposeObject(this.scro),this.scro=null,GObj.disposeObject(this.rewardList),this.rewardList=null;for(var t=0,e=this.rewards;t<e.length;t++){var s=e[t];GObj.disposeObject(s)}this.rewards=null,this.codeP4=null,this.extraGoodsArr=null,i.prototype.dispose.call(this)}},e}(e);__reflect(s.prototype,"IMiniGameWin");var h=function(i){function e(){return i.call(this)||this}return __extends(e,i),e.prototype.initSkins=function(){this.isInit||(this.isInit=!0,this.horizontalCenter=0,this.verticalCenter=0,this.width=StageManager.stageWidth,this.height=StageManager.stageHeight,this.bgGrp=GObj.create(eui.Group),this.bgGrp.y=200,this.addChild(this.bgGrp),this.bgMap=GObj.create(t.ImageOutside),this.bgMap.horizontalCenter=0,this.bgMap.verticalCenter=0,this.bgMap.loadCompleteCall(this.loadComplete,this),this.bgMap.setOutSrc("bg_stage",FileConst.png,"chapter"),this.bgGrp.addChild(this.bgMap),this.bitMap=GObj.create(t.IBitNumMap),this.bitMap.setGap(4),this.bitMap.setPath("num9"),this.bitMap.horizontalCenter=0,this.bitMap.verticalCenter=0,this.bgGrp.addChild(this.bitMap))},e.prototype.closeClick=function(){this.parent&&this.parent.removeChild(this)},e.prototype.setData=function(t,i,e,s){this.initSkins(),t&&t.call(i,IMiniGameResultType.type_5),this.x=(StageManager.stageWidth-this.width)/2,this.y=(StageManager.stageHeight-this.height)/2,this.curStage=s,this.loadComplete()},e.prototype.loadComplete=function(){this.curStage&&this.bgMap.iconWidth&&(this.bgGrp.x=this.width,this.bitMap.setString(IMiniGameMain.getString(IMiniGameLanguage.c_16,this.curStage)),egret.Tween.removeTweens(this.bgGrp),egret.Tween.get(this.bgGrp).to({x:(this.width-this.bgMap.iconWidth)/2},1e3).wait(1500).to({x:-this.bgGrp.width},1e3).call(this.closeClick,this))},e.prototype.dispose=function(){this.isInit&&(this.isDestory||(this.isDestory=!0,GObj.disposeObject(this.bgGrp),this.bgGrp=null,GObj.disposeObject(this.bgMap),this.bgMap=null,GObj.disposeObject(this.bitMap),this.bitMap=null))},e}(eui.Component);__reflect(h.prototype,"IMiniGameMinWin")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.touchChildren=!1,t}return __extends(e,i),e.prototype.initSkins=function(){this.isInit||(this.isInit=!0,this.width=192,this.height=170,this.moveGrp=GObj.create(eui.Group),this.addChild(this.moveGrp),this.bgImg=GObj.create(t.ImageOutside),this.moveGrp.addChild(this.bgImg),this.lockImg=GObj.create(t.ImageOutside),this.moveGrp.addChild(this.lockImg),this.rewardImg=GObj.create(t.ImageOutside),this.moveGrp.addChild(this.rewardImg),this.flagImg=GObj.create(t.ImageOutside),this.moveGrp.addChild(this.flagImg),this.stageImg=GObj.create(t.ImageOutside),this.moveGrp.addChild(this.stageImg),this.labStage=GObj.create(t.IBitNumMap),this.moveGrp.addChild(this.labStage),this.imgRed=GObj.create(t.ImageOutside),this.moveGrp.addChild(this.imgRed),this.skinName=this.getSkin(),this.setLayout(),this.updateView())},e.prototype.getSkin=function(){var t=GObj.create(eui.Skin);return t.skinParts=["mcDisplay"],t.moveGrp=this.moveGrp,t.elementsContent=[this.moveGrp],t.states=[new eui.State("up",[]),new eui.State("down",[new eui.SetProperty("moveGrp","y",-2)])],t},e.prototype.setLayout=function(){this.isInit&&(this.moveGrp.width=this.width,this.moveGrp.height=this.height,this.bgImg.y=27,this.bgImg.horizontalCenter=0,this.lockImg.x=40,this.lockImg.y=51,this.rewardImg.x=124,this.rewardImg.y=25,this.flagImg.x=75,this.flagImg.y=113,this.stageImg.y=0,this.stageImg.horizontalCenter=0,this.labStage.y=2,this.labStage.horizontalCenter=0,this.labStage.setGap(3),this.labStage.setPath("num2"),this.imgRed.right=0,this.imgRed.top=24,this.rewardImg.setOutSrc("reward",FileConst.png,"chapter"),this.stageImg.setOutSrc("wordbg",FileConst.png,"chapter"))},e.prototype.readSkins=function(){this.isInit||(this.isInit=!0,this.once(egret.Event.COMPLETE,this.loadSkinsOver,this),this.skinName=ResourcesUtil.getSkinPath("IMiniGameSectionItem"+IMiniGameMain.curMiniGame.readSkins))},e.prototype.loadSkinsOver=function(){this.rewardImg.setOutSrc("chapter/reward"),this.stageImg.setOutSrc("chapter/wordbg"),this.updateView()},e.prototype.setData=function(t,i,e){this.chapter=t,this.sectionData=i,this.isOpen=e,this.isInit&&this.updateView(),IMiniGameMain.curMiniGame.readSkins?this.readSkins():this.initSkins()},e.prototype.updateView=function(){this.bgImg.setOutSrc("chapter/g"+this.chapter+"_"+this.sectionData.stageId),IMiniGameMain.curMiniGame.readSkins?(this.lockImg.setOutSrc(this.isOpen?"":"chapter/lock"),this.flagImg.setOutSrc(this.isOpen?"chapter/dimed":"chapter/diming")):(this.lockImg.setOutSrc(this.isOpen?"":"lock",FileConst.png,"chapter"),this.flagImg.setOutSrc(this.isOpen?"dimed":"diming",FileConst.png,"chapter")),this.bgImg.filters=this.isOpen?[]:[IMiniGameMain.getGrayFilter()],this.labStage.setString(IMiniGameMain.getString(IMiniGameLanguage.c_26,this.sectionData.stageId))},e.prototype.setReward=function(i){if(this.isGetRweard=!1,this.isInit&&i){this.giftId=i.id;var e=i.rewardList&&i.rewardList[0];if(e){this.goods||(this.goods=GObj.create(GoodsItemView),this.goods.scaleX=.6,this.goods.scaleY=.6,this.goods.y=this.rewardImg.y+30,this.goods.x=this.rewardImg.x,this.moveGrp.addChild(this.goods));var s=this.goods.data;s||(s=GObj.create(GoodsInfo)),s.tid=e.tempId,s.count=e.count,this.goods.data=s}this.isGetRweard=2==i.status,this.imgRed.setOutSrc(1==i.status?"redPoint":"",FileConst.png,"chapter"),this.imgGeted||(this.imgGeted=GObj.create(t.ImageOutside),this.imgGeted.x=92,this.imgGeted.y=59,this.moveGrp.addChild(this.imgGeted)),this.imgGeted.visible=this.isGetRweard,this.imgGeted.visible&&(IMiniGameMain.curMiniGame.readSkins?this.imgGeted.setOutSrc("chapter/pass"):this.imgGeted.setOutSrc("pass",FileConst.png,"chapter"))}},e.prototype.dispose=function(){this.bgImg&&(this.bgImg.filters=null,GObj.disposeObject(this.bgImg),this.bgImg=null,GObj.disposeObject(this.lockImg),this.lockImg=null,GObj.disposeObject(this.rewardImg),this.rewardImg=null,GObj.disposeObject(this.flagImg),this.flagImg=null,GObj.disposeObject(this.stageImg),this.stageImg=null,GObj.disposeObject(this.labStage),this.labStage=null,GObj.disposeObject(this.goods),this.goods=null,GObj.disposeObject(this.imgGeted),this.imgGeted=null,GObj.disposeObject(this.imgRed),this.imgRed=null,this.sectionData=null)},e}(eui.Button);t.IMiniGameSectionItem=i,__reflect(i.prototype,"miniGame.IMiniGameSectionItem")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(t){function i(){var i=t.call(this)||this;return i.frameSize=0,i.direction=1,i}return __extends(i,t),i.prototype.setPart=function(t){this.part!=t&&(this.part=t,this.updateState())},i.prototype.setModel=function(t){this.model!=t&&(this.model=t,this.updateState())},i.prototype.setAction=function(t){this.action!=t&&(this.action=t,this.updateState())},i.prototype.setDirection=function(t){this.direction!=t&&(this.direction=t,this.updateState())},i.prototype.setFrame=function(t){var t=~~(t%this.frameSize);if(t!=this.frame){if(this.frame=t,this.frameSize<=0)return void(this.texture=null);if(!this.asvo.jsonObj)return void htg.warn(this.key+" avatar part json null");var i=this.asvo.jsonObj.frames[this.frame];i&&(this.texture=this.asvo.ttfs[this.frame],0==this.frame&&(this.fx=-i.ox,this.fy=-i.oy),this.x=this.center?-i.ox-this.fx:-i.ox,this.y=this.center?-i.oy-this.fy:-i.oy,this.anchorOffsetX=this.center?this.width/2:0,this.anchorOffsetY=this.center?this.height/2:0)}},i.prototype.updateState=function(){this.action&&this.model&&this.part&&(this.tempKey=IMiniGameConfig.avatarPath+this.model+GConst.STR_DIR+this.part+this.action,this.direction&&(this.tempKey+=this.direction),this.tempKey!=this.key&&(this.startTime=$GApp.timer,this.key=this.tempKey))},i.prototype.loading=function(){if(this.pkey){if(this.pkey==this.key)return;$GApp.avatarCache.delCache(this.pkey)}this.key&&(this.frameSize=0,this.pkey=this.key,$GApp.avatarCache.addCache(this.pkey),$GApp.avatarCache.getDisplay(this.key,this.loadComplete,this))},i.prototype.loadComplete=function(t){this.key==t.key&&t.jsonObj&&(this.startTime=$GApp.timer,this.asvo=t,this.frameSize=t.ttfs.length,this.callFun&&this.callFun.call(this.thisObj,t),this.frame=-1)},i.prototype.setCallBack=function(t,i){this.callFun=t,this.thisObj=i},i.prototype.dispose=function(){this.parent&&this.parent.removeChild(this),$GApp.avatarCache.delCache(this.key),this.callFun=null,this.thisObj=null},i}(egret.Bitmap);t.IAvatarPart=i,__reflect(i.prototype,"miniGame.IAvatarPart")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.initEffct(),t}return __extends(e,i),e.prototype.initEffct=function(){this.effct_name="ui_yindao",this.effct=GObj.create(t.IMovie),this.effct.isLast=!0,this.touchEnabled=!1,this.touchChildren=!1,this.addChild(this.effct)},e.prototype.playEffct=function(t,i,e){void 0===e&&(e=0),this.x=t,this.y=i,this.stopEffct(),this.effct&&(this.effct.start(this.effct_name,e,100,IMiniGameMain.getCommonPath()),this.effct.autoRun())},e.prototype.stopEffct=function(){egret.Tween.removeTweens(this),this.effct&&this.effct.stop()},e.prototype.removeMine=function(){this.stopEffct(),this.parent&&this.parent.removeChild(this)},e.prototype.dispose=function(){this.stopEffct(),GObj.disposeObject(this.effct),this.effct=null,GObj.disposeObject(this.effct_name),this.effct_name=null},e}(eui.Component);t.IGuideView=i,__reflect(i.prototype,"miniGame.IGuideView")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.touchEnabled=!1,t.targets={},t.paths={},t.imgs={},t.imgPool=[],t.key=IMiniGameMain.getCurGamePath()+"trailing/trailing",t}return __extends(e,i),e.prototype.logPath=function(){if(this.isRun&&this.targets){var t,i,e,s,h;for(var a in this.targets)t=this.targets[a],e=null,t.showTrailing?(i=this.paths[a],h=t.leng||3,i.length>=h&&(e=i.pop()),i.length<h&&(t.getXYR?e=t.getXYR(e):(e||(e={}),e.x=t.x,e.y=t.y,e.angle=t.getAngle()),s=i[0],s?(e.dis=GMath.distance(s.x,s.y,e.x,e.y),e.dis>=t.imageW&&i.unshift(e)):(e.dis=0,i.unshift(e)))):this.paths[a]=[]}},e.prototype.draw=function(){return __awaiter(this,void 0,void 0,function(){var t,i,e;return __generator(this,function(s){if(!this.targets)return[2];for(e in this.targets)t=this.targets[e],t.showTrailing&&(i=this.paths[e],0!=i.length&&this.drawLine(e,t,i));return[2]})})},e.prototype.drawLine=function(i,e,s){for(var h,a,n=this.imgs[i],o=s.length-1;o>=0;o--)a=s[o],h=n[o],h||(h=this.createImg(),h.texture=t.IMiniGameMgr.ins.getImageByKey(this.key,e.imageSrc+o),h.anchorOffsetX=h.texture.textureWidth/2,h.anchorOffsetY=h.texture.textureHeight/2,e.imageW||(e.imageW=h.width),n[o]=h,this.addChild(h)),h.x=a.x,h.y=a.y,a.dis&&(h.scaleX=a.dis/e.imageW),h.rotation=a.angle},e.prototype.createImg=function(){return this.imgPool.pop()||GObj.create(egret.Bitmap)},e.prototype.backPool=function(t){!t||this.imgPool.indexOf(t)>-1||(t.parent&&t.parent.removeChild(t),this.imgPool.push(t))},e.prototype.destoryPool=function(){for(var t=0,i=this.imgPool;t<i.length;t++){var e=i[t];GObj.disposeObject(e)}},e.prototype.rmTargetImgs=function(t){for(var i=this.imgs[t],e=0,s=i;e<s.length;e++){var h=s[e];this.backPool(h)}},e.prototype.addTarget=function(t){if(t.showTrailing){var i=t.hashCode;this.targets[i]||(this.targets[i]=t,this.paths[i]=[],this.imgs[i]=[])}},e.prototype.rmTarget=function(t){var i=t.hashCode;this.targets[i]&&(this.targets[i]=null,this.paths[i]=null,this.rmTargetImgs(i),delete this.targets[i],delete this.paths[i],delete this.imgs[i])},e.prototype.rmAllTarget=function(){if(this.targets){if(this.targets)for(var t in this.targets)this.rmTarget(this.targets[t]);this.targets={},this.paths={},this.imgs={}}},e.prototype.run=function(){this.isRun&&(this.logPath(),this.draw())},e.prototype.stop=function(){this.isRun=!1,this.rmAllTarget()},e.prototype.start=function(){var i=this;t.IMiniGameMgr.ins.checkSheets(this.key)?this.isRun=!0:t.IMiniGameMgr.ins.loadSheet(this.key,function(){i.isRun=!0},this)},e.prototype.dispose=function(){this.targets&&(this.stop(),this.rmAllTarget(),this.destoryPool(),this.targets=null,this.paths=null,this.imgs=null,this.imgPool=null,this.key=null)},e}(egret.DisplayObjectContainer);t.IImageTrailing=i,__reflect(i.prototype,"miniGame.IImageTrailing")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(t){function i(){var i=t.call(this)||this;return i.touchEnabled=!1,i.targets={},i.paths={},i.setBaseAtt(),i}return __extends(i,t),i.prototype.logPath=function(){if(this.isRun&&this.targets){var t,i,e,s;for(var h in this.targets)t=this.targets[h],e=null,t.showTrailing?(i=this.paths[h],s=t.leng||Math.ceil(t.width/2)||10,i.length>=s&&(e=i.shift(),e.cos=null,e.sin=null),i.length<s&&(t.getXYR?e=t.getXYR(e):(e||(e={}),e.x=t.x,e.y=t.y,e.angle=t.getAngle()+90),null==e.cos&&(e.cos=GMath.cos(e.angle)),null==e.sin&&(e.sin=GMath.sin(e.angle)),i.push(e))):this.paths[h]=[]}},i.prototype.draw=function(){return __awaiter(this,void 0,void 0,function(){var t,i,e;return __generator(this,function(s){if(!this.targets)return[2];this.graphics.clear();for(e in this.targets)if(t=this.targets[e],t.showTrailing&&(i=this.paths[e],0!=i.length))switch(t.trailingType){default:case 1:this.drawLineTriangle(t,i);break;case 2:this.drawLineCircle(t,i);break;case 3:this.drawDispersedCircle(t,i);break;case 4:this.drawRoughRriangle(t,i);break;case 5:this.drawGradualRect(t,i)}return this.graphics.endFill(),[2]})})},i.prototype.drawLineTriangle=function(t,i){var e=i.length,s=t.lineWidth||this.lineWidth;this.graphics.lineStyle(s,t.lineColor||this.lineColor,t.lineAlpah||this.lineAlpah,!1,egret.StageScaleMode.EXACT_FIT,egret.CapsStyle.SQUARE,egret.JointStyle.BEVEL);var h,a,n=t.width*(t.lineRare||this.lineRare),o=Math.floor(n/s/2),r=Math.floor(e/o);0==r&&(r=1);for(var l,p=-o,c=0;o>=p;p++){c=e-Math.abs(p*r);for(var u=e-1;u>=0&&!(--c<=0);u--)l=i[u],l&&(h=l.x+s*p*l.cos,a=l.y+s*p*l.sin,u==e-1&&this.graphics.moveTo(h,a),this.graphics.lineTo(h,a))}},i.prototype.drawLineCircle=function(t,i){var e=i.length;this.graphics.beginFill(t.lineColor||this.lineColor,t.lineAlpah||this.lineAlpah);for(var s=(t.lineRare||this.lineRare)*t.width/e/2,h=1,a=0,n=i;a<n.length;a++){var o=n[a];this.graphics.drawCircle(o.x,o.y,h),h+=s}},i.prototype.drawDispersedCircle=function(t,i){var e=i.length;this.graphics.beginFill(t.lineColor||this.lineColor,t.lineAlpah||this.lineAlpah);for(var s,h=t.width/2,a=h/e,n=1,o=2,r=0,l=i;r<l.length;r++){for(var p=l[r],c=0;o>c;c++)s=(t.lineRare||this.lineRare)*GMath.randomInt(-n,n),this.graphics.drawCircle(p.x+s*p.cos,p.y+s*p.sin,n/o);n+=a}},i.prototype.drawRoughRriangle=function(t,i){var e=i.length,s=t.width*(t.lineRare||this.lineRare),h=t.lineWidth||this.lineWidth,a=t.lineColor||this.lineColor,n=t.lineAlpah||this.lineAlpah;this.graphics.lineStyle(s,a,n);var o=i[e-1];this.graphics.moveTo(o.x,o.y);for(var r=e-2,l=1;r>=0;r--,l++)if(o=i[r]){if(s==h*l)break;this.graphics.lineStyle(s-h*l,a,n,!1,null,egret.CapsStyle.SQUARE),this.graphics.lineTo(o.x,o.y)}},i.prototype.drawGradualRect=function(t,i){for(var e,s,h,a,n=i.length,o=t.lineWidth||this.lineWidth,r=t.lineColor||this.lineColor,l=t.lineAlpah||this.lineAlpah,p=t.width*(t.lineRare||this.lineRare),c=Math.floor(p/o/2),u=-c;c>=u;u++){e=l;for(var d=n-1;d>=0&&(s=i[d],!(s&&(this.graphics.lineStyle(o,r,e,!1,egret.StageScaleMode.EXACT_FIT,egret.CapsStyle.SQUARE,egret.JointStyle.BEVEL),h=s.x+o*s.cos*u,a=s.y+o*s.sin*u,d!=n-1&&this.graphics.lineTo(h,a),this.graphics.moveTo(h,a),e-=.02,0>=e)));d--);}},i.prototype.addTarget=function(t){var i=t.hashCode;this.targets[i]||(this.targets[i]=t,this.paths[i]=[])},i.prototype.rmTarget=function(t){var i=t.hashCode;this.targets[i]&&(this.targets[i]=null,this.paths[i]=null,delete this.targets[i],delete this.paths[i])},i.prototype.rmAllTarget=function(){if(this.targets){if(this.targets)for(var t in this.targets)this.rmTarget(this.targets[t]);this.targets={},this.paths={}}},i.prototype.rmAllPath=function(){for(var t in this.paths)this.paths[t]=[]},i.prototype.setBaseAtt=function(t,i,e,s){this.lineColor=t||16711680,this.lineAlpah=i||.5,this.lineRare=e||.8,this.lineWidth=s||1},i.prototype.run=function(){this.isRun&&(this.logPath(),this.draw())},i.prototype.stop=function(){this.isRun=!1,this.graphics&&this.graphics.clear(),this.rmAllPath()},i.prototype.start=function(){this.isRun=!0},i.prototype.dispose=function(){this.stop(),this.rmAllTarget(),this.targets=null,this.paths=null},i}(egret.Shape);t.ILinearTrailing=i,__reflect(i.prototype,"miniGame.ILinearTrailing")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(t){function i(){var i=t.call(this)||this;return Matter.Render.create=e.create,Matter.Mouse.create=s.create,i}return __extends(i,t),i.prototype.getAttribute=function(t){return 1},i.prototype.createEngine=function(t){t||(t={gravity:{x:0,y:1,scale:.001}}),this.engine?Matter.Common.extend(this.engine,t):this.engine=Matter.Engine.create(t)},i.prototype.createRunner=function(t){t||(t={}),this.runner?Matter.Common.extend(this.runner,t):(this.runner=Matter.Runner.create(t),this.runner.isFixed=!0)},i.prototype.createRender=function(t){var i={element:document.body,engine:this.engine,container:this,canvas:this,options:{width:StageManager.stageWidth,height:StageManager.stageHeight,showVelocity:!0,wireframes:!0}},e=Matter.Common.extend(i,t);if(this.render)Matter.Common.extend(this.render,e);else{if(this.render=Matter.Render.create(e),!this.runner||!this.engine)return void console.error("请先创建engine和runner");Matter.Runner.run(this.runner,this.engine)}},i.prototype.init=function(){this.isInit||(this.isInit=!0,this.createEngine(),this.createRunner(),this.createRender())},i.prototype.startRun=function(){this.isRunning||(this.isRunning=!0,egret.startTick(this.renderWorld,this))},i.prototype.stopRun=function(){this.isRunning&&(this.isRunning=!1,egret.stopTick(this.renderWorld,this))},i.prototype.renderWorld=function(t){return this.isRunning?(e.world(this.render),this.run(t),!1):void 0},i.prototype.run=function(t){},i.prototype.dispose=function(){this.isDestory||(this.isDestory=!0,Matter.Engine.clear(this.engine),Matter.Runner.stop(this.runner),this.stopRun())},i}(egret.DisplayObjectContainer);t.IMiniGameMatterScene=i,__reflect(i.prototype,"miniGame.IMiniGameMatterScene");var e=function(){function i(){}return i.create=function(t){var e={controller:i,engine:null,element:null,canvas:null,mouse:null,frameRequestId:null,timing:{historySize:60,delta:0,deltaHistory:[],lastTime:0,lastTimestamp:0,lastElapsed:0,timestampElapsed:0,timestampElapsedHistory:[],engineDeltaHistory:[],engineElapsedHistory:[],elapsedHistory:[]},options:{width:t.options.width||540,height:t.options.height||960,pixelRatio:1,background:"#fafafa",wireframeBackground:"#222222",hasBounds:!!t.bounds,enabled:!0,wireframes:!0,showSleeping:!0,showDebug:!1,showBroadphase:!1,showBounds:!1,showVelocity:!1,showCollisions:!1,showSeparations:!1,showAxes:!1,showPositions:!1,showAngleIndicator:!1,showIds:!1,showShadows:!1,showVertexNumbers:!1,showConvexHulls:!1,showInternalEdges:!1,showMousePosition:!1}},s=Matter.Common.extend(e,t);
return s.mouse=t.mouse,s.engine=t.engine,s.container=s.container||egret.lifecycle.stage,s.bounds=s.bounds||{min:{x:0,y:0},max:{x:s.options.width,y:s.options.height}},s},i.world=function(t){var e=t.engine,s=e.world,h=t.container,a=t.options,n=Matter.Composite.allBodies(s),o=Matter.Composite.allConstraints(s),r=[];a.wireframes;var l=t.bounds.max.x-t.bounds.min.x,p=t.bounds.max.y-t.bounds.min.y,c=l/t.options.width,u=p/t.options.height;if(a.hasBounds){for(var d=0;d<n.length;d++){var m=n[d];m.render.sprite.visible=Matter.Bounds.overlaps(m.bounds,t.bounds)}for(var g=0;g<o.length;g++){var f=o[g],b=f.bodyA,y=f.bodyB,G=f.pointA,v=f.pointB;b&&(G=Matter.Vector.add(b.position,f.pointA,null)),y&&(v=Matter.Vector.add(y.position,f.pointB,null)),G&&v&&(Matter.Bounds.contains(t.bounds,G)||Matter.Bounds.contains(t.bounds,v))&&r.push(f)}h.scaleX=1/c,h.scaleY=1/u,h.x=-t.bounds.min.x*(1/c),h.y=-t.bounds.min.y*(1/u)}else r=o;for(d=0;d<n.length;d++)i.body(t,n[d]);for(d=0;d<r.length;d++)i.constraint(t,r[d])},i.body=function(t,e){var s=e.render;if(s.visible)if(s.sprite&&s.sprite.texture){var h=e.egretSprite,a=t.container;h||(h=e.egretSprite=i._createBodySprite(t,e)),a.contains(h)||a.addChild(h),h.x=e.position.x,h.y=e.position.y,h.rotation=180*e.angle/Math.PI,h.scaleX=s.sprite.xScale||1,h.scaleY=s.sprite.yScale||1}else{var h=e.egretSprite,a=t.container;h||(h=i._createBodyPrimitive(t,e),e.egretSprite=h,h.initAngle=e.angle),a.contains(h)||a.addChild(h),h.x=e.position.x,h.y=e.position.y,h.rotation=180*(e.angle-h.initAngle)/Math.PI}},i._createBodySprite=function(i,e){var s=e.render,h=s.sprite.texture,a=GObj.create(t.ImageOutside);return a.setOutSrc(h,FileConst.png,"common"),a.anchorOffsetX=e.render.sprite.xOffset,a.anchorOffsetY=e.render.sprite.yOffset,a},i._createBodyPrimitive=function(t,i){var e,s,h,n,o=i.render,r=t.options,l=GObj.create(a),p=[],c=l.graphics;c.clear();for(var u=i.parts.length>1?1:0;u<i.parts.length;u++){n=i.parts[u],r.wireframes?(e=null,s=16711680,h=1):(e=o.fillStyle,s=o.strokeStyle,h=o.lineWidth);for(var d=0;d<n.vertices.length;d++)p.push([n.vertices[d].x-i.position.x,n.vertices[d].y-i.position.y]);c.lineStyle(1,s),c.moveTo(p[0][0],p[0][1]);for(var m=1;m<p.length;m++)c.lineTo(p[m][0],p[m][1]);c.lineTo(p[0][0],p[0][1]),c.endFill()}return l},i.constraint=function(t,i){var e=i.bodyA,s=i.bodyB,h=i.pointA,n=i.pointB,o=t.container,r=i.render,l=i.egretSprite;l||(l=i.egretSprite=GObj.create(a));var p=l.graphics;if(!r.visible||!i.pointA||!i.pointB)return void p.clear();o.contains(l)||o.addChild(l),p.clear();var c,u,d,m;e?(c=e.position.x+h.x,u=e.position.y+h.y):(c=h.x,u=h.y),s?(d=s.position.x+n.x,m=s.position.y+n.y):(d=n.x,m=n.y);var g=65280;p.lineStyle(1,g),p.moveTo(c,u),p.lineTo(d,m),p.endFill()},i}();__reflect(e.prototype,"EgretRender");var s=function(){function t(){}return t.create=function(i){var e={};return i||Matter.Common.log("Mouse.create: element was undefined, defaulting to document.body","warn"),e.element=i||this,e.absolute={x:0,y:0},e.position={x:0,y:0},e.mousedownPosition={x:0,y:0},e.mouseupPosition={x:0,y:0},e.offset={x:0,y:0},e.scale={x:1,y:1},e.wheelDelta=0,e.button=-1,e.pixelRatio=1,e.sourceEvents={mousemove:null,mousedown:null,mouseup:null,mousewheel:null},e.mousemove=function(i){var s=t._getRelativeMousePosition(i,e.element,e.pixelRatio);e.button=0,i.preventDefault(),e.absolute.x=s.x,e.absolute.y=s.y,e.position.x=e.absolute.x*e.scale.x+e.offset.x,e.position.y=e.absolute.y*e.scale.y+e.offset.y,e.sourceEvents.mousemove=i},e.mousedown=function(i){var s=t._getRelativeMousePosition(i,e.element,e.pixelRatio);e.button=0,i.preventDefault(),e.absolute.x=s.x,e.absolute.y=s.y,e.position.x=e.absolute.x*e.scale.x+e.offset.x,e.position.y=e.absolute.y*e.scale.y+e.offset.y,e.mousedownPosition.x=e.position.x,e.mousedownPosition.y=e.position.y,e.sourceEvents.mousedown=i,t.addBoundEvent(e,e.element)},e.mouseup=function(i){var s=t._getRelativeMousePosition(i,e.element,e.pixelRatio);i.preventDefault(),e.button=-1,e.absolute.x=s.x,e.absolute.y=s.y,e.position.x=e.absolute.x*e.scale.x+e.offset.x,e.position.y=e.absolute.y*e.scale.y+e.offset.y,e.mouseupPosition.x=e.position.x,e.mouseupPosition.y=e.position.y,e.sourceEvents.mouseup=i,t.clearElement(e,e.element)},e.mousewheel=function(t){t.preventDefault()},t.setElement(e,e.element),e},t._getRelativeMousePosition=function(t,i,e){return i.globalToLocal(t.stageX,t.stageY)},t.setElement=function(t,i){i.addEventListener(egret.TouchEvent.TOUCH_BEGIN,t.mousedown,i)},t.addBoundEvent=function(t,i){var e=egret.lifecycle.stage;e&&(e.addEventListener(egret.TouchEvent.TOUCH_MOVE,t.mousemove,i),e.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,t.mouseup,i),e.addEventListener(egret.TouchEvent.TOUCH_END,t.mouseup,i))},t.clearElement=function(t,i){var e=egret.lifecycle.stage;e&&(e.removeEventListener(egret.TouchEvent.TOUCH_MOVE,t.mousemove,i),e.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,t.mouseup,i),e.removeEventListener(egret.TouchEvent.TOUCH_END,t.mouseup,i))},t}();__reflect(s.prototype,"EgretMouse");var h=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return __extends(i,t),i}(egret.Bitmap);__reflect(h.prototype,"BitMap");var a=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return __extends(i,t),i}(egret.Sprite);__reflect(a.prototype,"Sprite")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(){function t(){this.movies={},this._pngDict={},this.movieBack={},this.movieThis={},this.sheets={},this.sheetsLoading={},this.sheetsCallFun={},this.pools={},this.sceneIn={}}return Object.defineProperty(t,"ins",{get:function(){return t._ins||(t._ins=GObj.create(t)),t._ins},enumerable:!0,configurable:!0}),t.prototype.getMovie=function(t,i,e){this.movies||(this.movies={}),this.movieBack[t]||(this.movieBack[t]=[]),this.movieBack[t].push(i),this.movieThis[t]||(this.movieThis[t]=[]),this.movieThis[t].push(e),this.callBack(t)||$GApp.loaderMgr.load(t+FileConst.json,this.movieCfgLoadCpmplete,this,LoaderConst.PRIORITY_DEFAULT,t)},t.prototype.movieCfgLoadCpmplete=function(t){if(this.movies){var i=GObj.create(EffectSheetData);i.key=t.args,i.jsonObj=t.data,t.data&&(i.ftime=t.data.ftime,i.autoAngle=t.data.autoAngle,i.auto8dir=t.data.auto8dir,i.refStage=t.data.refStage,i.layerIndex=t.data.layerIndex||0,i.shootSpeed=t.data.shootSpeed||0),i.jsonLvo=t;var e=i.key+FileConst.png;$GApp.loaderMgr.load(e,this.moviePngLoadCpmplete,this,LoaderConst.PRIORITY_DEFAULT,i)}},t.prototype.moviePngLoadCpmplete=function(t){if(this.movies){var i,e,s,h=t.args,a=h.jsonObj;if(h.pngLvo=t,a&&t.data)for(var n=AvatarConsts.DIR_MIN;n<=AvatarConsts.DIR_NUM;n++){s=GConst.EFF+n;var o=a[s];if(o){i=GObj.create(EffectSheetVO),i.angle=o.angle,h.$eff[s]=i;var r=o.items;if(r)for(var l=r.length,p=0;l>p;p++){var c=r[p];e=GObj.create(EffectItemVO),ObjectUtil.oto(c,e);var u=h.$res[c.res];if(u||(h.$res[c.res]=u=this.drawToTexture(a.res[c.res],t.data)),u){var d=0;if(e.anchorCenter){for(var m=a.res[c.res],g=0,f=0,b=0,y=m;b<y.length;b++){var G=y[b];G.h>g&&(g=G.h,f=G.offY)}d=f-g/2}for(var v=u.length,I=0;v>I;I++){var O=u[I],C=GObj.create(SheetVO);C.offX=-O.offX,C.offY=-O.offY+d,C.ttr=O.ttr,e.ttfs.push(C)}}i.items.push(e)}i.format()}}this.movies[h.key]=h,this.callBack(h.key)}},t.prototype.callBack=function(t){var i=this.movies[t];if(!i)return!1;if(i.pngLvo){var e=this._pngDict[i.pngLvo.url];!e||0>=e?e=1:e++,this._pngDict[i.pngLvo.url]=e}this.movies[i.key]=i;var s=this.movieBack[i.key],h=this.movieThis[i.key];if(s){for(var a=0;a<s.length;a++)s[a]&&s[a].call(h[a],i);delete this.movieBack[i.key],delete this.movieThis[i.key]}return!0},t.prototype.drawToTexture=function(t,i){if(t){for(var e,s=t.length,h=GObj.create(egret.Rectangle),a=[],n=0;s>n;n++){e=GObj.create(SheetVO);var o=t[n];h.x=o.x,h.y=o.y,h.width=o.w,h.height=o.h,e.offX=o.offX,e.offY=o.offY,e.ttr=BitmapUtil.drawToTexture(i,h),a.push(e)}return a}},t.prototype.destoryMovieByKey=function(t){if(this.movies){var i=this.movies[t];if(i){var e=this._pngDict[i.pngLvo.url];e--,0>=e?this.gcByKey(t):this._pngDict[i.pngLvo.url]=e}}},t.prototype.destoryAllMovie=function(){if(this.movies){for(var t in this.movies)this._pngDict[t]=0,this.gcByKey(t);this.movies=null,this._pngDict={}}},t.prototype.gcByKey=function(t){var i=this.movies[t];if(i){if(i.pngLvo){var e=this._pngDict[i.pngLvo.url];e&&e>=1&&e--,this._pngDict[i.pngLvo.url]=e,!e||0>=e?delete this._pngDict[i.pngLvo.url]:i.pngLvo=null}return GObj.disposeObject(i),delete this.movies[t],!0}return!1},t.prototype.getImageByKey=function(t,i){var e=this.sheets[t];return e?e.getTexture(i):null},t.prototype.checkSheets=function(t){return null!=this.sheets[t]},t.prototype.loadSheet=function(t,i,e){return this.sheets[t]?void(i&&i.call(e)):(this.sheetsCallFun[t]||(this.sheetsCallFun[t]=[]),this.sheetsCallFun[t].push({callBack:i,thisObj:e}),void(this.sheetsLoading[t]||(this.sheetsLoading[t]=!0,RES.getResByUrl(t+FileConst.json,this.loadSheetSuccess,this,RES.ResourceItem.TYPE_SHEET))))},t.prototype.loadSheetSuccess=function(t){var i=t.$resourceInfo||{url:null},e=i.url;if(!e)return void console.error("loadSheetSuccess获取信息错误",t);var s=e.slice(0,e.length-4);this.sheets[s]=t;var h=this.sheetsCallFun[s];if(h){for(var a=0,n=h;a<n.length;a++){var o=n[a];o&&o.callBack&&o.callBack.call(o.thisObj),o.callBack=null,o.thisObj=null}delete this.sheetsCallFun[s],delete this.sheetsLoading[s]}},t.prototype.disposeAllSheet=function(){if(this.sheets){for(var t in this.sheets)this.sheets[t]&&(this.sheets[t].dispose(),RES.destroyRes(t+FileConst.png),RES.destroyRes(t+FileConst.json),delete this.sheets[t]);var i;for(var e in this.sheetsCallFun){i=this.sheetsCallFun[e];for(var s=0,h=i;s<h.length;s++){var a=h[s];a&&(a.callBack=null,a.thisObj=null)}}this.sheets={},this.sheetsLoading={},this.sheetsCallFun={}}},t.prototype.getPoolByClass=function(t,i){var e=egret.getQualifiedClassName(t),s=this.pools[e]||[],h=s.pop()||GObj.create(t,i);return h},t.prototype.backPoolByObject=function(t){var i=egret.getQualifiedClassName(t),e=this.pools[i]||[];e.push(t),this.pools[i]=e},t.prototype.destoryPool=function(){if(this.pools){var t,i;for(var e in this.pools)if(t=this.pools[e]){for(;t.length>0;)i=t.pop(),GObj.disposeObject(i),i=null;t=null,delete this.pools[e]}this.pools={}}},t.prototype.getSceneInByClass=function(t,i){return!i&&(i=egret.getQualifiedClassName(t)),this.sceneIn[i]||[]},t.prototype.pushSceneInByObject=function(t,i){!i&&(i=egret.getQualifiedClassName(t));var e=this.sceneIn[i]||[];e.push(t),this.sceneIn[i]=e},t.prototype.backPoolAllObject=function(){if(this.sceneIn){var t,i;for(var e in this.sceneIn)if(t=this.sceneIn[e]){for(;t.length>0;)i=t.pop(),i&&(i.removeMe&&i.removeMe(),i.parent&&i.parent.removeChild(i),this.backPoolByObject(i));t=null,delete this.sceneIn[e]}this.sceneIn={}}},t.destory=function(){t._ins&&t._ins.dispose()},t.prototype.dispose=function(){this.destoryAllMovie(),this.backPoolAllObject(),this.destoryPool(),this.pools=null,this.sceneIn=null,this.movies=null,this._pngDict=null,this.movieBack=null,this.movieThis=null,this.sheets=null,this.sheetsLoading=null,t._ins=null},t}();t.IMiniGameMgr=i,__reflect(i.prototype,"miniGame.IMiniGameMgr")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.addEventListener(egret.Event.ADDED_TO_STAGE,t.addToStage,t),t}return __extends(e,i),e.prototype.initSkin=function(){var i=this;this.bg||(this.dir=AvatarConsts.B_B,this.angle=90,this.rateVal=10,this.bg=GObj.create(t.ImageOutside),this.bg.touchEnabled=!1,this.bg.loadCompleteCall(function(){i.width=i.bg.iconWidth,i.height=i.bg.iconHeight,i.startX=i.width/2,i.startY=i.height/2,i.setArrowPoint()},this),this.bg.setOutSrc("rocker"),this.addChild(this.bg),this.rockerRect=GObj.create(eui.Rect),this.rockerRect.fillAlpha=.001,this.rocker=GObj.create(t.ImageOutside),this.rocker.touchEnabled=!1,this.rocker.loadCompleteCall(function(){i.rockerRect.width=4*i.rocker.iconWidth,i.rockerRect.height=4*i.rocker.iconHeight,i.rockerRect.anchorOffsetX=i.rockerRect.width/2,i.rockerRect.anchorOffsetY=i.rockerRect.height/2,i.rocker.anchorOffsetX=i.rocker.iconWidth/2,i.rocker.anchorOffsetY=i.rocker.iconHeight/2},this),this.rocker.setOutSrc("rockerPoint"),this.addChild(this.rocker),this.addChild(this.rockerRect),this.arrow=GObj.create(t.ImageOutside),this.arrow.touchEnabled=!1,this.arrow.loadCompleteCall(this.setArrowPoint,this),this.arrow.setOutSrc("rocketArrow"),this.addChild(this.arrow),this.addEvent())},e.prototype.setArrowPoint=function(){this.arrow&&this.bg&&this.arrow.iconWidth&&this.bg.iconWidth&&(this.arrow.anchorOffsetX=this.arrow.iconWidth/2,this.arrow.anchorOffsetY=this.bg.iconHeight/2+this.arrow.iconHeight/2+10,this.arrow.x=this.startX,this.arrow.y=this.startY,this.arrow.rotation=180,this.onEndClick(),this.callBack&&this.callBack.call(this.parentObj),this.oldx=this.x,this.oldy=this.y)},e.prototype.addEvent=function(){this.sceneArea&&this.sceneArea.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onSceneAreaClick,this),this.rockerRect.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBeginClick,this)},e.prototype.removeEvent=function(){this.sceneArea&&this.sceneArea.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onSceneAreaClick,this),this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.addToStage,this),this.rockerRect.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBeginClick,this),this.rockerRect.removeEventListener(egret.TouchEvent.TOUCH_END,this.onEndClick,this),this.parentObj&&(this.parentObj.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onMoveClick,this),this.parentObj.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMoveClick,this))},e.prototype.addToStage=function(){this.initSkin(),this.parentObj=this.parent,this.alpha=.5},e.prototype.onSceneAreaClick=function(t){this.x=t.stageX-this.startX,this.y=t.stageY-this.startY,this.onBeginClick(t)},e.prototype.onBeginClick=function(t){this.isMove||(this.isMove=!0,this.rockerRect.addEventListener(egret.TouchEvent.TOUCH_END,this.onEndClick,this),this.parentObj&&(this.parentObj.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onEndClick,this),this.parentObj.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMoveClick,this)),this.alpha=1,this.setPose(t))},e.prototype.onMoveClick=function(t){this.setPose(t)},e.prototype.setPose=function(t){this.tempPoint||(this.tempPoint=GObj.create(egret.Point)),this.globalToLocal(t.stageX,t.stageY,this.tempPoint);var i=GMath.distance(this.tempPoint.x,this.tempPoint.y,this.startX,this.startY);if(!(i<this.rateVal)){this.rockerRect.x=this.tempPoint.x,this.rockerRect.y=this.tempPoint.y;var e=this.width/2;if(i=GMath.distance(this.tempPoint.x,this.tempPoint.y,e,this.height/2),i>e){var s=GMath.towardSource(this.width/2,this.height/2,this.tempPoint.x,this.tempPoint.y,e);this.tempPoint.x=s.x,this.tempPoint.y=s.y,this.startX=this.width/2,this.startY=this.height/2}this.rocker.x=this.tempPoint.x,this.rocker.y=this.tempPoint.y,this.dir=this.getRocker(),this.startX=this.rocker.x,this.startY=this.rocker.y}},e.prototype.onEndClick=function(){this.parentObj&&(this.rockerRect.removeEventListener(egret.TouchEvent.TOUCH_END,this.onEndClick,this),this.parentObj.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onEndClick,this),this.parentObj.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMoveClick,this)),this.isMove=!1,this.startX=this.width/2,this.startY=this.height/2,this.rockerRect.x=this.startX,this.rockerRect.y=this.startY,this.rocker.x=this.startX,this.rocker.y=this.startY,this.x=this.oldx||this.x,this.y=this.oldy||this.y,this.alpha=.5},e.prototype.getRocker=function(){var t=this.startX,i=this.startY,e=this.rocker.x,s=this.rocker.y,h=GMath.angle(t,i,e,s);this.arrow.rotation=h+90,this.angle=h;var a=9-Math.floor((h+5.625)/11.25);return 0>=a&&(a+=32),a},e.prototype.setCallBack=function(t,i){this.callBack=i,this.parentObj=t},e.prototype.dispose=function(){this.bg&&(this.removeEvent(),GObj.disposeObject(this.bg),this.bg=null,GObj.disposeObject(this.rocker),this.rocker=null,GObj.disposeObject(this.rockerRect),this.rockerRect=null,GObj.disposeObject(this.arrow),this.arrow=null,this.parentObj=null,this.callBack=null,this.sceneArea=null,this.tempPoint=null)},e}(eui.Group);t.IMiniGameRocker=i,__reflect(i.prototype,"miniGame.IMiniGameRocker")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(t){function i(){var i=t.call(this)||this;return i.scaleZ=1,i.gap=10,i.loadCompleteCall(function(){i.anchorOffsetX=i.iconWidth/2,i.anchorOffsetY=i.iconHeight/2},i),i}return __extends(i,t),i.prototype.move=function(){var t=this.target;t&&(this.x=t.x,this.y=t.y+this.gap,this.alpha=t.alpha,this.scaleX=t.scaleX*this.scaleXY,this.scaleY=t.scaleY*this.scaleXY,this.visible=t.visible)},i.prototype.setTarget=function(t,i,e){this.target=t,this.scaleXY=i||1,this.gap=e||10,this.x=t.x,this.y=t.y},i.prototype.removeMe=function(){this.parent&&this.parent.removeChild(this),this.visible=!1},i.prototype.dispose=function(){this.target=null,t.prototype.dispose.call(this)},i}(t.ImageOutside);t.IShadow=i,__reflect(i.prototype,"miniGame.IShadow")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(t){return i.call(this,t)||this}return __extends(e,i),e.prototype.getGameView=function(){return this.gameView||(this.gameView=GObj.create(t.IMiniGame1View)),this.gameView.setData(this.configData.config,this.getCurGameData()),this.gameView},e}(t.IMiniGameBaseCtr);t.IMiniGame1=i,__reflect(i.prototype,"miniGame.IMiniGame1")}(miniGame||(miniGame={}));var miniGame;!function(t){t.IMiniGame1Consts={gou_scalx:.5,extra:"",extraNum:0,man_effet:"ui_renwu",chugou_effet:"ui_chugoufankui",zhuaqu_effet:"ui_zhuaqufankui",huode1_effet:"ui_huodeshanshuo",huode2_effet:"ui_huodeshuzi",man_chugou_effct:"ui_renwu_shifa",yun_effct:"minigame1_yun",gunlun:"gunlun",xingxing_effct:"ui_shanguang"}}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.initIcon(),t}return __extends(e,i),e.prototype.initIcon=function(){this.iconBg=GObj.create(t.ImageOutside),this.iconBg.x=this.iconBg.y=0,this.addChild(this.iconBg),this.iconBg.loadCompleteCall(this.initSkin,this),this.iconBg.setOutSrc("iconBg",FileConst.png)},e.prototype.initSkin=function(){var i=this;this.height=this.iconBg.height,this.icon=GObj.create(t.ImageOutside),this.icon.loadCompleteCall(function(){i.icon.x=i.iconBg.x+(i.iconBg.width-i.icon.width)/2,i.icon.y=i.iconBg.y+(i.iconBg.height-i.icon.height)/2},this),this.icon.setOutSrc("121",FileConst.png),this.addChild(this.icon),this.add=GObj.create(t.ImageOutside),this.add.loadCompleteCall(function(){i.add.x=i.iconBg.x+i.iconBg.width+2,i.add.y=i.iconBg.y+(i.iconBg.height-i.add.height)/2,i.numberImg=GObj.create(t.IBitNumMap),i.numberImg.x=i.add.x+i.add.width+2,i.numberImg.verticalCenter=0,i.numberImg.setGap(0),i.numberImg.setPath("num1"),i.addChild(i.numberImg)},this),this.add.setOutSrc("add",FileConst.png),this.addChild(this.add)},e.prototype.setRewardNumber=function(t){var i=this;this.numberImg.setNumber(t),this.visible=!0,this.alpha=1,egret.Tween.removeTweens(this),egret.Tween.get(this).to({y:this.y-10,alpha:0},1e3).call(function(){i.visible=!1,i.y=i.y+10,egret.Tween.removeTweens(i)})},e.prototype.dispose=function(){egret.Tween.removeTweens(this),GObj.disposeObject(this.iconBg),this.iconBg=null,GObj.disposeObject(this.icon),this.icon=null,GObj.disposeObject(this.numberImg),this.numberImg=null,GObj.disposeObject(this.add),this.add=null},e}(eui.Group);t.IMiniGame1GoldFly=i,__reflect(i.prototype,"miniGame.IMiniGame1GoldFly")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(t){function i(){return t.call(this)||this}return __extends(i,t),i.prototype.setHalfFun=function(t,i){this.halfBack=t,this.halfThis=i},i.prototype.run=function(){if(this.isRun&&this._effectCount>0&&this.parent){var t=this._effect;if(t){var i=Math.floor(($GApp.timer-this._startTime)/this._playInterval)%this._effectCount;if(i==this.frame)return;0==i&&this.halfBack&&this.halfBack.call(this.halfThis),this.frame=i;var e=t.ttfs[i];this.bitMap.texture=e.ttr,this.bitMap.x=e.offX,this.bitMap.y=e.offY,i==t.ttfs.length-1&&this.showComplete()}}},i.prototype.dispose=function(){this.halfBack=null,this.halfThis=null,t.prototype.dispose.call(this)},i}(t.IMovie);t.IMiniGame1Moive=i,__reflect(i.prototype,"miniGame.IMiniGame1Moive")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.initIcon(),t}return __extends(e,i),e.prototype.initIcon=function(){this.iconBg=GObj.create(t.ImageOutside),this.iconBg.loadCompleteCall(this.initSkin,this),this.iconBg.setOutSrc("numbg"),this.iconBg.x=this.iconBg.y=0,this.addChild(this.iconBg)},e.prototype.initSkin=function(){this.height=this.iconBg.height,this.width=this.iconBg.width,this.isInskin&&this.setData(this.num,this.key,this.data)},e.prototype.setData=function(i,e,s){var h=this;if(!this.height)return this.num=i,this.key=e,this.data=s,void(this.isInskin=!0);this.icon=GObj.create(t.ImageOutside),this.icon.verticalCenter=2,this.icon.left=21,this.add=GObj.create(eui.Label),this.add.verticalCenter=2,this.add.textColor=16776688,this.add.size=16,this.numberImg=GObj.create(t.ImageOutside),this.numberImg.setOutSrc("121",FileConst.png),this.numberImg.verticalCenter=2;var a=i%3;switch(a){case 0:this.right=15;break;case 1:this.left=15;break;case 2:this.horizontalCenter=0}var n=Math.floor((i-1)/3),o=n?4:0;this.top=4+this.height*n+o,this.icon.loadCompleteCall(function(){h.add.left=h.icon.left+h.icon.width+3,h.add.text="="+s,h.numberImg.left=h.add.left+h.add.width+3},this),this.icon.setOutSrc(e,FileConst.png),this.addChild(this.icon),this.addChild(this.add),this.addChild(this.numberImg)},e.prototype.dispose=function(){GObj.disposeObject(this.iconBg),this.iconBg=null,GObj.disposeObject(this.icon),this.icon=null,GObj.disposeObject(this.numberImg),this.numberImg=null,GObj.disposeObject(this.add),this.add=null,this.num=null,this.data=null,this.key=null,this.isInskin=null},e}(eui.Group);t.IMiniGame1NumItem=i,__reflect(i.prototype,"miniGame.IMiniGame1NumItem")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.initSkin(),t}return __extends(e,i),e.prototype.initSkin=function(){this.Image3=GObj.create(t.ImageOutside),this.Image3.visible=!1,this.Image3.verticalCenter=this.Image3.horizontalCenter=0,this.Image3.setOutSrc("start3"),this.addChild(this.Image3),this.Image2=GObj.create(t.ImageOutside),this.Image2.visible=!1,this.Image2.verticalCenter=this.Image2.horizontalCenter=0,this.Image2.setOutSrc("start2"),this.addChild(this.Image2),this.Image1=GObj.create(t.ImageOutside),this.Image1.visible=!1,this.Image1.verticalCenter=this.Image1.horizontalCenter=0,this.Image1.setOutSrc("start1"),this.addChild(this.Image1)},e.prototype.playV=function(t,i){var e=this;this.fun=t,this.thisObj=i,this.Image3.visible=!0,egret.Tween.get(this.Image3,{loop:!1}).to({scaleX:2,scaleY:2},400).to({alpha:0},400).call(function(){e.Image3.visible=!1,e.Image3.alpha=1,e.Image3.scaleX=e.Image3.scaleY=1,e.Image2.visible=!0,egret.Tween.get(e.Image2,{loop:!1}).to({scaleX:2,scaleY:2},400).to({alpha:0},400).call(function(){e.Image2.visible=!1,e.Image2.alpha=1,e.Image2.scaleX=e.Image2.scaleY=1,e.Image1.visible=!0,egret.Tween.get(e.Image1,{loop:!1}).to({scaleX:2,scaleY:2},400).to({alpha:0},400).call(function(){egret.Tween.removeTweens(e),e.Image1.visible=!1,e.Image1.alpha=1,e.Image1.scaleX=e.Image1.scaleY=1,e.fun&&e.thisObj&&e.fun.call(e.thisObj)},e)},e)},this)},e.prototype.stopV=function(){this.fun=null,this.thisObj=null,egret.Tween.removeTweens(this.Image1),egret.Tween.removeTweens(this.Image2),egret.Tween.removeTweens(this.Image3),this.Image1.visible=this.Image2.visible=this.Image3.visible=!1,this.Image1.alpha=this.Image2.alpha=this.Image3.alpha=1,this.Image1.scaleX=this.Image1.scaleY=this.Image2.scaleX=this.Image2.scaleY=this.Image3.scaleX=this.Image3.scaleY=1},e.prototype.dispose=function(){this.stopV(),GObj.disposeObject(this.Image1),this.Image1=null,GObj.disposeObject(this.Image2),this.Image2=null,GObj.disposeObject(this.Image3),this.Image3=null},e}(eui.Group);t.IMiniGame1StartGame=i,__reflect(i.prototype,"miniGame.IMiniGame1StartGame")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.initLocalData(),t.initSkin(),t.initRight(),t.initMovieEffect(),t.initLastSkin(),t.once(egret.Event.ADDED_TO_STAGE,t.addToStageComplete,t),t}return __extends(e,i),e.prototype.initLocalData=function(){this.pos=GObj.create(egret.Point),this.textNum=0,this.times=90,this.allNumber=0,this.original_length=60,void 0==this.rope_number&&(this.rope_number=5),this.itemArr=[],this.numberBgItemArr=[],this.colorArr=[1,0,0,0,255,0,1,0,0,255,0,0,1,0,255,0,0,0,1,0],this.o_colorArr=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]},e.prototype.initSkin=function(){var i=this;this.height=960,this.width=540,this.horizontalCenter=this.verticalCenter=0,this.bmask_bg=GObj.create(t.ImageOutside),this.bmask_bg.setOutSrc("core_frame_bg",FileConst.png),this.bmask_bg.verticalCenter=this.bmask_bg.horizontalCenter=0,this.bmask_bg.width=StageManager.stageWidth,this.bmask_bg.height=StageManager.stageHeight,this.addChild(this.bmask_bg),this.gameBg=GObj.create(t.ImageOutside),this.gameBg.setOutSrc("gameBg",FileConst.jpg),this.gameBg.verticalCenter=this.gameBg.horizontalCenter=0,this.addChild(this.gameBg),this.itemBg=GObj.create(t.ImageOutside),this.itemBg.setOutSrc("itemBg",FileConst.png),this.itemBg.top=this.itemBg.left=0,this.addChild(this.itemBg),this.yun_eff=GObj.create(t.IMovieMore),this.yun_eff.x=this.width/2,this.yun_eff.y=this.height/2,this.yun_eff.alpha=.45,this.addChild(this.yun_eff),this.man_effct=GObj.create(t.IMovie),this.addChild(this.man_effct),this.man_effct.x=this.width/2,this.man_effct.y=320,this.man_effct.start(t.IMiniGame1Consts.man_effet,0),this.man_effct.autoRun(),this.man_chugou_effct=GObj.create(t.IMiniGame1Moive),this.man_chugou_effct.x=this.width/2,this.man_chugou_effct.y=this.man_effct.y,this.man_chugou_effct.setHalfFun(this.hideMan,this),this.man_chugou_effct.setCompleteBack(this.showMan,this),this.addChild(this.man_chugou_effct),this.gunlun_img=GObj.create(t.ImageOutside),this.gunlun_img.loadCompleteCall(function(){i.gunlun_img.anchorOffsetX=51,i.gunlun_img.anchorOffsetY=53,i.gunlun_img.x=i.man_effct.x+12,i.gunlun_img.y=i.man_effct.y-40},this),this.gunlun_img.setOutSrc("gunlun",FileConst.png),this.addChild(this.gunlun_img),this.turn_eff=GObj.create(t.IMovie),this.turn_eff.x=this.man_effct.x+10,this.turn_eff.y=this.man_effct.y-40,this.addChild(this.turn_eff),this.hookGroup=GObj.create(eui.Group),this.hookGroup.x=this.width/2,this.hookGroup.y=this.man_effct.y-50,this.hookGroup.height=this.original_length,this.hookGroup.width=1,this.hookGroup.rotation=0,this.addChild(this.hookGroup),this.rope=GObj.create(t.ImageOutside),this.rope.setOutSrc("lianzi",FileConst.png),this.rope.top=0,this.rope.horizontalCenter=0,this.rope.bottom=0,this.rope.fillMode="repeat",this.hookGroup.addChild(this.rope),this.hook=GObj.create(t.ImageOutside),this.hook.horizontalCenter=.5,this.hook.scaleX=this.hook.scaleY=.5,this.hook.loadCompleteCall(function(){i.hook.anchorOffsetX=i.hook.width/2?i.hook.width/2:30,i.hook.anchorOffsetY=i.hook.height/3*2?i.hook.height/3*2:33,i.hook.bottom=-Math.floor(i.hook.height/3*2*i.hook.scaleY)},this),this.hook.setOutSrc("kai",FileConst.png),this.hookGroup.addChild(this.hook),this.boom=GObj.create(t.IMovie),this.hookGroup.addChild(this.boom),this.bubbleGroup=GObj.create(eui.Group),this.bubbleGroup.top=84,this.bubbleGroup.horizontalCenter=0,this.addChild(this.bubbleGroup),this.bubbleImg=GObj.create(t.ImageOutside),this.bubbleImg.loadCompleteCall(function(){i.bubbleGroup.width=i.bubbleImg.width,i.bubbleGroup.height=i.bubbleImg.height},this),this.bubbleImg.setOutSrc("bubble",FileConst.png),this.bubbleImg.horizontalCenter=0,this.bubbleImg.verticalCenter=0,this.bubbleGroup.addChild(this.bubbleImg),this.bubbleText=GObj.create(eui.Label),this.bubbleText.size=18,this.bubbleText.textColor=7420426,this.bubbleText.width=180,this.bubbleText.wordWrap=!0,this.bubbleText.horizontalCenter=0,this.bubbleText.verticalCenter=-10,this.bubbleText.textAlign="center",this.bubbleGroup.addChild(this.bubbleText)},e.prototype.showMan=function(){this.man_effct.visible=!0},e.prototype.hideMan=function(){this.man_effct.visible=!1},e.prototype.initRight=function(){this.levelImgBg=GObj.create(t.ImageOutside),this.levelImgBg.setOutSrc("bigiconbg",FileConst.png),this.levelImgBg.left=30,this.levelImgBg.top=97,this.addChild(this.levelImgBg),this.timeImg=GObj.create(t.ImageOutside),this.timeImg.setOutSrc("smalliconbg",FileConst.png),this.timeImg.left=33,this.timeImg.top=135,this.addChild(this.timeImg),this.levelImg=GObj.create(t.ImageOutside),this.levelImg.setOutSrc("section",FileConst.png),this.levelImg.left=49,this.levelImg.top=101,this.addChild(this.levelImg),this.numImage=GObj.create(t.IBitNumMap),this.numImage.left=75,this.numImage.top=103,this.numImage.setGap(0),this.numImage.setPath("num1"),this.numImage.setNumber(1),this.addChild(this.numImage),this.levelImg2=GObj.create(t.ImageOutside),this.levelImg2.setOutSrc("level",FileConst.png),this.levelImg2.left=96,this.levelImg2.top=101,this.addChild(this.levelImg2),this.timeText=GObj.create(eui.Label),this.timeText.size=16,this.timeText.textColor=6291217,this.timeText.top=139,this.timeText.left=57,this.timeText.text=this.dateM(this.times),this.addChild(this.timeText),this.iconNumBg=GObj.create(t.ImageOutside),this.iconNumBg.setOutSrc("bigiconbg",FileConst.png),this.iconNumBg.right=30,this.iconNumBg.top=93,this.addChild(this.iconNumBg),this.iconBg=GObj.create(t.ImageOutside),this.iconBg.setOutSrc("iconBg",FileConst.png),this.iconBg.right=103,this.iconBg.top=89,this.addChild(this.iconBg),this.rewardImage=GObj.create(t.ImageOutside),this.rewardImage.setOutSrc("121",FileConst.png),this.rewardImage.right=110,this.rewardImage.top=96,this.addChild(this.rewardImage),this.labelText=GObj.create(eui.Label),this.labelText.size=20,this.labelText.text=this.allNumber+"",this.labelText.horizontalCenter=200,this.labelText.top=98,this.labelText.textColor=16776688,this.addChild(this.labelText)},e.prototype.initMovieEffect=function(){this.go_rope=GObj.create(t.IMovie),this.go_rope.x=this.hookGroup.x,this.go_rope.y=this.hookGroup.y,this.addChild(this.go_rope),this.get_reward=GObj.create(t.IMovie),this.addChild(this.get_reward),this.win1_effct=GObj.create(t.IMovie),this.win1_effct.x=this.hookGroup.x,this.win1_effct.y=this.hookGroup.y,this.addChild(this.win1_effct),this.star_eff=GObj.create(t.IMovie),this.addChild(this.star_eff)},e.prototype.initLastSkin=function(){this.goldNumber=GObj.create(t.IMiniGame1GoldFly),this.goldNumber.x=200,this.goldNumber.y=this.man_effct.y-80,this.goldNumber.visible=!1,this.addChild(this.goldNumber),this.startGameGroup=GObj.create(t.IMiniGame1StartGame),this.startGameGroup.width=this.width,this.startGameGroup.height=this.height,this.startGameGroup.verticalCenter=this.startGameGroup.horizontalCenter=0,this.addChild(this.startGameGroup),this.mask_bg=GObj.create(t.ImageOutside),this.mask_bg.setOutSrc("mask",FileConst.png),this.mask_bg.bottom=this.mask_bg.top=this.mask_bg.left=this.mask_bg.right=0,this.addChild(this.mask_bg),this.startBtn=GObj.create(t.IBaseBtn),this.startBtn.icon=IMiniGameMain.getIcon("startbtn",FileConst.png),this.startBtn.verticalCenter=this.startBtn.horizontalCenter=0,this.addChild(this.startBtn),this.exitBtn=GObj.create(t.IBaseBtn),this.exitBtn.icon=IMiniGameMain.getIcon("exit_btn",FileConst.png,"chapter"),this.exitBtn.right=35,this.exitBtn.top=180,this.addChild(this.exitBtn),this._ropeTurn()},e.prototype.setData=function(i,e){this.allData=i,this.stageData=e,this.allData&&(t.IMiniGame1Consts.extra=this.allData.extra||"",IMiniGameMain.playBgm(this.allData.minigame1_bgm)),this.updateView()},e.prototype.addToStageComplete=function(){this.initEvent()
},e.prototype.initEvent=function(){this.startBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.__startGame,this),this.exitBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this)},e.prototype.removeEvent=function(){this.clearTween(),this.removeEventListener(egret.Event.ENTER_FRAME,this.update,this),this.startBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.__startGame,this),DispatcherManager.removeListener(HGEvent.HEARTBEAT,this.timeFunc,this),DispatcherManager.removeListener(HGEvent.HEARTBEAT,this.bubbleF,this),this.exitBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this._launchRope,this)},e.prototype.updateView=function(){if(this.allData&&this.stageData){this.allData.gou_scalx?this.hook.scaleX=this.hook.scaleY=this.allData.gou_scalx:this.hook.scaleX=this.hook.scaleY=t.IMiniGame1Consts.gou_scalx,this.stageData&&(this.times=this.stageData.times||100,this.timeText.text=this.dateM(this.times),this.stageData.stageId>9?this.levelImg2.left=105:this.levelImg2.left=96,this.numImage.setNumber(this.stageData.stageId)),this.allData.ropeNumber&&(this.rope_number=this.allData.ropeNumber),this.allData.language&&(this.bubbleText.text=this.allData.language.language1),this.updateLevel();var i,e=1;if(!this.isCon){for(var s in this.allData.rewardId)i=GObj.create(t.IMiniGame1NumItem),i.setData(e,s,this.allData.rewardId[s]),this.addChildAt(i,e+2),this.numberBgItemArr.push(i),e++;this.isCon=!0}}},e.prototype.__startGame=function(){this.startBtn.visible=this.mask_bg.visible=!1,this.startGameGroup.playV(this.startPlay,this)},e.prototype.startPlay=function(){var i=this;IMiniGameMain.reqSocket(1,this.stageData.stageId),this.yun_eff.start(t.IMiniGame1Consts.yun_effct,0,100),this.yun_eff.autoRun(),this.stageData&&1==this.stageData.stageId&&ClockManager.setTimeout(function(){IMiniGameMain.getGuideView().playEffct(i.width/2,i.height/2),i.addChild(IMiniGameMain.getGuideView())},this,300),DispatcherManager.addListener(HGEvent.HEARTBEAT,this.bubbleF,this),DispatcherManager.addListener(HGEvent.HEARTBEAT,this.timeFunc,this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this._launchRope,this)},e.prototype.gameOver=function(i){var e=this;this.removeEventListener(egret.Event.ENTER_FRAME,this.update,this),DispatcherManager.removeListener(HGEvent.HEARTBEAT,this.timeFunc,this),DispatcherManager.removeListener(HGEvent.HEARTBEAT,this.bubbleF,this),this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this._launchRope,this),i?(IMiniGameMain.playEff(this.allData.minigame1_win),t.IMiniGame1Consts.extraNum=this.allNumber||0,ClockManager.setTimeout(function(){IMiniGameMain.reqSocket(3),t.IMiniGameResult.showResult(IMiniGameResultType.type_1,e.onClose,e,3,0/0,t.IMiniGame1Consts.extra,t.IMiniGame1Consts.extraNum)},this,1e3)):(IMiniGameMain.playEff(this.allData.minigame1_die),t.IMiniGameResult.showResult(IMiniGameResultType.type_0,this.updateLevel,this,3))},e.prototype.updateLevel=function(){if(this.clearTween(),this.itemArr)for(var i=0;i<this.itemArr.length;i++)this.itemArr[i]&&(egret.Tween.removeTweens(this.itemArr[i]),GObj.disposeObject(this.itemArr[i]),this.itemArr[i]=null);this.itemArr=[];for(var e,s,i=0;i<this.stageData.stageitem.length;i++){if(s=this.stageData.stageitem[i],e=GObj.create(t.IMovie),e.x=s.p4[0],e.y=s.p4[1],e.start(s.p2.split(",")[0],0),e.autoRun(),void 0==s.p6||s.p6){var h=Math.floor(4*Math.random())+1;egret.Tween.get(e,{loop:!0}).to({y:e.y-h},200*h).to({y:e.y},200*h).to({y:e.y+h},200*h).to({y:e.y},200*h)}this.addChildAt(e,i+3),this.itemArr.push(e)}this.stageData&&(this.times=this.stageData.times||100,this.timeText.text=this.dateM(this.times),this.stageData.stageId>9?this.levelImg2.left=105:this.levelImg2.left=96,this.numImage.setNumber(this.stageData.stageId)),this.initLevel()},e.prototype.initLevel=function(){this.o_colorMatrix||(this.o_colorMatrix=GObj.create(egret.ColorMatrixFilter,this.o_colorArr)),this.bubbleGroup.visible=!1,this.stageData&&1==this.stageData.stageId&&(this.bubbleGroup.visible=!0),this.man_effct&&(this.man_effct.x=this.width/2,this.man_effct.y=320,this.man_effct.scaleX=this.man_effct.scaleY=this.man_effct.alpha=1,this.man_effct.filters=[this.o_colorMatrix]),this.hookGroup&&(this.hookGroup.x=this.width/2,this.hookGroup.y=this.man_effct.y-50,this.hookGroup.height=this.original_length,this.hookGroup.width=1,this.rope.anchorOffsetY=0,this.hookGroup.anchorOffsetY=0,this.hookGroup.scaleX=this.hookGroup.scaleY=this.hookGroup.alpha=1,this.hookGroup.filters=[this.o_colorMatrix]),this.turn_eff&&(this.turn_eff.x=this.man_effct.x+11,this.turn_eff.y=this.man_effct.y-40,this.turn_eff.scaleX=this.turn_eff.scaleY=this.turn_eff.alpha=1,this.turn_eff.filters=[this.o_colorMatrix],this.gunlun_img.visible=!0),this.goldNumber&&(this.goldNumber.y=this.man_effct.y-80,this.goldNumber.visible=!1),this.allData.language&&(this.bubbleText.text=this.allData.language.language1),this.textNum=0,this.allNumber=0,this.hookGroup.rotation=0,this.hook.setOutSrc("kai",FileConst.png),this._ropeTurn(),this.changeText(0),this.yun_eff&&this.yun_eff.stop(),this.startBtn.visible=this.mask_bg.visible=!0},e.prototype._ropeTurn=function(t){egret.Tween.removeTweens(this.hookGroup),egret.Tween.get(this.hookGroup,{loop:!0}).to({rotation:60},1e3).to({rotation:0},1e3).to({rotation:-60},1e3).to({rotation:0},1e3)},e.prototype._launchRope=function(){this.bubbleGroup.visible=!1,IMiniGameMain.rmGuideView(),this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this._launchRope,this),egret.Tween.pauseTweens(this.hookGroup),this.rope_length=this.rope_number,this.isThree=!1,this.isOne=!0,this.selectImage=null,this.index=0/0,this.isp5=0,this.gunlun_img.visible=!1,this.turn_eff.start(t.IMiniGame1Consts.gunlun,0),this.turn_eff.autoRun(),this.man_chugou_effct.start(t.IMiniGame1Consts.man_chugou_effct,1),this.man_chugou_effct.autoRun(),this.go_rope.start(t.IMiniGame1Consts.chugou_effet,1),this.go_rope.autoRun(),this.maxLength=this.getMaxLength(),IMiniGameMain.playEff(this.allData.minigame1_chugou),this.addEventListener(egret.Event.ENTER_FRAME,this.update,this)},e.prototype.update=function(){this.ropeMove(),this.isOne&&this.checkHitAll()&&(this.stageData&&this.stageData.stageitem?this.rope_length=-3*this.stageData.stageitem[this.index-1].p1:this.rope_length=-this.rope_number,this.isOne=!1,this.afterHit()),1!=this.isp5&&this.rope.height>=this.maxLength-Math.abs(this.hook.bottom)&&1!=this.isp5&&(this.isOne=!1,this.rope_length=-this.rope_number),!this.isOne&&this.rope.height<Math.abs(this.rope_length)&&(1==this.isp5?this.removeEventListener(egret.Event.ENTER_FRAME,this.update,this):(this.rope_length=this.rope_number,this.isThree=!0),this.removeSelect()),this.selectImage&&(this.selectImage.y=this.hook.y,this.selectImage.x=this.hook.x),this.isThree&&this.rope.height>=this.original_length&&1!=this.isp5&&(this.gunlun_img.visible=!0,this.turn_eff.stop(),egret.Tween.resumeTweens(this.hookGroup),0==this.isp5&&this.addEventListener(egret.TouchEvent.TOUCH_TAP,this._launchRope,this),this.removeEventListener(egret.Event.ENTER_FRAME,this.update,this))},e.prototype.ropeMove=function(){this.hookGroup.height=this.hookGroup.height+this.rope_length,this.rope.height=this.rope.height+this.rope_length,1==this.isp5&&(this.rope.anchorOffsetY=this.rope.height,this.hookGroup.anchorOffsetY=this.hookGroup.height,this.man_effct.x=this.man_effct.x-Math.sin(this.hookGroup.rotation/180*Math.PI)*Math.abs(this.rope_length),this.man_effct.y=this.man_effct.y+Math.cos(this.hookGroup.rotation/180*Math.PI)*Math.abs(this.rope_length),this.turn_eff.x=this.turn_eff.x-Math.sin(this.hookGroup.rotation/180*Math.PI)*Math.abs(this.rope_length),this.turn_eff.y=this.turn_eff.y+Math.cos(this.hookGroup.rotation/180*Math.PI)*Math.abs(this.rope_length))},e.prototype.afterHit=function(){if(egret.Tween.removeTweens(this.itemArr[this.index-1]),this.stageData.stageitem[this.index-1].p5){var i=Number(this.stageData.stageitem[this.index-1].p5.split(",")[0]);switch(i){case 1:this.isp5=2,this.normalA();break;case 2:this.isp5=0,egret.Tween.get(this.selectImage).to({alpha:0},800),this.selectImage=null;break;case 3:this.isp5=1,this.selectImage=null,this.man_chugou_effct.stop(),this.showMan(),this.man_effct.start(t.IMiniGame1Consts.man_effet,0),this.man_effct.autoRun(),this.hook.setOutSrc("he",FileConst.png);var e=this.hookGroup.rotation;this.hookGroup.x=this.hookGroup.x-Math.sin(e/180*Math.PI)*this.hookGroup.height,this.hookGroup.y=this.hookGroup.y+Math.cos(e/180*Math.PI)*this.hookGroup.height,this.rope.anchorOffsetY=this.rope.height,this.hookGroup.anchorOffsetY=this.hookGroup.height}}else this.normalA()},e.prototype.normalA=function(){this.get_reward.x=this.selectImage.x,this.get_reward.y=this.selectImage.y,this.get_reward.start(t.IMiniGame1Consts.zhuaqu_effet,1),this.get_reward.autoRun(),this.hook.setOutSrc("he",FileConst.png),this.hookGroup.addChildAt(this.selectImage,0),this.selectImage.start(this.stageData.stageitem[this.index-1].p2.split(",")[1]),this.selectImage.autoRun(),this.selectImage.y=this.hook.y,this.selectImage.x=this.hook.x},e.prototype.removeSelect=function(){var i=this;if(this.hook.setOutSrc("kai",FileConst.png),this.index)if(this.stageData.stageitem[this.index-1].p5){var e=Number(this.stageData.stageitem[this.index-1].p5.split(",")[0]);if(1==e)this.boom.x=this.selectImage.x,this.boom.y=this.selectImage.y,IMiniGameMain.playEff(this.allData.minigame1_boom),this.boom.start(this.stageData.stageitem[this.index-1].p5.split(",")[1],1),this.boom.autoRun(),ClockManager.setTimeout(this.gameOver,this,800,!1),this.selectImage.parent.removeChild(this.selectImage),this.selectImage=null,GObj.disposeObject(this.itemArr[this.index-1]),this.itemArr[this.index-1]=null,this.index=0/0;else if(2==e)GObj.disposeObject(this.itemArr[this.index-1]),this.itemArr[this.index-1]=null,this.index=0/0;else if(3==e){var s=this.stageData.stageitem[this.index-1].p4[0],h=this.stageData.stageitem[this.index-1].p4[1];this.colorMatrix||(this.colorMatrix=GObj.create(egret.ColorMatrixFilter,this.colorArr)),this.o_colorMatrix||(this.o_colorMatrix=GObj.create(egret.ColorMatrixFilter,this.o_colorArr)),egret.Tween.get(this.man_effct).to({filters:[this.colorMatrix]},80).to({filters:[this.o_colorMatrix]},80).wait(50).call(function(){egret.Tween.get(i.man_effct).to({alpha:0,scaleX:0,scaleY:0,x:s,y:h},500)}),egret.Tween.get(this.hookGroup).to({filters:[this.colorMatrix]},80).to({filters:[this.o_colorMatrix]},80).wait(50).call(function(){egret.Tween.get(i.hookGroup).to({alpha:0,scaleX:0,scaleY:0,x:s,y:h},500)}),egret.Tween.get(this.turn_eff).to({filters:[this.colorMatrix]},80).to({filters:[this.o_colorMatrix]},80).wait(50).call(function(){egret.Tween.get(i.turn_eff).to({alpha:0,scaleX:0,scaleY:0,x:s,y:h},500)}),ClockManager.setTimeout(this.gameOver,this,800,!1),this.index=0/0}}else this.selectImage&&this.selectImage.parent&&(IMiniGameMain.reqSocket(2),IMiniGameMain.playEff(this.allData.minigame1_baowu),this.changeText(this.stageData.stageitem[this.index-1].p3),this.goldNumber&&this.goldNumber.setRewardNumber(this.stageData.stageitem[this.index-1].p3),this.win1_effct.start(t.IMiniGame1Consts.huode1_effet,1),this.win1_effct.autoRun(),this.selectImage.parent.removeChild(this.selectImage),this.selectImage=null,GObj.disposeObject(this.itemArr[this.index-1]),this.itemArr[this.index-1]=null,this.index=0/0,this.isGameOver()&&this.gameOver(!0))},e.prototype.checkHitAll=function(){for(var t=0;t<this.itemArr.length;t++)if(this.itemArr[t]&&this.checkHit(this.itemArr[t]))return this.index=t+1,!0;return!1},e.prototype.checkHit=function(t){return this.pos=this.hookGroup.localToGlobal(this.hook.x,this.hook.y,this.pos),t.hitTestPoint(this.pos.x,this.pos.y)?(this.selectImage=t,!0):!1},e.prototype.getMaxLength=function(){var t=Math.abs(this.hookGroup.rotation),i=this.width/2,e=this.height-this.hookGroup.y,s=Math.abs(180*Math.atan(i/e)/Math.PI);return s>=t?Math.abs(Math.floor(e/Math.cos(t/180*Math.PI))):Math.abs(Math.floor(i/Math.sin(t/180*Math.PI)))},e.prototype.timeFunc=function(){this.times--,this.timeText.text=this.dateM(this.times),this.times<=0&&this.gameOver(!1)},e.prototype.bubbleF=function(){if(this.textNum++,this.textNum>=5&&this.allData){this.textNum=0;for(var i=[],e=0;e<this.itemArr.length;e++)this.itemArr[e]&&!this.stageData.stageitem[e].p5&&i.push(this.itemArr[e]);var s=Math.floor(Math.random()*i.length);i[s]&&(this.star_eff.x=i[s].x,this.star_eff.y=i[s].y,this.star_eff.start(t.IMiniGame1Consts.xingxing_effct,1),this.star_eff.autoRun())}},e.prototype.dateM=function(t){var i=GObj.create(Date);i.setTime(1e3*t);var e=i.getMinutes(),s=i.getSeconds();return IMiniGameMain.getString(IMiniGameLanguage.c_25,e,s)},e.prototype.changeText=function(t){this.allNumber=this.allNumber+t,this.labelText.text=this.allNumber+""},e.prototype.onClose=function(){this.parent&&(this.startGameGroup&&this.startGameGroup.stopV(),this.clearTween(),this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this._launchRope,this),this.removeEventListener(egret.Event.ENTER_FRAME,this.update,this),DispatcherManager.removeListener(HGEvent.HEARTBEAT,this.timeFunc,this),DispatcherManager.removeListener(HGEvent.HEARTBEAT,this.bubbleF,this),i.prototype.onCloseClick.call(this))},e.prototype.isGameOver=function(){for(var t,i=0;i<this.itemArr.length;i++)if(!this.stageData.stageitem[i].p5&&this.itemArr[i])return t=!1;return!0},e.prototype.clearTween=function(){if(this.hookGroup&&egret.Tween.removeTweens(this.hookGroup),this.man_effct&&egret.Tween.removeTweens(this.man_effct),this.turn_eff&&egret.Tween.removeTweens(this.turn_eff),this.turn_eff.stop(),this.itemArr)for(var t=0;t<this.itemArr.length;t++)this.itemArr[t]&&egret.Tween.removeTweens(this.itemArr[t])},e.prototype.dispose=function(){if(!this.isDestory){if(this.isDestory=!0,this.clearTween(),this.removeEvent(),GObj.disposeObject(this.rope_number),this.rope_number=null,GObj.disposeObject(this.allData),this.allData=null,GObj.disposeObject(this.stageData),this.stageData=null,GObj.disposeObject(this.gameBg),this.gameBg=null,GObj.disposeObject(this.startBtn),this.startBtn=null,GObj.disposeObject(this.boom),this.boom=null,GObj.disposeObject(this.hookGroup),this.hookGroup=null,GObj.disposeObject(this.rope),this.rope=null,GObj.disposeObject(this.hook),this.hook=null,GObj.disposeObject(this.rope_length),this.rope_length=null,GObj.disposeObject(this.isOne),this.isOne=null,GObj.disposeObject(this.isThree),this.isThree=null,this.itemArr)for(var t=0;t<this.itemArr.length;t++)GObj.disposeObject(this.itemArr[t]),this.itemArr[t]=null;if(GObj.disposeObject(this.itemArr),this.itemArr=null,this.numberBgItemArr)for(var t=0;t<this.numberBgItemArr.length;t++)GObj.disposeObject(this.numberBgItemArr[t]),this.numberBgItemArr[t]=null;GObj.disposeObject(this.numberBgItemArr),this.numberBgItemArr=null,GObj.disposeObject(this.pos),this.pos=null,GObj.disposeObject(this.selectImage),this.selectImage=null,GObj.disposeObject(this.maxLength),this.maxLength=null,GObj.disposeObject(this.index),this.index=null,GObj.disposeObject(this.man_effct),this.man_effct=null,GObj.disposeObject(this.get_reward),this.get_reward=null,GObj.disposeObject(this.go_rope),this.go_rope=null,GObj.disposeObject(this.win1_effct),this.win1_effct=null,GObj.disposeObject(this.original_length),this.original_length=null,GObj.disposeObject(this.timeText),this.timeText=null,GObj.disposeObject(this.times),this.times=null,GObj.disposeObject(this.bubbleText),this.bubbleText=null,GObj.disposeObject(this.textNum),this.textNum=null,GObj.disposeObject(this.numImage),this.numImage=null,GObj.disposeObject(this.bubbleImg),this.bubbleImg=null,GObj.disposeObject(this.levelImg),this.levelImg=null,GObj.disposeObject(this.levelImg2),this.levelImg2=null,GObj.disposeObject(this.timeImg),this.timeImg=null,GObj.disposeObject(this.mask_bg),this.mask_bg=null,GObj.disposeObject(this.star_eff),this.star_eff=null,GObj.disposeObject(this.yun_eff),this.yun_eff=null,GObj.disposeObject(this.bmask_bg),this.bmask_bg=null,GObj.disposeObject(this.startGameGroup),this.startGameGroup=null,GObj.disposeObject(this.exitBtn),this.exitBtn=null,GObj.disposeObject(this.goldNumber),this.goldNumber=null,GObj.disposeObject(this.man_chugou_effct),this.man_chugou_effct=null,GObj.disposeObject(this.turn_eff),this.turn_eff=null,GObj.disposeObject(this.isCon),this.isCon=null,GObj.disposeObject(this.levelImgBg),this.levelImgBg=null,GObj.disposeObject(this.iconNumBg),this.iconNumBg=null,GObj.disposeObject(this.rewardImage),this.rewardImage=null,GObj.disposeObject(this.labelText),this.labelText=null,GObj.disposeObject(this.allNumber),this.allNumber=null,GObj.disposeObject(this.iconBg),this.iconBg=null,GObj.disposeObject(this.itemBg),this.itemBg=null,GObj.disposeObject(this.bubbleGroup),this.bubbleGroup=null,GObj.disposeObject(this.isp5),this.isp5=null,GObj.disposeObject(this.o_colorMatrix),this.o_colorMatrix=null,GObj.disposeObject(this.colorMatrix),this.colorMatrix=null,GObj.disposeObject(this.gunlun_img),this.gunlun_img=null,this.o_colorArr=null,this.colorArr=null,i.prototype.dispose.call(this)}},e}(t.IBaseView);t.IMiniGame1View=i,__reflect(i.prototype,"miniGame.IMiniGame1View")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(t){return i.call(this,t)||this}return __extends(e,i),e.prototype.getGameView=function(){return this.gameView||(this.gameView=GObj.create(t.IMiniGame10View)),this.gameView.setData(this.getCurGameData()),this.gameView},e.prototype.loadConfigComplete=function(e){if(e)for(var s in e.config)t.IMiniGame10Consts[s]=e.config[s];if(t.IMiniGame10Consts.stages=[],0==t.IMiniGame10Consts.stages.length)for(var h=0;h<e.chapters.length;h++)for(var a=0;a<e.chapters[h].stages.length;a++)t.IMiniGame10Consts.stages.push(e.chapters[h].stages[a]);i.prototype.loadConfigComplete.call(this,e)},e.prototype.getMiniGameView=function(){if(!this.configData)return null;if(this.configData.showChapter)return this.getChapterView(),this.chapterView.setData(this.gameData,this.configData.chapters),this.chapterView;if(this.gameData&&this.gameData.funny){var t=this.gameData.funny.bagList[0];if(t&&2==t.status)return App.msgtip.show(IMiniGameLanguage.c_8),null}return this.gameView||this.getGameView(),this.gameView},e.setDefaultData=function(i){for(var e in t.IMiniGame10Consts.skills){var s=t.IMiniGame10Consts.skills[e];s||(s={});var h=i.skills[e];h||(h=i.skills[e]={});for(var a in s)void 0==h[a]&&(h[a]=s[a])}for(var n in t.IMiniGame10Consts.monsters){var s=t.IMiniGame10Consts.monsters[n];s||(s={});var h=i.monsters[n];h||(h=i.monsters[n]={});for(var a in s)void 0==h[a]&&(h[a]=s[a])}if(i.pet)for(var o in t.IMiniGame10Consts.pet){var s=t.IMiniGame10Consts.pet[o];s||(s={});var h=i.pet[o];h||(h=i.pet[o]={});for(var a in s)void 0==h[a]&&(h[a]=s[a])}},e}(t.IMiniGameBaseCtr);t.IMiniGame10=i,__reflect(i.prototype,"miniGame.IMiniGame10")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.initSkins(),t}return __extends(e,i),e.prototype.initSkins=function(){var i=this;this.touchEnabled=!1,this.touchChildren=!1,this.labHp=GObj.create(eui.Label),this.thumbImg=GObj.create(t.ImageOutside),this.thumbImg.loadCompleteCall(function(){i.x=-i.thumbImg.width/2,i.labHp.width=i.thumbImg.width},this),this.thumbImg.setOutSrc("booshp_0"),this.addChild(this.thumbImg),this.thumb=GObj.create(t.ImageOutside),this.thumb.loadCompleteCall(function(){i.thumb.x=2,i.thumb.y=1},this),this.thumb.setOutSrc("booshp_1"),this.addChild(this.thumb),this.labHp.y=-2,this.labHp.size=16,this.labHp.textAlign=egret.HorizontalAlign.CENTER,this.labHp.visible=!1,this.addChild(this.labHp),this.ghostImg=GObj.create(t.ImageOutside),this.ghostImg.setOutSrc("ghost"),this.ghostImg.x=-20,this.ghostImg.y=-7,this.addChild(this.ghostImg),this.slideDuration=2e3/egret.ticker.$frameRate},e.prototype.setData=function(t,i){0>t||t>i||(this.value=t/i*100,this.labHp.text=t+"")},e.prototype.dispose=function(){GObj.disposeObject(this.thumbImg),this.thumbImg=null,GObj.disposeObject(this.thumb),this.thumb=null,GObj.disposeObject(this.labHp),this.labHp=null,GObj.disposeObject(this.ghostImg),this.ghostImg=null},e}(eui.ProgressBar);t.IMiniGame10BossHp=i,__reflect(i.prototype,"miniGame.IMiniGame10BossHp")}(miniGame||(miniGame={}));var miniGame;!function(t){t.IMiniGame10Consts={bruiseTime:300,bossRedNum:10,hurtFrame:8,switchPet:1,stages:[],isBackGame:!1,winBackGame:!0,minigame10_bgm:"bgm_login",minigame10_win:"win",minigame10_die:"minigame_lose",minigame10_attack:"att",minigame10_prop:"baozha",minigame10_monDie:"baozha",bossMovie:"ui_bosslaixi",monsterGap:50,bossGap:100,hitBack:20,defeatedY:100,victoryY:150,map:[2304,1536,9,6,0,0],skills:{1:{skillType:1,name:"回旋镖技能",model:"skill1",hitmodel:"sj_skill1",hurt:[10,20]}},monsters:{0:{model:"monster_1",hp:[50,100],hurt:[1,10],speed:2,atkSpeed:120},1:{model:"monster_2",hp:[50,100],hurt:[1,10],speed:2,atkSpeed:120},2:{model:"monster_3",hp:[50,100],hurt:[1,10],speed:2,atkSpeed:120}},pet:{}}}(miniGame||(miniGame={}));var Atk10Vo=function(){function t(){}return t.prototype.reset=function(){this.atkx=0,this.atky=0,this.skillType=null,this.hitModel=null,this.hurt=null,this.isRole=null,this.aindex=null,this.hitBack=null},t}();__reflect(Atk10Vo.prototype,"Atk10Vo");var Skill10Type;!function(t){t[t.TYPE_1=1]="TYPE_1",t[t.TYPE_2=2]="TYPE_2",t[t.TYPE_3=3]="TYPE_3",t[t.TYPE_4=4]="TYPE_4",t[t.TYPE_5=5]="TYPE_5",t[t.TYPE_6=6]="TYPE_6"}(Skill10Type||(Skill10Type={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.initV(),t}return __extends(e,i),e.prototype.partComplete=function(t){i.prototype.partComplete.call(this,t),t&&t.jsonObj&&(this.fixWidth=t.jsonObj.frames[0].w,this.fixHeight=t.jsonObj.frames[0].h)},e.prototype.setFun=function(t,i,e,s){this.fun=t,this.thisobj=i,this.fun1=e,this.thisobj1=s},e.prototype.initV=function(){this.atk10Vo=GObj.create(Atk10Vo),this.lockGap=0,this.atkFrame=[7,8,9,10,11,12,13,14,15,16]},e.prototype.setData=function(t){this.data=t,this.resetData()},e.prototype.resetData=function(){this.data&&(this.updatePart(this.data.petModel),this.speedy=this.speedx=0,this.radius=this.data.petRadius||200,this.atkSpeed=this.data.atkSpeed||5,this.atkRadius=this.data.atkRadius||50,this.speed=this.data.petSpeed||8,this.scaleX=this.scaleY=this.data.scaleXY||1,this.isAtkIng=!1,this.Hurtnterval=t.IMiniGame10Consts.hurtFrame||2,this.setDirection(AvatarConsts.R_R),this.setAction(AvatarConsts.ACTION_WALK))},e.prototype.run=function(){this.confirmMove(),i.prototype.run.call(this),this.lockTarget(),this.atk(),this.checkAtkFrame()},e.prototype.checkAtkFrame=function(){this._action==AvatarConsts.ACTION_ATTACK&&this.atkFrame.indexOf(this.part.frame)>-1&&this.fun1&&--this.Hurtnterval<1&&(this.Hurtnterval=t.IMiniGame10Consts.hurtFrame||2,this.atk10Vo.hurt||(this.atk10Vo.hurt=GMath.randomInt(this.data.petHurt[0],this.data.petHurt[1])),this.fun1.call(this.thisobj1,this.atk10Vo.hurt))},e.prototype.move=function(){this.move2(),this._isMove&&(this.x+=this.speedx*this.scaleZ||0,this.y+=this.speedy*this.scaleZ||0,this.setAction(AvatarConsts.ACTION_WALK))},e.prototype.move2=function(){this._isMove2&&(this.y+=this.speedy*this.scaleZ||0,this.setAction(AvatarConsts.ACTION_WALK))},e.prototype.confirmMove=function(){return this.isAtkIng?(this._isMove=!1,void(this._isMove2=!1)):void(this.target?(this.distance=GMath.distance(this.x,this.y,this.target.x,this.target.y),this.target instanceof t.IMiniGame10Monster?(this._isMove=this.distance>this.atkRadius,this._isMove||(this._isMove2=Math.abs(this.target.y-this.y)>5)):this.target instanceof t.IMiniGame10Player?(this._isMove=this.distance>=this.radius,this._isMove2=!1):(this._isMove=!1,this._isMove2=!1)):(this._isMove=!1,this._isMove2=!1))},e.prototype.getLeft=function(){return this._direction8==AvatarConsts.L_L},e.prototype.actionOver=function(t){i.prototype.actionOver.call(this,t),t==AvatarConsts.ACTION_ATTACK&&(this.isAtkIng=!1,this.attackTarget=null)},e.prototype.juageFollow=function(){return GMath.distance(this.x,this.y,this.follow.x,this.follow.y)<=this.radius},e.prototype.setFollow=function(t){this.follow=t},e.prototype.setTarget=function(t){this.attackTarget=t},e.prototype.getTarget=function(){return this.juageFollow()?this.attackTarget?this.attackTarget:(this.fun&&this.fun.call(this.thisobj),this.attackTarget):(this.attackTarget=null,this.follow)},e.prototype.lockTarget=function(){if(!this.isAtkIng&&(this.target=this.getTarget(),this.target&&!(--this.lockGap>0))){this.lockGap=Math.ceil(egret.ticker.$frameRate/5);var t=GMath.angle(this.x,this.y,this.target.x,this.target.y),i=this.getDirection(t);this.setDirection(i),this.setAngle(t)}},e.prototype.atk=function(){if(!this.isAtkIng&&this.target&&!(this.target instanceof t.IMiniGame10Player)){if(this.target.isDie())return void(this.attackTarget=null);this.distance=GMath.distance(this.x,this.y,this.target.x,this.target.y),this._isMove=this.distance>this.atkRadius,this._isMove||(this._isMove2=Math.abs(this.target.y-this.y)>5,this._isMove2||--this.atkSpeed>0||(this.atkSpeed=this.data.atkSpeed||0,this.atk10Vo.hurt=GMath.randomInt(this.data.petHurt[0],this.data.petHurt[1]),this.isAtkIng=!0,this.setAction(AvatarConsts.ACTION_ATTACK)))}},e.prototype.getDirection=function(t){var i;return i=t>90&&270>t?AvatarConsts.L_L:AvatarConsts.R_R},e.prototype.reset=function(){this.resetData(),this.lockGap=0,this.thisobj=null,this.fun=null},e.prototype.dispose=function(){this.data=null,this.follow=null,this.attackTarget=null,this.radius=null,this.minRadius=null,this.atkSpeed=null,this.atkRadius=null,this.target=null,this.lockGap=null,this.distance=null,this.atk10Vo=null,this.fun=null,this.thisobj=null,this.isAtkIng=null,this.Hurtnterval=null},e}(t.IAvatarViewCtr);t.IMiniGame10DivinePet=i,__reflect(i.prototype,"miniGame.IMiniGame10DivinePet")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.initSkins(),t}return __extends(e,i),e.prototype.getDropExp=function(){return this._exp},e.prototype.initSkins=function(){var i=this;this.touchEnabled=!1,this.icon=GObj.create(t.ImageOutside),this.icon.loadCompleteCall(function(){i.anchorOffsetX=i.icon.width/2,i.anchorOffsetY=i.icon.height/2},this),this.addChild(this.icon)},e.prototype.setData=function(t,i,e){this.x=t,this.y=i,this._exp=e,this.icon.setOutSrc("exp")},e.prototype.reset=function(){this.isFly=!1,this.isRemove=!1,this._exp=0},e.prototype.flyToPlayer=function(t){var i=this;this.isFly||(this.isFly=!0,egret.Tween.removeTweens(this),egret.Tween.get(this).to({x:t.x,y:t.y-t.height*t.scaleY/4},300).call(function(){i.isRemove=!0}))},e.prototype.dispose=function(){this.reset(),egret.Tween.removeTweens(this),egret.Tween.removeTweens(this.icon),GObj.disposeObject(this.icon),this.icon=null},e}(eui.Component);t.IMiniGame10Drop=i,__reflect(i.prototype,"miniGame.IMiniGame10Drop")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(t){function i(){var i=t.call(this)||this;return i.setGap(1),i.setPath("num10"),i}return __extends(i,t),i.prototype.setHurt=function(t){this.speed=1,this.setString("-"+(t||0)),this.anchorOffsetX=this.width/2,this.initMove2(),this.isRun=!0},i.prototype.setAngle=function(t){this.angle!=t&&(this.angle=t,this.speedx=this.speed*GMath.cos(t),this.speedy=this.speed*GMath.sin(t))},i.prototype.run=function(){this.isRun&&this.showMove2()},i.prototype.showMove2=function(){this.x+=this.speedx,this.y+=this.speedy,this.scaleX+=this.show2p1,this.scaleY+=this.show2p1,this.alpha+=this.show2p2,this.scaleX>=1&&(this.show2p1=-.02,this.show2p2=-.02,this.speed=this.show2p3,this.setAngle(0)),this.alpha<.3&&(this.isRun=!1)},i.prototype.initMove2=function(){this.show2p1=.1,this.show2p2=0,this.show2p3=this.speed,this.speed=5*this.show2p3,this.setAngle(GMath.randomInt(270,280)),this.scaleX=this.scaleY=.3,this.alpha=1},i}(t.IBitNumMap);t.IminiGame10Hurt=i,__reflect(i.prototype,"miniGame.IminiGame10Hurt")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){return i.call(this)||this}return __extends(e,i),e.prototype.setData=function(i){this.data=i,this.hp=GMath.randomInt(i.hp[0],i.hp[1]),this.maxHp=this.hp,this.hurt=GMath.randomInt(i.hurt[0],i.hurt[1]),this.isBoss&&(this.bossBlood||(this.bossBlood=GObj.create(t.IMiniGame10BossHp)),this.addChild(this.bossBlood),this.bossBlood.setData(this.hp,this.maxHp),this.name="boss",this.bossEnd=!0),this.atkGap=this.isBoss?t.IMiniGame10Consts.bossGap:t.IMiniGame10Consts.monsterGap,this.updatePart(i.model),this.setSpeed(i.speed),this.scaleX=this.scaleY=i.scaleXY||1,this.setAction(AvatarConsts.ACTION_WALK)},e.prototype.partComplete=function(t){i.prototype.partComplete.call(this,t),this.isBoss&&this.bossBlood&&(this.bossBlood.y=-t.jsonObj.frames[0].h)},e.prototype.reset=function(){this.atkSpeed=0,this.isBoss=!1,this.isDieBack=!1,this.isBruise=!1,this.bruiseTime=!1,this.isStop=!1,this._isDie=!1,this._isMove=!0,this.target=null,this.follow=null,this.isFollow=!1,this.distance=99999,this.hp=0,this.maxHp=0,this.hurt=0,this.data=null,this.speed=0,this.lastAIndex=0,this.id=0,this.filters=null,this.lockGap=0,this.atkGap=0,this.bossEnd=null,this.bossBlood&&this.bossBlood.parent&&this.bossBlood.parent.removeChild(this.bossBlood)},e.prototype.setTarget=function(t){this.target=t,this.lockTarget()},e.prototype.setFollow=function(t){this.backFollow()||(this.follow=t,this.follow.isFollow=!0,this.filters=[IMiniGameMain.getRedFilter()],this.follow.name="哥哥"+GMath.randomInt(1,10),console.log("有跟随变红，跟随名字",this.follow.name))},e.prototype.backFollow=function(){return!this.follow||this.follow.isDie()?null:this.follow},e.prototype.actionOver=function(e){var s=this;if(i.prototype.actionOver.call(this,e),e==AvatarConsts.ACTION_DIE&&(this.isDieBack=!1,this.part.setFrame(this.part.frameSize-1)),e==AvatarConsts.ACTION_BRUISE){if(this.isBruise=!1,ClockManager.setTimeout(function(){s.bruiseTime=!1},this,t.IMiniGame10Consts.bruiseTime||300),this.isDie())return void this.dieBack();this.setAction(AvatarConsts.ACTION_WALK)}},e.prototype.run=function(){i.prototype.run.call(this),this.lockTarget()},e.prototype.lockTarget=function(){if(!this._isDie&&this.target&&!(--this.lockGap>0)){this.lockGap=Math.ceil(egret.ticker.$frameRate/5);var t=this.target.x,i=this.target.y-this.target.height*this.target.scaleY/5;if(this.distance=GMath.distance(this.x,this.y,t,i),this.atkSpeed<=0){var e=GMath.angle(this.x,this.y,t,i),s=this.getDirection(e)<=5?4:6;this.setDirection(s),this.setAngle(e)}}},e.prototype.getDirection=function(t){if(!t||this.angle==t)return this._direction8;var i=AvatarConsts.R_R-Math.floor((t+22.5)/45);return 0>=i&&(i+=AvatarConsts.L_B),i},e.prototype.move=function(){this.target&&!this.target.isDie()&&(this.isDie()||this.isBruise||this.isStop||(i.prototype.move.call(this),this.setAction(AvatarConsts.ACTION_WALK)))},e.prototype.monsterCollision=function(){return this.isDie()||(this.atkSpeed--,this.distance>this.atkGap)?void 0:this.atkSpeed<0?(this.atkSpeed=this.data.atkSpeed,!0):void 0},e.prototype.setHit=function(t){t.aindex&&(this.lastAIndex=t.aindex);var i=Math.min(t.hurt,this.hp);this.hp-=i,this.updateHp(),this.hp<=0&&(this.died(),this.isDieBack=!0),this.hurtBack(t)},e.prototype.updateHp=function(){this.isBoss&&this.bossBlood&&this.bossBlood&&this.bossBlood.setData(this.hp,this.maxHp)},e.prototype.dieBack=function(){IMiniGameMain.playEff(t.IMiniGame10Consts.minigame10_monDie),this.setAction(AvatarConsts.ACTION_DIE)},e.prototype.hurtBack=function(i){var e=this;(!this.isBoss||this.bossEnd)&&(egret.Tween.removeTweens(this),this.partCont.filters=[IMiniGameMain.getRedFilter()],egret.Tween.get(this).wait(200).call(function(){e.partCont.filters=null})),this.isBoss&&this.bossEnd&&(this.bossEnd=!1,ClockManager.setTimeout(function(){e.bossEnd=!0},this,t.IMiniGame10Consts.bossRedNum||300));var s=i.hitBack||0;i.skillType||(s=t.IMiniGame10Consts.hitBack);var h=this.x-this.speedx*this.scaleX*s,a=this.y-this.speedy*this.scaleX*s;if(this.isBoss){if(this.isDieBack&&!this.isBruise)return void this.dieBack();this.bruiseTime||this.isBruise||(this.bruiseTime=!0,this.isBruise=!0,this.setAction(AvatarConsts.ACTION_BRUISE))
}else egret.Tween.get(this).to({x:h,y:a},200).call(function(){!e.isBoss&&e.dieBack()})},e.prototype.canRemove=function(){return!this.isDieBack&&this.isDie()},e.prototype.getMonsterExp=function(){return this.data.monExp||0},e.prototype.dispose=function(){this.reset(),egret.Tween.removeTweens(this),GObj.disposeObject(this.bossBlood),this.bossBlood=null,i.prototype.dispose.call(this)},e}(t.IAvatarViewCtr);t.IMiniGame10Monster=i,__reflect(i.prototype,"miniGame.IMiniGame10Monster")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var e=i.call(this)||this;return e.speed=1,e.playerBlood=GObj.create(t.IMiniGame10PlayerHp),e.addChild(e.playerBlood),e}return __extends(e,i),e.prototype.setData=function(t){this.data=t,this.initVo()},e.prototype.initVo=function(){this.data&&(this.hp=this.data.hp[0],this.maxHp=this.hp,this.speed=this.data.speed,this.atkSpeed=this.data.atkSpeed||80,this.atkGap=this.data.atkGap||100,this.scaleX=this.scaleY=this.data.scaleXY||1,this.updatePart(this.data.model),this.skillArr=[],ObjectUtil.oto(this.data.initSkills||[],this.skillArr),this.lv=this.data.initLv||1,this.exp=0,this._isDie=!1,this.isAtking=!1,this.atkIndex=0,this.isDieBack=!1,this.updateHp(),this.setDirection(AvatarConsts.R_R),this.setAction(AvatarConsts.ACTION_STAND))},e.prototype.getExpInfo=function(){return this.data.upExp},e.prototype.getSkillInfo=function(){return this.data.upSkill},e.prototype.getSkill=function(){return this.skillArr||[]},e.prototype.addSkill=function(t){-1==this.skillArr.indexOf(t)&&this.skillArr.push(t)},e.prototype.getCollPropDis=function(t){var i=t?99999:this.data.collDrop;return i},e.prototype.addExp=function(t){this.exp+=t;var i=this.data.upExp[this.lv+1];return i&&this.exp>=i?(this.exp%=i,this.lv++,!0):!1},e.prototype.setMaxLv=function(){for(var t=!0;t;){var i=this.data.upExp[this.lv+1];i?this.lv++:t=!1}},e.prototype.setMoveArea=function(t,i,e,s){this.ax=t,this.ay=i,this.aw=e,this.ah=s},e.prototype.setMove=function(t){this._isMove=t},e.prototype.setDir=function(t){t&&this.setDirection(t)},e.prototype.run=function(){i.prototype.run.call(this),this.playerAtk()},e.prototype.playerAtk=function(){if(this.isAtking=!1,!this._isDie){var t=[4,5];this._action==AvatarConsts.ACTION_ATTACK&&t.indexOf(this.part.frame)>-1&&(this.isAtking=!0),this._action!=AvatarConsts.ACTION_ATTACK&&--this.atkSpeed>0}},e.prototype.actionOver=function(e){i.prototype.actionOver.call(this,e),e==AvatarConsts.ACTION_STAND&&(this.atkSpeed<=0?(this.atkSpeed=this.data.atkSpeed,this.setAction(AvatarConsts.ACTION_ATTACK),this.atkIndex++,IMiniGameMain.playEff(t.IMiniGame10Consts.minigame10_attack)):(this._actionOver=!1,this.part.startTime=$GApp.timer)),e==AvatarConsts.ACTION_ATTACK&&this.setAction(AvatarConsts.ACTION_STAND),e==AvatarConsts.ACTION_DIE&&(this.isDieBack=!1,this.part.setFrame(this.part.frameSize-1))},e.prototype.move=function(){if(this._isMove){var t=this.x+(this.speedx||0);t>this.ax&&t<this.aw-this.ax&&(this.x=t);var i=this.y+(this.speedy||0);i>this.ay&&i<this.ah-this.ay&&(this.y=i)}},e.prototype.getAtkHurt=function(){var t=GMath.randomInt(this.data.hurt[0],this.data.hurt[1]);return t},e.prototype.checkAtkMonster=function(t){var i=this.y-80,e=GMath.distance(this.x,i,t.x,t.y);if(this.atkGap<e)return!1;var s=this._direction8,h=[s-1,s,s+1],a=AvatarHelp.getDirection8(this.x,i,t.x,t.y),n=-1!=h.indexOf(a);return n},e.prototype.setHit=function(t){var t=Math.min(t,this.hp);return this.hp-=t,this.hp<=0?(this.hp=0,this.updateHp(),void this.dieBack()):void this.updateHp()},e.prototype.updateHp=function(){this.playerBlood.setData(this.hp,this.maxHp)},e.prototype.dieBack=function(){this.isDieBack||(this.isDieBack=!0,this.died(),this.setAction(AvatarConsts.ACTION_DIE))},e.prototype.canRemove=function(){return!this.isDieBack&&this.isDie()},e.prototype.dispose=function(){egret.Tween.removeTweens(this),GObj.disposeObject(this.playerBlood),this.playerBlood=null,this.data=null,i.prototype.dispose.call(this)},e}(t.IAvatarViewCtr);t.IMiniGame10Player=i,__reflect(i.prototype,"miniGame.IMiniGame10Player")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.initSkins(),t}return __extends(e,i),e.prototype.initSkins=function(){var i=this;this.touchEnabled=!1,this.touchChildren=!1,this.labHp=GObj.create(eui.Label),this.thumbImg=GObj.create(t.ImageOutside),this.thumbImg.loadCompleteCall(function(){i.x=-i.thumbImg.width/2,i.y=15,i.labHp.width=i.thumbImg.width},this),this.thumbImg.setOutSrc("rolehp_0"),this.addChild(this.thumbImg),this.thumb=GObj.create(t.ImageOutside),this.thumb.loadCompleteCall(function(){i.thumb.x=1,i.thumb.y=1},this),this.thumb.setOutSrc("rolehp_1"),this.addChild(this.thumb),this.labHp.y=-2,this.labHp.size=16,this.labHp.textAlign=egret.HorizontalAlign.CENTER,this.labHp.visible=!1,this.addChild(this.labHp),this.slideDuration=2e3/egret.ticker.$frameRate},e.prototype.setData=function(t,i){0>t||t>i||(this.value=t/i*100,this.labHp.text=t+"")},e.prototype.dispose=function(){GObj.disposeObject(this.thumbImg),this.thumbImg=null,GObj.disposeObject(this.thumb),this.thumb=null,GObj.disposeObject(this.labHp),this.labHp=null},e}(eui.ProgressBar);t.IMiniGame10PlayerHp=i,__reflect(i.prototype,"miniGame.IMiniGame10PlayerHp")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){return i.call(this)||this}return __extends(e,i),e.prototype.initSkins=function(){this.horizontalCenter=0,this.verticalCenter=0,this.width=540,this.height=960,this.bgRect=GObj.create(eui.Rect),this.bgRect.horizontalCenter=0,this.bgRect.verticalCenter=0,this.bgRect.alpha=.8,this.bgRect.width=StageManager.stageWidth,this.bgRect.height=StageManager.stageHeight,this.addChild(this.bgRect),this.resultImg=GObj.create(t.ImageOutside),this.resultImg.horizontalCenter=0,this.resultImg.verticalCenter=-220,this.addChild(this.resultImg),this.djsImg=GObj.create(t.ImageOutside),this.djsImg.setOutSrc("img6"),this.addChild(this.djsImg),this.djsLab=GObj.create(eui.Label),this.djsLab.size=30,this.djsLab.textColor=0,this.addChild(this.djsLab),this.backBtn=GObj.create(t.IBaseBtn),this.backBtn.name="1",this.backBtn.horizontalCenter=-100,this.backBtn.icon=IMiniGameMain.getIcon("btn_2"),this.addChild(this.backBtn),this.nextBtn=GObj.create(t.IBaseBtn),this.nextBtn.name="2",this.nextBtn.horizontalCenter=100,this.nextBtn.icon=IMiniGameMain.getIcon("btn_3"),this.addChild(this.nextBtn),this.againBtn=GObj.create(t.IBaseBtn),this.againBtn.name="3",this.againBtn.horizontalCenter=100,this.againBtn.icon=IMiniGameMain.getIcon("btn_4"),this.addChild(this.againBtn),this.backMain=GObj.create(t.IBaseBtn),this.backMain.name="4",this.backMain.horizontalCenter=-100,this.backMain.icon=IMiniGameMain.getIcon("btn_5"),this.addChild(this.backMain),this.backBtn.visible=this.nextBtn.visible=this.againBtn.visible=this.backMain.visible=!1,this.rewardGrp=GObj.create(eui.Group),this.rewardGrp.horizontalCenter=0,this.rewardGrp.verticalCenter=0,this.rewardGrp.layout||(this.rewardGrp.layout=GObj.create(eui.HorizontalLayout),this.rewardGrp.layout.gap=10),this.addChild(this.rewardGrp),this.addEvent()},e.prototype.addEvent=function(){DispatcherManager.addListener(HGEvent.HEARTBEAT,this.countDown,this),this.backBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.closeClick,this),this.nextBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.closeClick,this),this.againBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.closeClick,this),this.backMain.addEventListener(egret.TouchEvent.TOUCH_TAP,this.closeClick,this)},e.prototype.removeEvent=function(){DispatcherManager.removeListener(HGEvent.HEARTBEAT,this.countDown,this),this.backBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.closeClick,this),this.nextBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.closeClick,this),this.againBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.closeClick,this),this.backMain.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.closeClick,this)},e.prototype.show=function(i,e,s,h){this.initSkins(),this.data=e,this.resultImg.setOutSrc(i?"successBg":"failBg"),this.result=i,this.closeBack=s,this.thisObj=h,this.time=3,this.countDown(),this.stageId=e.stageId,this.djsImg.horizontalCenter=-22,this.djsLab.horizontalCenter=-20;var a=IMiniGameMain.curMiniGame.gameData,n=a.backGame,o=!1;if(!i)return void(4==n||5==n||6==n?(this.backMain.verticalCenter=this.backBtn.verticalCenter=this.againBtn.verticalCenter=this.djsImg.verticalCenter=this.djsLab.verticalCenter=t.IMiniGame10Consts.defeatedY||100,o=this.checkBackGame(),this.backBtn.visible=!o,this.backMain.visible=o,this.againBtn.visible=!0,o?this.timeOver=+this.backMain.name:this.timeOver=+this.againBtn.name):(o=!t.IMiniGame10Consts.isBackGame||2==n||3==n,this.backMain.verticalCenter=this.backBtn.verticalCenter=this.againBtn.verticalCenter=this.djsImg.verticalCenter=this.djsLab.verticalCenter=t.IMiniGame10Consts.defeatedY||100,this.backBtn.visible=!o,this.backMain.visible=o,this.againBtn.visible=!0,IMiniGameMain.curMiniGame.configData.loseBackMain&&1==this.stageId?this.timeOver=+this.backMain.name:this.timeOver=+this.againBtn.name));var r=IMiniGameMain.curMiniGame.gameData.funny,l=r.bagList;l.sort(function(t,i){return t.sort-i.sort});var p=l[e.stageId-1];if(p){for(var c=p.rewardList,u=0;u<c.length;u++){var d=GObj.create(GoodsInfo);d.tid=c[u].tempId,d.count=c[u].count;var m=GObj.create(t.IMiniGame10Reward);m.setData(d),this.rewardGrp.addChild(m)}this.autoGetReward(),4==n||5==n||6==n?(this.backBtn.verticalCenter=this.nextBtn.verticalCenter=this.backMain.verticalCenter=this.djsImg.verticalCenter=this.djsLab.verticalCenter=t.IMiniGame10Consts.victoryY||150,o=this.checkBackGame(),6==n?(this.backMain.visible=o,this.backBtn.visible=!o,this.nextBtn.visible=!this.checkNext(),1==this.data.stageId&&(this.nextBtn.visible=!0),this.nextBtn.visible||(this.djsImg.horizontalCenter=60,this.djsLab.horizontalCenter=62,this.backMain.horizontalCenter=-20),this.timeOver=+this.backMain.name):(this.backMain.visible=o,this.backBtn.visible=!o,this.nextBtn.visible=!o,1==this.data.stageId&&(this.nextBtn.visible=!0),o?(this.nextBtn.visible||(this.djsImg.horizontalCenter=60,this.djsLab.horizontalCenter=62,this.backMain.horizontalCenter=-20),this.timeOver=+this.backMain.name):this.timeOver=+this.nextBtn.name)):(t.IMiniGame10Consts.stages[e.stageId]||(o=!0),t.IMiniGame10Consts.isBackGame&&1!=n&&3!=n||(o=!0),r.p1&&(o=!1,e.stageId==r.p3&&(o=!0)),this.backBtn.verticalCenter=this.nextBtn.verticalCenter=this.backMain.verticalCenter=this.djsImg.verticalCenter=this.djsLab.verticalCenter=t.IMiniGame10Consts.victoryY||150,t.IMiniGame10Consts.stages[e.stageId]?(this.backMain.visible=o,this.backBtn.visible=!o,this.nextBtn.visible=!0,t.IMiniGame10Consts.winBackGame&&1==this.stageId?this.timeOver=+this.backMain.name:this.timeOver=+this.nextBtn.name):(this.backMain.horizontalCenter=-20,this.backMain.visible=!0,this.djsImg.horizontalCenter=60,this.djsLab.horizontalCenter=62,this.timeOver=+this.backMain.name))}},e.prototype.checkBackGame=function(){var i=IMiniGameMain.curMiniGame.gameData;switch(i.backGame){case 4:return this.checkStageNum();case 5:if(i.isMust){var i=IMiniGameMain.curMiniGame.gameData,e=i.funny;return this.data&&t.IMiniGame10Consts.stages[this.data.stageId]?this.data.stageId==e.p3?!0:this.data&&1==this.data.stageId?!0:!1:!0}return this.checkStageNum();case 6:return!0}return!1},e.prototype.checkNext=function(){var i=IMiniGameMain.curMiniGame.gameData;if(i.isMust){var i=IMiniGameMain.curMiniGame.gameData,e=i.funny;return this.data&&t.IMiniGame10Consts.stages[this.data.stageId]?this.data&&1==this.data.stageId?!0:this.data.stageId==e.p3?!0:!1:!0}return this.checkStageNum()},e.prototype.checkStageNum=function(){var i=IMiniGameMain.curMiniGame.gameData;if(!this.data||!t.IMiniGame10Consts.stages[this.data.stageId])return!0;var i=IMiniGameMain.curMiniGame.gameData,e=i.funny;return this.data.stageId==e.p3?!0:i.isMust?!1:1==this.data.stageId?!0:!1},e.prototype.countDown=function(){return this.time<0?void this.closeClick():(this.bgRect.touchEnabled=!0,void(this.djsLab.text=this.time--+""))},e.prototype.autoGetReward=function(){if(this.result){var t=IMiniGameMain.curMiniGame.gameData,i=t.funny;if(i)for(var e,s=0,h=i.bagList;s<h.length;s++){var a=h[s];if(e=a.conditionList[0],e&&e.p1==t.chapter&&e.p2==this.stageId){2!=a.status&&IMiniGameMain.reqSocket(6,a.id);break}}}},e.prototype.closeClick=function(t){this.autoGetReward();var i=t&&t.target,e=i&&+i.name;this.closeBack&&this.closeBack.call(this.thisObj,e||this.timeOver,this.result),GObj.disposeObject(this)},e.prototype.dispose=function(){this.removeEvent(),this.thisObj=null,this.data=null,this.closeBack=null,GObj.disposeObject(this.bgRect),this.bgRect=null,GObj.disposeObject(this.resultImg),this.resultImg=null,GObj.disposeObject(this.djsImg),this.djsImg=null,GObj.disposeObject(this.djsLab),this.djsLab=null,GObj.disposeObject(this.backBtn),this.backBtn=null,GObj.disposeObject(this.nextBtn),this.nextBtn=null,GObj.disposeObject(this.againBtn),this.againBtn=null,GObj.disposeObject(this.backMain),this.backMain=null,GObj.disposeObject(this.rewardGrp),this.rewardGrp=null},e}(eui.Component);t.IMiniGame10ResultPop=i,__reflect(i.prototype,"miniGame.IMiniGame10ResultPop")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.once(egret.Event.REMOVED_FROM_STAGE,t.dispose,t),t.initSkins(),t}return __extends(e,i),e.prototype.initSkins=function(){var i=this;this.touchEnabled=!1,this.bg=GObj.create(t.ImageOutside),this.bg.loadCompleteCall(function(){i.width=i.bg.width,i.height=i.bg.height},this),this.bg.setOutSrc("rewardBg"),this.item=GObj.create(GoodsItemView),this.item.horizontalCenter=0,this.item.verticalCenter=0,this.item.scaleX=this.item.scaleY=1,this.addChild(this.item)},e.prototype.setData=function(t){this.item.data=t},e.prototype.dispose=function(){this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.dispose,this),GObj.disposeObject(this.bg),this.bg=null,GObj.disposeObject(this.item),this.item=null},e}(eui.Component);t.IMiniGame10Reward=i,__reflect(i.prototype,"miniGame.IMiniGame10Reward")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.once(egret.Event.ADDED_TO_STAGE,t.initSkin,t),t}return __extends(e,i),e.prototype.initSkin=function(){var i=this;this.angle=0,this.rateVal=10,this.bg=GObj.create(t.ImageOutside),this.bg.touchEnabled=!1,this.bg.loadCompleteCall(function(){i.width=i.bg.iconWidth,i.height=i.bg.iconHeight,i.anchorOffsetX=i.width/2,i.anchorOffsetY=i.height/2,i.startX=i.width/2,i.startY=i.height/2,i.onEndClick()},this),this.bg.setOutSrc("rocker"),this.addChild(this.bg),this.rockerRect=GObj.create(eui.Rect),this.rockerRect.fillAlpha=.001,this.rocker=GObj.create(t.ImageOutside),this.rocker.touchEnabled=!1,this.rocker.loadCompleteCall(function(){i.rockerRect.width=3*i.rocker.iconWidth,i.rockerRect.height=3*i.rocker.iconHeight,i.rockerRect.anchorOffsetX=i.rockerRect.width/2,i.rockerRect.anchorOffsetY=i.rockerRect.height/2,i.rocker.anchorOffsetX=i.rocker.iconWidth/2,i.rocker.anchorOffsetY=i.rocker.iconHeight/2,i.onEndClick()},this),this.rocker.setOutSrc("rockerPoint"),this.addChild(this.rocker),this.addChild(this.rockerRect),this.arrow=GObj.create(t.ImageOutside),this.addEvent()},e.prototype.addEvent=function(){this.rockerRect.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBeginClick,this)},e.prototype.removeEvent=function(){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.initSkin,this),this.rockerRect.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBeginClick,this),this.rockerRect.removeEventListener(egret.TouchEvent.TOUCH_END,this.onEndClick,this),this.parentObj&&(this.parentObj.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onEndClick,this),this.parentObj.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMoveClick,this))},e.prototype.onBeginClick=function(){this.isMove||(this.parentObj||(this.parentObj=this.parent),this.rockerRect.addEventListener(egret.TouchEvent.TOUCH_END,this.onEndClick,this),this.parentObj.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onEndClick,this),this.parentObj.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMoveClick,this),this.tempPoint||(this.tempPoint=GObj.create(egret.Point)))},e.prototype.onMoveClick=function(t){this.globalToLocal(t.stageX,t.stageY,this.tempPoint);var i=GMath.distance(this.tempPoint.x,this.tempPoint.y,this.startX,this.startY);if(!(i<this.rateVal)){this.isMove=!0,this.rockerRect.x=this.tempPoint.x,this.rockerRect.y=this.tempPoint.y;var e=this.width/2;if(i=GMath.distance(this.tempPoint.x,this.tempPoint.y,this.width/2,this.height/2),i>e){var s=GMath.towardSource(this.width/2,this.height/2,this.tempPoint.x,this.tempPoint.y,e);this.tempPoint.x=s.x,this.tempPoint.y=s.y,this.startX=this.width/2,this.startY=this.height/2}this.rocker.x=this.tempPoint.x,this.rocker.y=this.tempPoint.y,this.getRocker(),this.startX=this.rocker.x,this.startY=this.rocker.y}},e.prototype.onEndClick=function(){this.rockerRect&&(this.rockerRect.removeEventListener(egret.TouchEvent.TOUCH_END,this.onEndClick,this),this.parentObj&&(this.parentObj.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onEndClick,this),this.parentObj.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMoveClick,this)),this.isMove=!1,this.startX=this.width/2,this.startY=this.height/2,this.rockerRect.x=this.startX,this.rockerRect.y=this.startY,this.rocker.x=this.startX,this.rocker.y=this.startY,this.visible=!1)},e.prototype.getRocker=function(){var t=this.startX,i=this.startY,e=this.rocker.x,s=this.rocker.y;this.angle=GMath.angle(t,i,e,s),this.arrow.rotation=this.angle+90;var h=this.arrow.rotation;h>0&&180>h?this.dir=AvatarConsts.R_R:h>-180&&0>h&&(this.dir=AvatarConsts.L_L)},e.prototype.dispose=function(){this.removeEvent(),GObj.disposeObject(this.bg),this.bg=null,GObj.disposeObject(this.rocker),this.rocker=null,GObj.disposeObject(this.rockerRect),this.rockerRect=null,GObj.disposeObject(this.arrow),this.arrow=null,this.parentObj=null},e}(eui.Group);t.IMiniGame10Rocker=i,__reflect(i.prototype,"miniGame.IMiniGame10Rocker")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){return i.call(this)||this}return __extends(e,i),e.prototype.setData=function(i){t.IMiniGame10.setDefaultData(i),this.data=i,this.specInfo=this.data.specInfo||{},this.updateSpec(),this.initSkins(),this.loadMapImg(this.data.mapId,this.data.map||t.IMiniGame10Consts.map),this.init(),this.removeGrp(),this.initPassInfo(),IMiniGameMain.playBgm(t.IMiniGame10Consts.minigame10_bgm)},e.prototype.updateSpec=function(){if(this.data.specInfo.spSkill){var t=this.data.specInfo.spSkill;for(var i in this.data.skills){var e=this.data.skills[i];e||(e={});var s=t[i];if(s)for(var h in e)void 0==s[h]&&(s[h]=e[h])}}},e.prototype.initSkins=function(){if(!this.isInit){i.prototype.initSkins.call(this),this.dropGrp=GObj.create(egret.DisplayObjectContainer),this.dropGrp.touchEnabled=!1,this.dropGrp.touchChildren=!1,this.mapGrp.addChild(this.dropGrp),this.avatarGrp=GObj.create(egret.DisplayObjectContainer),this.avatarGrp.touchEnabled=!1,this.avatarGrp.touchChildren=!1,this.mapGrp.addChild(this.avatarGrp),this.skillGrpDict={};for(var e,s=1;6>=s;s++)e=GObj.create(egret.DisplayObjectContainer),e.touchEnabled=!1,e.touchChildren=!1,this.skillGrpDict[s]=e,this.mapGrp.addChild(e);this.tuoweiGrp=GObj.create(egret.DisplayObjectContainer),this.tuoweiGrp.touchEnabled=!1,this.tuoweiGrp.touchChildren=!1,this.mapGrp.addChild(this.tuoweiGrp),this.hitEffGrp=GObj.create(egret.DisplayObjectContainer),this.hitEffGrp.touchEnabled=!1,this.hitEffGrp.touchChildren=!1,this.mapGrp.addChild(this.hitEffGrp),this.hurtGrp=GObj.create(egret.DisplayObjectContainer),this.hurtGrp.touchEnabled=!1,this.hurtGrp.touchChildren=!1,this.mapGrp.addChild(this.hurtGrp),this.uiGroup=GObj.create(eui.Group),this.uiGroup.touchEnabled=!1,this.uiGroup.width=this.width,this.uiGroup.height=this.height,this.addChild(this.uiGroup),this.touchRect=GObj.create(eui.Rect),this.touchRect.fillAlpha=.001,this.touchRect.width=this.uiGroup.width,this.touchRect.height=this.uiGroup.height,this.uiGroup.addChild(this.touchRect),this.rocker=GObj.create(t.IMiniGame10Rocker),this.uiGroup.addChild(this.rocker),this.monsterImg=GObj.create(t.ImageOutside),this.monsterImg.setOutSrc("img2"),this.monsterImg.left=10,this.monsterImg.top=80,this.uiGroup.addChild(this.monsterImg),this.timeLab=GObj.create(eui.Label),this.timeLab.horizontalCenter=0,this.timeLab.top=100,this.timeLab.size=20,this.timeLab.textColor=0,this.uiGroup.addChild(this.timeLab),this.waveLab=GObj.create(eui.Label),this.waveLab.horizontalCenter=0,this.waveLab.top=70,this.waveLab.size=30,this.waveLab.textColor=0,this.uiGroup.addChild(this.waveLab),this.monsterLab=GObj.create(eui.Label),this.monsterLab.left=55,this.monsterLab.top=85,this.monsterLab.size=20,this.monsterLab.textColor=0,this.uiGroup.addChild(this.monsterLab),this.fightImg=GObj.create(t.ImageOutside),this.fightImg.setOutSrc("img3"),this.fightImg.horizontalCenter=0,this.fightImg.bottom=81,this.uiGroup.addChild(this.fightImg),this.expBgImg=GObj.create(t.ImageOutside),this.expBgImg.width=StageManager.stageWidth,this.expBgImg.x=0,this.expBgImg.bottom=55,this.expBgImg.setOutSrc("exp_0"),this.uiGroup.addChild(this.expBgImg),this.expImg=GObj.create(t.ImageOutside),this.expImg.x=this.expBgImg.x,this.expImg.bottom=55,this.expImg.setOutSrc("exp_1"),this.uiGroup.addChild(this.expImg),this.expLab=GObj.create(eui.Label),this.expLab.left=10,this.expLab.bottom=60,this.expLab.size=20,this.expLab.textColor=0,this.uiGroup.addChild(this.expLab),this.exitBtn=GObj.create(t.IBaseBtn),this.exitBtn.icon=IMiniGameMain.getIcon("exit_btn",FileConst.png,"chapter"),this.exitBtn.right=0,this.exitBtn.top=IMiniGameMain.safeHeight+100,this.uiGroup.addChild(this.exitBtn),this.specGrp=GObj.create(eui.Group),this.specGrp.horizontalCenter=0,this.specGrp.bottom=0,this.specGrp.layout||(this.specGrp.layout=GObj.create(eui.HorizontalLayout),this.specGrp.layout.gap=10),this.uiGroup.addChild(this.specGrp),this.bossMovie=GObj.create(t.IMovie),this.bossMovie.isLast=!0,this.uiGroup.addChild(this.bossMovie),this.popGroup=GObj.create(eui.Group),this.popGroup.touchEnabled=!1,this.popGroup.width=this.width,this.popGroup.height=this.height,this.addChild(this.popGroup),this.addEvent(!0),this.natureInfo.textColor=16711680,this.natureInfo.visible=!1,this.addChild(this.natureInfo)}},e.prototype.addEvent=function(t){t&&(i.prototype.addEvent.call(this),this.touchRect.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.touchBeginHandler,this),this.exitBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCloseClick,this))},e.prototype.removeEvent=function(){i.prototype.removeEvent.call(this),this.touchRect.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.touchBeginHandler,this),this.exitBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onCloseClick,this)},e.prototype.init=function(){this.frameDown50=0;var t=0;for(!this.dropPool&&(this.dropPool=[]),!this.dropIn&&(this.dropIn=[]),t=0;t<this.dropIn.length;t++)this.backDropObj(this.dropIn[t]);for(this.dropIn.length=0,!this.monstersPool&&(this.monstersPool=[]),!this.monstersIn&&(this.monstersIn=[]),t=0;t<this.monstersIn.length;t++)this.backMonsterObj(this.monstersIn[t]);for(this.monstersIn.length=0,!this.skillPool&&(this.skillPool={}),!this.skillIn&&(this.skillIn=[]),t=0;t<this.skillIn.length;t++)this.backSkillObj(this.skillIn[t]);for(this.skillIn.length=0,!this.hitEffPool&&(this.hitEffPool=[]),!this.hitEffIn&&(this.hitEffIn=[]),t=0;t<this.hitEffIn.length;t++)this.backHitEffObj(this.hitEffIn[t]);for(this.hitEffIn.length=0,!this.hurtPool&&(this.hurtPool=[]),!this.hurtIn&&(this.hurtIn=[]),t=0;t<this.hurtIn.length;t++)this.backHurtObj(this.hurtIn[t]);this.hurtIn.length=0,!this.atkVoPool&&(this.atkVoPool=[]),this.refreshC=0,this.lastT=0,this.time=0,this.monsterFrame=0,this.skillFrame=0,this.frameCount=0,this.isAllExp=!1,this.timeLab.text="00:00",this.specImgs=[],this.skillCountDict={}},e.prototype.removeGrp=function(){this.popGroup.removeChildren(),this.dropGrp.removeChildren(),this.avatarGrp.removeChildren(),this.hitEffGrp.removeChildren(),this.hurtGrp.removeChildren(),this.specGrp.removeChildren(),this.tuoweiGrp.removeChildren(),this.clearSkillGrp()},e.prototype.clearSkillGrp=function(){if(this.skillGrpDict)for(var t in this.skillGrpDict)this.skillGrpDict[t].removeChildren()},e.prototype.initPassInfo=function(){this.initPlayer(),this.checkWave(!0),this.start(),IMiniGameMain.reqSocket(1,this.data.stageId)},e.prototype.checkNature=function(){if(!i.prototype.checkNature.call(this))return!1;if(this.time++,3==this.time&&IMiniGameMain.reqSocket(2),this.time>this.data.time)return void this.setResult(!1);var t=Math.floor(this.time/60);t=t>=10?t:"0"+t;var e=this.time%60;if(e=e>=10?e:"0"+e,this.timeLab.text=t+":"+e,this.time==this.specInfo.spTime-1&&(this.isAllExp=!0),this.specInfo.spTime==this.time){this.isAllExp=!1,this.specInfo.spIsExp&&(this.player.setMaxLv(),this.expMaxShow()),this.specInfo.spDa&&this.showUpPop(this.specInfo.spDa),this.specInfo.spCM&&(this.lastT=0,this.curIdx=this.specInfo.spCM),this.specInfo.spSkill&&this.specSkill();for(var s in this.specInfo.spSkill)this.player.addSkill(+s);this.updateSkillIcon()}return this.checkWave(),this.checkBoss(),!0},e.prototype.checkWave=function(t){void 0===t&&(t=!1),t&&(this.curIdx=1);for(var i=this.data.passes.length,e=this.curIdx;i>e;e++){var s=this.data.passes[e];this.time>=s.passTime&&(this.curIdx++,this.lastT=0)}if(this.waveLab.text="第"+this.curIdx+"/"+i+"波",this.waveData=this.data.passes[this.curIdx-1],this.waveData){if(this.curIdx==i&&this.refreshC==this.waveData.refreshC){var h=0==this.monstersIn.length,a=void 0;return a=this.data.boss?this.boss&&this.boss.isDie():!0,void(h&&a&&this.setResult(!0))}this.time-this.lastT>=(this.waveData.timeGap||0)&&(this.curIdx==i&&this.refreshC++,this.createMonsters(),this.lastT=this.time)}},e.prototype.checkBoss=function(){if(this.data.boss){var i=this.data.boss.bossTime;this.time==i&&(this.bossMovie.visible=!1,this.bossMovie.setLoadCompleteBack(this.showBossMovie,this),this.bossMovie.start(t.IMiniGame10Consts.bossMovie,1),this.bossMovie.autoRun())}},e.prototype.showBossMovie=function(){var t=this;this.bossMovie.visible=!0,this.bossMovie.x=this.width+this.bossMovie.width,this.bossMovie.y=this.height/3;var i=(this.width-this.bossMovie.width)/2;egret.Tween.get(this.bossMovie).to({x:i},500).wait(500).call(function(){t.createBoss()},this).to({x:-this.bossMovie.width},500).call(function(){t.bossMovie&&t.bossMovie.stop()},this)},e.prototype.updateExp=function(t){if(this.player){var i=t&&this.player.addExp(t),e=this.player.getExpInfo()[this.player.lv+1];if(e?(this.expImg.width=this.player.exp/e*this.expBgImg.width,this.expLab.text="lv:"+this.player.lv+",exp:"+this.player.exp+"/"+e):this.expMaxShow(),i){var s=this.player.getSkillInfo()[this.player.lv];this.showUpPop(s)}}},e.prototype.expMaxShow=function(){this.expImg.width=this.expBgImg.width,this.expLab.text="lv:max"},e.prototype.showUpPop=function(i){var e=this;i&&(this.isRunning=!1,this.upPop||(this.upPop=GObj.create(t.IMiniGame10UpPop)),this.upPop.show(i,null,function(){e.player.addSkill(i),e.isRunning=!0,e.createSkill([i]),e.updateSkillIcon()},this),this.popGroup.addChild(this.upPop),IMiniGameMain.playEff(t.IMiniGame10Consts.minigame10_prop))},e.prototype.specSkill=function(){var t=this,i=[];for(var e in this.specInfo.spSkill)i.push(+e);egret.Tween.get(this).wait(1e3).call(function(){t.createSkill(i,!0)})},e.prototype.updateSkillIcon=function(){for(var i=10,e=this.player.getSkill(),s=function(i){var s=h.specImgs[i];s||(s=GObj.create(t.ImageOutside),s.setOutSrc("img5"),s.loadCompleteCall(function(){s.width=s.iconWidth,s.height=s.iconHeight},h),h.specGrp.addChild(s)),e[i]&&s.setOutSrc("skill_sm_"+e[i]),h.specImgs[i]=s},h=this,a=0;i>a;a++)s(a)},e.prototype.setResult=function(i){this.isRunning=!1,i?(this.clearSkillGrp(),IMiniGameMain.playEff(t.IMiniGame10Consts.minigame10_win)):IMiniGameMain.playEff(t.IMiniGame10Consts.minigame10_die),i&&this.data.spExtra&&t.IMiniGame10Consts.switchPet?(this.upPop||(this.upPop=GObj.create(t.IMiniGame10UpPop)),this.upPop.show(null,this.data.spExtra,this.openResultPop,this,i),this.popGroup.addChild(this.upPop)):this.openResultPop(i)},e.prototype.openResultPop=function(i){var e=GObj.create(t.IMiniGame10ResultPop);e.show(i,this.data,this.resultCallBack,this),this.popGroup.addChild(e)},e.prototype.resultCallBack=function(i,e){var s=t.IMiniGame10Consts.stages[this.data.stageId];1==i&&(e&&!s?i=4:DispatcherManager.dispatch(IMiniGameEvent.IMiniGameResultBack,4)),2==i&&this.setData(s),3==i&&this.setData(this.data),4==i&&DispatcherManager.dispatch(IMiniGameEvent.IMiniGameResultBack,2)},e.prototype.onCloseClick=function(){this.stop(),DispatcherManager.dispatch(IMiniGameEvent.IMiniGameResultBack,4)},e.prototype.touchBeginHandler=function(t){var i=GObj.create(egret.Point);this.globalToLocal(t.stageX,t.stageY,i),this.rocker.visible=!0,this.rocker.x=i.x,this.rocker.y=i.y,this.rocker.onBeginClick()},e.prototype.run=function(){this.isRunning&&(this.playerRun(),this.monsterRun(),this.hitEffRun(),this.hurtRun(),this.dropCollisionPlayer())},e.prototype.initPlayer=function(){var i=this;this.divinePet&&(GObj.disposeObject(this.divinePet),this.divinePet=null),this.player||(this.player=GObj.create(t.IMiniGame10Player)),this.avatarGrp.addChild(this.player);var e=this.data.player;if(this.player.setData(e),this.player.x=this.mapGrp.width/2,this.player.y=this.mapGrp.height/2,this.data.player.pets&&0!=this.data.player.pets.length&&this.data.pet){var s=this.data.pet[0];this.divinePet=GObj.create(t.IMiniGame10DivinePet),this.divinePet.setData(s),this.divinePet.x=this.player.x+100,this.divinePet.y=this.player.y+100,this.divinePet.setFollow(this.player),this.radius=s.petRadius||200,this.petRadius=s.atkRadius||50,this.petAngle=s.atkAngle||60,this.divinePet.setFun(this.RefreshMon,this,this.petHurt,this),this.avatarGrp.addChild(this.divinePet)}this.setMoveArea(this.player),this.cameraFollow=this.player,this.setCamera(),this.updateExp(),this.updateSkillIcon(),egret.Tween.get(this).wait(2e3).call(function(){i.createSkill()})},e.prototype.RefreshMon=function(){if(this.monstersIn&&0!=this.monstersIn.length){for(var t,i,e,s,h,a=GMath.sin(this.petAngle/2)*this.petRadius,n=0,o=0,r=0;r<this.monstersIn.length;r++)t=this.monstersIn[r],GMath.distance(t.x,t.y,this.player.x,this.player.y)<this.radius&&(s=GMath.distance(t.x,t.y,this.divinePet.x,this.divinePet.y),t.y>this.divinePet.y-a&&t.y<this.divinePet.y+a&&(0==n&&(i=t),h=GMath.distance(i.x,i.y,this.divinePet.x,this.divinePet.y),h>s&&(i=t),n++),0==o&&(e=t),h=GMath.distance(e.x,e.y,this.divinePet.x,this.divinePet.y),h>s&&(e=t),o++);i?this.divinePet.setTarget(i):this.divinePet.setTarget(e)}},e.prototype.petHurt=function(t){if(this.monstersIn&&0!=this.monstersIn.length)for(var i,e,s,h,a,n=GMath.sin(this.petAngle/2)*this.petRadius,o=this.divinePet.y-this.divinePet.fixHeight/2,r=0;r<this.monstersIn.length;r++)i=this.monstersIn[r],i&&i.y>o-n&&i.y<o+n&&(e=this.divinePet.getLeft()?-this.petRadius:this.petRadius,0>e?(s=this.divinePet.x-this.divinePet.fixWidth/2,h=this.divinePet.x+e-this.divinePet.fixWidth/2):(s=this.divinePet.x+e+this.divinePet.fixWidth/2,h=this.divinePet.x+this.divinePet.fixWidth/2),i.x>h&&i.x<s&&(a=this.getAtkVoObj({atkx:i.x,atky:i.y,hurt:t||10}),i.setHit(a),this.hurtAddToScene(a)))},e.prototype.playerRun=function(){return this.divinePet&&this.divinePet.run(),this.player?(this.player.run(),this.player.canRemove()?void this.setResult(!1):void(this.player.isDie()||(this.player.setMove(this.rocker.isMove),this.player.setDir(this.rocker.dir),this.player.setAngle(this.rocker.angle),this.rocker.isMove&&this.setCamera(),this.checkPlayerA(),this.runSkill()))):void 0},e.prototype.checkPlayerA=function(){if(this.player.isAtking){var t=this.monstersIn,i=t.length;if(i)for(var e=0;i>e;e++){var s=t[e];
if(s&&!s.isDie()&&s.lastAIndex!=this.player.atkIndex&&this.player.checkAtkMonster(s)){var h=this.getAtkVoObj({aindex:this.player.atkIndex,atkx:s.x,atky:s.y,hurt:this.player.getAtkHurt()});s.setHit(h),this.hurtAddToScene(h)}}}},e.prototype.createMonsters=function(){for(var t,i=this.waveData.monsterNum,e=0;i>e;e++){var s=GMath.randomInt(0,this.waveData.monsterType.length-1),h=this.waveData.monsterType[s],a=this.data.monsters[h];t=this.getMonsterFromPool(),t.setData(a),t.setTarget(this.player),t.id=this.monstersIn.length+1,this.setMonPosition(t),this.monstersIn.push(t),this.avatarGrp.addChild(t)}},e.prototype.setMonPosition=function(t,i){void 0===i&&(i=1);var e=200*i,s=this.player.x,h=this.player.y,a=[s-this.width/2-e,s+this.width/2+e],n=a[0],o=a[1],r=[0,0,0,0],l=r[0],p=r[1],c=r[2],u=r[3];c=GMath.randomInt(n,o),c>=s-this.width/2&&c<=s+this.width/2?(d=GMath.rate(50)?[h-this.height/2-e,h-this.height/2]:[h+this.height/2,h+this.height/2+e],l=d[0],p=d[1]):(m=[h-this.height/2-e,h+this.height/2+e],l=m[0],p=m[1]),u=GMath.randomInt(l,p),t.x=c,t.y=u,this.isAroundHaveMon(c,u)&&this.setMonPosition(t,++i);var d,m},e.prototype.isAroundHaveMon=function(t,i){var e=this.getMonLives(!1),s=e.length;if(0!=s){for(var h=0;s>h;h++){var a=e[h];if(!a.isBoss){var n=GMath.distance(t,i,a.x,a.y),o=a.width/2||100;if(o>n)return!0}}return!1}},e.prototype.createBoss=function(){this.boss||(this.boss=this.getMonsterFromPool()),this.boss.reset(),this.boss.isBoss=!0,this.boss.setData(this.data.boss),this.boss.setTarget(this.player),this.setMonsterPoint(this.boss),this.monstersIn.push(this.boss),this.avatarGrp.addChild(this.boss)},e.prototype.setMonsterPoint=function(t){var i=GMath.randomInt(0,360),e=GMath.randomInt(this.width/2,this.width/2+200),s=GMath.randomInt(this.height/2,this.height/2+200);t.isBoss&&(i=315,e=this.width/2,s=this.height/3),t.x=this.player.x+e*GMath.cos(i),t.y=this.player.y+s*GMath.sin(i)},e.prototype.getMonLives=function(t){for(var i=[],e=this.monstersIn,s=0,h=e;s<h.length;s++){var a=h[s];a.isDie()||i.push(a)}return t&&i.sort(function(t,i){return t.distance-i.distance}),i},e.prototype.getTarget=function(t){var i=t&&t.length;if(0!=i){var e=i>20?20:i,s=GMath.randomInt(0,e-1),h=t[s];return h}},e.prototype.getMonsterFromPool=function(){var i=this.monstersPool.pop();return i||(i=GObj.create(t.IMiniGame10Monster)),i.reset(),i},e.prototype.backMonsterObj=function(t){t&&(t.parent&&t.parent.removeChild(t),-1==this.monstersPool.indexOf(t)&&this.monstersPool.push(t))},e.prototype.backSkillObj=function(t){if(t){t.parent&&t.parent.removeChild(t);var i=t.getSkillType(),e=this.skillPool[i];!e&&(e=this.skillPool[i]=[]),-1==e.indexOf(t)&&e.push(t)}},e.prototype.monsterRun=function(){var t=this.monstersIn,i=t.length;if(this.monsterLab.text=i+"",i){for(var e,s=Math.ceil(.6*i),h=this.monsterFrame;s>0;)if((h>=i||0>h)&&(h=0),e=t[h],s--,e)if(e.canRemove())t.splice(h,1),h--,e.isBoss||this.dropAddToScene(e.x,e.y-e.height/2,e.getMonsterExp()),this.backMonsterObj(e);else{if(e.isBoss&&this.avatarGrp.addChildAt(e,0),e.y<this.player.y){var a=this.avatarGrp.getChildIndex(this.player),n=this.avatarGrp.getChildIndex(e);this.divinePet&&this.avatarGrp.addChildAt(this.divinePet,a),n>a&&this.avatarGrp.addChildAt(e,a)}if(e.run(),h++,!e.isDie()&&(this.showOrHide(e),!this.player.isDie()&&e.monsterCollision())){var o=this.getAtkVoObj({atkx:this.player.x,atky:this.player.y-20,hurt:e.hurt,isRole:!0});this.player.setHit(o.hurt),this.hurtAddToScene(o)}}this.monsterFrame=h}},e.prototype.hitEffAddToScene=function(t){var i=this.gethitEffObj();i.x=t.atkx,i.y=t.atky;var e=t.isRole?AvatarConsts.B_B:AvatarConsts.R_B,s="ui_shouji";t.hitModel&&(s=t.hitModel),i.start(s,1,100,null,e),this.hitEffIn.push(i),this.hitEffGrp.addChild(i)},e.prototype.gethitEffObj=function(){var i=this.hitEffPool.pop();return i||(i=GObj.create(t.IMovie)),i},e.prototype.backHitEffObj=function(t){t&&-1==this.hitEffPool.indexOf(t)&&(t.parent&&t.parent.removeChild(t),this.hitEffPool.push(t))},e.prototype.hitEffRun=function(){var t=this.hitEffIn.length;if(0!=t)for(var i=0;t>i;i++){var e=this.hitEffIn[i];e&&(e.run(),this.showOrHide(e),e.isOver&&(this.hitEffIn.splice(i,1),this.backHitEffObj(e),i--))}},e.prototype.hurtAddToScene=function(t){this.hitEffAddToScene(t);var i=this.getHurtObj();i.x=t.atkx,i.y=t.atky,i.setHurt(t.hurt),this.hurtIn.push(i),this.hurtGrp.addChild(i),this.backAtkVoObj(t)},e.prototype.getHurtObj=function(){var i=this.hurtPool.pop();return i||(i=GObj.create(t.IminiGame10Hurt)),i},e.prototype.backHurtObj=function(t){t&&-1==this.hurtPool.indexOf(t)&&(t.parent&&t.parent.removeChild(t),this.hurtPool.push(t))},e.prototype.hurtRun=function(){var t=this.hurtIn.length;if(t)for(var i=0;t>i;i++){var e=this.hurtIn[i];if(!e)break;e.run(),this.showOrHide(e),e.isRun||(this.hurtIn.splice(i,1),i--,this.backHurtObj(e))}},e.prototype.dropAddToScene=function(t,i,e){var s=this.getDropObj();s.setData(t,i,e),this.dropIn.push(s),this.dropGrp.addChild(s)},e.prototype.getDropObj=function(){var i=this.dropPool.pop();return i||(i=GObj.create(t.IMiniGame10Drop)),i.reset(),i},e.prototype.backDropObj=function(t){t&&-1==this.dropPool.indexOf(t)&&(t.parent&&t.parent.removeChild(t),this.dropPool.push(t))},e.prototype.dropCollisionPlayer=function(){if(!this.player.isDie()){var t=this.dropIn.length;if(t)for(var i=0;t>i;i++){var e=this.dropIn[i];if(!e)break;if(e.isRemove)this.dropIn.splice(i,1),i--,this.backDropObj(e),this.updateExp(e.getDropExp());else{var s=GMath.distance(this.player.x,this.player.y-this.player.height/2,e.x,e.y),h=this.player.getCollPropDis(this.isAllExp);h>=s&&e.flyToPlayer(this.player)}}}},e.prototype.createSkill=function(t,i){if(void 0===t&&(t=this.player.getSkill()),t.length)for(var e,s,h,a,n,o,r=0;r<t.length;r++)if(n=t[r],(this.monstersIn.length||n==Skill10Type.TYPE_6)&&(o=this.skillCountDict[n]||0,!(n==Skill10Type.TYPE_5&&o>0))){h=i?this.specInfo.spSkill[n]:this.data.skills[n],s=h.skillNum||1,a=this.skillGrpDict[n];for(var l=0;s>l;l++)e=this.getSkillObj(n),e.setData(h),n!=Skill10Type.TYPE_4&&e.setPlayer(this.player),n==Skill10Type.TYPE_1&&e.setTuoweiGrp(this.tuoweiGrp),this.skillIn.push(e),a.addChild(e),o++;this.skillCountDict[n]=o}},e.prototype.getSkillObj=function(i){var e=this.skillPool[i],s=e&&e.pop();return s||(s=GObj.create(t["IMiniGame10Skill"+i])),s.reset(),s},e.prototype.runSkill=function(){this.frameCount++;var t=this.skillIn.length;if(t){for(var i,e,s=t,h=this.skillFrame,a=this.getMonLives(this.frameCount%20==0);s>0;)if((h>=t||0>h)&&(h=0),i=this.skillIn[h],s--,h++,i)switch(this.showOrHide(i),i.getSkillType()){case Skill10Type.TYPE_1:e=this.skill1Handler(i,a);break;case Skill10Type.TYPE_2:e=this.skill2Handler(i,a);break;case Skill10Type.TYPE_3:e=this.skill3Handler(i,a);break;case Skill10Type.TYPE_4:e=this.skill4Handler(i,a);break;case Skill10Type.TYPE_5:e=this.skill5Handler(i,a);break;case Skill10Type.TYPE_6:e=this.skill6Handler(i,a)}this.skillFrame=h}},e.prototype.skill1Handler=function(t,i){if(!t.checkTarget())if(t.lastAtkVo)this.hurtAddToScene(t.lastAtkVo),t.lastAtkVo=null;else{var e=this.getTarget(i);e&&t.setTarget(e)}return t.run(),!1},e.prototype.skill2Handler=function(t,i){if(t.lastAtkVo){var e=this.getAtkVoObj(t.lastAtkVo);return t.target.setHit(e),this.hurtAddToScene(e),t.lastAtkVo=null,!0}if(!t.checkTarget()){var s=this.getTarget(i);s&&t.setTarget(s)}return t.run(),!1},e.prototype.skill3Handler=function(t,i){if(t.run(),t.lastAtkVo){var e=this.getAtkVoObj(t.lastAtkVo);return t.target.setHit(e),this.hurtAddToScene(e),t.lastAtkVo=null,!0}if(t.getIsCd())return!1;if(!t.target){var s=this.getTarget(i);return s&&t.setTarget(s),!1}for(var h=i,a=0;a<h.length;a++){var n=h[a];if(n&&!n.isDie()&&t.checkAtkMonster(n)){var e=this.getAtkVoObj({skillType:t.getSkillType(),atkx:n.x,atky:n.y,hurt:t.hurt,hitModel:t.getHitModel()});n.setHit(e),this.hurtAddToScene(e)}}return!1},e.prototype.skill4Handler=function(t,i){if(t.run(),t.getIsCd())return!1;var e=this.getTarget(i);if(e&&t.setTarget(e),t.isFirst){var s=this.getAtkVoObj(t.getFirstVo());t.target.setHit(s),this.hurtAddToScene(s),t.isFirst=!1,e=this.getTarget(i),t.setAngleByMon(e,this.player)}if(t.isSecond){for(var h=i,a=0;a<h.length;a++){var n=h[a];if(n&&!n.isDie()&&t.checkAtkMonster(n)){var o=this.getAtkVoObj({skillType:t.getSkillType(),atkx:n.x,atky:n.y,hurt:t.hurt,hitModel:t.getHitModel()});n.setHit(o),this.hurtAddToScene(o)}}t.isSecond=!1}return!1},e.prototype.skill5Handler=function(t,i){if(t.run(),!t.getIsCd()){for(var e=i,s=void 0,h=0;h<e.length;h++)if(s=e[h],s&&!s.isDie()&&t.checkAtkMonster(s)){var a=this.getAtkVoObj({skillType:t.getSkillType(),atkx:s.x,atky:s.y,hurt:t.hurt,hitModel:t.getHitModel()});s.setHit(a),this.hurtAddToScene(a)}t.enterCd()}return!1},e.prototype.skill6Handler=function(t,i){if(t.run(),!t.getIsCd())for(var e=i,s=void 0,h=0;h<e.length;h++)if(s=e[h],s&&!s.isDie()&&t.checkAtkMonster(s)){var a=this.getAtkVoObj({skillType:t.getSkillType(),atkx:s.x,atky:s.y,hurt:t.hurt,hitModel:t.getHitModel()});s.setHit(a),this.hurtAddToScene(a)}return!1},e.prototype.getAtkVoObj=function(t){var i=this.atkVoPool.pop();return i||(i=GObj.create(Atk10Vo)),ObjectUtil.oto(t,i),i},e.prototype.backAtkVoObj=function(t){t&&-1==this.atkVoPool.indexOf(t)&&(t.reset(),this.atkVoPool.push(t))},e.prototype.dispose=function(){if(!this.isDestory){if(this.removeEvent(),egret.Tween.removeTweens(this),this.divinePet&&(GObj.disposeObject(this.divinePet),this.divinePet=null),GObj.disposeObject(this.avatarGrp),this.avatarGrp=null,GObj.disposeObject(this.dropGrp),this.dropGrp=null,GObj.disposeObject(this.hitEffGrp),this.hitEffGrp=null,GObj.disposeObject(this.hurtGrp),this.hurtGrp=null,GObj.disposeObject(this.player),this.player=null,this.skillGrpDict){for(var t in this.skillGrpDict)GObj.disposeObject(this.skillGrpDict[t]);this.skillGrpDict=null}for(var e=0,s=this.monstersPool;e<s.length;e++){var h=s[e];GObj.disposeObject(h)}this.monstersPool=null;for(var a=0,n=this.monstersIn;a<n.length;a++){var h=n[a];GObj.disposeObject(h)}this.monstersIn=null,GObj.disposeObject(this.boss),this.boss=null;for(var o=0,r=this.dropPool;o<r.length;o++){var l=r[o];GObj.disposeObject(l)}this.dropPool=null;for(var p=0,c=this.dropIn;p<c.length;p++){var l=c[p];GObj.disposeObject(l)}this.dropIn=null;for(var u in this.skillPool)for(var d=0,m=this.skillPool[u];d<m.length;d++){var g=m[d];GObj.disposeObject(g)}this.skillPool=null;for(var f=0,b=this.skillIn;f<b.length;f++){var g=b[f];GObj.disposeObject(g)}this.skillIn=null;for(var y=0,G=this.hitEffPool;y<G.length;y++){var v=G[y];GObj.disposeObject(v)}this.hitEffPool=null;for(var I=0,O=this.hitEffIn;I<O.length;I++){var v=O[I];GObj.disposeObject(v)}this.hitEffIn=null;for(var C=0,M=this.hurtPool;C<M.length;C++){var k=M[C];GObj.disposeObject(k)}this.hurtPool=null;for(var x=0,j=this.hurtIn;x<j.length;x++){var k=j[x];GObj.disposeObject(k)}this.hurtIn=null;for(var w=0,T=this.atkVoPool;w<T.length;w++){var _=T[w];GObj.disposeObject(_)}this.atkVoPool=null,GObj.disposeObject(this.uiGroup),this.uiGroup=null,GObj.disposeObject(this.popGroup),this.popGroup=null,GObj.disposeObject(this.upPop),this.upPop=null,GObj.disposeObject(this.touchRect),this.touchRect=null,GObj.disposeObject(this.rocker),this.rocker=null,GObj.disposeObject(this.timeLab),this.timeLab=null,GObj.disposeObject(this.waveLab),this.waveLab=null,GObj.disposeObject(this.monsterImg),this.monsterImg=null,GObj.disposeObject(this.monsterLab),this.monsterLab=null,GObj.disposeObject(this.fightImg),this.fightImg=null,GObj.disposeObject(this.expBgImg),this.expBgImg=null,GObj.disposeObject(this.expImg),this.expImg=null,GObj.disposeObject(this.expLab),this.expLab=null,GObj.disposeObject(this.exitBtn),this.exitBtn=null,GObj.disposeObject(this.specGrp),this.specGrp=null;for(var S=0,E=this.specImgs;S<E.length;S++){var B=E[S];GObj.disposeObject(B)}this.specImgs=null,GObj.disposeObject(this.bossMovie),this.bossMovie=null,i.prototype.dispose.call(this)}},e}(t.IMiniGameSecne);t.IMiniGame10Secne=i,__reflect(i.prototype,"miniGame.IMiniGame10Secne")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.skillType=Skill10Type.TYPE_1,t.exact=!0,t.showTrailing=!0,t.trailingType=4,t}return __extends(e,i),e.prototype.initSkins=function(){var e=this;i.prototype.initSkins.call(this),this.img=GObj.create(t.ImageOutside),this.img.loadCompleteCall(function(){e.width=e.img.iconWidth,e.height=e.img.iconHeight,e.img.anchorOffsetX=e.width/2,e.img.anchorOffsetY=e.height/2},this),this.addChild(this.img),this.tuowei=GObj.create(t.IMovie),this.tuowei.x=this.tuowei.y=0,this.tuowei.start("ui_tuowei"),this.tuowei.autoRun(),this.tuoweiGrop&&this.tuoweiGrop.addChild(this.tuowei)},e.prototype.setTuoweiGrp=function(t){this.tuoweiGrop=t,this.tuoweiGrop&&this.tuowei&&this.tuoweiGrop.addChild(this.tuowei)},e.prototype.setData=function(t){i.prototype.setData.call(this,t),this.speed=t.speed||3,this.leng=1.2*this.speed,this.autoRoation=this.data.rotation||0,this.scaleX=this.scaleY=this.data.scaleXY||1,this.hurt=GMath.randomInt(this.data.hurt[0],this.data.hurt[1]),this.img.setOutSrc(t.model)},e.prototype.setPlayer=function(t){this.player=t},e.prototype.setTarget=function(t){this.target=t,this.isFirst&&this.setSkillPoint(),this.ttttt=0},e.prototype.setSkillPoint=function(){if(this.player&&this.target){this.isFirst=!1;var t=this.target.scaleX*this.target.width*.3;this.px=GMath.randomInt(-t,t);var i=this.target.scaleY*this.target.height;this.py=GMath.randomInt(0,.7*i),this.x=this.player.x,this.y=this.player.y-this.player.height*this.player.scaleY/4,this.lockTarget();var e=GMath.angle(this.x,this.y,this.target.x-this.px,this.target.y-this.py);this.setAngle(Math.floor(e))}},e.prototype.run=function(){i.prototype.run.call(this),this.player&&this.target&&(this.scaleX<1?(this.scaleX+=this.data.scaleAdd||.02,this.scaleY=this.scaleX):this.scaleX=this.scaleY=1,this.x+=this.speedx*this.scaleX||0,this.y+=this.speedy*this.scaleY||0,this.tuowei.x=this.x,this.tuowei.y=this.y,this.ttttt++,this.lockTarget(),this.updateAngle(),this.distance=GMath.distance(this.x,this.y,this.target.x-this.px,this.target.y-this.py),this.distance<3*this.speed&&!this.isCd&&this.checkTarget()&&(this.lastAtkVo||(this.lastAtkVo=GObj.create(Atk10Vo),this.lastAtkVo.skillType=this.skillType,this.lastAtkVo.atkx=this.target.x,this.lastAtkVo.atky=this.target.y,this.lastAtkVo.hurt=this.hurt,this.lastAtkVo.hitModel=this.getHitModel()),this.target.setHit(this.lastAtkVo),this.enterCd(),this.target=null))},e.prototype.updateAngle=function(){if(this.autoRoation&&(this.img.rotation+=this.autoRoation),!(this.ttttt>220&&this.ttttt<270)){var t=this.angleTarget-this.angle;if(Math.abs(t)>2*this.speed){var i=t/Math.abs(t);(t>180||-180>t)&&(i=-i);var e=GMath.randomInt(1,this.speed);t=this.angle+Math.ceil(e*i)}else t=this.angleTarget;this.setAngle(t)}},e.prototype.lockTarget=function(){--this.lockGap>0||(this.lockGap=Math.ceil(egret.ticker.$frameRate/5),this.angleTarget=GMath.angle(this.x,this.y,this.target.x-this.px,this.target.y-this.py),this.angleTarget=Math.floor(this.angleTarget))},e.prototype.setAngle=function(t){t!=this.angle&&(this.angle=Math.floor((t+360)%360),this.autoRoation||(this.img.rotation=t+90),this.tuowei.rotation=t+90,this.speedx=this.speed*Math.cos(t*Math.PI/180),this.speedy=this.speed*Math.sin(t*Math.PI/180))},e.prototype.checkTarget=function(){return this.target?!this.target.isDie():!1},e.prototype.reset=function(){i.prototype.reset.call(this),this.isFirst=!0,this.lockGap=0,this.angle=null,this.target=null,this.player=null,this.data=null,this.px=0,this.py=0,this.distance=9999,this.autoRoation=0,this.lastAtkVo=null,this.tuoweiGrop=null},e.prototype.getAngle=function(){return this.angle||0},e.prototype.dispose=function(){GObj.disposeObject(this.img),this.img=null,GObj.disposeObject(this.tuowei),this.tuowei=null,i.prototype.dispose.call(this)},e}(t.IMiniGame10BaseSkill);t.IMiniGame10Skill1=i,__reflect(i.prototype,"miniGame.IMiniGame10Skill1",["ITrailingVo","egret.DisplayObject"])}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.skillType=Skill10Type.TYPE_2,t.exact=!0,t}return __extends(e,i),e.prototype.initSkins=function(){var e=this;i.prototype.initSkins.call(this),this.img=GObj.create(t.ImageOutside),this.img.loadCompleteCall(function(){e.width=e.img.iconWidth,e.height=e.img.iconHeight,e.anchorOffsetX=e.width/2,e.anchorOffsetY=e.height/2},this),this.addChild(this.img)},e.prototype.setData=function(t){i.prototype.setData.call(this,t),this.speed=t.speed||3,this.autoRoation=0,this.scaleX=this.scaleY=this.data.scaleXY||1,this.hurt=GMath.randomInt(t.hurt[0],t.hurt[1]),this.img.setOutSrc(t.model),this.isUpdate=!0},e.prototype.setPlayer=function(t){this.player=t},e.prototype.setTarget=function(t){this.target=t,this.checkTarget()&&this.setSkillPoint()},e.prototype.setSkillPoint=function(){if(this.player&&this.target&&this.isUpdate){this.isUpdate=!1;var t=this.target.scaleX*this.target.width*.3;this.px=GMath.randomInt(-t,t);var i=this.target.scaleY*this.target.height;this.py=GMath.randomInt(0,.7*i),this.x=this.player.x,this.y=this.player.y-this.player.height*this.player.scaleY/4,this.lockTarget();var e=GMath.angle(this.x,this.y,this.target.x-this.px,this.target.y-this.py);this.setAngle(Math.floor(e))}},e.prototype.checkTarget=function(){return this.target?!this.target.isDie():!1},e.prototype.lockTarget=function(){this.angleTarget=GMath.angle(this.x,this.y,this.target.x-this.px,this.target.y-this.py),this.angleTarget=Math.floor(this.angleTarget)},e.prototype.setAngle=function(t){t!=this.angle&&(this.angle=Math.floor((t+360)%360),this.autoRoation||(this.rotation=t+90),this.speedx=this.speed*Math.cos(t*Math.PI/180),this.speedy=this.speed*Math.sin(t*Math.PI/180))},e.prototype.cdFinish=function(){i.prototype.cdFinish.call(this),this.target=null,this.isUpdate=!0,this.scaleX=this.scaleY=this.data.scaleXY||1,this.hurt=GMath.randomInt(this.data.hurt[0],this.data.hurt[1])},e.prototype.run=function(){this.visible=!this.isCd,i.prototype.run.call(this),this.isCd||this.player&&this.checkTarget()&&this.trackPath1()},e.prototype.trackPath1=function(){this.scaleX<1?(this.scaleX+=this.data.scaleAdd||.02,this.scaleY=this.scaleX):this.scaleX=this.scaleY=1,this.lockTarget(),this.updateAngle(),this.x+=this.speedx*this.scaleX||0,this.y+=this.speedy*this.scaleY||0,this.distance=GMath.distance(this.x,this.y,this.target.x-this.px,this.target.y-this.py),this.distance<3*this.speed&&(this.lastAtkVo||(this.lastAtkVo={skillType:this.skillType,atkx:this.target.x,atky:this.target.y,hurt:this.hurt,hitModel:this.getHitModel()}),this.enterCd())},e.prototype.updateAngle=function(){this.autoRoation&&(this.rotation+=this.autoRoation);var t=this.angleTarget-this.angle;if(this.distance>30&&Math.abs(t)>2*this.speed){var i=t/Math.abs(t);(t>180||-180>t)&&(i=-i),t=this.angle+Math.ceil(this.speed*i)}else t=this.angleTarget;this.setAngle(t)},e.prototype.reset=function(){i.prototype.reset.call(this),this.isUpdate=!1,this.rotation=0,this.lockGap=0,this.angle=null,this.target=null,this.player=null,this.data=null,this.px=0,this.py=0,this.distance=9999,this.autoRoation=0,this.lastAtkVo=null},e.prototype.dispose=function(){GObj.disposeObject(this.img),this.img=null,i.prototype.dispose.call(this)},e}(t.IMiniGame10BaseSkill);t.IMiniGame10Skill2=i,__reflect(i.prototype,"miniGame.IMiniGame10Skill2")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.skillType=Skill10Type.TYPE_3,t.exact=!0,t}return __extends(e,i),e.prototype.initSkins=function(){i.prototype.initSkins.call(this),this.skillM=GObj.create(t.IMovie),this.addChild(this.skillM)},e.prototype.setData=function(t){i.prototype.setData.call(this,t),this.atkGap=t.atkGap,this.speed=t.speed||3,this.cdFinish()},e.prototype.setPlayer=function(t){this.player=t},e.prototype.setTarget=function(t){this.target||(this.target=t,this.atkList.push(this.target.id),this.skillM.start(this.data.model),this.skillM.autoRun(),this.setSkillPoint())},e.prototype.setSkillPoint=function(){if(this.player&&this.target){var t=this.target.scaleX*this.target.width*.3;this.px=GMath.randomInt(-t,t);var i=this.target.scaleY*this.target.height;this.py=GMath.randomInt(0,.7*i),this.x=this.player.x,this.y=this.player.y-this.player.height*this.player.scaleY/4,this.trackPath1()}},e.prototype.checkTarget=function(){return this.target?!this.target.isDie():!1},e.prototype.lockTarget=function(){--this.lockGap>0||(this.lockGap=Math.ceil(egret.ticker.$frameRate/5),this.angleTarget=GMath.angle(this.x,this.y,this.target.x-this.px,this.target.y-this.py),this.angleTarget=Math.floor(this.angleTarget))},e.prototype.setAngle=function(){var t=GMath.angle(this.x,this.y,this.target.x-this.px,this.target.y-this.py);t!=this.angle&&(this.angle=Math.floor((t+360)%360),this.speedx=this.speed*Math.cos(t*Math.PI/180),this.speedy=this.speed*Math.sin(t*Math.PI/180))},e.prototype.cdFinish=function(){i.prototype.cdFinish.call(this),this.scaleX=this.scaleY=this.data.scaleXY||1,this.hurt=GMath.randomInt(this.data.hurt[0],this.data.hurt[1]),this.reset(!1)},e.prototype.run=function(){this.visible=!this.isCd,i.prototype.run.call(this),this.isCd||this.trackPath1()},e.prototype.trackPath1=function(){this.target&&(this.scaleX<1?(this.scaleX+=this.data.scaleAdd||.02,this.scaleY=this.scaleX):this.scaleX=this.scaleY=1,this.lockTarget(),this.setAngle(),this.x+=this.speedx*this.scaleX||0,this.y+=this.speedy*this.scaleY||0,this.distance=GMath.distance(this.x,this.y,this.target.x-this.px,this.target.y-this.py),this.distance<this.skillM.width/4&&(!this.lastAtkVo&&this.checkTarget()&&(this.lastAtkVo={skillType:this.skillType,atkx:this.target.x,atky:this.target.y,hurt:this.hurt,hitBack:this.data.hitBack,hitModel:this.getHitModel()}),this.enterCd()))},e.prototype.checkAtkMonster=function(t){var i=t.id;if(!(this.atkList.indexOf(i)>-1)){var e=GMath.distance(this.x,this.y,t.x,t.y);return e<this.atkGap?(this.atkList.push(i),!0):void 0}},e.prototype.reset=function(t){void 0===t&&(t=!0),t&&(i.prototype.reset.call(this),this.data=null,this.player=null),this.lockGap=0,this.angle=null,this.target=null,this.px=0,this.py=0,this.distance=9999,this.lastAtkVo=null,this.atkList=[]},e.prototype.dispose=function(){GObj.disposeObject(this.skillM),this.skillM=null,i.prototype.dispose.call(this)},e}(t.IMiniGame10BaseSkill);t.IMiniGame10Skill3=i,__reflect(i.prototype,"miniGame.IMiniGame10Skill3")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.skillType=Skill10Type.TYPE_4,t.exact=!0,t}return __extends(e,i),e.prototype.initSkins=function(){var e=this;i.prototype.initSkins.call(this),this.skillM1=GObj.create(t.IMovie),this.skillM1.setLoadCompleteBack(function(){e.skillM1.scaleX=e.skillM1.scaleY=1,e.isFirst=!0},this),this.addChild(this.skillM1),this.skillM2=GObj.create(t.IMovie),this.skillM2.setLoadCompleteBack(function(){e.skillM2.rotation=e.angle-90},this),this.skillM2.setCompleteBack(function(){e.enterCd()},this),this.addChild(this.skillM2)},e.prototype.setData=function(t){i.prototype.setData.call(this,t),this.atkGap=t.atkGap,this.atkAngle=t.atkAngle,this.cdFinish()},e.prototype.setTarget=function(t){!this.isRun&&t&&(this.playM(),this.target=t,this.isRun=!0,this.x=t.x,this.y=t.y)},e.prototype.playM=function(){var t=this;this.data&&this.skillM1&&this.skillM2&&(this.skillM1.stop(),this.skillM1.start(this.data.model,1,100,null,AvatarConsts.B_B),this.skillM1.autoRun(),egret.Tween.get(this).wait(870).call(function(){t.skillM2.stop(),t.skillM2.start(t.data.model,1,100,null,AvatarConsts.R_B),t.skillM2.autoRun()}),egret.Tween.get(this).wait(1e3).call(function(){t.isSecond=!0}))},e.prototype.cdFinish=function(){i.prototype.cdFinish.call(this),this.data&&(this.scaleX=this.scaleY=this.data.scaleXY||1,this.hurt=GMath.randomInt(this.data.hurt[0],this.data.hurt[1]),this.reset(!1))},e.prototype.getFirstVo=function(){if(this.target){var t={skillType:this.skillType,atkx:this.target.x,atky:this.target.y,hurt:this.hurt,hitModel:this.getHitModel()};return t}},e.prototype.setAngleByMon=function(t,i){t&&(t==this.target?this.angle=GMath.angle(this.x,this.y,i.x,i.y):this.angle=GMath.angle(this.x,this.y,t.x,t.y),this.angle=Math.floor((this.angle+360)%360),Math.abs(this.angle-270)<=22.5&&(this.skillM1.scaleY=-1),Math.abs(this.angle-180)<=67.5&&(this.skillM1.scaleX=-1))},e.prototype.checkAtkMonster=function(t){var i=GMath.distance(this.x,this.y,t.x,t.y);if(30>i)return!0;if(this.atkGap<i)return!1;var e=GMath.angle(this.x,this.y,t.x,t.y),s=Math.abs(e-this.angle),h=s<=this.atkAngle/2;return h},e.prototype.run=function(){this.visible=!this.isCd,i.prototype.run.call(this)},e.prototype.reset=function(t){void 0===t&&(t=!0),t&&(i.prototype.reset.call(this),this.data=null),this.angle=0,this.rotation=0,this.isFirst=!1,this.isSecond=!1,this.isRun=!1,this.target=null},e.prototype.dispose=function(){egret.Tween.removeTweens(this),this.skillM1.stop(),GObj.disposeObject(this.skillM1),this.skillM1=null,this.skillM2.stop(),GObj.disposeObject(this.skillM2),this.skillM2=null,i.prototype.dispose.call(this)},e}(t.IMiniGame10BaseSkill);t.IMiniGame10Skill4=i,__reflect(i.prototype,"miniGame.IMiniGame10Skill4")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.skillType=Skill10Type.TYPE_5,t.exact=!0,t}return __extends(e,i),e.prototype.initSkins=function(){var e=this;i.prototype.initSkins.call(this),this.isLoadFinish=!1,this.skillM=GObj.create(t.IMovie),this.skillM.setLoadCompleteBack(function(){e.isLoadFinish=!0},this),this.addChild(this.skillM)},e.prototype.setData=function(t){i.prototype.setData.call(this,t),this.atkGap=t.atkGap,this.scaleX=this.scaleY=this.data.scaleXY||1,this.hurt=GMath.randomInt(this.data.hurt[0],this.data.hurt[1])},e.prototype.setPlayer=function(t){t&&(this.player=t,this.playM())},e.prototype.playM=function(){this.data&&this.skillM&&(this.skillM.stop(),this.skillM.start(this.data.model),this.skillM.autoRun())},e.prototype.checkAtkMonster=function(t){var i=GMath.distance(this.x,this.y,t.x,t.y),e=this.atkGap>=i;return e},e.prototype.run=function(){this.player&&this.isLoadFinish&&(this.x=this.player.x,this.y=this.player.y,i.prototype.run.call(this))},e.prototype.dispose=function(){this.skillM.stop(),GObj.disposeObject(this.skillM),this.skillM=null,this.player=null,i.prototype.dispose.call(this)},e}(t.IMiniGame10BaseSkill);t.IMiniGame10Skill5=i,__reflect(i.prototype,"miniGame.IMiniGame10Skill5")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.skillType=Skill10Type.TYPE_6,t.point1=GObj.create(egret.Point),t.point2=GObj.create(egret.Point),t.exact=!0,t.isSet=!1,t}return __extends(e,i),e.prototype.initSkins=function(){var e=this;i.prototype.initSkins.call(this),this.isLoadFinish=!1,this.skillM=GObj.create(t.IMovie),this.skillM.setLoadCompleteBack(function(){e.isLoadFinish=!0},this),this.addChild(this.skillM)},e.prototype.setData=function(t){i.prototype.setData.call(this,t),this.scaleX=this.scaleY=this.data.scaleXY||1,this.hurt=GMath.randomInt(this.data.hurt[0],this.data.hurt[1]),this.speed=t.speed||5,this.timeNum=t.skill6Time||15,this.monFrame={}},e.prototype.setPlayer=function(t){t&&(this.player=t,this.playM())},e.prototype.playM=function(){this.data&&this.skillM&&(this.skillM.stop(),this.skillM.start(this.data.model,0,100,null,AvatarConsts.B_B),this.skillM.autoRun())},e.prototype.checkAtkMonster=function(t){if(void 0!=this.monFrame.hasOwnProperty(t.hashCode+"")){if(--this.monFrame[t.hashCode+""]>0)return!1;this.monFrame[t.hashCode+""]=this.timeNum}if(this.skillM.parent&&t.parent){this.skillM.parent.localToGlobal(this.skillM.x,this.skillM.y,this.point1),t.parent.localToGlobal(t.x,t.y-t.height/2,this.point2);var i=this.point1.x-t.width/2*t.scaleX,e=this.point1.x+t.width/2*t.scaleX,s=this.point2.x-this.skillM.width/2*this.scaleX/2,h=this.point2.x+this.skillM.width/2*this.scaleX/2,a=this.point1.y-t.height/2*t.scaleY,n=this.point1.y+t.height/2*t.scaleY,o=this.point2.y-this.skillM.height/2*this.scaleY/2,r=this.point2.y+this.skillM.height/2*this.scaleY/2,l=!1;return(i>=s&&h>=i||e>=s&&h>=e||s>=i&&e>=h||i>=s&&h>=e)&&(a>=o&&r>=a||n>=o&&r>=n||o>=a&&n>=r||a>=o&&r>=n)&&(l=!0),l&&(this.monFrame[t.hashCode+""]=this.timeNum),l}},e.prototype.enterCd=function(){i.prototype.enterCd.call(this),this.monFrame={}},e.prototype.run=function(){this.player&&this.isLoadFinish&&(this.visible=!this.isCd,i.prototype.run.call(this),this.isCd||(this.isSet||(this.isSet=!0,1==GMath.randomInt(0,1)?(this.Movedirection=1,this.x=GMath.randomInt(this.player.x-StageManager.stageWidthHalf+this.skillM.width/2,this.player.x+StageManager.stageWidthHalf-this.skillM.width/2),this.y=this.player.y-StageManager.stageHeightHalf):(this.Movedirection=0,this.x=this.player.x+StageManager.stageWidthHalf,this.y=GMath.randomInt(this.player.y-StageManager.stageHeightHalf+this.skillM.height/2,this.player.y+StageManager.stageHeightHalf-this.skillM.height/2)),this.skillM.start(this.data.model,0,100,null,this.Movedirection?AvatarConsts.R_B:AvatarConsts.B_B)),1==this.Movedirection?(this.y=this.y+this.speed,this.y>this.player.y+StageManager.stageHeightHalf&&(this.enterCd(),this.isSet=!1)):0==this.Movedirection&&(this.x=this.x-this.speed,this.x<this.player.x-StageManager.stageWidthHalf&&(this.enterCd(),this.isSet=!1))))},e.prototype.dispose=function(){this.skillM.stop(),GObj.disposeObject(this.skillM),this.skillM=null,this.player=null,this.monFrame=null,i.prototype.dispose.call(this)},e}(t.IMiniGame10BaseSkill);t.IMiniGame10Skill6=i,__reflect(i.prototype,"miniGame.IMiniGame10Skill6")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.initSkins(),t}return __extends(e,i),e.prototype.initSkins=function(){this.horizontalCenter=0,this.verticalCenter=0,this.width=540,this.height=960,this.bgRect=GObj.create(eui.Rect),this.bgRect.horizontalCenter=0,this.bgRect.verticalCenter=0,this.bgRect.alpha=.8,this.bgRect.width=StageManager.stageWidth,this.bgRect.height=StageManager.stageHeight,this.addChild(this.bgRect),this.img1=GObj.create(t.ImageOutside),this.img1.horizontalCenter=0,this.img1.verticalCenter=-200,this.addChild(this.img1),this.skillImg=GObj.create(t.ImageOutside),this.skillImg.horizontalCenter=0,this.skillImg.verticalCenter=0,this.addChild(this.skillImg),this.okBtn=GObj.create(t.IBaseBtn),this.okBtn.horizontalCenter=0,this.okBtn.verticalCenter=220,this.okBtn.icon=IMiniGameMain.getIcon("btn_1"),this.addChild(this.okBtn),this.addEvent()},e.prototype.addEvent=function(){this.okBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.closeClick,this)},e.prototype.removeEvent=function(){this.okBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.closeClick,this)},e.prototype.closeClick=function(){this.closeBack&&this.closeBack.call(this.thisObj,this.result),this.parent&&this.parent.removeChild(this)},e.prototype.show=function(t,i,e,s,h){t&&(this.skillImg.setOutSrc("skill_big_"+t),this.img1.setOutSrc("title_1")),i&&(this.skillImg.setOutSrc("mount_"+i),3==i?this.img1.setOutSrc("title_3"):this.img1.setOutSrc("title_2")),this.closeBack=e,this.thisObj=s,this.result=h},e.prototype.dispose=function(){this.removeEvent(),this.thisObj=null,this.closeBack=null,this.result=null,GObj.disposeObject(this.bgRect),this.bgRect=null,GObj.disposeObject(this.img1),this.img1=null,GObj.disposeObject(this.skillImg),this.skillImg=null,GObj.disposeObject(this.okBtn),this.okBtn=null},e}(eui.Component);t.IMiniGame10UpPop=i,__reflect(i.prototype,"miniGame.IMiniGame10UpPop")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){return i.call(this)||this}return __extends(e,i),e.prototype.addEvent=function(){},e.prototype.removeEvent=function(){},e.prototype.setData=function(t){this.initSkins(),this.scene.setData(t)},e.prototype.initSkins=function(){this.isInit||(this.isInit=!0,this.width=StageManager.stageWidth,this.height=StageManager.stageHeight,this.touchMask=GObj.create(eui.Rect),this.touchMask.height=StageManager.stageHeight+600,this.touchMask.width=StageManager.stageWidth,this.touchMask.fillColor=0,this.touchMask.horizontalCenter=0,this.touchMask.verticalCenter=0,this.touchMask.alpha=.1,this.addChild(this.touchMask),this.scene=GObj.create(t.IMiniGame10Secne),this.addChild(this.scene),this.addEvent())
},e.prototype.dispose=function(){this.isDestory||(this.isDestory=!0,this.removeEvent(),GObj.disposeObject(this.scene),this.scene=null,GObj.disposeObject(this.touchMask),this.touchMask=null,i.prototype.dispose.call(this))},e}(t.IBaseView);t.IMiniGame10View=i,__reflect(i.prototype,"miniGame.IMiniGame10View")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(t){return i.call(this,t)||this}return __extends(e,i),e.prototype.getGameView=function(){return this.gameView||(this.gameView=GObj.create(t.IMiniGame11View)),this.gameView.setData(this.getCurGameData()),this.gameView},e.prototype.loadConfigComplete=function(e){if(e)for(var s in e.config)t.IMiniGame11Consts[s]=e.config[s];i.prototype.loadConfigComplete.call(this,e)},e.prototype.dispose=function(){i.prototype.dispose.call(this)},e}(t.IMiniGameBaseCtr);t.IMiniGame11=i,__reflect(i.prototype,"miniGame.IMiniGame11")}(miniGame||(miniGame={}));var miniGame;!function(t){t.IMiniGame11Consts={musicNum:5,ui_xuanwo:"ui_xuanwo",ui_shouji:"ui_shouji",distance:100,countDown:200,upLevel:"ui_shengji",dian:"ui_dian",huo:"ui_huo",tiao:"ui_tiao",monstor_y:668,player_y:798,moveArr:[150,600],pos:[120,180,260,340,400],ui_shuaguai:"ui_shuaguai",xuanwo_y:142,shuaiguai_y:142,minigame11_bgm:"bgm_login",minigame11_win:"win",minigame11_die:"minigame_lose",minigame11_attack:"att",minigame11_yanbao:"yanbao",minigame11_shandian:"yanbao",minigame11_mondie:"monstor_die",minigame11_uplevel1:"uplevel_1",minigame11_uplevel2:"uplevel_2",bossMovie:"ui_bosslaixi",skills:{1:{skillType:1,name:"闪电",hitmodel:"",hurt:[15,30],des:"闪电！！！！",num:50},2:{skillType:2,name:"炎爆",hitmodel:"",hurt:[15,30],des:"炎爆！！！！",num:100},3:{skillType:3,name:"加攻击力",des:"加攻击力！！！",num:1},4:{skillType:4,name:"弹射",des:"可以到处弹射"},5:{skillType:5,name:"加弹道",des:"加一条弹道"},6:{skillType:6,name:"倾斜弹道",des:"倾斜弹道！！！",num:10},7:{skillType:7,name:"加移速",des:"移速提升",num:2},8:{skillType:8,name:"加攻速",des:"加！！！",num:5},9:{skillType:9,name:"技能9",des:"全屬性提升",skillData:{1:{attmodel:"ui_b1",hitmodel:"ui_s1",attack:1,atttime:5,flyspeed:10},2:{attmodel:"ui_b2",hitmodel:"ui_s2",attack:1,atttime:5,flyspeed:10},3:{attmodel:"ui_b3",hitmodel:"ui_s3",attack:1,atttime:5,flyspeed:10},4:{attmodel:"ui_b4",hitmodel:"ui_s4",attack:1,atttime:5,flyspeed:10}}}},monsters:{0:{idx:0,model:"monster_1",hp:[1,2],speed:2,monExp:15},1:{idx:1,model:"monster_2",hp:[1,4],speed:2,monExp:10},2:{idx:2,model:"monster_3",hp:[1,3],speed:2,monExp:5}}}}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.initSkins(),t}return __extends(e,i),e.prototype.getDropExp=function(){return this._exp},e.prototype.initSkins=function(){var i=this;this.touchEnabled=!1,this.icon=GObj.create(t.ImageOutside),this.icon.loadCompleteCall(function(){i.anchorOffsetX=i.icon.width/2,i.anchorOffsetY=i.icon.height/2},this),this.addChild(this.icon)},e.prototype.setData=function(t,i,e){this.x=t,this.y=i,this._exp=e,this.icon.setOutSrc("exp")},e.prototype.reset=function(){this.isFly=!1,this.isRemove=!1,this.isPlay=0,this._exp=0},e.prototype.moveTween=function(){var t=this;this.isPlay=1,egret.Tween.removeTweens(this.icon),egret.Tween.get(this.icon).to({y:-7},200).to({y:0},200).to({y:7},200).to({y:0},200).wait(200).call(function(){t.isPlay=2})},e.prototype.flyToPlayer=function(t){var i=this;this.isFly||(this.isFly=!0,egret.Tween.removeTweens(this),egret.Tween.get(this).to({x:t.x,y:t.y-t.height*t.scaleY/4},500).call(function(){i.isRemove=!0}))},e.prototype.dispose=function(){this.reset(),egret.Tween.removeTweens(this),this.icon&&egret.Tween.removeTweens(this.icon),GObj.disposeObject(this.icon),this.icon=null},e}(eui.Component);t.IMiniGame11Drop=i,__reflect(i.prototype,"miniGame.IMiniGame11Drop")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(t){function i(){var i=t.call(this)||this;return i.enterFrame=0,i}return __extends(i,t),i.prototype.setHalfFun=function(t,i,e){this.halfBack=t,this.halfThis=i,this.data=e},i.prototype.run=function(){if(this.isRun&&!($GApp.timer-this._startTime<this._playInterval)&&(this._startTime=$GApp.timer,this._effectCount>0&&this.parent)){var t=this._effect;if(t){var i=this.enterFrame++%this._effectCount,e=t.ttfs[i];this.bitMap.texture=e.ttr,this.bitMap.x=e.offX,this.bitMap.y=e.offY,3==i&&this.halfBack&&this.halfBack.call(this.halfThis,this.data,this),i==t.ttfs.length-1&&(this.enterFrame=0,this.showComplete())}}},i.prototype.showComplete=function(){this.isLoop||--this.loop<=0&&(this.isLast||(this.bitMap.texture=null),this.isRun=!1,this.isOver=!0,this.unAutoRun()),this.showBack&&this.showBack.call(this.showThis,this)},i.prototype.reset=function(){egret.Tween.removeTweens(this),this.touchChildren=!1,this.touchEnabled=!1,this.enterFrame=0,this._startTime=0},i.prototype.dispose=function(){this.isDestory||(t.prototype.dispose.call(this),this.halfBack=null,this.halfThis=null,this.data=null,this.enterFrame=null)},i}(t.IMovie);t.IMiniGame11Moive=i,__reflect(i.prototype,"miniGame.IMiniGame11Moive")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.setDirection(0),t.setAction(AvatarConsts.ACTION_WALK),t.numB=GObj.create(eui.Label),t.numB.size=20,t.numB.bold=!0,t.numB.fontFamily="SimHei",t.numB.strokeColor=0,t.numB.horizontalCenter=0,t.numB.textColor=16777215,t.addChild(t.numB),t}return __extends(e,i),e.prototype.partComplete=function(t){i.prototype.partComplete.call(this,t),this.numB.y=-t.jsonObj.frames[0].h-5},Object.defineProperty(e.prototype,"Hp",{get:function(){return this._Hp},enumerable:!0,configurable:!0}),e.prototype.setFun=function(t,i){this.thisobj=t,this.fun=i},e.prototype.setHp=function(i){this._Hp=this._Hp-i,this._Hp<=0?(this._isDie=!0,IMiniGameMain.playEff(t.IMiniGame11Consts.minigame11_mondie)):this.setNum(this._Hp)},Object.defineProperty(e.prototype,"exper",{get:function(){return this._exper},enumerable:!0,configurable:!0}),e.prototype.setData=function(i,e,s){if(this.data=i,i){this.updatePart(this.data.model),this.scaleX=this.scaleY=i.scaleXY||1,this.speed=this.data.speed||3,this._exper=this.data.monExp||1,this.data.hp?1==this.data.hp.length?this._Hp=this.data.hp[0]:this._Hp=this.data.hp[0]+Math.floor(Math.random()*(this.data.hp[1]-this.data.hp[0]+1)):this._Hp=3,this.setNum(this._Hp);var h=t.IMiniGame11Consts.pos;this.y=e,this.x=h[Math.floor(Math.random()*h.length)],this.over_y=s}},e.prototype.setNum=function(t){this.numB.text=t+"",this.numB.x=-this.numB.width/2},e.prototype.run=function(){i.prototype.run.call(this)},e.prototype.setDie=function(t){this._isDie=t},e.prototype.reset=function(){this._isDie=!1,this.filters=null,egret.Tween.removeTweens(this)},e.prototype.getMonsterExp=function(){return this.data.monExp||0},e.prototype.move=function(){this.y>this.over_y?this.thisobj&&this.fun&&this.fun.call(this.thisobj,!1):this.y+=this.speed||0},e.prototype.hurtBack=function(){var t=this;this.filters=[IMiniGameMain.getRedFilter()],egret.Tween.get(this).wait(200).call(function(){t.filters=null})},e.prototype.dispose=function(){this.data=null,egret.Tween.removeTweens(this),GObj.disposeObject(this._Hp),this._Hp=null,GObj.disposeObject(this._exper),this._exper=null,GObj.disposeObject(this.numB),this.numB=null,GObj.disposeObject(this.over_y),this.over_y=null,this.thisobj=null,this.fun=null,i.prototype.dispose.call(this)},e}(t.IAvatarViewCtr);t.IMiniGame11Monster=i,__reflect(i.prototype,"miniGame.IMiniGame11Monster")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var e=i.call(this)||this;return e.numB=GObj.create(eui.Label),e.numB.size=20,e.numB.bold=!0,e.numB.fontFamily="SimHei",e.numB.strokeColor=0,e.numB.horizontalCenter=0,e.numB.textColor=16777215,e.addChild(e.numB),e.upLevel=GObj.create(t.IMovie),e.addChild(e.upLevel),e}return __extends(e,i),e.prototype.partComplete=function(t){i.prototype.partComplete.call(this,t),this.numB.y=-t.jsonObj.frames[0].h-10},e.prototype.getSkill5=function(){return this.skill5lv},e.prototype.setNum=function(t){this.numB.text=t+"",this.numB.x=-this.numB.width/2},e.prototype.setData=function(t){this.data=t,this.initVo()},e.prototype.setFunc=function(t,i){this.thisObj=t,this.fun=i},e.prototype.setFunc2=function(t,i){this.thisObj2=t,this.fun2=i},e.prototype.initVo=function(){this.data&&(this.updatePart(this.data.model),this.speed=this.data.speed||80,this.tempSpeed=this.atkSpeed=this.data.atkSpeed||80,this.scaleX=this.scaleY=this.data.scaleXY||1,this.upNum=this.data.upNum||3,this.skillArr=[],this.lv=this.data.initLv||1,this.levelNum=-1,this.attackNum=this.data.hurt||1,this.setNum(this.attackNum),this.exp=0,this.skill5lv=1,this.isAtking=!1,this.atkIndex=0,this.setDirection(0),this.setAction(AvatarConsts.ACTION_ATTACK_I))},e.prototype.getAttNumber=function(){return this.attackNum},e.prototype.getExpInfo=function(){return this.data.upExp},e.prototype.getSkill=function(){return this.skillArr||[]},e.prototype.addSkill=function(i,e){switch(i){case 3:this.attackNum=this.attackNum+t.IMiniGame11Consts.skills[i].num,this.setNum(this.attackNum);break;case 5:this.skill5lv++;break;case 7:this.speed=this.speed+t.IMiniGame11Consts.skills[i].num;break;case 8:this.atkSpeed=this.tempSpeed=this.tempSpeed-t.IMiniGame11Consts.skills[i].num,this.atkSpeed<=10&&(this.tempSpeed=this.atkSpeed=10);break;case 9:t.IMiniGame11Consts.skills[9].skillData[e]&&(this.atkSpeed=this.tempSpeed=this.tempSpeed-t.IMiniGame11Consts.skills[9].skillData[e].atttime,this.attackNum=this.attackNum+t.IMiniGame11Consts.skills[9].skillData[e].attack,this.setNum(this.attackNum),this.atkSpeed<=10&&(this.tempSpeed=this.atkSpeed=10))}-1==this.skillArr.indexOf(i)&&this.skillArr.push(i)},e.prototype.setAngle=function(t){this._isMove&&(this.angle=t)},e.prototype.addExp=function(t){this.exp+=t;var i=this.data.upExp[this.lv+1];return i&&this.exp>=i?(this.exp%=i,this.lv++,this.levelNum++,this.playUpEffect(),!0):!1},e.prototype.setMaxLv=function(){for(var t=!0;t;){var i=this.data.upExp[this.lv+1];i?this.lv++:t=!1}},e.prototype.setMoveArea=function(t,i){this.ax=t,this.aw=i},e.prototype.setMove=function(t){this._isMove=t},e.prototype.run=function(){i.prototype.run.call(this),this.playerAtk()},e.prototype.playerAtk=function(){this.isAtking||--this.atkSpeed>0||(this.atkSpeed=this.tempSpeed,this.isAtking=!0)},e.prototype.move=function(){if(this._isMove){var t=this.x+(this.speed*this.angle||0);t>this.ax&&t<this.aw-this.ax&&(this.x=t)}},e.prototype.playUpEffect=function(){this.upLevel.x=this.upLevel.width/2,this.upLevel.autoRun(),this.thisObj2&&this.fun2&&this.fun2.call(this.thisObj2),this.thisObj&&this.fun&&this.upLevel.setCompleteBack(this.fun,this.thisObj),IMiniGameMain.playEff(t.IMiniGame11Consts.minigame11_uplevel1),this.upLevel.start(t.IMiniGame11Consts.upLevel,1)},e.prototype.reset=function(){this.initVo()},e.prototype.dispose=function(){this.data=null,this.thisObj=null,this.fun=null,this.thisObj2=null,this.fun2=null,GObj.disposeObject(this.attackNum),this.attackNum=null,GObj.disposeObject(this.atkSpeed),this.atkSpeed=null,GObj.disposeObject(this.isAtking),this.isAtking=null,GObj.disposeObject(this.atkIndex),this.atkIndex=null,GObj.disposeObject(this.ax),this.ax=null,GObj.disposeObject(this.aw),this.aw=null,GObj.disposeObject(this.lv),this.lv=null,GObj.disposeObject(this.levelNum),this.levelNum=null,GObj.disposeObject(this.exp),this.exp=null,GObj.disposeObject(this.tempSpeed),this.tempSpeed=null,GObj.disposeObject(this.upNum),this.upNum=null;for(var t=0,e=this.skillArr;t<e.length;t++){var s=e[t];GObj.disposeObject(s)}this.skillArr=null,GObj.disposeObject(this.numB),this.numB=null,GObj.disposeObject(this.upLevel),this.upLevel=null,i.prototype.dispose.call(this)},e}(t.IAvatarViewCtr);t.IMiniGame11Player=i,__reflect(i.prototype,"miniGame.IMiniGame11Player")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.once(egret.Event.ADDED_TO_STAGE,t.initSkin,t),t}return __extends(e,i),e.prototype.initSkin=function(){var i=this;this.rateVal=10,this.angle=0,this.scrollEnabled=!1,this.bg=GObj.create(t.ImageOutside),this.bg.touchEnabled=!1,this.addChild(this.bg),this.bg.loadCompleteCall(function(){i.width=i.bg.iconWidth,i.height=i.bg.iconHeight,i.anchorOffsetX=i.width/2,i.anchorOffsetY=i.height/2,i.startX=i.width/2,i.startY=i.height/2,i.initElse()},this),this.bg.setOutSrc("rocker")},e.prototype.initElse=function(){var i=this;this.left_arrow=GObj.create(t.ImageOutside),this.left_arrow.touchEnabled=!1,this.left_arrow.setOutSrc("right",FileConst.png),this.left_arrow.left=10,this.left_arrow.verticalCenter=0,this.addChild(this.left_arrow),this.right_arrow=GObj.create(t.ImageOutside),this.right_arrow.touchEnabled=!1,this.right_arrow.right=10,this.right_arrow.verticalCenter=0,this.right_arrow.setOutSrc("left",FileConst.png),this.right_arrow.touchEnabled=!1,this.addChild(this.right_arrow),this.rockerRect=GObj.create(eui.Rect),this.rockerRect.fillAlpha=.001,this.rocker=GObj.create(t.ImageOutside),this.rocker.touchEnabled=!1,this.rocker.loadCompleteCall(function(){i.rockerRect.width=3*i.rocker.iconWidth,i.rockerRect.height=3*i.rocker.iconHeight,i.rockerRect.anchorOffsetX=i.rockerRect.width/2,i.rockerRect.anchorOffsetY=i.rockerRect.height/2,i.rocker.anchorOffsetX=i.rocker.iconWidth/2,i.rocker.anchorOffsetY=i.rocker.iconHeight/2,i.rocker.x=i.startX,i.rocker.y=i.startY},this),this.rocker.setOutSrc("rockerPoint"),this.addChild(this.rocker),this.addChild(this.rockerRect),this.addEvent()},e.prototype.addEvent=function(){this.rockerRect.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBeginClick,this)},e.prototype.removeEvent=function(){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.initSkin,this),this.rockerRect.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBeginClick,this),this.rockerRect.removeEventListener(egret.TouchEvent.TOUCH_END,this.onEndClick,this),this.parentObj&&(this.parentObj.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onMoveClick,this),this.parentObj.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMoveClick,this))},e.prototype.onBeginClick=function(){this.isMove||(this.parentObj||(this.parentObj=this.parent),this.rockerRect.addEventListener(egret.TouchEvent.TOUCH_END,this.onEndClick,this),this.parentObj.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onEndClick,this),this.parentObj.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMoveClick,this),this.tempPoint||(this.tempPoint=GObj.create(egret.Point)))},e.prototype.onMoveClick=function(t){this.globalToLocal(t.stageX,t.stageY,this.tempPoint);var i=Math.abs(this.tempPoint.x-this.startX);if(!(i<this.rateVal)){this.isMove=!0,this.rockerRect.x=this.tempPoint.x;var e=this.width/2-this.rocker.anchorOffsetX;if(i=Math.abs(this.tempPoint.x-e),i>e){var s=GMath.towardSource(this.width/2,this.height/2,this.tempPoint.x,this.tempPoint.y,e);this.tempPoint.x=s.x,this.startX=this.width/2}this.rocker.x=this.tempPoint.x,this.getRocker(),this.startX=this.rocker.x}},e.prototype.onEndClick=function(){this.parentObj&&(this.rockerRect.removeEventListener(egret.TouchEvent.TOUCH_END,this.onEndClick,this),this.parentObj.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onEndClick,this),this.parentObj.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMoveClick,this),this.y=this.parentObj.height-100,this.x=this.parentObj.width/2),this.isMove=!1,this.startX=this.width/2,this.startY=this.height/2,this.rockerRect.x=this.startX,this.rockerRect.y=this.startY,this.rocker.x=this.startX,this.rocker.y=this.startY},e.prototype.getRocker=function(){this.startX<this.tempPoint.x?this.angle=1:this.angle=-1},e.prototype.dispose=function(){this.removeEvent(),GObj.disposeObject(this.bg),this.bg=null,GObj.disposeObject(this.rocker),this.rocker=null,GObj.disposeObject(this.rockerRect),this.rockerRect=null,GObj.disposeObject(this.left_arrow),this.left_arrow=null,GObj.disposeObject(this.right_arrow),this.right_arrow=null,this.parentObj=null},e}(eui.Group);t.IMiniGame11Rocker=i,__reflect(i.prototype,"miniGame.IMiniGame11Rocker")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.exact=!0,t.touchEnabled=!1,t.touchChildren=!1,t.isRun=!1,t.angleData=0,t.reflexN=0,t.numberN=0,t.is_y=!1,t.createImg(),t}return __extends(e,i),e.prototype.isRunning=function(){return this.isRun},e.prototype.setRunning=function(t){this.isRun=t},e.prototype.setSkillInfo=function(t){this.speed=t},e.prototype.setSkill9Lv=function(t){this.skill9Lv=t},e.prototype.createImg=function(){this.img=GObj.create(t.IMovie),this.addChild(this.img)},e.prototype.setPlayer=function(i,e){this.img.stop(),this.skill9Lv&&t.IMiniGame11Consts.skills[9].skillData[this.skill9Lv]?this.img.start(t.IMiniGame11Consts.skills[9].skillData[this.skill9Lv].attmodel,0):this.img.start("ui_b1",0),this.img.autoRun(),this.player=i,this.x=i.x,e&&(this.x=e),this.y=i.y-this.anchorOffsetY-i.anchorOffsetY-70,this.isRun=!0},e.prototype.run=function(){var t=this.y<0||this.y>StageManager.stageHeight||this.x<0||this.x>StageManager.stageWidth;if(t&&this.numberN<=0){if(this.player&&-1!=this.player.getSkill().indexOf(4)&&0==this.reflexN)return this.reflexN=1,this.numberN=5,void(this.x<0||this.x>StageManager.stageWidth?this.angleData=-this.angleData:this.is_y=!0);this.isRun=!1}else 1==this.reflexN&&this.numberN--,this.x=this.x+this.speed*Math.sin(this.angleData/180*Math.PI),1==this.reflexN&&this.is_y?this.y=this.y+this.speed*Math.cos(this.angleData/180*Math.PI):this.y=this.y-this.speed*Math.cos(this.angleData/180*Math.PI)},e.prototype.reset=function(){this.isRun=!1,this.angleData=0,this.reflexN=0,this.numberN=0,this.is_y=!1},e.prototype.dispose=function(){GObj.disposeObject(this.img),this.img=null,GObj.disposeObject(this.skill9Lv),this.skill9Lv=null,GObj.disposeObject(this.reflexN),this.reflexN=null,GObj.disposeObject(this.numberN),this.numberN=null,GObj.disposeObject(this.is_y),this.is_y=null,GObj.disposeObject(this.angleData),this.angleData=null,GObj.disposeObject(this.isRun),this.isRun=null,GObj.disposeObject(this.img),this.img=null,GObj.disposeObject(this.hurt),this.hurt=null,this.player=null},e}(egret.DisplayObjectContainer);t.IMiniGame11Skill=i,__reflect(i.prototype,"miniGame.IMiniGame11Skill")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function s(){var t=i.call(this)||this;return t.initSkins(),t.addEventListener(egret.Event.ADDED_TO_STAGE,t.addToStageComplete,t),t.list.addEventListener(eui.ItemTapEvent.ITEM_TAP,t.onListClick,t),t}return __extends(s,i),s.prototype.setskill=function(t){this.initSkill=[],this.showSkill=[];for(var i=0;i<t.length;i++)this.initSkill.push(t[i])},s.prototype.setFun=function(t,i,e){this.thisObj=t,this.closeBack=i,this.level=e},s.prototype.initSkins=function(){if(!this.isInit){this.isInit=!0,this.horizontalCenter=0,this.verticalCenter=0,this.width=540,this.height=960,this.touchEnabled=!1,this.bgRect=GObj.create(eui.Rect),this.bgRect.horizontalCenter=0,this.bgRect.verticalCenter=0,this.bgRect.width=StageManager.stageWidth,this.bgRect.height=StageManager.stageHeight+600,this.bgRect.touchEnabled=!1,this.addChild(this.bgRect),this.view_bg=GObj.create(t.ImageOutside),this.view_bg.horizontalCenter=0,this.view_bg.verticalCenter=0,this.view_bg.setOutSrc("skill11bg",FileConst.png),this.addChild(this.view_bg),this.skillText=GObj.create(t.ImageOutside),this.skillText.horizontalCenter=0,this.skillText.verticalCenter=-58,this.skillText.setOutSrc("skilltext",FileConst.png),this.addChild(this.skillText),this.listData=GObj.create(eui.ArrayCollection),this.list=GObj.create(eui.List),this.list.horizontalCenter=7,this.list.bottom=120,this.list.width=510,this.list.height=347,this.list.itemRenderer=e,this.list.dataProvider=this.listData;var i=GObj.create(eui.VerticalLayout);i.gap=10,this.list.layout=i,this.addChild(this.list)}},s.prototype.addToStageComplete=function(){this.updateList()},s.prototype.onListClick=function(t){if(t&&t.itemRenderer){var i=t.itemRenderer;this.callFun(i.index,i.skillindex)}},s.prototype.updateList=function(){if(0!=this.initSkill.length){this.list.selectedIndex=void 0;var i,e=[];if(0==this.level){this.showSkill=[];for(var s=0;3>s;s++)this.initSkill.length>s&&this.showSkill.push(this.initSkill[s])}for(var h=this.showSkill,a=0;a<h.length;a++)i=a,i<h.length&&e.push({index:i,skillname:t.IMiniGame11Consts.skills[h[i]].name,skilldes:t.IMiniGame11Consts.skills[h[i]].des,skillindex:t.IMiniGame11Consts.skills[h[i]].skillType,thisObj:this,fun:this.callFun});this.listData.replaceAll(e)}},s.prototype.callFun=function(t,i){var e=3+this.level;this.showSkill.length>t&&this.initSkill.length>e?this.showSkill[t]=this.initSkill[e]:this.showSkill.length>t&&this.showSkill.splice(t,1),this.closeBack&&this.thisObj&&this.closeBack.call(this.thisObj,i),this.parent&&this.parent.removeChild(this)},s.prototype.dispose=function(){if(this.thisObj=null,this.closeBack=null,this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.addToStageComplete,this),this.list&&this.list.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onListClick,this),GObj.disposeObject(this.bgRect),this.bgRect=null,GObj.disposeObject(this.view_bg),this.view_bg=null,GObj.disposeObject(this.skillText),this.skillText=null,this.list){for(;this.list.$children.length>0;)GObj.disposeObject(this.list.$children[0]);this.list.dataProvider=null,GObj.disposeObject(this.list),this.list=null}GObj.disposeObject(this.listData),this.listData=null,GObj.disposeObject(this.isInit),this.isInit=null;for(var t=0,i=this.showSkill;t<i.length;t++){var e=i[t];GObj.disposeObject(e)}this.showSkill=null;for(var s=0,h=this.initSkill;s<h.length;s++){var e=h[s];GObj.disposeObject(e)}this.initSkill=null},s}(eui.Component);t.IMiniGame11UpPop=i,__reflect(i.prototype,"miniGame.IMiniGame11UpPop");var e=function(i){function e(){var t=i.call(this)||this;return t.initskins(),t}return __extends(e,i),e.prototype.initskins=function(){var i=this;this.uigroup=GObj.create(eui.Group),this.uigroup.width=500,this.uigroup.anchorOffsetX=this.uigroup.width/2,this.uigroup.x=this.uigroup.width/2,this.uigroup.verticalCenter=0,this.addChild(this.uigroup),this.itemBg=GObj.create(t.ImageOutside),this.itemBg.horizontalCenter=0,this.itemBg.verticalCenter=0,this.skilldes=GObj.create(eui.Label),this.skilldes.width=this.uigroup.width-180,this.itemBg.loadCompleteCall(function(){i.uigroup.width=i.width=i.itemBg.width,i.uigroup.height=i.height=i.itemBg.height,i.uigroup.anchorOffsetX=i.width/2,i.uigroup.anchorOffsetY=i.height/2,i.uigroup.x=i.uigroup.width/2,i.skilldes.width=i.width-180},this),this.itemBg.setOutSrc("noselected",FileConst.png),this.uigroup.addChild(this.itemBg),this.skillbg=GObj.create(t.ImageOutside),this.skillbg.left=15,this.skillbg.verticalCenter=0,this.skillbg.setOutSrc("skillitembg",FileConst.png),this.uigroup.addChild(this.skillbg),this.skill=GObj.create(t.ImageOutside),this.skill.left=27,this.skill.verticalCenter=0,this.uigroup.addChild(this.skill),this.skillname=GObj.create(eui.Label),this.skillname.left=150,this.skillname.top=15,this.skillname.size=35,this.skillname.bold=!0,this.skillname.fontFamily="Microsoft JhengHei",this.skillname.textColor=4601382,this.uigroup.addChild(this.skillname),this.skilldes.left=150,this.skilldes.top=60,this.skilldes.textColor=10053171,this.skilldes.size=20,this.skilldes.fontFamily="SimHei",this.skilldes.bold=!0,this.skilldes.wordWrap=!0,this.uigroup.addChild(this.skilldes),this.skinName=this.getSkin()},e.prototype.getSkin=function(){var t=GObj.create(eui.Skin);return t.skinParts=["mcDisplay"],t.myself=this.uigroup,t.elementsContent=[this.uigroup],t.states=[new eui.State("up",[]),new eui.State("down",[new eui.SetProperty("myself","scaleX",.92),new eui.SetProperty("myself","scaleY",.92)]),new eui.State("disabled",[])],t},e.prototype.dataChanged=function(){if(i.prototype.dataChanged.call(this),this.data){this.uigroup.x=0,this.uigroup.alpha=0;var t=150*(this.itemIndex+1);egret.Tween.get(this.uigroup).wait(t).to({x:this.uigroup.width/2+2,alpha:1},150).to({x:this.uigroup.width/2},50),this.index=this.data.index,this.thisObj=this.data.thisObj,this.fun=this.data.fun,this.skillindex=this.data.skillindex,this.skillname.text=this.data.skillname,this.skilldes.text=this.data.skilldes,this.skill.setOutSrc("skill"+this.skillindex,FileConst.png)}},e.prototype.dispose=function(){this.uigroup&&egret.Tween.removeTweens(this.uigroup),GObj.disposeObject(this.uigroup),this.uigroup=null,GObj.disposeObject(this.itemBg),this.itemBg=null,GObj.disposeObject(this.skillbg),this.skillbg=null,GObj.disposeObject(this.skill),this.skill=null,GObj.disposeObject(this.skillname),this.skillname=null,GObj.disposeObject(this.skilldes),this.skilldes=null,GObj.disposeObject(this.index),this.index=null,GObj.disposeObject(this.skillindex),this.skillindex=null,this.thisObj=null,this.fun=null},e}(eui.ItemRenderer);t.skillItem=e,__reflect(e.prototype,"miniGame.skillItem")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){return i.call(this)||this}return __extends(e,i),e.prototype.addEvent=function(){this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBeginClick,this),this.exitBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCloseClick,this)},e.prototype.removeEvent=function(){this.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBeginClick,this),this.exitBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onCloseClick,this),this.suspendEvent()},e.prototype.setData=function(i){i&&(this.stageData=i,IMiniGameMain.playBgm(t.IMiniGame11Consts.minigame11_bgm),this.initSkins(),this.updateView())},e.prototype.initSkins=function(){var i=this;this.isInit||(this.isInit=!0,this.width=540,this.height=960,this.horizontalCenter=this.verticalCenter=0,this.skillArr=[],this.skillPool=[],this.actFrame=10,this.monsterArr=[],this.monsterPool=[],this.dropPool=[],this.dropIn=[],this.bornPool=[],this.bornArr=[],this.colorArr=[1,0,0,0,255,0,1,0,0,255,0,0,1,0,255,0,0,0,1,0],this.gameBg=GObj.create(t.ImageOutside),this.gameBg.horizontalCenter=this.gameBg.verticalCenter=0,this.gameBg.setOutSrc("game11bg",FileConst.jpg),this.addChild(this.gameBg),this.explosionMovie=GObj.create(t.IMovie),this.explosionMovie.x=this.width/2,this.explosionMovie.y=t.IMiniGame11Consts.xuanwo_y,this.addChild(this.explosionMovie),this.bornGrp=GObj.create(egret.DisplayObjectContainer),this.bornGrp.width=this.width,this.bornGrp.height=this.width,this.addChild(this.bornGrp),this.monsterGrp=GObj.create(egret.DisplayObjectContainer),this.monsterGrp.width=this.width,this.monsterGrp.height=this.width,this.addChild(this.monsterGrp),this.skillGrp=GObj.create(egret.DisplayObjectContainer),this.skillGrp.width=this.width,this.skillGrp.height=this.width,this.addChild(this.skillGrp),this.dropGrp=GObj.create(egret.DisplayObjectContainer),this.dropGrp.touchEnabled=!1,this.dropGrp.touchChildren=!1,this.addChild(this.dropGrp),this.player=GObj.create(t.IMiniGame11Player),this.player.setData(this.stageData.player),this.player.setFunc(this,this.openSkill),this.player.setFunc2(this,this.showupLevel),this.player.y=t.IMiniGame11Consts.player_y,this.player.setMoveArea(t.IMiniGame11Consts.moveArr[0],t.IMiniGame11Consts.moveArr[1]),this.addChild(this.player),this.rocker=GObj.create(t.IMiniGame11Rocker),this.rocker.x=this.width/2,this.rocker.y=this.height-100,this.addChild(this.rocker),this.timeGroup=GObj.create(eui.Group),this.timeGroup.top=150,this.timeGroup.left=10,this.addChild(this.timeGroup),this.timeBg=GObj.create(t.ImageOutside),this.timeBg.loadCompleteCall(function(){i.timeGroup.width=i.timeBg.width,i.timeGroup.height=i.timeBg.height},this),this.timeBg.setOutSrc("timebg",FileConst.png),this.timeBg.verticalCenter=0,this.timeBg.horizontalCenter=0,this.timeGroup.addChild(this.timeBg),this.timeLabel=GObj.create(eui.Label),this.timeLabel.verticalCenter=0,this.timeLabel.horizontalCenter=0,this.timeLabel.size=20,this.timeLabel.bold=!0,this.timeLabel.textColor=16777215,this.timeGroup.addChild(this.timeLabel),this.expBgImg=GObj.create(t.ImageOutside),this.expBgImg.width=this.width,this.expBgImg.x=0,this.expBgImg.bottom=0,this.expBgImg.setOutSrc("exp_0"),this.addChild(this.expBgImg),this.expImg=GObj.create(t.ImageOutside),this.expImg.x=this.expBgImg.x,this.expImg.bottom=2,this.expImg.setOutSrc("exp_1"),this.addChild(this.expImg),this.expLab=GObj.create(eui.Label),this.expLab.left=10,this.expLab.bottom=3,this.expLab.size=20,this.expLab.textAlign="center",this.expLab.textColor=0,this.addChild(this.expLab),this.skillGroup=GObj.create(eui.Group),this.addChild(this.skillGroup),this.skillbg=GObj.create(t.ImageOutside),this.skillbg.loadCompleteCall(function(){i.skillGroup.height=i.skillbg.height,i.skillGroup.width=i.skillbg.width,i.skillGroup.anchorOffsetX=i.skillGroup.width/2,i.skillGroup.anchorOffsetY=i.skillGroup.height/2},this),this.skillbg.horizontalCenter=0,this.skillbg.verticalCenter=0,this.skillbg.setOutSrc("skillitembg",FileConst.png),this.skillGroup.addChild(this.skillbg),this.skillIcon=GObj.create(t.ImageOutside),this.skillIcon.horizontalCenter=0,this.skillIcon.verticalCenter=0,this.skillGroup.addChild(this.skillIcon),this.initEffect(),this.guide=GObj.create(t.ImageOutside),this.guide.horizontalCenter=0,this.guide.y=this.player.y-250,this.guide.setOutSrc("guide"),this.addChild(this.guide),this.uplevel=GObj.create(t.ImageOutside),this.uplevel.loadCompleteCall(function(){i.uplevel.anchorOffsetX=i.uplevel.width/2,i.uplevel.anchorOffsetY=i.uplevel.height/2},this),this.uplevel.setOutSrc("uplevel"),this.addChild(this.uplevel),this.exitBtn=GObj.create(t.IBaseBtn),this.exitBtn.icon=IMiniGameMain.getIcon("exit_btn",FileConst.png,"chapter"),this.exitBtn.right=10,this.exitBtn.top=150,this.exitBtn.touchEnabled=!0,this.addChild(this.exitBtn),this.addEvent())},e.prototype.initEffect=function(){this.lightMovie=GObj.create(t.IMovie),this.addChild(this.lightMovie),this.hireE=GObj.create(t.IMovie),this.hireE.setCompleteBack(this.hireChange,this),this.addChild(this.hireE),this.hitEf=GObj.create(t.IMovie),this.addChild(this.hitEf),this.bossMovie=GObj.create(t.IMovie),this.bossMovie.x=this.width/2,this.bossMovie.y=200,this.addChild(this.bossMovie),this.skillup=GObj.create(t.IMovie),this.addChild(this.skillup)},e.prototype.hireChange=function(){this.ishireEd=!0},e.prototype.updateView=function(){this.ishireEd=!0,this.musicNum=t.IMiniGame11Consts.musicNum,this.uplevel.visible=!1,this.player.x=this.width/2,this.skillGroup.scaleX=this.skillGroup.scaleY=0,IMiniGameMain.reqSocket(1,this.stageData.stageId),this.isOver=!1,this.skillSpeed=this.stageData.player.skillspeed||20,this.skill9Lv=this.stageData.player.skill9lv||1,this.is_boss=!1,this.waveIndex=1,this.startTime=0,this.lastT=0,this.timeLabel.text=this.format(this.stageData.time||60),this.explosionMovie.stop(),this.explosionMovie.start(t.IMiniGame11Consts.ui_xuanwo,0),this.explosionMovie.autoRun(),this.player.setData(this.stageData.player),this.skillView||(this.skillView=GObj.create(t.IMiniGame11UpPop),this.skillView.horizontalCenter=this.skillView.verticalCenter=0),this.skillView.setskill(this.stageData.player.initSkills),this.skillView&&this.skillView.parent&&this.skillView.parent.removeChild(this.skillView),this.rocker.x=this.width/2,this.rocker.y=this.height-100,this.recovery(),this.showGuide(),this.updateExp()},e.prototype.update=function(){this.playerRun(),this.createSkill(),this.skillRun(),this.monsterRun(),this.checkHit(),this.dropCollisionPlayer(),this.juageS()},e.prototype.playerRun=function(){this.player&&(this.player.run(),this.player.setMove(this.rocker.isMove),this.player.setAngle(this.rocker.angle))},e.prototype.createSkill=function(){if(this.player.isAtking){this.player.isAtking=!1;var i;if(-1!=this.player.getSkill().indexOf(5))for(var e=Math.floor(this.player.getSkill5()/2),s=this.player.getSkill5()%2,h=void 0,a=0;a<this.player.getSkill5();a++)i=this.getSkillObj(),i.setSkillInfo(this.skillSpeed),i.setSkill9Lv(this.skill9Lv),0!=s?i.setPlayer(this.player,this.player.x+60*(e-a)):(h=a>=e?a-e+1:a-e,i.setPlayer(this.player,this.player.x+60*h+30*(h>=0?-1:1))),this.skillGrp.addChild(i),this.skillArr.push(i);
else i=this.getSkillObj(),i.setSkillInfo(this.skillSpeed),i.setSkill9Lv(this.skill9Lv),i.setPlayer(this.player),this.skillGrp.addChild(i),this.skillArr.push(i);if(-1!=this.player.getSkill().indexOf(6))for(var n=2,a=0;n>a;a++){if(i=this.getSkillObj(),i.setSkill9Lv(this.skill9Lv),i.angleData=t.IMiniGame11Consts.skills[6].num*Math.pow(-1,a),i.setSkillInfo(this.skillSpeed),-1!=this.player.getSkill().indexOf(5)){var o=60*Math.floor(this.player.getSkill5()/2)+10;i.setPlayer(this.player,this.player.x+o*Math.pow(-1,a))}else i.setPlayer(this.player);this.skillGrp.addChild(i),this.skillArr.push(i)}--this.musicNum<0&&(IMiniGameMain.playEff(t.IMiniGame11Consts.minigame11_attack),this.musicNum=t.IMiniGame11Consts.musicNum)}},e.prototype.createMonster=function(){var i,e=this.waveData.monsterNum||0;this.colorMatrix||(this.colorMatrix=GObj.create(egret.ColorMatrixFilter,this.colorArr));for(var s=0;e>s;s++){var h=GMath.randomInt(0,this.waveData.monsterType.length-1),a=this.waveData.monsterType[h],n={};if(t.IMiniGame11Consts.monsters[a])for(var o in t.IMiniGame11Consts.monsters[a])n[o]=t.IMiniGame11Consts.monsters[a][o];if(this.stageData.monsters&&this.stageData.monsters[a])for(var o in this.stageData.monsters[a])n[o]=this.stageData.monsters[a][o];i=this.getMonster(),i.setData(n,t.IMiniGame11Consts.shuaiguai_y,t.IMiniGame11Consts.monstor_y);var r=void 0;r=this.getBornEffect(),r.reset(),r.setHalfFun(this.addMonster,this,i),r.setCompleteBack(this.backBornEffect,this),r.x=i.x,r.y=i.y,r.parent||this.bornGrp.addChild(r),r.start(t.IMiniGame11Consts.ui_shuaguai,1),r.autoRun()}},e.prototype.addMonster=function(t,i){t&&-1==this.monsterArr.indexOf(t)&&(this.monsterGrp.addChildAt(t,0),this.monsterArr.push(t),t.filters=[this.colorMatrix],egret.Tween.get(t).wait(50).to({filters:null},80))},e.prototype.skillRun=function(){if(0!=this.skillArr.length)for(var t,i=0;i<this.skillArr.length;i++)t=this.skillArr[i],t.isRunning()?t.run():(t.parent&&t.parent.removeChild(t),this.skillArr.splice(i,1),this.backSkillObj(t),i--)},e.prototype.getSkillObj=function(){var i=this.skillPool.pop();return i||(i=GObj.create(t.IMiniGame11Skill)),i},e.prototype.backSkillObj=function(t){t&&-1==this.skillPool.indexOf(t)&&(t.reset(),this.skillPool.push(t))},e.prototype.getMonster=function(){var i=this.monsterPool.pop();return i||(i=GObj.create(t.IMiniGame11Monster),i.setFun(this,this.setResult)),i},e.prototype.backMonster=function(t){t&&-1==this.monsterPool.indexOf(t)&&(t.reset(),this.monsterPool.push(t))},e.prototype.monsterRun=function(){if(0!=this.monsterArr.length)for(var i,e=0;e<this.monsterArr.length;e++)if(i=this.monsterArr[e],i.isDie())this.dropAddToScene(this.monsterArr[e].x,this.monsterArr[e].y-i.height/2,this.monsterArr[e].getMonsterExp()),i.parent&&i.parent.removeChild(i),this.monsterArr.splice(e,1),this.backMonster(i),e--;else{for(var s=void 0,h=0;h<this.monsterArr.length;h++)this.monsterArr[h].x==i.x&&this.monsterArr[h].y>t.IMiniGame11Consts.shuaiguai_y&&(s?s.y>this.monsterArr[h].y&&(s=this.monsterArr[h]):s=this.monsterArr[h]);if(i.y==t.IMiniGame11Consts.shuaiguai_y&&s&&s.y-i.y<t.IMiniGame11Consts.distance)continue;i.run()}},e.prototype.showGuide=function(){1==this.stageData.stageId?(this.guide.alpha=1,this.guide.visible=!0):this.guide.visible=!1},e.prototype.checkHit=function(){for(var i,e,s,h,a,n,o=0;o<this.skillArr.length;o++){i=this.skillArr[o],s=i.x-i.anchorOffsetX,h=i.x+i.anchorOffsetX;for(var r=0;r<this.monsterArr.length;r++)if(e=this.monsterArr[r],a=e.x-e.width/2,n=e.x+e.width/2,(s>=a&&n>=s||h>=a&&n>=h)&&e.y>=i.y){if(i.setRunning(!1),e.setHp(this.player.getAttNumber()),this.hitEf.x=e.x,this.hitEf.y=e.y,this.hitEf.stop(),i.skill9Lv&&t.IMiniGame11Consts.skills[9].skillData[i.skill9Lv]?this.hitEf.start(t.IMiniGame11Consts.skills[9].skillData[i.skill9Lv].hitmodel,1):this.hitEf.start("ui_s1",1),this.hitEf.autoRun(),e.isDie()||e.hurtBack(),-1!=this.player.getSkill().indexOf(1)&&Math.floor(100*Math.random())<t.IMiniGame11Consts.skills[1].num){this.lightMovie.x=e.x,this.lightMovie.y=e.y,this.lightMovie.stop(),this.lightMovie.start(t.IMiniGame11Consts.dian,1),IMiniGameMain.playEff(t.IMiniGame11Consts.minigame11_shandian),this.lightMovie.autoRun();var l=0,p=t.IMiniGame11Consts.skills[1].hurt;p&&(l=1==p.length?p[0]:p[0]+Math.floor(Math.random()*(p[1]-p[0]+1)),e.setHp(l))}if(-1!=this.player.getSkill().indexOf(2)&&e.isDie()&&this.ishireEd){this.ishireEd=!1,this.hireE.stop(),this.hireE.x=e.x,this.hireE.y=e.y,IMiniGameMain.playEff(t.IMiniGame11Consts.minigame11_yanbao),this.hireE.start(t.IMiniGame11Consts.huo,1),this.hireE.autoRun();var c=t.IMiniGame11Consts.skills[2].num,l=0,u=t.IMiniGame11Consts.skills[2].hurt;u&&(l=1==u.length?u[0]:u[0]+Math.floor(Math.random()*(u[1]-u[0]+1)));for(var d=void 0,m=0;m<this.monsterArr.length;m++)d=GMath.distance(this.hireE.x,this.hireE.y,this.monsterArr[m].x,this.monsterArr[m].y),c>d&&this.monsterArr[m].setHp(l)}}}},e.prototype.dropAddToScene=function(t,i,e){var s=this.getDropObj();s.setData(t,i,e),this.dropIn.push(s),this.dropGrp.addChild(s)},e.prototype.getDropObj=function(){var i=this.dropPool.pop();return i||(i=GObj.create(t.IMiniGame11Drop)),i.reset(),i},e.prototype.backDropObj=function(t){t&&-1==this.dropPool.indexOf(t)&&(t.parent&&t.parent.removeChild(t),this.dropPool.push(t))},e.prototype.dropCollisionPlayer=function(){var t=this.dropIn.length;if(t)for(var i=0;t>i;i++){var e=this.dropIn[i];if(!e)break;e.isRemove?(this.dropIn.splice(i,1),i--,this.backDropObj(e),this.updateExp(e.getDropExp())):0==e.isPlay?e.moveTween():2==e.isPlay&&e.flyToPlayer(this.player)}},e.prototype.onBeginClick=function(i){var e=this;1==this.stageData.stageId&&(this.guide.alpha=1,egret.Tween.get(this.guide).to({alpha:0},t.IMiniGame11Consts.countDown).call(function(){e.guide.visible=!1}));var s=GObj.create(egret.Point);this.globalToLocal(i.stageX,i.stageY,s),this.rocker.x=s.x,this.rocker.y=s.y,this.rocker.onBeginClick()},e.prototype.suspendEvent=function(){DispatcherManager.removeListener(HGEvent.HEARTBEAT,this.timeFun,this),EnterFrameManager.instance.unRegisteRender(this.update,this)},e.prototype.recovery=function(){DispatcherManager.addListener(HGEvent.HEARTBEAT,this.timeFun,this),EnterFrameManager.instance.registeRender(this.update,this)},e.prototype.timeFun=function(){if(this.startTime++,this.timeLabel.text=this.format(this.stageData.time-this.startTime),this.startTime>=this.stageData.time)return void this.setResult(!1);if(this.startTime==this.stageData.boss.bossTime){IMiniGameMain.reqSocket(2),this.bossMovie.stop(),this.bossMovie.start(t.IMiniGame11Consts.bossMovie,1),this.bossMovie.autoRun();var i=this.getMonster();return i.setData(this.stageData.boss,t.IMiniGame11Consts.shuaiguai_y,t.IMiniGame11Consts.monstor_y),this.monsterGrp.addChildAt(i,0),this.monsterArr.push(i),void(this.is_boss=!0)}if(!(this.startTime>this.stageData.boss.bossTime)){for(var e=this.stageData.passes.length,s=this.waveIndex;e>s;s++){var h=this.stageData.passes[s];this.startTime>=h.passTime&&(this.waveIndex++,this.lastT=0)}this.waveData=this.stageData.passes[this.waveIndex-1],this.waveData&&this.startTime-this.lastT>=(this.waveData.timeGap||3)&&(this.createMonster(),this.lastT=this.startTime)}},e.prototype.juageS=function(){this.is_boss&&0==this.monsterArr.length&&this.setResult(!0)},e.prototype.clearObject=function(){this.suspendEvent();for(var t,i=0;i<this.monsterArr.length;i++)t=this.monsterArr[i],t.parent&&t.parent.removeChild(t),this.backMonster(t);this.monsterArr=[];for(var e,i=0;i<this.skillArr.length;i++)e=this.skillArr[i],e.parent&&e.parent.removeChild(e),this.backSkillObj(e);this.skillArr=[];for(var s,i=0;i<this.dropIn.length;i++)s=this.dropIn[i],s.parent&&s.parent.removeChild(s),this.backDropObj(s);this.dropIn=[];for(var h,i=0;i<this.bornArr.length;i++)h=this.bornArr[i],h.parent&&h.parent.removeChild(h),this.backBornEffect(h);this.bornArr=[]},e.prototype.setResult=function(i){this.isOver||(this.isOver=!0,i&&IMiniGameMain.reqSocket(3),this.skillView&&this.skillView.parent&&this.skillView.parent.removeChild(this.skillView),this.clearObject(),i?(IMiniGameMain.playEff(t.IMiniGame11Consts.minigame11_win),t.IMiniGameResult.showResult(IMiniGameResultType.type_1,this.onCloseClick,this)):(IMiniGameMain.playEff(t.IMiniGame11Consts.minigame11_die),t.IMiniGameResult.showResult(IMiniGameResultType.type_0,this.updateView,this)))},e.prototype.skillCall=function(i){if(this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBeginClick,this),this.recovery(),9==i){this.skill9Lv++;for(var e=void 0,s=0;s<this.skillArr.length;s++)e=this.skillArr[s],e.setSkill9Lv(this.skill9Lv),this.skill9Lv&&t.IMiniGame11Consts.skills[9].skillData[this.skill9Lv]&&(this.skillSpeed=this.skillSpeed+t.IMiniGame11Consts.skills[9].skillData[this.skill9Lv].flyspeed),e.setSkillInfo(this.skillSpeed)}this.player.addSkill(i,this.skill9Lv),this.skillIcon&&this.skillIcon.setOutSrc("skill"+i,FileConst.png),this.skillCollisionPlayer()},e.prototype.skillCollisionPlayer=function(){var i=this;this.skillGroup&&(egret.Tween.removeTweens(this.skillGroup),this.skillGroup.x=20,this.skillGroup.y=this.height/3*2,this.skillGroup.scaleX=this.skillGroup.scaleY=1,egret.Tween.get(this.skillGroup).to({x:this.player.x,y:this.player.y-this.player.height/2},600).to({scaleX:0,scaleY:0},200).call(function(){i.skillup.x=i.player.x,i.skillup.y=i.player.y,IMiniGameMain.playEff(t.IMiniGame11Consts.minigame11_uplevel2),i.skillup.start(t.IMiniGame11Consts.ui_shouji,1),i.skillup.autoRun()},this))},e.prototype.updateExp=function(t){if(this.player){t&&this.player.addExp(t);var i=this.player.getExpInfo()[this.player.lv+1];i?(this.expImg.width=this.player.exp/i*this.expBgImg.width,this.expLab.text="lv:"+this.player.lv+",exp:"+this.player.exp+"/"+i):this.expMaxShow()}},e.prototype.expMaxShow=function(){this.expImg.width=this.expBgImg.width,this.expLab.text="lv:max"},e.prototype.openSkill=function(){this.isOver||(this.skillView||(this.skillView=GObj.create(t.IMiniGame11UpPop),this.skillView.setskill(this.stageData.player.initSkills),this.skillView.horizontalCenter=this.skillView.verticalCenter=0),this.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBeginClick,this),this.suspendEvent(),this.skillView.setFun(this,this.skillCall,this.player.levelNum),this.skillView.scaleX=this.skillView.scaleY=0,this.addChild(this.skillView),egret.Tween.get(this.skillView).to({scaleX:1,scaleY:1},200))},e.prototype.showupLevel=function(){this.uplevel.visible=!0,this.uplevel.x=this.player.x,this.uplevel.alpha=1,this.uplevel.y=this.player.y-this.player.height,egret.Tween.get(this.uplevel).to({y:this.uplevel.y-10,alpha:0},300)},e.prototype.format=function(t){var i=Math.floor(t/60)>=10?Math.floor(t/60):"0"+Math.floor(t/60);t-=60*i;var e=t>=10?t:"0"+t;return i+":"+e},e.prototype.getBornEffect=function(){var i=this.bornPool.pop();return i||(i=GObj.create(t.IMiniGame11Moive),this.bornGrp.addChild(i)),this.bornArr.push(i),i},e.prototype.backBornEffect=function(t){t&&-1==this.bornPool.indexOf(t)&&(t.parent&&t.parent.removeChild(t),t.reset(),this.bornPool.push(t))},e.prototype.clearTween=function(){this.uplevel&&egret.Tween.removeTweens(this.uplevel),this.skillView&&egret.Tween.removeTweens(this.skillView),this.guide&&egret.Tween.removeTweens(this.guide),this.skillGroup&&egret.Tween.removeTweens(this.skillGroup)},e.prototype.onCloseClick=function(){this.parent&&(this.clearObject(),i.prototype.onCloseClick.call(this))},e.prototype.dispose=function(){if(!this.isDestory){this.isDestory=!0,this.removeEvent(),this.clearTween(),GObj.disposeObject(this.dropGrp),this.dropGrp=null;for(var t=0,e=this.dropPool;t<e.length;t++){var s=e[t];GObj.disposeObject(s)}this.dropPool=null;for(var h=0,a=this.dropIn;h<a.length;h++){var s=a[h];GObj.disposeObject(s)}this.dropIn=null,this.stageData=null,GObj.disposeObject(this.gameBg),this.gameBg=null,GObj.disposeObject(this.rocker),this.rocker=null,GObj.disposeObject(this.player),this.player=null;for(var n=0,o=this.skillArr;n<o.length;n++){var r=o[n];GObj.disposeObject(r)}this.skillArr=null;for(var l=0,p=this.skillPool;l<p.length;l++){var r=p[l];GObj.disposeObject(r)}this.skillPool=null;for(var c=0,u=this.bornPool;c<u.length;c++){var d=u[c];GObj.disposeObject(d)}this.bornPool=null;for(var m=0,g=this.bornArr;m<g.length;m++){var d=g[m];GObj.disposeObject(d)}this.bornArr=null,GObj.disposeObject(this.actFrame),this.actFrame=null;for(var f=0,b=this.monsterPool;f<b.length;f++){var y=b[f];GObj.disposeObject(y)}this.monsterPool=null;for(var G=0,v=this.monsterArr;G<v.length;G++){var y=v[G];GObj.disposeObject(r)}this.monsterArr=null,GObj.disposeObject(this.waveIndex),this.waveIndex=null,GObj.disposeObject(this.startTime),this.startTime=null,GObj.disposeObject(this.lastT),this.lastT=null,this.waveData=null,GObj.disposeObject(this.timeLabel),this.timeLabel=null,GObj.disposeObject(this.skillView),this.skillView=null,GObj.disposeObject(this.expBgImg),this.expBgImg=null,GObj.disposeObject(this.expImg),this.expImg=null,GObj.disposeObject(this.expLab),this.expLab=null,GObj.disposeObject(this.monsterGrp),this.monsterGrp=null,GObj.disposeObject(this.lightMovie),this.lightMovie=null,GObj.disposeObject(this.explosionMovie),this.explosionMovie=null,GObj.disposeObject(this.hireE),this.hireE=null,GObj.disposeObject(this.hitEf),this.hitEf=null,GObj.disposeObject(this.skillGrp),this.skillGrp=null,GObj.disposeObject(this.guide),this.guide=null,GObj.disposeObject(this.bossMovie),this.bossMovie=null,GObj.disposeObject(this.is_boss),this.is_boss=null,GObj.disposeObject(this.skillSpeed),this.skillSpeed=null,GObj.disposeObject(this.skill9Lv),this.skill9Lv=null,GObj.disposeObject(this.isOver),this.isOver=null,GObj.disposeObject(this.timeBg),this.timeBg=null,GObj.disposeObject(this.timeGroup),this.timeGroup=null,GObj.disposeObject(this.skillGroup),this.skillGroup=null,GObj.disposeObject(this.skillbg),this.skillbg=null,GObj.disposeObject(this.skillIcon),this.skillIcon=null,GObj.disposeObject(this.skillup),this.skillup=null,GObj.disposeObject(this.uplevel),this.uplevel=null,GObj.disposeObject(this.musicNum),this.musicNum=null,GObj.disposeObject(this.colorArr),this.colorArr=null,GObj.disposeObject(this.colorMatrix),this.colorMatrix=null,GObj.disposeObject(this.bornGrp),this.bornGrp=null,GObj.disposeObject(this.ishireEd),this.ishireEd=null,GObj.disposeObject(this.exitBtn),this.exitBtn=null,i.prototype.dispose.call(this)}},e}(t.IBaseView);t.IMiniGame11View=i,__reflect(i.prototype,"miniGame.IMiniGame11View")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(t){return i.call(this,t)||this}return __extends(e,i),e.prototype.getGameView=function(){return this.gameView||(this.gameView=GObj.create(t.IMiniGame12View)),this.gameView.setData(this.getCurGameData()),this.gameView},e.prototype.loadConfigComplete=function(e){if(e)for(var s in e.config)t.IMiniGame12Consts[s]=e.config[s];var h=[];h=h.concat([1,0,0,0,100]),h=h.concat([0,0,0,0,0]),h=h.concat([0,0,0,0,0]),h=h.concat([0,0,0,1,0]),t.IMiniGame12Consts.redFilter=new egret.ColorMatrixFilter(h),h=[],h=h.concat([1,0,0,0,150]),h=h.concat([0,1,0,0,150]),h=h.concat([0,0,1,0,150]),h=h.concat([0,0,0,1,0]),t.IMiniGame12Consts.flashFilter=new egret.ColorMatrixFilter(h),i.prototype.loadConfigComplete.call(this,e)},e.setDefMonsterVo=function(i){for(var e=0;e<i.length;e++){var s=i[e].index,h=t.IMiniGame12Consts.monsters[s];for(var a in h)void 0==i[e][a]&&"monProp"!=a&&(i[e][a]=h[a])}},e.setDefSpecVo=function(i,e){for(var s=0;s<i.length;s++){var h=i[s].index,a=t.IMiniGame12Consts.specs[h];if(a.specPet&&i[s].specPet)for(var n in a.specPet)void 0==i[s].specPet[n]&&(i[s].specPet[n]=a.specPet[n]);for(var o in a)void 0==i[s][o]&&(i[s][o]=a[o]);void 0!=e&&(i[s].specTime=e)}},e.prototype.dispose=function(){i.prototype.dispose.call(this)},e}(t.IMiniGameBaseCtr);t.IMiniGame12=i,__reflect(i.prototype,"miniGame.IMiniGame12")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var e=i.call(this)||this;return e.exact=!0,e.touchEnabled=!1,e.touchChildren=!1,e.reset(),e.img=GObj.create(t.ImageOutside),e.img.loadCompleteCall(function(){e.width=e.img.iconWidth,e.height=e.img.iconHeight,e.anchorOffsetX=e.width/2,e.anchorOffsetY=e.height/2},e),e.addChild(e.img),e}return __extends(e,i),e.prototype.setData=function(i,e){this.speed=i.data.bullSpeed,i instanceof t.IMiniGame12Player?(this.hurt=i.hurt,this.atkGap=i.atkGap,this.img.setOutSrc(e||i.data.bullImg,FileConst.png)):(this.isPet=!0,this.hurt=GMath.randomInt(i.data.hurt[0],i.data.hurt[1]),this.atkGap=i.data.atkGap,this.img.setOutSrc(i.data.bullImg,FileConst.png)),this.autoRoation=i.data.autoRoation||0},e.prototype.run=function(){this.isDie||(this.initPosY||(this.initPosY=this.y),this.rotation+=this.autoRoation,this.y-=this.speed,Math.abs(this.y-this.initPosY)>this.atkGap&&(this.isDie=!0),this.y+this.height<0&&(this.isDie=!0))},e.prototype.died=function(){this.isDie=!0},e.prototype.isCanRemove=function(){return this.isDie},e.prototype.reset=function(){this.speed=1,this.hurt=0,this.atkGap=0,this.autoRoation=0,this.isDie=!1,this.initPosY=0,this.rotation=0,this.isPet=!1},e.prototype.dispose=function(){this.reset(),GObj.disposeObject(this.img),this.img=null},e}(eui.Component);t.IMiniGame12Bullet=i,__reflect(i.prototype,"miniGame.IMiniGame12Bullet")}(miniGame||(miniGame={}));var miniGame;!function(t){t.IMiniGame12Consts={heroDisplay:!0,allow_bottom:100,rocker_bottom:10,ui_hireEff:"ui_tesu",petsDis:10,petsNumber:4,isRocker:1,redFilter:null,flashFilter:null,seleRoleDir:!0,extraNum:0,extra:"",roleY:850,mapSpeed:1,arrowTime:200,role_select_eff:"ui_xuankuang",addEff:"ui_shengji",reduceEff:"ui_jiangdi",dieEff:"ui_siwang",hitEff:"ui_shouji",dian:"ui_dian",huo:"ui_huo",specLeft:160,specRight:385,monLeft:150,monRight:370,minigame12_bgm:"bgm_login",minigame12_win:"win",minigame12_die:"minigame_lose",minigame12_boss:"minigame12_boss",minigame12_add:"minigame_lose",minigame12_reduce:"minigame_lose",minigame12_hit:"att",minigame12_attack:"att",bossMovie:"ui_bosslaixi",specTextY:0,icon_y:2,monsters:{},specs:{},players:{}}}(miniGame||(miniGame={}));var Spec12Type;!function(t){t[t.TYPE_1=1]="TYPE_1",t[t.TYPE_2=2]="TYPE_2",t[t.TYPE_3=3]="TYPE_3",t[t.TYPE_4=4]="TYPE_4",t[t.TYPE_5=5]="TYPE_5",t[t.TYPE_6=6]="TYPE_6",t[t.TYPE_7=7]="TYPE_7",t[t.TYPE_8=8]="TYPE_8",t[t.TYPE_9=9]="TYPE_9",t[t.TYPE_10=10]="TYPE_10",t[t.TYPE_11=11]="TYPE_11"}(Spec12Type||(Spec12Type={}));var miniGame;!function(t){var i=function(t){function i(){return t.call(this)||this}return __extends(i,t),i.prototype.getEffectData=function(){return this._effect&&this._effect.ttfs?this._effect.ttfs[0].ttr||null:null},i.prototype.dispose=function(){t.prototype.dispose.call(this)},i}(t.IMovie);t.IMiniGame12IMovie=i,__reflect(i.prototype,"miniGame.IMiniGame12IMovie")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.initSkin(),t}return __extends(e,i),e.prototype.initSkin=function(){var i=this;this.isInit||(this.isInit=!0,this.stageImg=GObj.create(t.ImageOutside),this.monEff=GObj.create(t.IMiniGame12IMovie),this.stageImg.loadCompleteCall(function(){i.width=i.stageImg.iconWidth,i.height=i.stageImg.iconHeight,i.anchorOffsetX=i.width/2,i.anchorOffsetY=i.height/2,i.stageImg.anchorOffsetX=i.width/2,i.stageImg.anchorOffsetY=i.height/2,i.stageImg.x=i.width/2,i.stageImg.y=i.height/2,i.monEff.x=i.anchorOffsetX,i.monEff.y=50},this),this.monEff.setLoadCompleteBack(function(){i.isLoad=!0,i.monEff.x=i.anchorOffsetX,i.monEff.y=50,i.setLabel()},this),this.stageImg.setOutSrc("stageImg"),this.addChild(this.stageImg),this.addChild(this.monEff),this.hireEff=GObj.create(t.IMovie),this.hireEff.setLoadCompleteBack(function(){i.hireEff.x=i.anchorOffsetX,i.hireEff.y=50},this),this.addChild(this.hireEff),this.numB=GObj.create(t.IBitNumMap),this.numB.setGap(-7),this.numB.setPath("num12"),this.numB.horizontalCenter=0,this.numB.y=70,this.addChild(this.numB),this.labelText=GObj.create(eui.Label),this.labelText.textAlign="center",this.labelText.textColor=16774479,this.labelText.wordWrap=!0,this.labelText.strokeColor=0,this.labelText.stroke=1,this.labelText.size=24,this.labelText.lineSpacing=10,this.labelText.fontFamily="SimHei",this.labelText.horizontalCenter=0,this.addChild(this.labelText))},e.prototype.stageImgV=function(t){this.stageImg&&(this.stageImg.visible=t)},e.prototype.setData=function(i){this.data=i,i&&(this.monEff.scaleX=this.monEff.scaleY=this.data.scaleXY||1,this.monEff.start(i.model),this.monEff.autoRun(),this._hp=GMath.randomInt(i.hp[0],i.hp[1]),this.numB.setNumber(this._hp),this.setLabel(),this.data.monProp&&(this.hireEff.start(t.IMiniGame12Consts.ui_hireEff),this.hireEff.autoRun()))},e.prototype.setLabel=function(){if(this.isLoad&&this.data&&!this.isUpdate&&(this.isUpdate=!0,this.data.monProp)){var t="",i=1;for(var e in this.data.monProp)t=1==i?this.data.monProp[e].specName:t+"\n"+this.data.monProp[e].specName,i++;this.labelText.text=t;var s=this.monEff.getEffectData();s?this.labelText.bottom=s.textureHeight*this.monEff.scaleX-this.monEff.y+this.height:this.labelText.text=""}},e.prototype.reset=function(){this._hp=0,this._isDie=!1,this.isDieBack=!1,this.isUpdate=!1,this.isLoad=!1,this.isBoss=!1,this.labelText.text="",this.hireEff.stop()},e.prototype.run=function(){this.y+=t.IMiniGame12Consts.mapSpeed,this.y>960+this.height&&(this._isDie=!0)},e.prototype.getCollisionPoint=function(){var t=this.x-40,i=this.x+40,e=this.y;return[{x:t,y:e},{x:i,y:e}]},e.prototype.isDie=function(){return this._isDie},e.prototype.setHit=function(i){var e=this;return this._hp-=i,egret.Tween.removeTweens(this),this.filters=[t.IMiniGame12Consts.redFilter],egret.Tween.get(this).wait(200).call(function(){e.filters=null}),egret.Tween.removeTweens(this.stageImg),egret.Tween.get(this.stageImg).to({scaleX:.7,scaleY:.7},80).call(function(){e.stageImg.scaleX=e.stageImg.scaleY=1}),this._hp<=0&&(this._hp=0,this._isDie=!0,this.isDieBack=!0,egret.Tween.get(this).wait(50).call(function(){e.isDieBack=!1})),this.numB.setNumber(this._hp),this._isDie},e.prototype.isCanRemove=function(){return this._isDie&&!this.isDieBack},e.prototype.dispose=function(){egret.Tween.removeTweens(this.stageImg),egret.Tween.removeTweens(this),this.data=null,this.reset(),GObj.disposeObject(this.stageImg),this.stageImg=null,GObj.disposeObject(this.monEff),this.monEff=null,GObj.disposeObject(this.numB),this.numB=null,GObj.disposeObject(this.hireEff),this.hireEff=null},e}(eui.Component);t.IMiniGame12Monster=i,__reflect(i.prototype,"miniGame.IMiniGame12Monster")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(t){function i(){return t.call(this)||this}return __extends(i,t),i.prototype.setFun=function(t,i){this.fun=t,this.thisobj=i},i.prototype.getCanAtk=function(){return this.atk_speed--,this.atk_speed<0?(this.atk_speed=this.data.pet_atkSpeed||10,!0):!1},i.prototype.partComplete=function(i){t.prototype.partComplete.call(this,i),i&&i.jsonObj&&(this.fixWidth=i.jsonObj.frames[0].w,this.fixHeight=i.jsonObj.frames[0].h,this.fun&&this.fun.call(this.thisobj))},i.prototype.setData=function(t,i){t&&(this.data=t,this.scaleX=this.scaleY=t.scaleXY,this.atk_speed=t.pet_atkSpeed||10,this.setDirection(0),this.updatePart(t.model),this.autoRun(),i?this.setAction(AvatarConsts.ACTION_WALK):this.setAction(AvatarConsts.ACTION_ATTACK_I))},i.prototype.dispose=function(){this.data=null,t.prototype.dispose.call(this)},i}(t.IAvatarView);t.IMiniGame12Pets=i,__reflect(i.prototype,"miniGame.IMiniGame12Pets")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.petsArr=[],t}return __extends(e,i),e.prototype.getPetsArr=function(){return this.petsArr||[]},e.prototype.getBulletModel=function(){return this.bulletModel},e.prototype.initData=function(){for(var t=0,i=this.petsArr;t<i.length;t++){var e=i[t];e.parent&&e.parent.removeChild(e),GObj.disposeObject(e),e=null}this.petsArr=[]},e.prototype.setFun=function(t,i){this.fun=t,this.thisobj=i},e.prototype.setData=function(t){t&&(this.bulletModel=[],this.skillArr=[],this._isDie=!1,this.data=t,this.speed=this.data.role_speed||1,this.atkSpeedNum=this.atkSpeed=this.data.role_atkSpeed||60,this.scaleX=this.scaleY=this.data.role_scaleXY||1,this.trackNum=this.data.role_trackNum||1,this.hurt=this.data.hurt||1,this.atkGap=this.data.atkGap||100,this.bulletModel.push(t.bullImg),this.updatePart(this.data.role_model),this.setDirection(AvatarConsts.B_B),this.setAction(AvatarConsts.ACTION_ATTACK),this.initData(),this.clearMount())},e.prototype.partComplete=function(t){i.prototype.partComplete.call(this,t),t&&t.jsonObj&&(this.width=this.fixWidth=t.jsonObj.frames[0].w,this.height=this.fixHeight=t.jsonObj.frames[0].h)},e.prototype.getFixW=function(){return this.fixWidth||this.width},e.prototype.getFixH=function(){return this.fixHeight||this.height},e.prototype.run=function(){return i.prototype.run.call(this),this.checkAtk()},e.prototype.setRocker=function(t){this.isRocker=t,this.isSlide=!1},e.prototype.checkAtk=function(){return--this.atkSpeedNum>0?void 0:(this.atkSpeedNum=this.atkSpeed,!0)},e.prototype.actionOver=function(t){i.prototype.actionOver.call(this,t)},e.prototype.setAngle=function(t){this._isMove&&(this.angle=t)},e.prototype.setMoveArea=function(t,i){this.ax=t,this.aw=i},e.prototype.setMove=function(t){this._isMove=t},e.prototype.getSkill=function(){return this.skillArr||[]},e.prototype.move=function(){if(!this._isDie&&this.fixWidth)if(this.isRocker){if(void 0==this.targetEndX||this.tempTargetEndX==this.targetEndX)return;this.tempTargetEndX=this.targetEndX;var t=this.ax+this.scaleX*this.fixWidth/2,i=this.aw-this.scaleX*this.fixWidth/2;this.targetEndX>this.x?this.targetEndX>=i&&(this.targetEndX=i):this.targetEndX<=t&&(this.targetEndX=t),this.x=this.targetEndX}else{if(!this._isMove||void 0==this.endX)return;var e,t=this.ax+this.scaleX*this.fixWidth/2,i=this.aw-this.scaleX*this.fixWidth/2,e=this.x+(this.speed*this.angle||0);if(1==this.angle)i>e&&(this.endX>=i&&(this.endX=i),e<this.endX&&(this.x=e),this.isSlide&&this.x<this.targetEndX&&(this.x=e));else{if(-1!=this.angle)return;e>t&&(this.endX<=t&&(this.endX=t),this.endX<e&&(this.x=e),this.isSlide&&this.x>this.targetEndX&&(this.x=e))}}},e.prototype.getCollisionPoint=function(){var t=this.x-40*this.scaleX,i=this.x+40*this.scaleX,e=this.y-120*this.scaleX;return[{x:t,y:e},{x:i,y:e}]},e.prototype.addBySpec=function(t){if(t)switch(t.index){case Spec12Type.TYPE_1:this.addAtkGap(t.specValue);break;case Spec12Type.TYPE_2:this.addAtkSpeed(t.specValue);break;case Spec12Type.TYPE_3:this.addTrackNum(t);break;case Spec12Type.TYPE_4:this.addAtk(t.specValue);break;case Spec12Type.TYPE_5:this.addRoleSpeed(t.specValue);break;case Spec12Type.TYPE_6:this.addPets(t.specPet[t.specPetIndex]);break;case Spec12Type.TYPE_7:this.addMount(t.specPet[t.specPetIndex]);break;case Spec12Type.TYPE_8:this.addWing(t.specPet[t.specPetIndex]);break;case Spec12Type.TYPE_9:case Spec12Type.TYPE_10:this.addSkill(t.index);break;case Spec12Type.TYPE_11:t.type11_name||this.fun&&this.fun.call(this.thisobj)}},e.prototype.addSkill=function(t){-1==this.skillArr.indexOf(t)&&this.skillArr.push(t)},e.prototype.addRoleSpeed=function(t){this.speed+=t,this.speed<=0&&(this.speed=1)},e.prototype.addAtk=function(t){this.hurt+=t,this.hurt<=0&&(this.hurt=1)},e.prototype.addTrackNum=function(t){if(this.trackNum+=t.specValue,this.trackNum<=0&&(this.trackNum=1),t.specValue>0){if(t.specModel)for(var i=t.specModel.split("|"),e=0;e<i.length;e++)this.bulletModel.push(i[e])}else t.specValue<0&&this.bulletModel.length>1&&this.bulletModel.pop()},e.prototype.addAtkSpeed=function(t){this.atkSpeed+=t,this.atkSpeed<1&&(this.atkSpeed=1)},e.prototype.addAtkGap=function(t){this.atkGap+=t,this.atkGap<=0&&(this.atkGap=100)},e.prototype.changePets=function(){for(var i,e=this.petsArr.length,s=0;e>s;s++)i=this.petsArr[s],i.fixWidth&&this.fixWidth&&(i.x=i.index%2==0?-(this.fixWidth*this.scaleX/2+i.fixWidth/2*i.scaleX+t.IMiniGame12Consts.petsDis):this.fixWidth*this.scaleX/2+i.fixWidth/2*i.scaleX+t.IMiniGame12Consts.petsDis,i.y=0==Math.floor((i.index-1)/2)?0:-this.fixHeight*this.scaleX,i.parent||this.addChild(i))},e.prototype.addPets=function(i){var e=this.petsArr.length;if(i&&!(e>=t.IMiniGame12Consts.petsNumber)){var s=GObj.create(t.IMiniGame12Pets);s.setFun(this.changePets,this),s.index=e+1,s.setData(i),-1==this.petsArr.indexOf(s)&&this.petsArr.push(s)}},e.prototype.setMountXY=function(){this.mountObj.x=0,this.mountObj.y=this.mountObj.fixHeight*this.mountObj.scaleY/3*2,this.setAction(AvatarConsts.ACTION_STAND)},e.prototype.addMount=function(i){i&&(this.mountObj||(this.mountObj=GObj.create(t.IMiniGame12Pets)),this.mountObj.setData(i,!0),this.mountObj.setFun(this.setMountXY,this),this.mountObj.parent||this.addChildAt(this.mountObj,0))},e.prototype.addWing=function(i){i&&(this.wingObj||(this.wingObj=GObj.create(t.IMovie)),this.wingObj.x=this.partCont.x,this.wingObj.y=this.partCont.y,this.wingObj.start(i.model),this.wingObj.autoRun(),this.wingObj.scaleX=this.wingObj.scaleY=i.scaleXY||1,this.wingObj.parent||this.addChild(this.wingObj))},e.prototype.clearMount=function(){this.mountObj&&(GObj.disposeObject(this.mountObj),this.mountObj=null),this.wingObj&&(GObj.disposeObject(this.wingObj),this.wingObj=null)},e.prototype.dispose=function(){for(var t=0,e=this.petsArr;t<e.length;t++){var s=e[t];s.parent&&s.parent.removeChild(s),GObj.disposeObject(s),s=null}this.clearMount(),this.petsArr=null,this.fun=null,this.thisobj=null,this.skillArr=null,this.data=null,i.prototype.dispose.call(this)},e}(t.IAvatarViewCtr);t.IMiniGame12Player=i,__reflect(i.prototype,"miniGame.IMiniGame12Player")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.initSkin(),t}return __extends(e,i),e.prototype.initSkin=function(){var i=this;this.angle=0,this.tempM=120,this.scrollEnabled=!1,this.rocker=GObj.create(t.ImageOutside),this.rocker.loadCompleteCall(function(){i.width=i.rocker.iconWidth,i.height=i.rocker.iconHeight,i.anchorOffsetX=i.width/2,i.anchorOffsetY=i.height/2,i.startX=i.width/2,i.startY=i.height/2,i.rocker.anchorOffsetX=i.rocker.iconWidth/2,i.rocker.anchorOffsetY=i.rocker.iconHeight/2,i.rocker.x=i.startX,i.rocker.y=i.startY,i.setRealWidth(),i.onEndClick()},this),this.rocker.setOutSrc("rockerPoint"),this.addChild(this.rocker),this.left_arrow=GObj.create(t.ImageOutside),this.left_arrow.touchEnabled=!1,this.left_arrow.setOutSrc("left",FileConst.png),this.left_arrow.left=-60,this.left_arrow.verticalCenter=0,this.addChildAt(this.left_arrow,0),this.right_arrow=GObj.create(t.ImageOutside),this.right_arrow.touchEnabled=!1,this.right_arrow.right=-60,this.right_arrow.verticalCenter=0,this.right_arrow.setOutSrc("right",FileConst.png),this.right_arrow.touchEnabled=!1,this.addChildAt(this.right_arrow,1),this.addEvent()},e.prototype.setMoveWidth=function(t,i,e){this.tempM=t||120,this.fun=i,this.thisobj=e,this.setRealWidth()},e.prototype.setRealWidth=function(){this.moveWidth=this.tempM-this.rocker.width/2},e.prototype.getRealWidth=function(){return this.moveWidth||100},e.prototype.setFun2=function(t,i){this.fun2=t,this.thisobj2=i},e.prototype.addEvent=function(){this.rocker.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBeginClick,this)},e.prototype.removeEvent=function(){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.initSkin,this),this.rocker.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBeginClick,this),this.rocker.removeEventListener(egret.TouchEvent.TOUCH_END,this.onEndClick,this),this.parentObj&&(this.parentObj.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onMoveClick,this),this.parentObj.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMoveClick,this))},e.prototype.updatePos=function(){this.startX=this.width/2,this.startY=this.height/2,this.rocker.x=this.startX,this.rocker.y=this.startY},e.prototype.onBeginClick=function(t){this.isMove||(this.parentObj||(this.parentObj=this.parent),this.rocker.addEventListener(egret.TouchEvent.TOUCH_END,this.onEndClick,this),this.parentObj.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onEndClick,this),this.parentObj.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMoveClick,this),this.fun2&&this.fun2.call(this.thisobj2),this.tempPoint||(this.tempPoint=GObj.create(egret.Point)))
},e.prototype.onMoveClick=function(t){this.globalToLocal(t.stageX,t.stageY,this.tempPoint),this.isMove=!0,this.tempPoint.x<=this.moveWidth+this.rocker.anchorOffsetX&&this.tempPoint.x>=-this.moveWidth+this.rocker.anchorOffsetX&&(this.rocker.x=this.tempPoint.x),this.fun&&this.fun.call(this.thisobj,this.rocker.x-this.rocker.anchorOffsetX),this.getRocker(),this.startX=this.rocker.x,this.startY=this.rocker.y},e.prototype.onEndClick=function(){this.parentObj&&(this.rocker.removeEventListener(egret.TouchEvent.TOUCH_END,this.onEndClick,this),this.parentObj.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onEndClick,this),this.parentObj.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMoveClick,this)),this.isMove=!1},e.prototype.getRocker=function(){this.startX<this.rocker.x?this.angle=1:this.angle=-1},e.prototype.dispose=function(){this.removeEvent(),GObj.disposeObject(this.rocker),this.rocker=null,GObj.disposeObject(this.left_arrow),this.left_arrow=null,GObj.disposeObject(this.right_arrow),this.right_arrow=null,this.parentObj=null,this.fun=null,this.thisobj=null,this.fun2=null,this.thisobj2=null,this.tempPoint=null},e}(eui.Group);t.IMiniGame12Rocker=i,__reflect(i.prototype,"miniGame.IMiniGame12Rocker")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function s(){var t=i.call(this)||this;return t.initSkins(),t}return __extends(s,i),s.prototype.initSkins=function(){var i=this;this.width=540,this.height=960,this.bgImg=GObj.create(t.ImageOutside),this.bgImg.horizontalCenter=0,this.bgImg.verticalCenter=0,this.bgImg.height=StageManager.stageHeight+600,this.bgImg.width=StageManager.stageWidth,this.bgImg.setOutSrc("img3"),this.addChild(this.bgImg),this.itemGrp=GObj.create(eui.Group),this.itemGrp.width=540,this.itemGrp.height=960,this.addChild(this.itemGrp),this.okBtn=GObj.create(t.IBaseBtn),this.okBtn.horizontalCenter=0,this.okBtn.bottom=120,this.okBtn.icon=IMiniGameMain.getIcon("btn_1"),this.okBtn.scaleX=0,this.addChild(this.okBtn),this.titleImg=GObj.create(t.ImageOutside),this.titleImg.horizontalCenter=0,t.IMiniGame12Consts.seleRoleDir?this.titleImg.top=50:this.titleImg.top=0,this.titleImg.scaleX=0,this.titleImg.loadCompleteCall(function(){egret.Tween.get(i.titleImg).to({scaleX:1},500),egret.Tween.get(i.okBtn).to({scaleX:1},500)},this),this.titleImg.setOutSrc("img1"),this.addChild(this.titleImg),this.addEvent()},s.prototype.addEvent=function(){this.okBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.okBtnClick,this)},s.prototype.removeEvent=function(){this.okBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.okBtnClick,this)},s.prototype.show=function(i,s){this.closeBack=i,this.thisObj=s,this.itemArr=[],this.nowSelIndex=0;for(var h=Object.keys(t.IMiniGame12Consts.players),a=0;a<h.length;a++){var n=GObj.create(e);t.IMiniGame12Consts.seleRoleDir?(n.x=120+150*a,1==a&&(this.midX=n.x),n.y=-300,n.alpha=0,egret.Tween.get(n).wait(200*a).to({y:480,alpha:1},500,egret.Ease.circInOut)):(n.y=270+200*a,1==a&&(this.midY=n.y),n.x=-300,n.alpha=0,egret.Tween.get(n).wait(200*a).to({x:270,alpha:1},500,egret.Ease.circInOut)),n.addEventListener(egret.TouchEvent.TOUCH_TAP,this.itemTap,this),n.setData({img:t.IMiniGame12Consts.players[a].role_model,idx:a,sel:this.nowSelIndex}),this.itemGrp.addChild(n),this.itemArr.push(n)}},s.prototype.itemTap=function(t){var i=t.target.index;if(this.nowSelIndex!=i){this.nowSelIndex=i;for(var e=0;e<this.itemArr.length;e++){var s=this.itemArr[e];s.setData({sel:this.nowSelIndex})}}},s.prototype.okBtnClick=function(){for(var i,e=this,s=0;s<this.itemArr.length;s++){var h=this.itemArr[s];h.visible=h.index==this.nowSelIndex,h.visible&&(i=h)}i&&(t.IMiniGame12Consts.seleRoleDir?i.x==this.midX?egret.Tween.get(i).to({y:-300},300).call(function(){e.closeClick()}):egret.Tween.get(i).to({x:this.midX},300).to({y:-300},300).call(function(){e.closeClick()}):i.y==this.midY?egret.Tween.get(i).to({x:-300},300).call(function(){e.closeClick()}):egret.Tween.get(i).to({y:this.midY},300).to({x:-300},300).call(function(){e.closeClick()}))},s.prototype.closeClick=function(){this.closeBack&&this.closeBack.call(this.thisObj,this.nowSelIndex),GObj.disposeObject(this)},s.prototype.dispose=function(){this.removeEvent(),this.thisObj=null,this.closeBack=null,egret.Tween.removeTweens(this.titleImg),egret.Tween.removeTweens(this.okBtn),GObj.disposeObject(this.bgImg),this.bgImg=null,GObj.disposeObject(this.titleImg),this.titleImg=null,GObj.disposeObject(this.okBtn),this.okBtn=null,GObj.disposeObject(this.itemGrp),this.itemGrp=null;for(var t=0,i=this.itemArr;t<i.length;t++){var e=i[t];e.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.itemTap,this),GObj.disposeObject(e),e=null}this.itemArr=null},s}(eui.Component);t.IMiniGame12SelectPop=i,__reflect(i.prototype,"miniGame.IMiniGame12SelectPop");var e=function(i){function e(){var t=i.call(this)||this;return t.initskins(),t}return __extends(e,i),e.prototype.initskins=function(){var i=this;this.itemBg=GObj.create(t.ImageOutside),this.itemBg.touchEnabled=!1,this.selEff=GObj.create(t.IMovie),this.selEff.touchEnabled=!1,this.itemBg.loadCompleteCall(function(){i.width=i.itemBg.width,i.height=i.itemBg.height,i.anchorOffsetX=i.width/2,i.anchorOffsetY=i.height/2,t.IMiniGame12Consts.seleRoleDir?(i.selEff.x=i.anchorOffsetX,i.selEff.y=i.anchorOffsetY+10):(i.selEff.x=248,i.selEff.y=87),i.selEff.start(t.IMiniGame12Consts.role_select_eff),i.selEff.autoRun()},this),this.addChild(this.itemBg),this.addChild(this.selEff)},e.prototype.setData=function(t){t.img&&this.itemBg.setOutSrc(t.img),isNaN(t.idx)||(this.index=t.idx),isNaN(t.sel)||(this.selEff.visible=this.index==t.sel)},e.prototype.dispose=function(){egret.Tween.removeTweens(this),GObj.disposeObject(this.itemBg),this.itemBg=null,GObj.disposeObject(this.selEff),this.selEff=null},e}(eui.Component);t.IMiniGame12SelectItem=e,__reflect(e.prototype,"miniGame.IMiniGame12SelectItem")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.isUpdate=!1,t.initSkins(),t}return __extends(e,i),e.prototype.getIsPick=function(){return this._isPick},e.prototype.setPick=function(i){var e=this;void 0===i&&(i=!0),this._isPick=!0,i&&(egret.Tween.removeTweens(this),this.data.index==Spec12Type.TYPE_11&&this.data.type11_name?this.parent&&egret.Tween.get(this).to({x:this.parent.width/2-this.width/2,y:this.parent.height/2-this.height/2},300).to({scaleX:3,scaleY:3,alpha:0},500).call(this.callBack,this):(this.filters=[t.IMiniGame12Consts.flashFilter],egret.Tween.get(this).wait(200).call(function(){e.filters=null})))},e.prototype.initSkins=function(){var i=this;this.touchEnabled=!1,this.bgImg=GObj.create(t.IMiniGame12IMovie),this.bgImg.setLoadCompleteBack(function(){i.isLoad=!0,i.updateView()},this),this.addChild(this.bgImg),this.nameLab=GObj.create(eui.Label),this.nameLab.size=24,this.nameLab.textColor=16774479,this.nameLab.stroke=1,this.nameLab.strokeColor=0,this.addChild(this.nameLab),this.qipaoImg=GObj.create(t.ImageOutside),this.addChild(this.qipaoImg),this.icon=GObj.create(t.ImageOutside),this.addChild(this.icon)},e.prototype.updateView=function(){var i=this;if(this.isLoad&&this.data&&!this.isUpdate){this.isUpdate=!0;var e=this.bgImg.getEffectData();e&&(this.width=e.textureWidth,this.height=e.textureHeight),this.nameLab.text=this.data.specName,this.nameLab.horizontalCenter=0,this.nameLab.y=t.IMiniGame12Consts.specTextY,this.icon.loadCompleteCall(function(){i.icon.horizontalCenter=0,i.icon.y=i.nameLab.y+i.nameLab.height+t.IMiniGame12Consts.icon_y,egret.Tween.removeTweens(i.icon),egret.Tween.get(i.icon,{loop:!0}).to({y:i.icon.y-2},400).to({y:i.icon.y+2},800).to({y:i.icon.y},400)},this),this.icon.setOutSrc(this.data.specIconName||"")}},e.prototype.setData=function(t){if(this.data=t,this.alpha=1,this.scaleX=this.scaleY=1,t.index==Spec12Type.TYPE_11&&this.data.type11_name){this.qipaoImg.visible=!0,this.bgImg.unAutoRun(),this.bgImg.visible=!1,this.nameLab.visible=!1,this.icon.visible=!1,this.qipaoImg.setOutSrc(this.data.type11_name),this.nameLab.text="";var i=GMath.randomInt(10,20);egret.Tween.get(this.qipaoImg,{loop:!0}).to({y:this.qipaoImg.y-i},30*i).to({y:this.qipaoImg.y+i},60*i).to({y:this.qipaoImg.y},30*i)}else this.qipaoImg.visible=!1,this.bgImg.visible=!0,this.bgImg.start(this.data.specEff?"addImg":"reduceImg"),this.bgImg.autoRun(),this.nameLab.visible=!0,this.icon.visible=!0,this.updateView()},e.prototype.run=function(){this.isDie||(this.y+=t.IMiniGame12Consts.mapSpeed,this.y>960+this.height&&(this.isDie=!0))},e.prototype.setFun=function(t,i){this.thisObj=t,this.fun=i},e.prototype.callBack=function(){this.scaleX=this.scaleY=1,this.fun&&this.fun.call(this.thisObj),this.parent&&this.parent.removeChild(this)},e.prototype.isCanRemove=function(){return this.isDie},e.prototype.reset=function(){this.isDie=!1,this._isPick=!1,this.data=null,this.isLoad=!1,this.isUpdate=!1,this.thisObj=null,this.fun=null,egret.Tween.removeTweens(this),this.icon&&egret.Tween.removeTweens(this.icon),this.qipaoImg&&egret.Tween.removeTweens(this.qipaoImg)},e.prototype.dispose=function(){this.reset(),GObj.disposeObject(this.bgImg),this.bgImg=null,GObj.disposeObject(this.icon),this.icon=null,GObj.disposeObject(this.qipaoImg),this.qipaoImg=null,GObj.disposeObject(this.nameLab),this.nameLab=null},e}(eui.Component);t.IMiniGame12Spec=i,__reflect(i.prototype,"miniGame.IMiniGame12Spec")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function s(){var t=i.call(this)||this;return t.initSkins(),t.addEventListener(egret.Event.ADDED_TO_STAGE,t.addToStageComplete,t),t.list.addEventListener(eui.ItemTapEvent.ITEM_TAP,t.onListClick,t),t}return __extends(s,i),s.prototype.setskill=function(t){this.level=0,this.initSkill=[],this.showSkill=[];for(var i=0;i<t.length;i++)this.initSkill.push(t[i])},s.prototype.setFun=function(t,i){this.thisObj=t,this.closeBack=i},s.prototype.initSkins=function(){if(!this.isInit){this.isInit=!0,this.horizontalCenter=0,this.verticalCenter=0,this.width=540,this.height=960,this.touchEnabled=!1,this.bgRect=GObj.create(eui.Rect),this.bgRect.horizontalCenter=0,this.bgRect.verticalCenter=0,this.bgRect.width=StageManager.stageWidth,this.bgRect.height=StageManager.stageHeight+600,this.bgRect.touchEnabled=!1,this.addChild(this.bgRect),this.view_bg=GObj.create(t.ImageOutside),this.view_bg.horizontalCenter=0,this.view_bg.verticalCenter=0,this.addChild(this.view_bg),this.skillText=GObj.create(t.ImageOutside),this.skillText.horizontalCenter=0,this.skillText.verticalCenter=-58,this.addChild(this.skillText),this.listData=GObj.create(eui.ArrayCollection),this.list=GObj.create(eui.List),this.list.horizontalCenter=7,this.list.bottom=120,this.list.width=510,this.list.height=347,this.list.itemRenderer=e,this.list.dataProvider=this.listData;var i=GObj.create(eui.VerticalLayout);i.gap=10,this.list.layout=i,this.addChild(this.list)}},s.prototype.setImage=function(){this.view_bg&&this.view_bg.setOutSrc("skill12bg",FileConst.png),this.skillText&&this.skillText.setOutSrc("skilltext",FileConst.png)},s.prototype.addToStageComplete=function(){this.updateList()},s.prototype.onListClick=function(t){if(t&&t.itemRenderer){var i=t.itemRenderer;this.callFun(i.index,i.skillindex,i.getXY(),this.showSkill[i.itemIndex])}},s.prototype.updateList=function(){if(0==this.initSkill.length)return void(this.parent&&this.parent.removeChild(this));this.list.selectedIndex=void 0;var t,i=[];if(0==this.level){this.showSkill=[];for(var e=0;3>e;e++)this.initSkill.length>e&&this.showSkill.push(this.initSkill[e])}for(var s,h=this.showSkill,a=0;a<h.length;a++)if(t=a,t<h.length){if(s=h[t],!s)continue;i.push({index:t,skillname:s.name,skilldes:s.des,skillindex:s.index,thisObj:this,fun:this.callFun})}this.listData.replaceAll(i)},s.prototype.callFun=function(t,i,e,s){var h=3+this.level;this.showSkill.length>t&&this.initSkill.length>h?this.showSkill[t]=this.initSkill[h]:this.showSkill.length>t&&this.showSkill.splice(t,1),this.level++,this.closeBack&&this.thisObj&&this.closeBack.call(this.thisObj,i,e,s),this.parent&&this.parent.removeChild(this)},s.prototype.dispose=function(){if(this.thisObj=null,this.closeBack=null,this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.addToStageComplete,this),this.list&&this.list.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onListClick,this),GObj.disposeObject(this.bgRect),this.bgRect=null,GObj.disposeObject(this.view_bg),this.view_bg=null,GObj.disposeObject(this.skillText),this.skillText=null,this.list){for(;this.list.$children.length>0;)GObj.disposeObject(this.list.$children[0]);this.list.dataProvider=null,GObj.disposeObject(this.list),this.list=null}GObj.disposeObject(this.listData),this.listData=null,GObj.disposeObject(this.isInit),this.isInit=null;for(var t=0,i=this.showSkill;t<i.length;t++){var e=i[t];e=null}this.showSkill=null;for(var s=0,h=this.initSkill;s<h.length;s++){var e=h[s];e=null}this.initSkill=null},s}(eui.Component);t.IMiniGame12UpPop=i,__reflect(i.prototype,"miniGame.IMiniGame12UpPop");var e=function(i){function e(){var t=i.call(this)||this;return t.initskins(),t}return __extends(e,i),e.prototype.initskins=function(){var i=this;this.point=GObj.create(egret.Point),this.uigroup=GObj.create(eui.Group),this.uigroup.width=500,this.uigroup.anchorOffsetX=this.uigroup.width/2,this.uigroup.x=this.uigroup.width/2,this.uigroup.verticalCenter=0,this.addChild(this.uigroup),this.itemBg=GObj.create(t.ImageOutside),this.itemBg.horizontalCenter=0,this.itemBg.verticalCenter=0,this.skilldes=GObj.create(eui.Label),this.skilldes.width=this.uigroup.width-180,this.itemBg.loadCompleteCall(function(){i.uigroup.width=i.width=i.itemBg.width,i.uigroup.height=i.height=i.itemBg.height,i.uigroup.anchorOffsetX=i.width/2,i.uigroup.anchorOffsetY=i.height/2,i.uigroup.x=i.uigroup.width/2,i.skilldes.width=i.width-180},this),this.itemBg.setOutSrc("noselected",FileConst.png),this.uigroup.addChild(this.itemBg),this.skillbg=GObj.create(t.ImageOutside),this.skillbg.left=15,this.skillbg.verticalCenter=0,this.skillbg.setOutSrc("skillitembg",FileConst.png),this.uigroup.addChild(this.skillbg),this.skill=GObj.create(t.ImageOutside),this.skill.left=27,this.skill.verticalCenter=0,this.uigroup.addChild(this.skill),this.skillname=GObj.create(eui.Label),this.skillname.left=150,this.skillname.top=15,this.skillname.size=35,this.skillname.bold=!0,this.skillname.fontFamily="Microsoft JhengHei",this.skillname.textColor=4601382,this.uigroup.addChild(this.skillname),this.skilldes.left=150,this.skilldes.top=60,this.skilldes.textColor=10053171,this.skilldes.size=20,this.skilldes.fontFamily="SimHei",this.skilldes.bold=!0,this.skilldes.wordWrap=!0,this.uigroup.addChild(this.skilldes),this.skinName=this.getSkin()},e.prototype.getXY=function(){return this.uigroup.localToGlobal(this.skillbg.left+this.skillbg.width/2,this.itemBg.height/2,this.point),[this.point.x,this.point.y]},e.prototype.getSkin=function(){var t=GObj.create(eui.Skin);return t.skinParts=["mcDisplay"],t.myself=this.uigroup,t.elementsContent=[this.uigroup],t.states=[new eui.State("up",[]),new eui.State("down",[new eui.SetProperty("myself","scaleX",.92),new eui.SetProperty("myself","scaleY",.92)]),new eui.State("disabled",[])],t},e.prototype.dataChanged=function(){if(i.prototype.dataChanged.call(this),this.data){this.uigroup.x=0,this.uigroup.alpha=0;var t=150*(this.itemIndex+1);egret.Tween.get(this.uigroup).wait(t).to({x:this.uigroup.width/2+2,alpha:1},150).to({x:this.uigroup.width/2},50),this.index=this.data.index,this.thisObj=this.data.thisObj,this.fun=this.data.fun,this.skillindex=this.data.skillindex,this.skillname.text=this.data.skillname,this.skilldes.text=this.data.skilldes,this.skill.setOutSrc("skill"+this.skillindex,FileConst.png)}},e.prototype.dispose=function(){this.uigroup&&egret.Tween.removeTweens(this.uigroup),GObj.disposeObject(this.uigroup),this.uigroup=null,GObj.disposeObject(this.itemBg),this.itemBg=null,GObj.disposeObject(this.skillbg),this.skillbg=null,GObj.disposeObject(this.skill),this.skill=null,GObj.disposeObject(this.skillname),this.skillname=null,GObj.disposeObject(this.skilldes),this.skilldes=null,GObj.disposeObject(this.index),this.index=null,GObj.disposeObject(this.skillindex),this.skillindex=null,this.thisObj=null,this.fun=null},e}(eui.ItemRenderer);t.skillItem12=e,__reflect(e.prototype,"miniGame.skillItem12")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){return i.call(this)||this}return __extends(e,i),e.prototype.setData=function(i){i&&(this.stageData=i,this.isRocker=1==t.IMiniGame12Consts.isRocker,this.initSkins(),this.updateView(),App.sound.playBgm(t.IMiniGame12Consts.minigame12_bgm))},e.prototype.updateRocker=function(){this.player&&(this.player.setFun(this.openSkill,this),this.player.setRocker(this.isRocker),this.isRocker?(this.rocker.updatePos(),this.player.tempTargetEndX=this.player.targetEndX=void 0):this.isMoved=!1)},e.prototype.updateView=function(){this.backBoss(),this.isStartGame=!1,1==this.stageData.stageId?(this.arrowImg.alpha=1,this.arrowImg.visible=!0,this.isPause=!0):(this.arrowImg.visible=!1,this.isPause=!1),this.time=0,this.scoreLab.visible=this.timeLab.visible=this.timeImg.visible=this.headImg.visible=this.nameLab.visible=this.headBg.visible=!1,this.bulletArr=[],this.bulletPool=[],this.monsterArr=[],this.monsterPool=[],this.specArr=[],this.specPool=[],this.hitEffPool=[],this.hitEffIn=[],this.mapSpeed=t.IMiniGame12Consts.mapSpeed,this.allScore=0,this.isHaveHit=!1,this.avatarGrp.removeChildren(),this.hitEffGrp.removeChildren(),this.endImg.visible=!1,this.endImg.y=100,this.showSkillView(),t.IMiniGame12Consts.heroDisplay?this.selectRole():this.choiceHero(0),this.updateRocker(),this.skillGroup.scaleX=this.skillGroup.scaleY=0},e.prototype.showSkillView=function(){this.skillView||(this.skillView=GObj.create(t.IMiniGame12UpPop),this.skillView.horizontalCenter=this.skillView.verticalCenter=0),this.stageData.initSkills&&t.IMiniGame12.setDefSpecVo(this.stageData.initSkills),this.skillView.setskill(this.stageData.initSkills||[]),this.skillView&&this.skillView.parent&&this.skillView.parent.removeChild(this.skillView)},e.prototype.initRocker=function(){var i=this;this.rockerBg=GObj.create(t.ImageOutside),this.rockerBg.horizontalCenter=0,this.rockerBg.bottom=t.IMiniGame12Consts.rocker_bottom,this.rocker=GObj.create(t.IMiniGame12Rocker),this.rockerBg.loadCompleteCall(function(){i.rocker.setMoveWidth(i.rockerBg.width/2||120,i.setPlayerTarget,i)},this),this.rocker.setFun2(this.guide,this),this.rockerBg.setOutSrc("rockerBg"),this.addChild(this.rockerBg),this.rockerBg.touchEnabled=!1,this.rocker.horizontalCenter=0,this.rocker.bottom=t.IMiniGame12Consts.rocker_bottom,this.addChild(this.rocker)},e.prototype.initUiGrp=function(){this.uiGrp=GObj.create(egret.DisplayObjectContainer),this.uiRect=GObj.create(eui.Rect),this.uiGrp.width=this.uiRect.width=this.width,this.uiGrp.height=this.uiRect.height=this.height,this.addChild(this.uiGrp),this.uiRect.fillAlpha=.001,this.uiGrp.addChild(this.uiRect)},e.prototype.initSkins=function(){var i=this;if(!this.isInit){this.isInit=!0,this.horizontalCenter=this.verticalCenter=0,this.width=540,this.height=960,this.oneBgH=960,this.bgArr=[],this.touchMask=GObj.create(eui.Rect),this.touchMask.height=StageManager.stageHeight+600,this.touchMask.width=StageManager.stageWidth,this.touchMask.fillColor=0,this.touchMask.horizontalCenter=0,this.touchMask.verticalCenter=0,this.touchMask.alpha=.1,this.addChild(this.touchMask);for(var e=-1;1>=e;e++){var s=GObj.create(t.ImageOutside);s.y=-this.oneBgH*e,s.setOutSrc("bg"+this.stageData.mapId,FileConst.jpg),this.bgArr.push(s),this.addChild(s)}this.endImg=GObj.create(t.ImageOutside),this.endImg.horizontalCenter=0,this.endImg.loadCompleteCall(function(){i.endImg.anchorOffsetY=i.endImg.height},this),this.endImg.setOutSrc("end"),this.addChild(this.endImg),this.avatarGrp=GObj.create(egret.DisplayObjectContainer),this.avatarGrp.width=this.width,this.avatarGrp.height=this.height,this.avatarGrp.touchEnabled=!1,this.avatarGrp.touchChildren=!1,this.addChild(this.avatarGrp),this.player=GObj.create(t.IMiniGame12Player),this.addChild(this.player),this.hitEffGrp=GObj.create(egret.DisplayObjectContainer),this.hitEffGrp.touchEnabled=!1,this.hitEffGrp.touchChildren=!1,this.addChild(this.hitEffGrp),this.skillGroup=GObj.create(eui.Group),this.addChild(this.skillGroup),this.skillbg=GObj.create(t.ImageOutside),this.skillbg.loadCompleteCall(function(){i.skillGroup.height=i.skillbg.height,i.skillGroup.width=i.skillbg.width,i.skillGroup.anchorOffsetX=i.skillGroup.width/2,i.skillGroup.anchorOffsetY=i.skillGroup.height/2},this),this.skillbg.horizontalCenter=0,this.skillbg.verticalCenter=0,this.skillGroup.addChild(this.skillbg),this.skillIcon=GObj.create(t.ImageOutside),this.skillIcon.horizontalCenter=0,this.skillIcon.verticalCenter=0,this.skillGroup.addChild(this.skillIcon),this.isRocker||this.initUiGrp(),this.headBg=GObj.create(t.ImageOutside),this.headBg.left=0,this.headBg.top=15,this.addChild(this.headBg),this.headImg=GObj.create(t.ImageOutside),this.headImg.left=-20,this.headImg.top=0,this.addChild(this.headImg),this.nameLab=GObj.create(eui.Label),this.nameLab.size=20,this.nameLab.top=25,this.nameLab.x=100,this.nameLab.textColor=14483432,this.nameLab.stroke=1,this.addChild(this.nameLab),this.scoreLab=GObj.create(eui.Label),this.scoreLab.size=16,this.scoreLab.top=50,this.scoreLab.x=100,this.scoreLab.stroke=1,this.addChild(this.scoreLab),this.timeImg=GObj.create(t.ImageOutside),this.timeImg.left=0,this.timeImg.top=95,this.addChild(this.timeImg),this.timeLab=GObj.create(eui.Label),this.timeLab.size=25,this.timeLab.left=10,this.timeLab.top=95,this.timeLab.width=100,this.timeLab.textAlign=egret.HorizontalAlign.CENTER,this.addChild(this.timeLab),this.isRocker&&this.initRocker(),this.headBg.touchEnabled=this.headImg.touchEnabled=this.nameLab.touchEnabled=this.scoreLab.touchEnabled=this.timeImg.touchEnabled=this.timeLab.touchEnabled=!1,this.arrowImg=GObj.create(t.ImageOutside),this.arrowImg.horizontalCenter=0,this.arrowImg.bottom=t.IMiniGame12Consts.allow_bottom,this.arrowImg.setOutSrc("arrowImg"),this.arrowImg.touchEnabled=!1,this.addChild(this.arrowImg),this.bossMovie=GObj.create(t.IMovie),this.bossMovie.isLast=!0,this.addChild(this.bossMovie),this.exitBtn=GObj.create(t.IBaseBtn),this.exitBtn.icon=IMiniGameMain.getIcon("exit_btn",FileConst.png,"chapter"),this.exitBtn.right=20,this.exitBtn.top=100+IMiniGameMain.safeHeight,this.addChild(this.exitBtn),this.addEvent()}},e.prototype.backBoss=function(){this.boss&&(this.boss.parent&&this.boss.parent.removeChild(this.boss),GObj.disposeObject(this.boss),this.boss=null)},e.prototype.addEvent=function(){this.uiGrp&&this.uiGrp.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBeginClick,this),this.exitBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCloseClick,this),EnterFrameManager.instance.registeRender(this.update,this)},e.prototype.removeEvent=function(){this.uiGrp&&(this.uiGrp.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBeginClick,this),this.uiGrp.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMoveClick,this),this.uiGrp.removeEventListener(egret.TouchEvent.TOUCH_END,this.onEndClick,this)),this.exitBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onCloseClick,this),DispatcherManager.removeListener(HGEvent.HEARTBEAT,this.timeFun,this),EnterFrameManager.instance.unRegisteRender(this.update,this)},e.prototype.setPlayerTarget=function(t){var i=2*this.rocker.getRealWidth();this.player.targetEndX=this.width/i*(t+i/2)},e.prototype.updateScore=function(){this.scoreLab.text="分数："+this.allScore},e.prototype.guide=function(){var i=this;if(1==this.stageData.stageId){if(this.isPause=!1,this.isStartGame)return;this.isStartGame=!0,this.arrowImg.alpha=1,egret.Tween.get(this.arrowImg).to({alpha:0},t.IMiniGame12Consts.arrowTime).call(function(){i.arrowImg.visible=!1})}},e.prototype.onBeginClick=function(t){this.guide(),this.tempoint||(this.tempoint=GObj.create(egret.Point)),this.uiGrp.globalToLocal(t.stageX,t.stageY,this.tempoint),this.startX=this.tempoint.x,this.uiGrp.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMoveClick,this),this.uiGrp.addEventListener(egret.TouchEvent.TOUCH_END,this.onEndClick,this)},e.prototype.onCloseClick=function(t){i.prototype.onCloseClick.call(this,t),this.isRunning=!1},e.prototype.onMoveClick=function(t){if(this.player){this.uiGrp.globalToLocal(t.stageX,t.stageY,this.tempoint),this.endX=this.tempoint.x,this.isMoved=!0,this.globalToLocal(t.stageX,t.stageY,this.tempoint),this.player.endX=this.tempoint.x;var i=this.endX-this.startX;i>0?(this.player.endX<this.player.x&&(this.player.isSlide=!0,this.player.targetEndX=this.player.x+i),this.player.setAngle(1)):(this.player.x<this.player.endX&&(this.player.isSlide=!0,this.player.targetEndX=this.player.x+i),this.player.setAngle(-1)),this.startX=this.endX}},e.prototype.onEndClick=function(){this.player.isSlide=!1,this.isMoved=!1,this.uiGrp.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMoveClick,this),this.uiGrp.removeEventListener(egret.TouchEvent.TOUCH_END,this.onEndClick,this)},e.prototype.selectRole=function(){this.isRunning=!1,IMiniGameMain.reqSocket(1,this.stageData.stageId);var i=GObj.create(t.IMiniGame12SelectPop);i.show(this.choiceHero,this),this.addChild(i)},e.prototype.openSkill=function(){this.skillView||(this.skillView=GObj.create(t.IMiniGame12UpPop),this.stageData.initSkills&&t.IMiniGame12.setDefSpecVo(this.stageData.initSkills),this.skillView.setskill(this.stageData.initSkills||[]),this.skillView.horizontalCenter=this.skillView.verticalCenter=0),this.uiGrp&&this.uiGrp.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBeginClick,this),this.skillView.setImage(),this.skillView.setFun(this,this.skillCall),this.skillView.scaleX=this.skillView.scaleY=0,this.isRunning=!1,DispatcherManager.removeListener(HGEvent.HEARTBEAT,this.timeFun,this),this.addChild(this.skillView),egret.Tween.get(this.skillView).to({scaleX:1,scaleY:1},200)},e.prototype.skillCall=function(t,i,e){var s=this;this.isRunning=!0,egret.Tween.get(this.timeImg).wait(800).call(function(){DispatcherManager.addListener(HGEvent.HEARTBEAT,s.timeFun,s),s.timeImg&&egret.Tween.removeTweens(s.timeImg)},this),this.skillNumber=t,this.skillData=e,this.uiGrp&&this.uiGrp.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBeginClick,this),this.skillbg&&this.skillbg.setOutSrc("skillitembg",FileConst.png),this.skillIcon&&this.skillIcon.setOutSrc("skill"+t,FileConst.png),this.skillCollisionPlayer(i)},e.prototype.skillCollisionPlayer=function(i){var e=this;if(this.skillGroup){egret.Tween.removeTweens(this.skillGroup),this.skillGroup.x=i[0],this.skillGroup.y=i[1],this.skillGroup.scaleX=this.skillGroup.scaleY=this.skillGroup.alpha=1;var s=this.player;egret.Tween.get(this.skillGroup).to({x:s.x,y:s.y-s.height/2},600).to({scaleX:2.5,scaleY:2.5,alpha:0},200).call(function(){var i={atkx:e.player.x,atky:e.player.y,eff:t.IMiniGame12Consts.addEff};e.hitEffAddToScene(i),e.player.addBySpec(e.skillData)},this)}},e.prototype.choiceHero=function(i){t.IMiniGame12Consts.heroDisplay||IMiniGameMain.reqSocket(1,this.stageData.stageId);var e=t.IMiniGame12Consts.players[i];this.player.setData(e),this.player.y=t.IMiniGame12Consts.roleY,this.player.x=this.width/2,this.player.setMoveArea(0,this.width),this.updateScore(),this.nameLab.text=App.player.playerVo.name,this.headBg.setOutSrc("headBg_"+(i+1)),this.headImg.setOutSrc("headImg_"+(i+1)),this.timeImg.setOutSrc("timeBg"),this.timeLab.text=this.getTime(),this.scoreLab.visible=this.timeLab.visible=this.timeImg.visible=this.headImg.visible=this.nameLab.visible=this.headBg.visible=!0,this.isRunning=!0,DispatcherManager.removeListener(HGEvent.HEARTBEAT,this.timeFun,this),DispatcherManager.addListener(HGEvent.HEARTBEAT,this.timeFun,this)},e.prototype.setResult=function(i){this.isRunning=!1,i?(t.IMiniGame12Consts.extraNum=this.allScore,App.sound.playEff(t.IMiniGame12Consts.minigame12_win),IMiniGameMain.reqSocket(3)):App.sound.playEff(t.IMiniGame12Consts.minigame12_die),i?t.IMiniGameResult.showResult(IMiniGameResultType.type_1,this.onCloseClick,this,3,0/0,t.IMiniGame12Consts.extra,t.IMiniGame12Consts.extraNum):t.IMiniGameResult.showResult(IMiniGameResultType.type_0,this.updateView,this)},e.prototype.getTime=function(){var t=Math.floor(this.time/60);t=t>=10?t:"0"+t;var i=this.time%60;return i=i>=10?i:"0"+i,t+":"+i||""},e.prototype.timeFun=function(){if(this.isRunning&&!this.isPause){if(this.time++,this.timeLab.text=this.getTime(),this.stageData.gameTime&&this.time>=this.stageData.gameTime)return void this.setResult(!1);if(this.time>=this.stageData.time)return this.endImg.visible=!0,void IMiniGameMain.reqSocket(2);var i=this.stageData.monsters[this.time];if(i){t.IMiniGame12.setDefMonsterVo(i);for(var e=0,s=i;e<s.length;e++){var h=s[e];if(h.monProp)for(var a=void 0,n=void 0,o=0,r=h.monProp;o<r.length;o++){var l=r[o];a=l.index,n=l.specPetIndex||0;var p=t.IMiniGame12Consts.specs[a];if(l.specPet&&l.specPet[n]&&p.specPet&&p.specPet[n])for(var c in p.specPet[n])void 0==l.specPet[n][c]&&(l.specPet[n][c]=p.specPet[n][c]);for(var u in p)void 0==l[u]&&(l[u]=p[u])}}this.createMonster(i)}var d=this.stageData.specs[this.time];d&&(t.IMiniGame12.setDefSpecVo(d,this.time),this.createSpec(d)),this.checkBoss()}},e.prototype.checkBoss=function(){if(this.stageData.boss){var i=this.stageData.boss.bossTime;this.time==i&&(this.bossMovie.visible=!1,this.bossMovie.setLoadCompleteBack(this.showBossMovie,this),this.bossMovie.start(t.IMiniGame12Consts.bossMovie,1),this.bossMovie.autoRun())}},e.prototype.showBossMovie=function(){var i=this;this.bossMovie.visible=!0,this.bossMovie.x=this.width+this.bossMovie.width,this.bossMovie.y=this.height/3,App.sound.playEff(t.IMiniGame12Consts.minigame12_boss);var e=(this.width-this.bossMovie.width)/2;egret.Tween.get(this.bossMovie).to({x:e},500).wait(500).call(function(){i.createBoss()},this).to({x:-this.bossMovie.width},500).call(function(){i.bossMovie&&i.bossMovie.stop()},this)},e.prototype.createBoss=function(){this.boss||(this.boss=GObj.create(t.IMiniGame12Monster)),this.boss.reset(),this.boss.isBoss=!0,this.boss.y=this.stageData.boss.monsterY||400,this.boss.x=this.stageData.boss.monsterX||this.width/2,this.boss.setData(this.stageData.boss),this.boss.stageImgV(!1),this.avatarGrp.addChild(this.boss)},e.prototype.update=function(){this.isRunning&&(this.playerRun(),this.bulletRun(),this.isPause||(this.mapMove(),this.checkEnd(),this.monsterRun(),this.specRun(),this.hitEffRun(),this.hitBoss(),this.bulletCollisionMon()))},e.prototype.hitBoss=function(){var i=this;if(this.boss)for(var e,s,h,a=this.boss.x-this.boss.width/2,n=this.boss.x+this.boss.width/2,o=0;o<this.bulletArr.length&&this.boss;o++)if(h=this.bulletArr[o],e=h.x-h.anchorOffsetX,s=h.x+h.anchorOffsetX,n>e&&s>a&&Math.abs(this.boss.y-h.y)<=10){h.died();var r=this.boss.setHit(h.hurt);if(r){var l={atkx:this.boss.x,atky:this.boss.y,eff:t.IMiniGame12Consts.dieEff};this.hitEffAddToScene(l),this.backBoss()}else{var l={atkx:this.boss.x,atky:this.boss.y,eff:t.IMiniGame12Consts.hitEff};this.hitEffAddToScene(l)}this.allScore+=h.hurt,this.updateScore(),h.isPet||App.sound.playEff(t.IMiniGame12Consts.minigame12_hit),this.isHaveHit=!0,egret.Tween.removeTweens(this),egret.Tween.get(this).wait(100).call(function(){i.isHaveHit=!1})}},e.prototype.mapMove=function(){for(var t=0;t<this.bgArr.length;t++){var i=this.bgArr[t];i.y=i.y+this.mapSpeed,i.y>=StageManager.stageHeight&&(i.y-=3*this.oneBgH)}},e.prototype.checkEnd=function(){this.endImg.visible&&(this.boss||(this.endImg.y+=this.mapSpeed),this.isRunning&&this.endImg.y>=this.player.y&&this.setResult(!0))},e.prototype.playerRun=function(){if(this.player){var t=this.player.run();this.isRocker||this.player.setMove(this.isMoved),t&&this.createBullet(),0!=this.player.getPetsArr().length&&this.createBullet(!0)}},e.prototype.createBullet=function(i){if(void 0==i){this.isHaveHit||App.sound.playEff(t.IMiniGame12Consts.minigame12_attack);for(var e=this.player.trackNum,s=this.player.getBulletModel(),h=Math.floor(e/2),a=e%2==0,n=[],o=-h;h>=o;o++)0!=o?n.push(o):a||n.push(0);
for(var r=50,o=0;o<n.length;o++){var l=n[o],p=void 0;p=this.getBulletObj(),a?1==Math.abs(l)?p.x=this.player.x+l*(r/2):p.x=this.player.x+l*r-l/Math.abs(l)*r/2:p.x=this.player.x+l*r,p.y=this.player.getCollisionPoint()[0].y,s.length>o?p.setData(this.player,s[o]):p.setData(this.player),this.bulletArr.push(p)}}else{this.petPoint||(this.petPoint=GObj.create(egret.Point));for(var c=this.player.getPetsArr(),u=c.length,p=void 0,d=void 0,o=0;u>o;o++)d=c[o],d.getCanAtk()&&(p=this.getBulletObj(),this.player.localToGlobal(d.x,d.y,this.petPoint),p.x=this.petPoint.x-(StageManager.stageWidth-this.width)/2,p.y=this.petPoint.y-d.fixHeight*d.scaleY-30,p.setData(d),this.bulletArr.push(p))}},e.prototype.bulletRun=function(){var t=this.bulletArr.length;if(0!=t)for(var i,e=0;t>e;e++)i=this.bulletArr[e],i&&(i.isCanRemove()?(this.bulletArr.splice(e,1),e--,this.backBulletObj(i)):i.run())},e.prototype.getBulletObj=function(){var i=this.bulletPool.pop();return i||(i=GObj.create(t.IMiniGame12Bullet)),this.avatarGrp.addChild(i),i},e.prototype.backBulletObj=function(t){t&&-1==this.bulletPool.indexOf(t)&&(t.reset(),t.parent&&t.parent.removeChild(t),this.bulletPool.push(t))},e.prototype.createMonster=function(i){for(var e=i.length,s=0;e>s;s++){var h=void 0;h=this.getMonsterObj(),h.y=-50,i[s].monsterX?h.x=i[s].monsterX:h.x=i[s].monLR?t.IMiniGame12Consts.monRight:t.IMiniGame12Consts.monLeft,h.setData(i[s]),this.monsterArr.push(h)}},e.prototype.monsterRun=function(){var i=this.monsterArr.length;if(0!=i)for(var e,s=0;i>s;s++)if(e=this.monsterArr[s])if(e.isCanRemove()){var h={atkx:e.x,atky:e.y,eff:t.IMiniGame12Consts.dieEff};this.hitEffAddToScene(h),this.monsterArr.splice(s,1),s--,this.backMonsterObj(e)}else if(e.run(),!this.player.isDie()&&!e.isDie()){var a=this.player.getCollisionPoint(),n=a[0].x,o=a[1].x,r=a[0].y;a=e.getCollisionPoint();var l=a[0].x,p=a[1].x,c=a[0].y;if(c-r>=0&&50>=c-r&&(n>=l&&p>=n||o>=l&&p>=o)){this.player.died();var h={atkx:this.player.x,atky:this.player.y,eff:t.IMiniGame12Consts.dieEff};this.hitEffAddToScene(h),this.setResult(!1)}}},e.prototype.getMonsterObj=function(){var i=this.monsterPool.pop();return i||(i=GObj.create(t.IMiniGame12Monster)),this.avatarGrp.addChild(i),i},e.prototype.backMonsterObj=function(t){t&&-1==this.monsterPool.indexOf(t)&&(t.reset(),t.parent&&t.parent.removeChild(t),this.monsterPool.push(t))},e.prototype.bulletCollisionMon=function(){for(var i,e,s,h=this,a=0;a<this.bulletArr.length;a++){s=this.bulletArr[a],i=s.x-s.anchorOffsetX,e=s.x+s.anchorOffsetX;for(var n=0;n<this.monsterArr.length;n++){var o=this.monsterArr[n];if(!o.isDie()){var r=o.getCollisionPoint(),l=r[0].x,p=r[1].x,c=r[0].y;if((i>=l&&p>=i||e>=l&&p>=e)&&Math.abs(c-s.y)<=10){s.died();var u=o.setHit(s.hurt);if(u){if(o.data.monProp){for(var d in o.data.monProp)this.player.addBySpec(o.data.monProp[d]);var m={atkx:this.player.x,atky:this.player.y,eff:t.IMiniGame12Consts.addEff};this.hitEffAddToScene(m)}if(-1!=this.player.getSkill().indexOf(Spec12Type.TYPE_10)){var g={atkx:o.x,atky:o.y,eff:t.IMiniGame12Consts.huo};this.checkHire(g)}}else{var m={atkx:o.x,atky:o.y,eff:t.IMiniGame12Consts.hitEff};if(this.hitEffAddToScene(m),-1!=this.player.getSkill().indexOf(Spec12Type.TYPE_9)&&Math.floor(100*Math.random())<t.IMiniGame12Consts.specs[Spec12Type.TYPE_9].num){m.eff=t.IMiniGame12Consts.dian,this.hitEffAddToScene(m);var f=0,b=t.IMiniGame12Consts.specs[Spec12Type.TYPE_9].hurt;b&&(f=1==b.length?b[0]:b[0]+Math.floor(Math.random()*(b[1]-b[0]+1)),this.allScore+=f,u=o.setHit(f),u&&this.checkHire(m))}}this.allScore+=s.hurt,this.updateScore(),s.isPet||App.sound.playEff(t.IMiniGame12Consts.minigame12_hit),this.isHaveHit=!0,egret.Tween.removeTweens(this),egret.Tween.get(this).wait(100).call(function(){h.isHaveHit=!1})}}}}},e.prototype.checkHire=function(i){if(-1!=this.player.getSkill().indexOf(Spec12Type.TYPE_10)){i.eff=t.IMiniGame12Consts.huo,this.hitEffAddToScene(i);var e=t.IMiniGame12Consts.specs[Spec12Type.TYPE_10].num,s=0,h=t.IMiniGame12Consts.specs[Spec12Type.TYPE_10].hurt;h&&(s=1==h.length?h[0]:h[0]+Math.floor(Math.random()*(h[1]-h[0]+1)));for(var a,n,o=0;o<this.monsterArr.length;o++)n=this.monsterArr[o],a=GMath.distance(i.atkx,i.atky,n.x,n.y),e>a&&!n.isDie()&&(n.setHit(s),this.allScore+=s)}},e.prototype.createSpec=function(i){for(var e=i.length,s=0;e>s;s++){var h=void 0;h=this.getSpecObj(),h.setData(i[s]),h.y=0,i[s].specX?h.x=i[s].specX:h.x=i[s].specLR?t.IMiniGame12Consts.specRight:t.IMiniGame12Consts.specLeft,i[s].type11_name&&h.setFun(this,this.openSkill),this.specArr.push(h)}},e.prototype.specRun=function(){var i=this.specArr.length;if(0!=i)for(var e,s=0;i>s;s++)if(e=this.specArr[s])if(e.isCanRemove())this.specArr.splice(s,1),s--,this.backSpecObj(e);else if(e.run(),!e.getIsPick()&&!this.player.isDie()){var h=this.player.getCollisionPoint(),a=h[0].x,n=h[1].x,o=this.player.y,r=this.localToGlobal(a,o),l=this.localToGlobal(n,o);if(e.hitTestPoint(r.x,r.y)||e.hitTestPoint(l.x,l.y)){e.setPick(),this.setSpecTimeOfPick(e.data.specTime),this.player.addBySpec(e.data);var p="";e.data.specEff?(p=t.IMiniGame12Consts.addEff,App.sound.playEff(t.IMiniGame12Consts.minigame12_add)):(p=t.IMiniGame12Consts.reduceEff,App.sound.playEff(t.IMiniGame12Consts.minigame12_reduce));var c={atkx:this.player.x,atky:this.player.y,eff:p};this.hitEffAddToScene(c)}}},e.prototype.setSpecTimeOfPick=function(t){var i=this.specArr.length;if(0!=i)for(var e,s=0;i>s;s++)e=this.specArr[s],e&&e.data.specTime==t&&e.setPick(!1)},e.prototype.getSpecObj=function(){var i=this.specPool.pop();return i||(i=GObj.create(t.IMiniGame12Spec)),this.avatarGrp.addChildAt(i,0),i},e.prototype.backSpecObj=function(t){t&&-1==this.specPool.indexOf(t)&&(t.reset(),t.parent&&t.parent.removeChild(t),this.specPool.push(t))},e.prototype.hitEffAddToScene=function(t){var i=this.gethitEffObj();i.x=t.atkx,i.y=t.atky,i.start(t.eff,1),this.hitEffIn.push(i),this.hitEffGrp.addChild(i)},e.prototype.gethitEffObj=function(){var i=this.hitEffPool.pop();return i||(i=GObj.create(t.IMovie)),i},e.prototype.backHitEffObj=function(t){t&&-1==this.hitEffPool.indexOf(t)&&(t.parent&&t.parent.removeChild(t),this.hitEffPool.push(t))},e.prototype.hitEffRun=function(){var t=this.hitEffIn.length;if(0!=t)for(var i=0;t>i;i++){var e=this.hitEffIn[i];e&&(e.run(),e.isOver&&(this.hitEffIn.splice(i,1),i--,this.backHitEffObj(e)))}},e.prototype.dispose=function(){this.timeImg&&egret.Tween.removeTweens(this.timeImg),this.removeEvent(),this.backBoss(),this.bossMovie&&(GObj.disposeObject(this.bossMovie),this.bossMovie=null),egret.Tween.removeTweens(this),GObj.disposeObject(this.exitBtn),this.exitBtn=null,this.arrowImg&&egret.Tween.removeTweens(this.arrowImg),GObj.disposeObject(this.arrowImg),this.arrowImg=null,GObj.disposeObject(this.touchMask),this.touchMask=null;for(var t in this.bgArr)GObj.disposeObject(this.bgArr[t]),this.bgArr[t]=null;this.bgArr=null,GObj.disposeObject(this.endImg),this.endImg=null,GObj.disposeObject(this.avatarGrp),this.avatarGrp=null,GObj.disposeObject(this.player),this.player=null,GObj.disposeObject(this.hitEffGrp),this.hitEffGrp=null;for(var t in this.bulletArr)GObj.disposeObject(this.bulletArr[t]),this.bulletArr[t]=null;this.bulletArr=null;for(var t in this.bulletPool)GObj.disposeObject(this.bulletPool[t]),this.bulletPool[t]=null;this.bulletPool=null;for(var t in this.monsterArr)GObj.disposeObject(this.monsterArr[t]),this.monsterArr[t]=null;this.monsterArr=null;for(var t in this.monsterPool)GObj.disposeObject(this.monsterPool[t]),this.monsterPool[t]=null;this.monsterPool=null;for(var t in this.specArr)GObj.disposeObject(this.specArr[t]),this.specArr[t]=null;this.specArr=null;for(var t in this.specPool)GObj.disposeObject(this.specPool[t]),this.specPool[t]=null;this.specPool=null;for(var e=0,s=this.hitEffPool;e<s.length;e++){var h=s[e];GObj.disposeObject(h)}this.hitEffPool=null;for(var a=0,n=this.hitEffIn;a<n.length;a++){var h=n[a];GObj.disposeObject(h)}this.hitEffIn=null,this.skillData=null,GObj.disposeObject(this.headBg),this.headBg=null,this.uiGrp&&(GObj.disposeObject(this.uiGrp),this.uiGrp=null),this.uiRect&&(GObj.disposeObject(this.uiRect),this.uiRect=null),this.tempoint&&(this.tempoint=null),GObj.disposeObject(this.headImg),this.headImg=null,GObj.disposeObject(this.nameLab),this.nameLab=null,GObj.disposeObject(this.scoreLab),this.scoreLab=null,GObj.disposeObject(this.timeImg),this.timeImg=null,GObj.disposeObject(this.skillView),this.skillView=null,GObj.disposeObject(this.timeLab),this.timeLab=null,this.rockerBg&&GObj.disposeObject(this.rockerBg),this.rockerBg=null,this.rocker&&GObj.disposeObject(this.rocker),this.rocker=null,GObj.disposeObject(this.skillGroup),this.skillGroup=null,GObj.disposeObject(this.skillbg),this.skillbg=null,GObj.disposeObject(this.skillIcon),this.skillIcon=null,this.stageData=null,i.prototype.dispose.call(this)},e}(t.IBaseView);t.IMiniGame12View=i,__reflect(i.prototype,"miniGame.IMiniGame12View")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(t){return i.call(this,t)||this}return __extends(e,i),e.prototype.getGameView=function(){return this.gameView||(this.gameView=GObj.create(t.IMiniGame13View)),this.gameView.setData(this.gameData.funny,this.configData.config),this.gameView},e.prototype.loadConfigComplete=function(e){if(e)for(var s in e.config)t.IMiniGame13Consts[s]=e.config[s];i.prototype.loadConfigComplete.call(this,e)},e.prototype.getMiniGameView=function(){return this.configData?(this.gameView||this.getGameView(),this.gameView):null},e.prototype.onExitBtnClick=function(t){this.gameView&&this.gameView.isPassNew&&this.gameView.sendData(),i.prototype.onExitBtnClick.call(this,t)},e}(t.IMiniGameBaseCtr);t.IMiniGame13=i,__reflect(i.prototype,"miniGame.IMiniGame13")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.skinName=t.getSkin(),t}return __extends(e,i),e.prototype.getSkin=function(){var i=this,e=GObj.create(eui.Skin);e.skinParts=["mcDisplay"];var s=GObj.create(t.ImageOutside);s.touchEnabled=!1,s.loadCompleteCall(function(){i.width=i.iconDisplay.iconWidth,i.height=i.iconDisplay.iconHeight},this),s.horizontalCenter=0,s.verticalCenter=0,this.iconDisplay=s;var h=GObj.create(eui.Label);h.touchEnabled=!1,h.horizontalCenter=10,h.y=30,h.size=18,h.textColor=16777215,h.text="",this.labelDisplay=h;var a=GObj.create(eui.Label);a.horizontalCenter=0,a.y=5,a.size=18,a.textColor=16777215,this.gradeLab=a;var n=GObj.create(t.ImageOutside);return n.horizontalCenter=-40,n.y=28,this.goldImg=n,e.icon=s,e.label=h,e.gradeLab=a,e.goldImg=n,e.elementsContent=[s],e.states=[new eui.State("up",[]),new eui.State("down",[new eui.SetProperty("label","scaleX",.92),new eui.SetProperty("label","scaleY",.92),new eui.SetProperty("label","y",28),new eui.SetProperty("icon","scaleX",.92),new eui.SetProperty("icon","scaleY",.92),new eui.SetProperty("gradeLab","scaleX",.92),new eui.SetProperty("gradeLab","scaleY",.92),new eui.SetProperty("gradeLab","y",7),new eui.SetProperty("goldImg","scaleX",.92),new eui.SetProperty("goldImg","scaleY",.92),new eui.SetProperty("goldImg","horizontalCenter",-36)]),new eui.State("disabled",[])],e},Object.defineProperty(e.prototype,"money",{set:function(t){this.gradeLab&&(this.gradeLab.parent||this.addChild(this.gradeLab),this.gradeLab.text=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"label",{set:function(t){this.labelDisplay&&(this.labelDisplay.parent||this.addChild(this.labelDisplay),this.labelDisplay.text=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"goldIcon",{set:function(t){this.goldImg&&(this.goldImg.parent||this.addChild(this.goldImg),this.goldImg.source=t)},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){i.prototype.dispose.call(this),GObj.disposeObject(this.goldImg),this.goldImg=null,GObj.disposeObject(this.gradeLab),this.gradeLab=null},e}(t.IBaseBtn);t.IMiniGame13Btn=i,__reflect(i.prototype,"miniGame.IMiniGame13Btn")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.once(egret.Event.REMOVED_FROM_STAGE,t.dispose,t),t}return __extends(e,i),e.prototype.initSkins=function(){this.width=439,this.height=141,this.bgImg=GObj.create(t.ImageOutside),this.bgImg.setOutSrc("item",FileConst.png),this.bgImg.width=this.width,this.bgImg.height=this.height,this.addChild(this.bgImg),this.quaImg=GObj.create(t.ImageOutside),this.quaImg.x=38,this.quaImg.verticalCenter=2,this.quaImg.setOutSrc("quality",FileConst.png),this.addChild(this.quaImg),this.kunImg=GObj.create(t.ImageOutside),this.kunImg.x=41,this.kunImg.verticalCenter=2,this.addChild(this.kunImg),this.buyBtn=GObj.create(t.IMiniGame13Btn),this.buyBtn.icon=IMiniGameMain.getIcon("btn_3",FileConst.png),this.buyBtn.x=300,this.buyBtn.verticalCenter=0,this.buyBtn.labelDisplay.textColor=7353348,this.buyBtn.labelDisplay.horizontalCenter=8,this.buyBtn.labelDisplay.verticalCenter=0,this.buyBtn.goldIcon=IMiniGameMain.getIcon("gold",FileConst.png),this.buyBtn.goldImg.verticalCenter=0,this.addChild(this.buyBtn),this.gradeLab=GObj.create(eui.Label),this.gradeLab.x=150,this.gradeLab.y=50,this.gradeLab.textColor=7353348,this.addChild(this.gradeLab),this.moneyLab=GObj.create(eui.Label),this.moneyLab.x=150,this.moneyLab.y=80,this.moneyLab.textColor=7353348,this.addChild(this.moneyLab),this.lockBtn=GObj.create(t.IBaseBtn),this.lockBtn.x=300,this.lockBtn.verticalCenter=0,this.lockBtn.icon=IMiniGameMain.getIcon("btn_4",FileConst.png),this.lockBtn.labelDisplay.textColor=6314586,this.lockBtn.label=IMiniGameMain.getString(t.IMiniGame13Consts.lang[12]),this.addChild(this.lockBtn),this._shpBeMask=GObj.create(egret.Shape),this._shpBeMask.graphics.beginFill(7434327),this._shpBeMask.graphics.drawRect(0,0,78,78),this._shpBeMask.graphics.endFill(),this._shpBeMask.x=41,this._shpBeMask.y=34,this._shpBeMask.mask=this.kunImg,this.addEvent()},e.prototype.addEvent=function(){this.buyBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.__buyBtnHandler,this),this.lockBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.__lockBtnHandler,this)},e.prototype.removeEvent=function(){this.buyBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.__buyBtnHandler,this),this.lockBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.__lockBtnHandler,this)},e.prototype.dataChanged=function(){if(i.prototype.dataChanged.call(this),this.initSkins(),this.data){this.vo=this.data.vo,this.kunVo=this.data.kunsVo,this.yesCall=this.data.call,this.thisObj=this.data.thisObj,this.kunImg.setOutSrc("icon/"+t.IMiniGame13Consts.kun[this.kunVo.grade].img),this.gradeLab.text=IMiniGameMain.getString(t.IMiniGame13Consts.lang[10],this.kunVo.grade),this.moneyLab.text=IMiniGameMain.getString(t.IMiniGame13Consts.lang[11],this.kunVo.money);var e=this.getBuyKunData(this.kunVo.grade).price;this.buyBtn.label=IMiniGameMain.numberToStr(e,1),this.kunVo.grade>this.vo.top&&1!=this.kunVo.grade?(this.lockBtn.visible=!0,this.buyBtn.visible=!1,this.addChild(this._shpBeMask)):this.kunVo.grade>this.vo.top-t.IMiniGame13Consts.unlockGap&&1!=this.kunVo.grade?(this.lockBtn.visible=!0,this.buyBtn.visible=!1,this._shpBeMask.mask=null):(this.lockBtn.visible=!1,this.buyBtn.visible=!0,this._shpBeMask.mask=null)}},e.prototype.getBuyKunData=function(t){var i={},e=this.vo.kunsBuyTimesVo?this.vo.kunsBuyTimesVo[t]:0,s=this.kunVo;return i.price=s.price+s.add*e,i.grade=t,i.buyTimes=e,i.isLock=!1,i.speed=s.seconds,i.money=s.money,i.sell=s.sell,i.qua=s.qua,i},e.prototype.__buyBtnHandler=function(){this.yesCall&&this.yesCall.call(this.thisObj,this.kunVo.grade),IMiniGameMain.playEff(t.IMiniGame13Consts.minigame_btn)},e.prototype.__lockBtnHandler=function(){IMiniGameMain.playEff(t.IMiniGame13Consts.minigame_btn),App.msgtip.show(t.IMiniGame13Consts.lang[12])},e.prototype.dispose=function(){this.removeEvent(),this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.dispose,this),GObj.disposeObject(this.bgImg),this.bgImg=null,GObj.disposeObject(this.quaImg),this.quaImg=null,GObj.disposeObject(this.kunImg),this.kunImg=null,GObj.disposeObject(this.buyBtn),this.buyBtn=null,GObj.disposeObject(this.gradeLab),this.gradeLab=null,GObj.disposeObject(this.moneyLab),this.moneyLab=null,GObj.disposeObject(this.lockBtn),this.lockBtn=null,GObj.disposeObject(this._shpBeMask),this._shpBeMask=null,this.vo=null,this.kunVo=null,this.yesCall=null,this.thisObj=null},e}(eui.ItemRenderer);t.IMiniGame13BuyItem=i,__reflect(i.prototype,"miniGame.IMiniGame13BuyItem")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){return null!==i&&i.apply(this,arguments)||this}return __extends(e,i),e.prototype.initSkins=function(){this.horizontalCenter=0,this.verticalCenter=0,this.width=540,this.height=706,this.bgRect=GObj.create(eui.Rect),this.bgRect.horizontalCenter=0,this.bgRect.verticalCenter=0,this.bgRect.alpha=.8,this.bgRect.width=StageManager.stageWidth,this.bgRect.height=StageManager.stageHeight,this.addChild(this.bgRect),this.group=GObj.create(eui.Group),this.group.width=this.width,this.group.height=this.height,this.group.horizontalCenter=0,this.group.verticalCenter=0,this.group.scaleX=.6,this.group.scaleY=.6,this.addChild(this.group),this.bgImg=GObj.create(t.ImageOutside),this.bgImg.setOutSrc("shop_bg",FileConst.png),this.bgImg.horizontalCenter=0,this.bgImg.verticalCenter=0,this.group.addChild(this.bgImg),this.goldBg=GObj.create(t.ImageOutside),this.goldBg.setOutSrc("img_5",FileConst.png),this.goldBg.horizontalCenter=0,this.goldBg.y=115,this.group.addChild(this.goldBg),this.goldImg=GObj.create(t.ImageOutside),this.goldImg.setOutSrc("gold",FileConst.png),this.goldImg.x=190,this.goldImg.y=115,this.group.addChild(this.goldImg),this.goldLab=GObj.create(eui.Label),this.goldLab.horizontalCenter=0,this.goldLab.y=118,this.group.addChild(this.goldLab),this.closeBtn=GObj.create(t.IBaseBtn),this.closeBtn.icon=IMiniGameMain.getIcon("close_btn",FileConst.png),this.closeBtn.x=470,this.closeBtn.y=60,this.group.addChild(this.closeBtn),this.scro=GObj.create(eui.Scroller),this.group.addChild(this.scro),this.listData=GObj.create(eui.ArrayCollection),this.list=GObj.create(eui.List),this.list.dataProvider=this.listData,this.list.itemRenderer=t.IMiniGame13BuyItem,this.scro.viewport=this.list,egret.Tween.get(this.group).to({scaleX:1,scaleY:1},200),this.isOpen=!0,this.setLayout(),this.addEvent()},e.prototype.setLayout=function(){this.scro.horizontalCenter=-2,this.scro.y=147,this.scro.width=439,this.scro.height=500;var t=GObj.create(eui.VerticalLayout);t.gap=-6,this.list.layout=t},e.prototype.addEvent=function(){this.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.__closeBtnHandler,this)},e.prototype.removeEvent=function(){this.closeBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.__closeBtnHandler,this)},e.prototype.show=function(t,i,e,s){this.initSkins(),this.goldLab.text=IMiniGameMain.numberToStr(t.money,1),this.listData.source.length=0;var h=[];for(var a in i){var n={};n.vo=t,n.kunsVo=i[a],n.call=e,n.thisObj=s,h.push(n)}this.listData.replaceAll(h),this.yesCall=e,this.thisObj=s},e.prototype.updateData=function(t,i){this.listData.source.length=0;var e=[];for(var s in i){var h={};h.vo=t,h.kunsVo=i[s],h.call=this.yesCall,h.thisObj=this.thisObj,e.push(h)}this.listData.replaceAll(e)},e.prototype.setMoney=function(t){this.goldLab.text=t},e.prototype.__closeBtnHandler=function(){this.isOpen=!1,IMiniGameMain.playEff(t.IMiniGame13Consts.minigame_btn),GObj.disposeObject(this)},e.prototype.dispose=function(){this.removeEvent(),GObj.disposeObject(this.bgRect),this.bgRect=null,GObj.disposeObject(this.group),this.group=null,GObj.disposeObject(this.bgImg),this.bgImg=null,GObj.disposeObject(this.goldImg),this.goldImg=null,GObj.disposeObject(this.goldLab),this.goldLab=null,GObj.disposeObject(this.closeBtn),this.closeBtn=null,GObj.disposeObject(this.scro),this.scro=null,this.yesCall=null,this.thisObj=null,this.price=null},e}(eui.Component);t.IMiniGame13BuyPop=i,__reflect(i.prototype,"miniGame.IMiniGame13BuyPop")}(miniGame||(miniGame={}));var miniGame;!function(t){t.IMiniGame13Consts={maxLevel:10,maxCount:10,unlockGap:1,initMoney:2,offlineHours:12,maxMoney:9999e8,shopLevel:2,kun:{},lang:{},UI_YUNWU:"ui_yunwu",UI_HECHENG:"ui_hecheng",UI_CHUXIAN1:"ui_chuxian1",minigame_bgm:"game13_minigame_bgm",minigame_gold:"game13_minigame_gold",minigame_btn:"game13_minigame_btn",minigame_upgrade:"game13_minigame_upgrade",minigame_put:"game13_minigame_put",minigame_sell:"game13_minigame_sell"}}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var e=i.call(this)||this;return e.goldImg=GObj.create(t.ImageOutside),e.addChild(e.goldImg),e.goldLab=GObj.create(eui.Label),e.goldLab.x=25,e.goldLab.size=22,e.goldLab.textColor=16777215,e.goldLab.stroke=2,e.goldLab.strokeColor=1275078,e.addChild(e.goldLab),e.touchEnabled=!1,e.touchChildren=!1,e}return __extends(e,i),e.prototype.setData=function(t){this.goldImg.setOutSrc("gold",FileConst.png),this.goldLab.text=t},e.prototype["do"]=function(){var t=this;egret.Tween.get(this).to({y:360,alpha:0},1e3).call(function(){GObj.disposeObject(t)})},e.prototype.dispose=function(){egret.Tween.removeTweens(this),GObj.disposeObject(this.goldImg),this.goldImg=null,GObj.disposeObject(this.goldLab),this.goldLab=null},e}(eui.Component);t.IMiniGame13GoldUp=i,__reflect(i.prototype,"miniGame.IMiniGame13GoldUp")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){return null!==i&&i.apply(this,arguments)||this}return __extends(e,i),e.prototype.initSkins=function(){this.horizontalCenter=0,this.verticalCenter=0,this.width=446,this.height=502,this.bgRect=GObj.create(eui.Rect),this.bgRect.horizontalCenter=0,this.bgRect.verticalCenter=0,this.bgRect.alpha=.8,this.bgRect.width=StageManager.stageWidth,this.bgRect.height=StageManager.stageHeight,this.addChild(this.bgRect),this.group=GObj.create(eui.Group),this.group.width=this.width,this.group.height=this.height,this.group.horizontalCenter=0,this.group.verticalCenter=0,this.group.scaleX=.6,this.group.scaleY=.6,this.addChild(this.group),this.bgImg=GObj.create(t.ImageOutside),this.bgImg.horizontalCenter=0,this.bgImg.verticalCenter=0,this.bgImg.setOutSrc("pop_bg",FileConst.png),this.group.addChild(this.bgImg),this.titleImg=GObj.create(t.ImageOutside),this.titleImg.horizontalCenter=0,this.titleImg.y=40,this.titleImg.setOutSrc("offline",FileConst.png),this.group.addChild(this.titleImg),this.nameImg=GObj.create(t.ImageOutside),this.nameImg.horizontalCenter=0,this.nameImg.y=110,this.nameImg.setOutSrc("img_3",FileConst.png),this.group.addChild(this.nameImg),this.moneyLab=GObj.create(eui.Label),this.moneyLab.horizontalCenter=0,this.moneyLab.y=120,this.moneyLab.size=18,this.moneyLab.textColor=16777215,this.group.addChild(this.moneyLab),this.kunImg=GObj.create(t.ImageOutside),this.kunImg.horizontalCenter=0,this.kunImg.y=191,this.group.addChild(this.kunImg),this.timeBg=GObj.create(t.ImageOutside),this.timeBg.horizontalCenter=0,this.timeBg.y=325,this.timeBg.setOutSrc("img_4",FileConst.png),this.group.addChild(this.timeBg),this.timeLab=GObj.create(eui.Label),this.timeLab.horizontalCenter=0,this.timeLab.y=340,this.timeLab.textColor=16777215,this.timeLab.size=18,this.group.addChild(this.timeLab),this.goldLab=GObj.create(eui.Label),this.goldLab.horizontalCenter=0,this.goldLab.y=365,this.goldLab.textColor=4325160,this.group.addChild(this.goldLab),this.bubbleImg=GObj.create(t.ImageOutside),this.bubbleImg.horizontalCenter=0,this.bubbleImg.y=140,this.bubbleImg.setOutSrc("bubble",FileConst.png),this.group.addChild(this.bubbleImg),this.yesBtn=GObj.create(t.IBaseBtn),this.yesBtn.icon=IMiniGameMain.getIcon("btn_3",FileConst.png),this.yesBtn.horizontalCenter=0,this.yesBtn.y=402,this.yesBtn.labelDisplay.textColor=7353348,this.yesBtn.label=IMiniGameMain.getString(t.IMiniGame13Consts.lang[8]),this.group.addChild(this.yesBtn),egret.Tween.get(this.group).to({scaleX:1,scaleY:1},300),this.addEvent()},e.prototype.addEvent=function(){this.yesBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.__yesBtnHandler,this)},e.prototype.removeEvent=function(){this.yesBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.__yesBtnHandler,this)},e.prototype.show=function(i,e){this.initSkins(),this.moneyLab.text=IMiniGameMain.getString(t.IMiniGame13Consts.lang[13],i),this.kunImg.setOutSrc("money_3",FileConst.png),this.timeLab.text=this.lableChange(e),this.goldLab.text=IMiniGameMain.getString(t.IMiniGame13Consts.lang[18],t.IMiniGame13Consts.offlineHours)},e.prototype.lableChange=function(i){if(i>0){var e="",s=int(i/86400),h=int(i%86400/3600),a=int(i%86400%3600/60),n=int(i%86400%3600%60);return e=s>0?IMiniGameMain.getString(t.IMiniGame13Consts.lang[15],s,h):h>0?IMiniGameMain.getString(t.IMiniGame13Consts.lang[16],h,a):IMiniGameMain.getString(t.IMiniGame13Consts.lang[17],a,n),IMiniGameMain.getString(t.IMiniGame13Consts.lang[14],e)}},e.prototype.__yesBtnHandler=function(){IMiniGameMain.playEff(t.IMiniGame13Consts.minigame_btn),GObj.disposeObject(this)},e.prototype.dispose=function(){this.removeEvent(),GObj.disposeObject(this.bgRect),this.bgRect=null,GObj.disposeObject(this.group),this.group=null,GObj.disposeObject(this.bgImg),this.bgImg=null,GObj.disposeObject(this.titleImg),this.titleImg=null,GObj.disposeObject(this.nameImg),this.nameImg=null,GObj.disposeObject(this.moneyLab),this.moneyLab=null,GObj.disposeObject(this.kunImg),this.kunImg=null,GObj.disposeObject(this.timeBg),this.timeBg=null,GObj.disposeObject(this.timeLab),this.timeLab=null,GObj.disposeObject(this.bubbleImg),this.bubbleImg=null,GObj.disposeObject(this.yesBtn),this.yesBtn=null,GObj.disposeObject(this.goldLab),this.goldLab=null},e}(eui.Component);t.IMiniGame13OfflinePop=i,__reflect(i.prototype,"miniGame.IMiniGame13OfflinePop")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.initSkins(),t}return __extends(e,i),e.prototype.initSkins=function(){this.width=this.height=64,this.quaImg=GObj.create(t.ImageOutside),this.quaImg.touchEnabled=!1,this.addChild(this.quaImg),this.kunImg=GObj.create(t.ImageOutside),this.addChild(this.kunImg),this.gradeBg=GObj.create(t.ImageOutside),this.gradeBg.x=-6,this.gradeBg.y=-7,this.gradeBg.setOutSrc("grade",FileConst.png),this.addChild(this.gradeBg),this.gradeLab=GObj.create(eui.Label),this.gradeLab.horizontalCenter=-28,this.gradeLab.y=-6,this.gradeLab.touchEnabled=!1,this.gradeLab.size=16,this.addChild(this.gradeLab),this.backImg=GObj.create(t.ImageOutside),this.backImg.x=42,this.backImg.y=42,this.backImg.setOutSrc("back",FileConst.png),this.addChild(this.backImg),this.eff=GObj.create(t.IMovie),this.eff.x=33,this.eff.y=37,this.addChild(this.eff),this.buyEff=GObj.create(t.IMovie),this.buyEff.x=33,this.buyEff.y=37,this.addChild(this.buyEff)},e.prototype.setData=function(i,e){i.grade?(this.kunImg.setOutSrc("items/"+t.IMiniGame13Consts.kun[i.grade].img,FileConst.png),this.vo=i,this.kunImg.alpha=i.isLock?.5:1,this.backImg.visible=i.isLock,this.gradeLab.visible=!0,this.gradeBg.visible=!0,this.gradeLab.text=i.grade.toString()):(this.kunImg.source=null,this.vo=null,this.gradeLab.visible=!1,this.gradeBg.visible=!1,this.backImg.visible=!1),i.qua?this.quaImg.setOutSrc("qua_"+i.qua,FileConst.png):this.quaImg.setOutSrc("qua_1",FileConst.png),this.index=e},e.prototype.show=function(){this.eff.start(t.IMiniGame13Consts.UI_HECHENG,1),this.eff.autoRun(),this.kunImg.visible=!0},e.prototype.hide=function(){this.kunImg.visible=!1},e.prototype.playBuy=function(){this.eff.start(t.IMiniGame13Consts.UI_CHUXIAN1,1),this.eff.autoRun()},e.prototype.checkPos=function(t,i){var e=this,s=e.localToGlobal();return t>s.x&&i>s.y&&t<s.x+e.width&&i<s.y+e.height},e.prototype.dispose=function(){this.eff.unAutoRun(),GObj.disposeObject(this.quaImg),this.quaImg=null,GObj.disposeObject(this.kunImg),this.kunImg=null,GObj.disposeObject(this.gradeBg),this.gradeBg=null,GObj.disposeObject(this.gradeLab),this.gradeLab=null,GObj.disposeObject(this.backImg),this.backImg=null,GObj.disposeObject(this.eff),this.eff=null},e}(eui.Component);t.IMiniGame13SelItem=i,__reflect(i.prototype,"miniGame.IMiniGame13SelItem")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){return null!==i&&i.apply(this,arguments)||this}return __extends(e,i),e.prototype.initSkins=function(){this.horizontalCenter=0,this.verticalCenter=0,this.width=446,this.height=502,this.bgRect=GObj.create(eui.Rect),this.bgRect.horizontalCenter=0,this.bgRect.verticalCenter=0,this.bgRect.alpha=.8,this.bgRect.width=StageManager.stageWidth,this.bgRect.height=StageManager.stageHeight,this.addChild(this.bgRect),this.group=GObj.create(eui.Group),this.group.width=this.width,this.group.height=this.height,this.group.horizontalCenter=0,this.group.verticalCenter=0,this.group.scaleX=.6,this.group.scaleY=.6,this.addChild(this.group),this.bgImg=GObj.create(t.ImageOutside),this.bgImg.setOutSrc("pop_bg",FileConst.png),this.bgImg.horizontalCenter=0,this.bgImg.verticalCenter=0,this.group.addChild(this.bgImg),this.promptImg=GObj.create(t.ImageOutside),this.promptImg.horizontalCenter=0,this.promptImg.y=45,this.promptImg.setOutSrc("tips",FileConst.png),this.group.addChild(this.promptImg),this.kunImg=GObj.create(t.ImageOutside),this.kunImg.horizontalCenter=0,this.kunImg.y=160,this.group.addChild(this.kunImg),this.descBg=GObj.create(t.ImageOutside),this.descBg.horizontalCenter=0,this.descBg.y=325,this.descBg.setOutSrc("img_4",FileConst.png),this.group.addChild(this.descBg),this.descLab=GObj.create(eui.Label),this.descLab.horizontalCenter=0,this.descLab.y=340,this.descLab.textColor=16777215,this.descLab.size=18,this.descLab.lineSpacing=5,this.descLab.textAlign="center",this.group.addChild(this.descLab),this.bubbleImg=GObj.create(t.ImageOutside),this.bubbleImg.horizontalCenter=0,this.bubbleImg.y=125,this.bubbleImg.setOutSrc("bubble",FileConst.png),this.group.addChild(this.bubbleImg),this.yesBtn=GObj.create(t.IBaseBtn),this.yesBtn.icon=IMiniGameMain.getIcon("btn_3",FileConst.png),this.yesBtn.x=230,this.yesBtn.y=400,this.yesBtn.labelDisplay.textColor=7353348,this.yesBtn.label=IMiniGameMain.getString(t.IMiniGame13Consts.lang[8]),this.group.addChild(this.yesBtn),this.noBtn=GObj.create(t.IBaseBtn),this.noBtn.icon=IMiniGameMain.getIcon("btn_3",FileConst.png),this.noBtn.x=90,this.noBtn.y=400,this.noBtn.labelDisplay.textColor=7353348,this.noBtn.label=IMiniGameMain.getString(t.IMiniGame13Consts.lang[9]),this.group.addChild(this.noBtn),egret.Tween.get(this.group).to({scaleX:1,scaleY:1},300),this.addEvent()},e.prototype.addEvent=function(){this.yesBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.__yesBtnHandler,this),this.noBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.__noBtnHandler,this)},e.prototype.removeEvent=function(){this.yesBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.__yesBtnHandler,this),this.noBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.__noBtnHandler,this)},e.prototype.show=function(i,e,s,h){this.initSkins(),this.descLab.textFlow=IMiniGameMain.parserHtml(IMiniGameMain.getString(t.IMiniGame13Consts.lang[1],i)),this.kunImg.setOutSrc("kuns/"+t.IMiniGame13Consts.kun[e].img,FileConst.png),this.yesCall=s,this.thisObj=h,this.price=parseInt(i)},e.prototype.__yesBtnHandler=function(){IMiniGameMain.playEff(t.IMiniGame13Consts.minigame_btn),this.yesCall&&(this.yesCall.call(this.thisObj,this.price),GObj.disposeObject(this))},e.prototype.__noBtnHandler=function(){IMiniGameMain.playEff(t.IMiniGame13Consts.minigame_btn),GObj.disposeObject(this)},e.prototype.dispose=function(){this.removeEvent(),GObj.disposeObject(this.bgRect),this.bgRect=null,GObj.disposeObject(this.group),this.group=null,GObj.disposeObject(this.bgImg),this.bgImg=null,GObj.disposeObject(this.promptImg),this.promptImg=null,GObj.disposeObject(this.kunImg),this.kunImg=null,GObj.disposeObject(this.descBg),this.descBg=null,GObj.disposeObject(this.descLab),this.descLab=null,GObj.disposeObject(this.bubbleImg),this.bubbleImg=null,GObj.disposeObject(this.yesBtn),this.yesBtn=null,GObj.disposeObject(this.noBtn),this.noBtn=null,this.yesCall=null,this.thisObj=null,this.price=null
},e}(eui.Component);t.IMiniGame13SellPop=i,__reflect(i.prototype,"miniGame.IMiniGame13SellPop")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.total=5,t._count=0,t.touchEnabled=!1,t.touchChildren=!1,t._arr=[],t}return __extends(e,i),e.prototype.setData=function(t){this.endPoint=t},e.prototype["do"]=function(){var t=GObj.create(eui.Rect);t.width=127,t.height=75,t.x=0,t.y=100;for(var i=0;i<this.total;i++)ClockManager.setTimeout(this.createItem,this,30*i,t)},e.prototype.createItem=function(i){var e=GObj.create(t.IMinigame13TweenItem);e.x=50,e.y=0,e.anchorOffsetX=11.5,e.anchorOffsetY=11.5,e.scaleX=e.scaleY=.01,this.addChild(e),this._arr.push(e);var s=360*Math.random(),h=100*Math.random(),a=this.getCirclePos2(e.x,e.y,h,s);e.x=Math.max(i.x,Math.min(a.x,i.x+i.width)),e.y=Math.max(i.y,Math.min(a.y,i.y+i.height));var n=GMath.rate(50)?GMath.randomInt(0,30):GMath.randomInt(330,360);e.rotation=n,egret.Tween.get(e).to({scaleX:.7,scaleY:.7,y:a.y-50},500,egret.Ease.backOut).call(this.scaleEnd,this,[e])},e.prototype.getCirclePos2=function(t,i,e,s,h){return this.getCirclePos(t,i,e,this.angleToRadian(s),h)},e.prototype.getCirclePos=function(t,i,e,s,h){var a=h||{x:0,y:0};return a.x=t+Math.cos(s)*e,a.y=i+Math.sin(s)*e,a},e.prototype.angleToRadian=function(t){return t=t||0,t*Math.PI/180},e.prototype.scaleEnd=function(t){this._count++,t.beginPos=GObj.create(egret.Point),t.beginPos.x=t.x,t.beginPos.y=t.y,this._count>=this.total&&this.tween2()},e.prototype.tween2=function(){var t=this._arr,i=this.endPoint;t=t.sort(function(t,i){return t.x-i.x});var e=this.globalToLocal(i.x,i.y);this._count=0;for(var s=0,h=t.length;h>s;s++){var a=t[s];ClockManager.setTimeout(this.move,this,30*s,a,e,s)}},e.prototype.move=function(t,i,e){t.beginPos=GObj.create(egret.Point),t.beginPos.x=t.x,t.beginPos.y=t.y,t.endPos=i,t.anchorPos=GObj.create(egret.Point),t.anchorPos.x=e%2?i.x+GMath.randomInt(150,220):i.x-GMath.randomInt(80,160),i.y>t.y?t.anchorPos.y=i.y-100:t.anchorPos.y=i.y+100,egret.Tween.get(t).to({curveTo:1,scaleY:1},1e3,egret.Ease.cubicIn).call(this.moveEnd,this,[t])},e.prototype.moveEnd=function(t){GObj.disposeObject(t),t=null,this._count++;var i=this.parent.parent;i.goldImg&&i.goldLab&&(egret.Tween.get(i.goldLab).to({scaleX:1.1,scaleY:1.1},200).to({scaleX:1,scaleY:1},200),egret.Tween.get(i.goldImg).to({scaleX:1.1,scaleY:1.1},200).to({scaleX:1,scaleY:1},200),i.updateData()),this._arr&&this._count==this._arr.length&&GObj.disposeObject(this)},e.prototype.dispose=function(){GObj.disposeObject(this._arr),this._arr=null},e}(eui.Component);t.IMinigame13Tween=i,__reflect(i.prototype,"miniGame.IMinigame13Tween")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var e=i.call(this)||this;return e._isFirst=!0,e._iconView=GObj.create(t.ImageOutside),e._iconView.setOutSrc("gold",FileConst.png),e.addChild(e._iconView),e._t=0,e._startTime=GApp.timer,e._flowy=GMath.randomInt(5,8),e.exact=!0,e.addEvent(),e}return __extends(e,i),e.prototype.addEvent=function(){EnterFrameManager.instance.registeRender(this.__enterFrameHandler,this)},e.prototype.removeEvent=function(){EnterFrameManager.instance.unRegisteRender(this.__enterFrameHandler,this)},e.prototype.__enterFrameHandler=function(){if(this.beginPos){var t=GApp.timer+this._startTime,i=t%1300;this.y=this.beginPos.y+Math.sin(i*(2*Math.PI/1300))*this._flowy}},Object.defineProperty(e.prototype,"curveTo",{get:function(){return this._t},set:function(t){this.beginPos&&this.endPos&&this.anchorPos&&(this.removeEvent(),this._isFirst&&(this.beginPos.y=this.y,this._isFirst=!1),this._t=t,this.x=GEase.bezier(this.beginPos.x,this.anchorPos.x,this.endPos.x,t),this.y=GEase.bezier(this.beginPos.y,this.anchorPos.y,this.endPos.y,t))},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this.removeEvent(),this.parent&&this.parent.removeChild(this),GObj.disposeObject(this._iconView),this._iconView=null,GObj.disposeObject(this.beginPos),this.beginPos=null,GObj.disposeObject(this.endPos),this.endPos=null,GObj.disposeObject(this.anchorPos),this.anchorPos=null,GObj.disposeObject(this._t),this._t=null,GObj.disposeObject(this._startTime),this._startTime=null,GObj.disposeObject(this._flowy),this._flowy=null,GObj.disposeObject(this._isFirst),this._isFirst=null},e}(egret.DisplayObjectContainer);t.IMinigame13TweenItem=i,__reflect(i.prototype,"miniGame.IMinigame13TweenItem")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){return null!==i&&i.apply(this,arguments)||this}return __extends(e,i),e.prototype.initSkins=function(){this.horizontalCenter=0,this.verticalCenter=0,this.width=446,this.height=502,this.bgRect=GObj.create(eui.Rect),this.bgRect.horizontalCenter=0,this.bgRect.verticalCenter=0,this.bgRect.alpha=.8,this.bgRect.width=StageManager.stageWidth,this.bgRect.height=StageManager.stageHeight,this.addChild(this.bgRect),this.group=GObj.create(eui.Group),this.group.width=this.width,this.group.height=this.height,this.group.horizontalCenter=0,this.group.verticalCenter=0,this.group.scaleX=.6,this.group.scaleY=.6,this.addChild(this.group),this.bgImg=GObj.create(t.ImageOutside),this.bgImg.horizontalCenter=0,this.bgImg.verticalCenter=0,this.bgImg.setOutSrc("pop_bg",FileConst.png),this.group.addChild(this.bgImg),this.titleImg=GObj.create(t.ImageOutside),this.titleImg.horizontalCenter=0,this.titleImg.y=50,this.titleImg.setOutSrc("unlock",FileConst.png),this.group.addChild(this.titleImg),this.nameImg=GObj.create(t.ImageOutside),this.nameImg.horizontalCenter=0,this.nameImg.y=110,this.nameImg.setOutSrc("img_3",FileConst.png),this.group.addChild(this.nameImg);var i=GObj.create(eui.HorizontalLayout);i.gap=4,i.horizontalAlign="center",i.verticalAlign="middle",this.nameGroup=GObj.create(eui.Group),this.nameGroup.horizontalCenter=0,this.nameGroup.y=120,this.nameGroup.layout=i,this.group.addChild(this.nameGroup),this.leftImg=GObj.create(t.ImageOutside),this.leftImg.setOutSrc("left",FileConst.png),this.nameGroup.addChild(this.leftImg),this.kunLab=GObj.create(eui.Label),this.kunLab.horizontalCenter=0,this.kunLab.y=50,this.kunLab.size=18,this.kunLab.textColor=16777215,this.nameGroup.addChild(this.kunLab),this.rightImg=GObj.create(t.ImageOutside),this.rightImg.setOutSrc("right",FileConst.png),this.nameGroup.addChild(this.rightImg),this.kunImg=GObj.create(t.ImageOutside),this.kunImg.horizontalCenter=0,this.kunImg.y=170,this.group.addChild(this.kunImg),this.descBg=GObj.create(t.ImageOutside),this.descBg.horizontalCenter=0,this.descBg.y=325,this.descBg.setOutSrc("img_4",FileConst.png),this.group.addChild(this.descBg),this.descLab=GObj.create(eui.Label),this.descLab.horizontalCenter=0,this.descLab.y=340,this.descLab.textColor=16777215,this.descLab.size=18,this.descLab.lineSpacing=5,this.descLab.textAlign="center",this.group.addChild(this.descLab),this.goldLab=GObj.create(eui.Label),this.goldLab.horizontalCenter=0,this.goldLab.y=365,this.goldLab.textColor=16777215,this.group.addChild(this.goldLab),this.bubbleImg=GObj.create(t.ImageOutside),this.bubbleImg.horizontalCenter=0,this.bubbleImg.y=140,this.bubbleImg.setOutSrc("bubble",FileConst.png),this.group.addChild(this.bubbleImg),this.yesBtn=GObj.create(t.IBaseBtn),this.yesBtn.icon=IMiniGameMain.getIcon("btn_3",FileConst.png),this.yesBtn.horizontalCenter=0,this.yesBtn.y=402,this.yesBtn.labelDisplay.textColor=7353348,this.yesBtn.label=IMiniGameMain.getString(t.IMiniGame13Consts.lang[8]),this.group.addChild(this.yesBtn),egret.Tween.get(this.group).to({scaleX:1,scaleY:1},300),this.addEvent()},e.prototype.addEvent=function(){this.yesBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.__yesBtnHandler,this)},e.prototype.removeEvent=function(){this.yesBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.__yesBtnHandler,this)},e.prototype.show=function(i,e,s,h){this.initSkins(),this.kunLab.text=i.name,this.kunImg.setOutSrc("kuns/"+t.IMiniGame13Consts.kun[i.grade].img,FileConst.png),this.descLab.text=i.desc;var a=GObj.create(GoodsInfo);a.tid=s.tempId,a.count=s.count,this.goldLab.textFlow=IMiniGameMain.parserHtml(IMiniGameMain.getString(t.IMiniGame13Consts.lang[20],i.unlockReward,a.count,a.name)),this.data=i,this.isPassNew=e,this.bagId=h},e.prototype.__yesBtnHandler=function(){IMiniGameMain.playEff(t.IMiniGame13Consts.minigame_btn),IMiniGameMain.reqSocket(6,this.bagId);var i=this.parent.parent;if(1!=this.data.grade||this.isPassNew){if(2==this.data.grade&&!this.isPassNew){i.isFirst?(i.shape.x=190,i.shape.y=390,i.guide(200,400,1),egret.Tween.get(i.guideMove,{loop:!0}).to({x:418,y:422},1e3)):(i.shape.x=270,i.shape.y=390,i.guide(280,400,1),egret.Tween.get(i.guideMove,{loop:!0}).to({x:418,y:422},1e3)),i.shape.graphics.clear(),i.shape.graphics.beginFill(16777215),i.shape.graphics.drawCircle(0,0,60),i.shape.graphics.endFill(),i.newPlayerMask(i.shape,!0);var e=GObj.create(egret.Shape);e.x=450,e.y=422,e.graphics.clear(),e.graphics.beginFill(16777215),e.graphics.drawCircle(0,0,60),e.graphics.endFill(),i.newPlayerMask(e,!1),i.guideDesc.y=280,i.guideDesc.setOutSrc("desc/4",FileConst.png)}}else i.shape.x=270,i.shape.y=670,i.shape.graphics.clear(),i.shape.graphics.beginFill(16777215),i.shape.graphics.drawCircle(0,0,80),i.shape.graphics.endFill(),i.newPlayerMask(i.shape,!0),i.guideDesc.y=550,i.guideDesc.setOutSrc("desc/2",FileConst.png),i.guide(300,685);GObj.disposeObject(this)},e.prototype.dispose=function(){this.removeEvent(),GObj.disposeObject(this.bgRect),this.bgRect=null,GObj.disposeObject(this.group),this.group=null,GObj.disposeObject(this.bgImg),this.bgImg=null,GObj.disposeObject(this.titleImg),this.titleImg=null,GObj.disposeObject(this.nameImg),this.nameImg=null,GObj.disposeObject(this.nameGroup),this.nameGroup=null,GObj.disposeObject(this.leftImg),this.leftImg=null,GObj.disposeObject(this.kunLab),this.kunLab=null,GObj.disposeObject(this.rightImg),this.rightImg=null,GObj.disposeObject(this.kunImg),this.kunImg=null,GObj.disposeObject(this.descBg),this.descBg=null,GObj.disposeObject(this.descLab),this.descLab=null,GObj.disposeObject(this.bubbleImg),this.bubbleImg=null,GObj.disposeObject(this.yesBtn),this.yesBtn=null,GObj.disposeObject(this.goldLab),this.goldLab=null},e}(eui.Component);t.IMiniGame13UnlockPop=i,__reflect(i.prototype,"miniGame.IMiniGame13UnlockPop")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.arrowFrame=8,t.arrowIndex=0,t.posArr=[[156,345],[238,345],[320,345],[156,420],[238,420],[320,420],[156,495],[238,495],[320,495],[156,570],[238,570],[320,570]],t.frame=8,t.isAddOver=!1,t.timeSeconds=0,t.isPassNew=!1,t.isFirstFull=!0,t}return __extends(e,i),e.prototype.addEvent=function(){this.exitBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCloseClick,this),this.buyBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.buyBtnHandler,this),this.openBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.openBtnHandler,this),DispatcherManager.addListener(HGEvent.HEARTBEAT,this.__heartHandler,this)},e.prototype.removeEvent=function(){this.exitBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onCloseClick,this),this.buyBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.buyBtnHandler,this),this.openBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.openBtnHandler,this),DispatcherManager.removeListener(HGEvent.HEARTBEAT,this.__heartHandler,this)},e.prototype.newPlayerMask=function(t,i){i&&(this.blendShape.graphics.clear(),this.blendShape.graphics.beginFill(0,.7),this.blendShape.graphics.drawRect(0,0,this.width,this.height),this.blendShape.graphics.endFill(),this.container.addChild(this.blendShape)),this.container.addChild(t),t.blendMode=egret.BlendMode.ERASE,this.renderTexture.drawToTexture(this.container),this.blendBitmap.texture=this.renderTexture,this.blendBitmap.touchEnabled=!0,this.blendBitmap.pixelHitTest=!0},e.prototype.setData=function(i,e){this.initSkins(),this.funnyVo=i,this.data=e,this.kunData=this.data.kun,this.lang=this.data.lang,IMiniGameMain.playBgm(t.IMiniGame13Consts.minigame_bgm),this.initKunsData(),this.updateData(),EnterFrameManager.instance.registeRender(this.initPoolKuns,this),this.updateASecondMoney()},e.prototype.initSkins=function(){var i=this;if(!this.isInit){this.isInit=!0,this.horizontalCenter=0,this.verticalCenter=0,this.width=540,this.height=960,this.itemArr=[],this.lockArr=[],this.bgImg=GObj.create(t.ImageOutside),this.bgImg.setOutSrc("game13_bg_1",FileConst.jpg),this.bgImg.horizontalCenter=0,this.bgImg.bottom=0,this.addChild(this.bgImg),this.cloudEff=GObj.create(t.IMovieMore),this.cloudEff.y=StageManager.stageHeight/2,this.cloudEff.start(t.IMiniGame13Consts.UI_YUNWU),this.cloudEff.autoRun(),this.addChildAt(this.cloudEff,1),this.discImg=GObj.create(t.ImageOutside),this.discImg.x=132,this.discImg.y=205,this.discImg.setOutSrc("disc",FileConst.png),this.addChildAt(this.discImg,2),this.bgImg2=GObj.create(t.ImageOutside),this.bgImg2.loadCompleteCall(function(){i.bgImg2.anchorOffsetX=i.bgImg2.iconWidth/2,i.bgImg2.anchorOffsetY=i.bgImg2.iconWidth/2},this),this.bgImg2.setOutSrc("img_1",FileConst.png),this.bgImg2.x=75,this.bgImg2.y=500,this.addChildAt(this.bgImg2,3),this.bgImg3=GObj.create(t.ImageOutside),this.bgImg3.setOutSrc("img_2",FileConst.png),this.bgImg3.x=395,this.bgImg3.y=300,this.addChildAt(this.bgImg3,4),egret.Tween.get(this.bgImg3,{loop:!0}).to({y:290},2e3,egret.Ease.quadOut).to({y:300},2e3,egret.Ease.quadOut),this.arrowGroup=GObj.create(eui.Group),this.arrowGroup.x=430,this.arrowGroup.y=330,this.arrowGroup.width=44,this.arrowGroup.height=324,this.addChildAt(this.arrowGroup,5);for(var e=0;10>e;e++){var s=GObj.create(t.ImageOutside);s.y=300-30*e,s.setOutSrc("arrow_1",FileConst.png),this.arrowGroup.addChild(s)}this.itemGroup=GObj.create(eui.Group),this.itemGroup.horizontalCenter=0,this.itemGroup.bottom=0,this.itemGroup.width=540,this.itemGroup.height=960,this.itemGroup.touchThrough=!0,this.addChildAt(this.itemGroup,6),this.poolGroup=GObj.create(eui.Group),this.poolGroup.x=0,this.poolGroup.y=0,this.poolGroup.width=540,this.poolGroup.height=960,this.poolGroup.touchThrough=!0,this.addChildAt(this.poolGroup,7),this.goldGroup=GObj.create(eui.Group),this.goldGroup.width=this.width,this.goldGroup.height=this.height,this.goldGroup.touchThrough=!0,this.addChild(this.goldGroup),this.bgImg4=GObj.create(t.ImageOutside),this.bgImg4.setOutSrc("door",FileConst.png),this.bgImg4.x=373,this.bgImg4.y=220,this.addChild(this.bgImg4),egret.Tween.get(this.bgImg4,{loop:!0}).to({y:210},2e3,egret.Ease.quadOut).to({y:220},2e3,egret.Ease.quadOut),this.putKunImg=GObj.create(t.ImageOutside),this.putKunImg.width=90,this.putKunImg.height=324,this.putKunImg.x=420,this.putKunImg.y=340,this.putKunImg.alpha=0,this.addChild(this.putKunImg),this.sellImg=GObj.create(t.ImageOutside),this.sellImg.x=370,this.sellImg.y=720,this.sellImg.setOutSrc("sell",FileConst.png),this.sellImg.alpha=.5,this.sellImg.filters=[],this.addChild(this.sellImg),this.sellLab=GObj.create(t.ImageOutside),this.sellLab.x=400,this.sellLab.y=742,this.sellLab.alpha=.5,this.sellLab.setOutSrc("sell2",FileConst.png),this.addChild(this.sellLab),this.goldImg=GObj.create(t.ImageOutside),this.goldImg.setOutSrc("gold",FileConst.png),this.goldImg.x=195,this.goldImg.y=295,this.addChild(this.goldImg),this.goldLab=GObj.create(eui.Label),this.goldLab.x=228,this.goldLab.y=295,this.goldLab.textColor=16777215,this.goldLab.stroke=2,this.goldLab.strokeColor=1275078,this.goldLab.size=20,this.addChild(this.goldLab),this.earningsLab=GObj.create(eui.Label),this.earningsLab.x=228,this.earningsLab.y=320,this.earningsLab.textColor=16777215,this.earningsLab.stroke=2,this.earningsLab.strokeColor=1275078,this.earningsLab.size=18,this.addChild(this.earningsLab),this.buyBtn=GObj.create(t.IMiniGame13Btn),this.buyBtn.icon=IMiniGameMain.getIcon("btn_1",FileConst.png),this.buyBtn.goldIcon=IMiniGameMain.getIcon("gold",FileConst.png),this.buyBtn.horizontalCenter=0,this.buyBtn.y=648,this.addChild(this.buyBtn),this.openBtn=GObj.create(t.IBaseBtn),this.openBtn.icon=IMiniGameMain.getIcon("btn_2",FileConst.png),this.openBtn.x=325,this.openBtn.y=290,this.addChild(this.openBtn),this.flagImg=GObj.create(t.ImageOutside),this.flagImg.x=420,this.flagImg.y=265,this.addChild(this.flagImg),this.countLab=GObj.create(eui.Label),this.countLab.horizontalCenter=183,this.countLab.y=235,this.countLab.textColor=16777215,this.countLab.size=18,this.countLab.stroke=2,this.countLab.strokeColor=1275078,this.addChild(this.countLab),egret.Tween.get(this.countLab,{loop:!0}).to({y:225},2e3,egret.Ease.quadOut).to({y:235},2e3,egret.Ease.quadOut),this.swimmingLab=GObj.create(eui.Label),this.swimmingLab.x=420,this.swimmingLab.y=235,this.addChild(this.swimmingLab),this.popGroup=GObj.create(eui.Group),this.popGroup.width=540,this.popGroup.height=960,this.popGroup.touchThrough=!0,this.addChild(this.popGroup),this.exitBtn=GObj.create(t.IBaseBtn),this.exitBtn.icon=IMiniGameMain.getIcon("exit_btn",FileConst.png,"chapter"),this.exitBtn.right=20,this.exitBtn.top=100,this.addChild(this.exitBtn),this.kunsVo={},this.kunsBuyTimesVo={},this.serverVo={},this.addEvent()}},e.prototype.buyBtnHandler=function(i){IMiniGameMain.playEff(t.IMiniGame13Consts.minigame_btn);var e;if(e="number"==typeof i?this.getBuyKunData(i):this.getNextKunData(),this.goldNum<e.price)return App.msgtip.show(this.lang[3]);var s=0,h=0;for(var a in this.kunsVo)if(s++,!this.kunsVo[a].grade){h++,this.kunsVo[a]=e,this.kunsVo[a].buyTimes++,this.kunsBuyTimesVo[this.kunsVo[a].grade]++,this.addMoney(!1,this.kunsVo[a].price),this.itemArr[parseInt(a)-1].playBuy();break}return this.serverVo.kunsBuyTimesVo=this.kunsBuyTimesVo,12==s&&this.isFirstFull&&(this.shape.x=380,this.shape.y=520,this.shape.graphics.clear(),this.shape.graphics.beginFill(16777215),this.shape.graphics.drawEllipse(0,0,290,140),this.shape.rotation=53,this.shape.graphics.endFill(),this.newPlayerMask(this.shape,!0),this.blendBitmap.visible=!0,this.guideDesc.visible=!0,this.guideDesc.setOutSrc("desc/6",FileConst.png),this.guideDesc.y=450,this.guide(330,600,1),egret.Tween.get(this.guideMove,{loop:!0}).to({x:440,y:750},1e3)),0==h?App.msgtip.show(this.lang[2]):(e.grade>this.topLevel&&this.openUnlockPop(e.grade),this.isPassNew||this.kunsVo[2].grade||(this.shape.x=270,this.shape.y=655,this.shape.graphics.clear(),this.shape.graphics.beginFill(16777215),this.shape.graphics.drawCircle(0,0,80),this.shape.graphics.endFill(),this.newPlayerMask(this.shape,!0),this.guideDesc.setOutSrc(""),this.guide(300,670)),!this.isPassNew&&this.kunsVo[2].grade&&(this.shape.x=0,this.shape.y=0,this.shape.graphics.clear(),this.shape.graphics.beginFill(16777215),this.shape.graphics.drawRect(150,336,158,80),this.shape.graphics.endFill(),this.newPlayerMask(this.shape,!0),this.guideDesc.y=500,this.guideDesc.setOutSrc("desc/3",FileConst.png),this.guide(200,400,1),egret.Tween.get(this.guideMove,{loop:!0}).to({x:280},1e3)),"number"==typeof i&&App.msgtip.show(this.lang[21]),void this.updateKunsItemData())},e.prototype.openBtnHandler=function(){IMiniGameMain.playEff(t.IMiniGame13Consts.minigame_btn),this.buyPop=GObj.create(t.IMiniGame13BuyPop),this.buyPop.show(this.serverVo,this.kunData,this.buyBtnHandler,this),this.popGroup.addChild(this.buyPop)},e.prototype.initKunsData=function(){var i;this.funnyVo&&(i=this.funnyVo.actData.p5)?("string"==typeof i?this.serverVo=JSON.parse(i):this.serverVo=i,this.kunsVo=this.serverVo.kunsVo,this.goldNum=this.serverVo.money,this.topLevel=this.serverVo.top,this.kunsBuyTimesVo=this.serverVo.kunsBuyTimesVo,this.isPassNew=this.serverVo.isPassNew,this.isPassNew||this.clearData(),this.isFirstFull=this.serverVo.isFirstFull):this.clearData();for(var e in this.kunsVo)this.kunsVo[e].isLock&&this.lockArr.push(parseInt(e));if(this.serverVo.time&&this.serverVo.time<GApp.clockMgr.serverSecond-60&&this.lockArr.length>0){var s=GObj.create(t.IMiniGame13OfflinePop),h=GApp.clockMgr.serverSecond-this.serverVo.time,a=3600*t.IMiniGame13Consts.offlineHours,n=h>a?a:h;this.updateASecondMoney();var o=Math.round(this.earningNum*n),r=IMiniGameMain.numberToStr(o,1);s.show(r,n),this.popGroup.addChild(s),this.goldNum+=o}this.isPassNew||(this.shape=GObj.create(egret.Shape),this.shape.x=270,this.shape.y=670,this.shape.graphics.clear(),this.shape.graphics.beginFill(16777215),this.shape.graphics.drawCircle(0,0,80),this.shape.graphics.endFill(),this.addChild(this.shape),this.container=GObj.create(egret.DisplayObjectContainer),this.blendShape=GObj.create(egret.Shape),this.renderTexture=GObj.create(egret.RenderTexture),this.blendBitmap=GObj.create(egret.Bitmap),this.addChild(this.blendBitmap),this.guideDesc=GObj.create(t.ImageOutside),this.guideDesc.horizontalCenter=0,this.guideDesc.y=550,this.guideDesc.setOutSrc("desc/1",FileConst.png),this.addChild(this.guideDesc),this.newPlayerMask(this.shape,!0),this.guide(320,685)),this.exitBtn.visible=this.isPassNew,this.openBtn.visible=this.topLevel>=t.IMiniGame13Consts.shopLevel,this.countLab.text=IMiniGameMain.getString(this.lang[7],this.poolGroup.$children.length),this.initKunsItemData()},e.prototype.clearData=function(){for(var t=1;12>=t;t++)this.kunsVo[t]={};for(var i in this.kunData)this.kunsBuyTimesVo[i]=0;this.goldNum=this.data.initMoney,this.topLevel=0,this.serverVo.kunsVo=this.kunsVo,this.serverVo.money=this.goldNum,this.serverVo.top=this.topLevel,this.serverVo.kunsBuyTimesVo=this.kunsBuyTimesVo,this.serverVo.isPassNew=this.isPassNew,this.serverVo.isFirstFull=this.isFirstFull},e.prototype.initPoolKuns=function(){if(!this.isDestory){if(!this.isAddOver){if(this.frame<8)return void this.frame++;this.lockArr.length>0?(this.putKun(this.lockArr[0]),this.lockArr.shift(),this.frame=0):this.isAddOver=!0}if(this.arrowFrame<8)return void this.arrowFrame++;this.arrowIndex>9&&(this.arrowIndex=0);var t=this.arrowGroup.$children[this.arrowIndex];t.setOutSrc("arrow_2",FileConst.png),setTimeout(function(){t.setOutSrc("arrow_1",FileConst.png)},1e3),this.arrowFrame=0,this.arrowIndex++}},e.prototype.initKunsItemData=function(){var i;for(var e in this.kunsVo)i=GObj.create(t.IMiniGame13SelItem),i.$children[1].addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBeginClick,this),i.x=this.posArr[parseInt(e)-1][0],i.y=this.posArr[parseInt(e)-1][1],i.setData(this.kunsVo[e],parseInt(e)),this.itemGroup.addChild(i),this.itemArr.push(i)},e.prototype.updateKunsItemData=function(){var i;for(var e in this.itemArr)i=this.itemArr[e],i.setData(this.kunsVo[parseInt(e)+1],parseInt(e)+1);this.serverVo.kunsVo=this.kunsVo,this.buyPop&&this.buyPop.isOpen&&this.buyPop.updateData(this.serverVo,this.kunData),this.exitBtn.visible=this.isPassNew,this.openBtn.visible=this.topLevel>=t.IMiniGame13Consts.shopLevel,this.updateData(),this.updateASecondMoney()},e.prototype.unlock=function(t){var i=this,e=this._downTarget.parent,s=function(t){var s=h.poolGroup.$children[t];s.index==e.index&&(s.stop(),egret.Tween.get(s).to({x:h.posArr[s.index-1][0]+33,y:h.posArr[s.index-1][1]+33},200).call(function(){egret.Tween.removeTweens(s),i.poolGroup.removeChild(s),i.countLab.text=IMiniGameMain.getString(i.lang[7],i.poolGroup.$children.length)}),h.isPassNew||(h.isPassNew=!0,h.serverVo.isPassNew=h.isPassNew,egret.Tween.removeTweens(h.guideMove),IMiniGameMain.rmGuideView(),h.blendBitmap.visible=!1,h.guideDesc.visible=!1))},h=this;for(var a in this.poolGroup.$children)s(a);this.kunsVo[e.index].isLock=!1,this.updateKunsItemData()},e.prototype.updateData=function(){this.goldLab.text=IMiniGameMain.numberToStr(Math.min(this.goldNum,t.IMiniGame13Consts.maxMoney),1),this.serverVo.money=this.goldNum,this.buyPop&&this.buyPop.isOpen&&this.buyPop.setMoney(IMiniGameMain.numberToStr(this.goldNum,1)),this.buyBtn.money="等级："+this.getNextKunData().grade,this.buyBtn.label=IMiniGameMain.numberToStr(this.getNextKunData().price,1)},e.prototype.getNextKunData=function(){var t=this.topLevel-this.data.unlockGap<=1?1:this.topLevel-this.data.unlockGap,i={},e=this.kunsBuyTimesVo?this.kunsBuyTimesVo[t]:0,s=this.kunData[t];return i.price=s.price+s.add*e,i.grade=t,i.buyTimes=e,i.isLock=!1,i.speed=s.seconds,i.money=s.money,i.sell=s.sell,i.qua=s.qua,i},e.prototype.getBuyKunData=function(t){var i={},e=this.kunsBuyTimesVo?this.kunsBuyTimesVo[t]:0,s=this.kunData[t];return i.price=s.price+s.add*e,i.grade=t,i.buyTimes=e,i.isLock=!1,i.speed=s.seconds,i.money=s.money,i.sell=s.sell,i.qua=s.qua,i},e.prototype.onBeginClick=function(t){this._downTarget=t.target;var i=this._downTarget.parent;if(this.index=i.index,this.kunsVo[this.index].isLock)return void this.unlock(t);this.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMoveClick,this),this.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onEndClick,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.onEndClick,this);var e=this._downTarget.localToGlobal();this.globalToLocal(e.x,e.y,e),this._downTarget.x=e.x,this._downTarget.y=e.y,this.addChild(this._downTarget)},e.prototype.onMoveClick=function(t){this.movePoint||(this.movePoint=GObj.create(egret.Point)),this.globalToLocal(t.stageX,t.stageY,this.movePoint),this._downTarget.x=this.movePoint.x-33,this._downTarget.y=this.movePoint.y-33;var i=this.checkSellPos(t.stageX,t.stageY);i?(this.sellImg.alpha=1,this.sellLab.alpha=1,this.sellImg.filters=[IMiniGameMain.getRedFilter()],this.sellLab.setOutSrc("sell3",FileConst.png)):(this.sellImg.alpha=.5,this.sellLab.alpha=.5,this.sellImg.filters=[],this.sellLab.setOutSrc("sell2",FileConst.png))},e.prototype.onEndClick=function(i){this.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMoveClick,this),this.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onEndClick,this),this.removeEventListener(egret.TouchEvent.TOUCH_END,this.onEndClick,this),this._downTarget.x=0,this._downTarget.y=0,this.itemArr[this.index-1].addChildAt(this._downTarget,1);for(var e,s,h=0,a=this.itemArr;h<a.length;h++){s=a[h],e=s.checkPos(i.stageX,i.stageY);var n=s.index;if(e&&n>2&&!this.isPassNew)return;if(e&&2==this.topLevel&&!this.isPassNew)return;if(e&&n==this.index)break;if(e&&!s.vo){this.kunsVo[n]=this.kunsVo[this.index],this.kunsVo[this.index]={},this.updateKunsItemData();break}if(e&&s.vo&&!this.kunsVo[n].isLock&&this.kunsVo[n].grade==this.kunsVo[this.index].grade){if(this.kunsVo[n].grade>=t.IMiniGame13Consts.maxLevel){App.msgtip.show(IMiniGameMain.getString(t.IMiniGame13Consts.lang[19]));break}var o=this.funnyVo.bagList[0].conditionList[0].p3,r=this.funnyVo.bagList[0].conditionList[0].p4;if(o&&r&&!IMiniGameMain.checkOpen(o,r)){IMiniGameMain.checkOpenTip(o,r);break}this.kunsVo[n].grade++,this.kunsVo[n].money=this.kunData[this.kunsVo[n].grade].money,this.kunsVo[n].sell=this.kunData[this.kunsVo[n].grade].sell,this.kunsVo[n].qua=this.kunData[this.kunsVo[n].grade].qua,this.kunsVo[n].speed=this.kunData[this.kunsVo[n].grade].seconds,this.kunsVo[this.index]={};var l=this.kunsVo[n].grade;s.hide(),this.play(this.kunsVo[n],s),this.itemArr[this.index-1].setData(this.kunsVo[this.index],this.index),ClockManager.setTimeout(this.updateKunsItemData,this,400),l>this.topLevel&&(ClockManager.setTimeout(this.openUnlockPop,this,400,l),ClockManager.setTimeout(this.guide2,this,1e3));break}}var p=this.checkPutKunPos(i.stageX,i.stageY);if(p){if(!this.isPassNew&&this.kunsVo[this.index].grade<2)return;if(this.poolGroup.$children.length>=10)return IMiniGameMain.getString(this.lang[6]);this.kunsVo[this.index].isLock=!0,this.putKun(this.index,i)}var c=this.checkSellPos(i.stageX,i.stageY);c&&this.isPassNew&&this.sellKun(),this.sellImg.alpha=.5,this.sellImg.filters=[],this.sellLab.alpha=1,this.sellLab.setOutSrc("sell2",FileConst.png)},e.prototype.play=function(i,e){IMiniGameMain.playEff(t.IMiniGame13Consts.minigame_upgrade),e.hide();var s=GObj.create(t.ImageOutside);s.setOutSrc("items/"+this.kunData[i.grade-1].img,FileConst.png),s.x=this.posArr[e.index-1][0],s.y=this.posArr[e.index-1][1],this.addChild(s);var h=GObj.create(t.ImageOutside);h.setOutSrc("items/"+this.kunData[i.grade-1].img,FileConst.png),h.x=this.posArr[e.index-1][0],h.y=this.posArr[e.index-1][1],this.addChild(h),egret.Tween.get(s).to({x:s.x-50},200).to({x:s.x},200).call(function(){GObj.disposeObject(s),GObj.disposeObject(h),e.show()}),egret.Tween.get(h).to({x:s.x+50},200).to({x:s.x},200)},e.prototype.openUnlockPop=function(i){var e=GObj.create(t.IMiniGame13UnlockPop);e.show(this.kunData[i],this.isPassNew,this.funnyVo.bagList[0].rewardList[0],this.funnyVo.bagList[0].id),this.popGroup.addChild(e),this.topLevel=i,this.serverVo.top=this.topLevel,this.goldNum+=this.kunData[i].unlockReward,this.updateData()},e.prototype.sellKun=function(){this.isFirstFull&&(this.serverVo.isFirstFull=this.isFirstFull=!1,this.serverVo.isPassNew=this.isPassNew,egret.Tween.removeTweens(this.guideMove),IMiniGameMain.rmGuideView(),this.blendBitmap.visible=!1,this.guideDesc.visible=!1);var i=GObj.create(t.IMiniGame13SellPop),e=IMiniGameMain.numberToStr(this.kunsVo[this.index].sell,1),s=this.kunsVo[this.index].grade;i.show(e,s,this.yesCallBack,this),this.popGroup.addChild(i)},e.prototype.yesCallBack=function(i){this.kunsVo[this.index]={},this.goldNum+=i,IMiniGameMain.playEff(t.IMiniGame13Consts.minigame_sell),this.updateData(),this.updateKunsItemData()},e.prototype.checkPutKunPos=function(t,i){var e=this.putKunImg.localToGlobal();return t>e.x&&i>e.y&&t<e.x+this.putKunImg.width&&i<e.y+this.putKunImg.height},e.prototype.checkSellPos=function(t,i){var e=this.sellImg.localToGlobal();return t>e.x&&i>e.y&&t<e.x+this.sellImg.width&&i<e.y+this.sellImg.height},e.prototype.putKun=function(i,e){if(this.kunsVo[i].isLock){var s=GObj.create(t.IMiniGameSwimmingFish);s.setData(this.kunsVo[i]),s.index=i,s.x=450,e?s.y=e.$stageY:s.y=440,this.poolGroup.addChild(s),s["do"](),IMiniGameMain.playEff(t.IMiniGame13Consts.minigame_put),this.countLab.text=IMiniGameMain.getString(this.lang[7],this.poolGroup.$children.length),this.isPassNew||(this.isFirst?(this.shape.x=180,this.shape.y=390,this.guide(200,400)):(this.shape.x=270,this.shape.y=390,this.guide(280,400)),this.shape.graphics.clear(),this.shape.graphics.beginFill(16777215),this.shape.graphics.drawCircle(0,0,80),this.shape.graphics.endFill(),this.newPlayerMask(this.shape,!0),this.guideDesc.y=480,this.guideDesc.setOutSrc("desc/5",FileConst.png)),this.updateKunsItemData()}},e.prototype.addMoney=function(i,e){if(i){this.goldNum+=e;var s=GObj.create(t.IMiniGame13GoldUp);s.x=30,s.y=484,s.setData(IMiniGameMain.numberToStr(e,1)),s["do"](),this.goldGroup.addChild(s);var h=GObj.create(t.IMinigame13Tween);h.x=30,h.y=484,h.setData(this.goldImg.localToGlobal()),h["do"](),this.goldGroup.addChild(h),egret.Tween.removeTweens(this.bgImg2),egret.Tween.get(this.bgImg2).to({scaleX:1.1,scaleY:1.1},200).to({scaleX:1,scaleY:1},200),IMiniGameMain.playEff(t.IMiniGame13Consts.minigame_gold)}else{this.goldNum-=e;var a=GObj.create(eui.Label);a.x=275,a.y=285,a.textColor=16777215,a.size=20,a.stroke=2,a.strokeColor=1275078,a.text="-"+e,this.goldGroup.addChild(a),egret.Tween.get(a).to({y:260,alpha:0},500).call(function(){GObj.disposeObject(a)}),this.updateData()}},e.prototype.updateASecondMoney=function(){var t=0;for(var i in this.kunsVo)this.kunsVo[i].isLock&&(t+=Math.ceil(this.kunsVo[i].money/this.kunData[this.kunsVo[i].grade].seconds));this.earningsLab.text=t+"每秒",this.earningNum=t},e.prototype.sendData=function(){this.isPassNew&&(this.serverVo.time=GApp.clockMgr.serverSecond,IMiniGameMain.reqSocket(7,null,this.serverVo))},e.prototype.__heartHandler=function(){this.timeSeconds<10?this.timeSeconds++:(this.timeSeconds=0,this.sendData())},e.prototype.guide=function(t,i,e){this.guideMove||(this.guideMove=IMiniGameMain.getGuideView()),this.guideMove.playEffct(t,i,e),this.addChild(this.guideMove)},e.prototype.guide2=function(){this.shape.x=270,this.shape.y=655,this.shape.graphics.clear(),this.shape.graphics.beginFill(16777215),this.shape.graphics.drawCircle(0,0,80),this.shape.graphics.endFill(),this.newPlayerMask(this.shape,!0),this.guideDesc.setOutSrc(""),this.isPassNew||(this.guide(300,670),2==this.kunsVo[1].grade?this.isFirst=!0:this.isFirst=!1)},e.prototype.dispose=function(){if(!this.isDestory){this.isDestory=!0,EnterFrameManager.instance.unRegisteRender(this.initPoolKuns,this),this.removeEvent(),this.funnyVo=null,this.data=null,this.kunData=null,this.lang=null,this.arrowFrame=null,this.arrowIndex=null,this.earningNum=null;
for(var t in this.poolGroup.$children)egret.Tween.removeTweens(this.poolGroup.$children[t]);if(egret.Tween.removeTweens(this.bgImg2),egret.Tween.removeTweens(this.goldLab),GObj.disposeObject(this.bgImg),this.bgImg=null,GObj.disposeObject(this.cloudEff),this.cloudEff=null,GObj.disposeObject(this.discImg),this.discImg=null,GObj.disposeObject(this.bgImg2),this.bgImg2=null,GObj.disposeObject(this.bgImg3),this.bgImg3=null,GObj.disposeObject(this.bgImg4),this.bgImg4=null,GObj.disposeObject(this.goldImg),this.goldImg=null,GObj.disposeObject(this.goldLab),this.goldLab=null,GObj.disposeObject(this.buyBtn),this.buyBtn=null,GObj.disposeObject(this.openBtn),this.openBtn=null,GObj.disposeObject(this.flagImg),this.flagImg=null,GObj.disposeObject(this.swimmingLab),this.swimmingLab=null,GObj.disposeObject(this.sellImg),this.sellImg=null,GObj.disposeObject(this.sellLab),this.sellLab=null,GObj.disposeObject(this.earningsLab),this.earningsLab=null,GObj.disposeObject(this.countLab),this.countLab=null,GObj.disposeObject(this.putKunImg),this.putKunImg=null,GObj.disposeObject(this.guideDesc),this.guideDesc=null,GObj.disposeObject(this.exitBtn),this.exitBtn=null,this.guideMove&&(GObj.disposeObject(this.guideMove),this.guideMove=null),this.itemArr)for(var e=0;e<this.itemArr.length;e++)this.itemArr[e].removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBeginClick,this),GObj.disposeObject(this.itemArr[e]),this.itemArr[e]=null;if(this.itemArr=null,this.itemGroup){for(;this.itemGroup.$children.length>0;)GObj.disposeObject(this.itemGroup.$children[0]),this.itemGroup.$children[0]=null;GObj.disposeObject(this.itemGroup)}if(this.arrowGroup){for(;this.arrowGroup.$children.length>0;)GObj.disposeObject(this.arrowGroup.$children[0]);GObj.disposeObject(this.arrowGroup),this.arrowGroup=null}if(this.poolGroup){for(;this.poolGroup.$children.length>0;)GObj.disposeObject(this.poolGroup.$children[0]);GObj.disposeObject(this.poolGroup),this.poolGroup=null}i.prototype.dispose.call(this)}},e}(t.IBaseView);t.IMiniGame13View=i,__reflect(i.prototype,"miniGame.IMiniGame13View")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var e=i.call(this)||this;return e.isAdd=!1,e.kun=GObj.create(t.ImageOutside),e.kun.loadCompleteCall(function(){e.kun.anchorOffsetX=e.kun.iconWidth/2,e.kun.anchorOffsetY=e.kun.iconWidth/2},e),e.addChild(e.kun),e.touchEnabled=!1,e.touchChildren=!1,e}return __extends(e,i),e.prototype.setData=function(i){this.kunInfo=i,this.kun.setOutSrc("pool/"+t.IMiniGame13Consts.kun[this.kunInfo.grade].img);var e=t.IMiniGame13Consts.kun[this.kunInfo.grade].scale?t.IMiniGame13Consts.kun[this.kunInfo.grade].scale:.7;this.kun.scaleX=this.kun.scaleY=e},e.prototype["do"]=function(){var t=this;egret.Tween.get(this).to({y:347},(this.y-347)/233*this.kunInfo.speed*.15*1e3).call(function(){t.do2()})},e.prototype.do2=function(){var t=this;egret.Tween.get(this).to({fa:180},.35*this.kunInfo.speed*1e3).call(function(){t.do3()})},e.prototype.do3=function(){var t=this;egret.Tween.get(this,{onChange:this.addMoney,onChangeObj:this}).to({y:590},.15*this.kunInfo.speed*1e3).call(function(){t.do4()})},e.prototype.do4=function(){var t=this;egret.Tween.get(this).to({fa2:360},.35*this.kunInfo.speed*1e3).call(function(){t.isAdd=!1,t["do"]()})},e.prototype.addMoney=function(){if(90==this.x&&this.y>=492&&this.y<=498&&!this.isAdd){var t=this.parent.parent;t.addMoney(!0,this.kunInfo.money),this.isAdd=!0}},Object.defineProperty(e.prototype,"fa",{get:function(){return 0},set:function(t){var i=180,e=180,s=i+90,h=e+170;this.x=s+Math.cos(-t*Math.PI/180)*i,this.y=h+Math.sin(-t*Math.PI/180)*e,this.kun.rotation=-t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fa2",{get:function(){return 180},set:function(t){var i=180,e=180,s=i+90,h=e+410;this.x=s+Math.cos(-t*Math.PI/180)*i,this.y=h+Math.sin(-t*Math.PI/180)*e,this.kun.rotation=-t},enumerable:!0,configurable:!0}),e.prototype.stop=function(){egret.Tween.removeTweens(this)},e.prototype.dispose=function(){egret.Tween.removeTweens(this),GObj.disposeObject(this.kun),this.kun=null},e}(eui.Component);t.IMiniGameSwimmingFish=i,__reflect(i.prototype,"miniGame.IMiniGameSwimmingFish")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(t){return i.call(this,t)||this}return __extends(e,i),e.prototype.getGameView=function(){return this.gameView||(this.gameView=GObj.create(t.IMiniGame14View)),this.gameView.setData(this.getCurGameData()),this.gameView},e.prototype.loadConfigComplete=function(e){if(e)for(var s in e.config)t.IMiniGame14Consts[s]=e.config[s];i.prototype.loadConfigComplete.call(this,e)},e.prototype.getCurGameData=function(e,s){var h=i.prototype.getCurGameData.call(this);return h||(h=t.testData14),h},e.setDefaultData=function(i){if(i.skills)for(var e in t.IMiniGame14Consts.skills){var s=t.IMiniGame14Consts.skills[e];s||(s={});var h=i.skills[e];h||(h=i.skills[e]={});for(var a in s)void 0==h[a]&&(h[a]=s[a])}if(i.fish)for(var n in t.IMiniGame14Consts.fish){var s=t.IMiniGame14Consts.fish[n];s||(s={});var h=i.fish[n];h||(h=i.fish[n]={});for(var a in s)void 0==h[a]&&(h[a]=s[a])}if(i.player){var s=t.IMiniGame14Consts.player;s||(s={});var h=i.player;h||(h=i.player={});for(var a in s)void 0==h[a]&&(h[a]=s[a])}},e}(t.IMiniGameBaseCtr);t.IMiniGame14=i,__reflect(i.prototype,"miniGame.IMiniGame14")}(miniGame||(miniGame={}));var miniGame;!function(t){t.testData14={stageId:1,show:1,passes:[]},t.IMiniGame14Consts={guideTime:500,guideNumer:3,end_switch:!1,lightAlphaTime2:300,lightAlphaTime1:300,lightTime2:300,lightTime1:300,lightScalx2:10,lightScalx1:10,shakeArr:[6,10],vortexScalx:3,vortex_speed:15,vortex_value:-5,img_Scalx:.6,img_diff:.05,isNeedMap:!1,level_diff:.1,secne_diff:.01,tipsTime:2e3,tipsText:"请先选择技能",ui_zhaocaijinbao:"ui_zhaocaijinbao",ui_wuzhong:"ui_wuzhong",ui_die:"ui_die",ui_datang:"ui_datang",ui_hechengshengji:"ui_hechengshengji",ui_longxishui:"ui_longxishui",ui_qipao:"ui_qipao",skillText:"剩余{}次",skill2Text:"{}/{}",confirmString:"确认",radiusRange:1e3,interval_low:1,interval:1,map:[1536,1536,6,6,1,1],quantity:5,tQuantity:20,minigame14_bgm:"minigame14_bgm",minigame14_win:"minigame14_win",minigame14_die:"minigame14_die",minigame14_fishself:"minigame14_fishself",minigame14_fish:"minigame14_fish",minigame14_skill:"minigame14_skill",radius:700,skill2_radius:700,fish:{},skills:{},player:{}}}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(t){function i(){return t.call(this)||this}return __extends(i,t),i.prototype.fly=function(t,i,e,s){this.isTween||(this.thisObj=i,this.fun=t,this.isTween=!0,egret.Tween.removeTweens(this),egret.Tween.get(this).to({x:e,y:s},200).call(this.reset,this))},i.prototype.reset=function(){this.isTween=!1,this.fun&&this.fun.call(this.thisObj,this)},i.prototype.dispose=function(){t.prototype.dispose.call(this),this.thisObj=null,this.fun=null,this.isTween=null},i}(t.ImageOutside);t.IMiniGame14Image=i,__reflect(i.prototype,"miniGame.IMiniGame14Image")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.isMonster=!0,t.point_mon=GObj.create(egret.Point),t}return __extends(e,i),e.prototype.setData=function(t){i.prototype.setData.call(this,t)},e.prototype.updatePos=function(i,e){this.x=0==GMath.randomInt(0,1)?GMath.randomInt(i-t.IMiniGame14Consts.radius,i-StageManager.stageWidthHalf):GMath.randomInt(i+StageManager.stageWidthHalf,i+t.IMiniGame14Consts.radius),this.y=0==GMath.randomInt(0,1)?GMath.randomInt(e-t.IMiniGame14Consts.radius,e-StageManager.stageHeightHalf):GMath.randomInt(e+StageManager.stageHeightHalf,e+t.IMiniGame14Consts.radius),this.setMoveArea(i-t.IMiniGame14Consts.radius,e-t.IMiniGame14Consts.radius,i+t.IMiniGame14Consts.radius,e+t.IMiniGame14Consts.radius),this.setAngle(GMath.randomInt(0,360))},e.prototype.reSet=function(){i.prototype.reSet.call(this),this._isTween=!1,this.target=null,egret.Tween.removeTweens(this),this.pointer&&this.pointer.parent&&this.pointer.parent.removeChild(this.pointer)},e.prototype.move=function(){if(this._isMove){if(this.target)return void this.targetMove();var t=this.x+(this.speedx||0),e=this.y+(this.speedy||0);if(t<this.sx||t>this.ex||e<this.sy||e>this.ey){var s=(this.angle+GMath.randomInt(90,270))%360;this.setAngle(s)}i.prototype.move.call(this)}},e.prototype.setTarget=function(t){this.target||(this.target=t)},e.prototype.playMoive=function(){this.skill3Eff||(this.skill3Eff=GObj.create(t.IMovie)),this.skill3Eff.parent||this.addChild(this.skill3Eff),this.skill3Eff.autoRun(),this.skill3Eff.start(t.IMiniGame14Consts.ui_wuzhong,1)},e.prototype.targetMove=function(){var t=GMath.angle(this.x,this.y,this.target.x,this.target.y);this.setAngle(t),this.x=this.x+(this.speedx||0),this.y=this.y+(this.speedy||0)},e.prototype.showHidePointer=function(i){return this.pointer||(this.pointer=GObj.create(t.IMiniGame14Pointer)),this.pointer.visible=i,this.pointer},e.prototype.setPointer=function(t,i,e){this.pointer&&this.pointer.setPointer(t,i,e)},e.prototype.getIsTween=function(){return this._isTween},e.prototype.setIsTween=function(t){this._isTween=t},e.prototype.run=function(){this.isRun&&(i.prototype.run.call(this),this.move())},e.prototype.dispose=function(){i.prototype.dispose.call(this),GObj.disposeObject(this.pointer),this.pointer=null,GObj.disposeObject(this.skill3Eff),this.skill3Eff=null},e}(t.IMiniGame14Avatar);t.IMiniGame14Monster=i,__reflect(i.prototype,"miniGame.IMiniGame14Monster")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.playerPool=[],t.skillArr=[],t.addArr=[],t._angle=0,t.skill2_num=0,t.width=t.height=100,t.anchorOffsetX=t.anchorOffsetY=t.width/2,t.initSkins(),t}return __extends(e,i),e.prototype.initSkins=function(){this.effect=GObj.create(t.IMovie),this.effect.x=this.effect.y=0,this.effect.start("ui_qipao"),this.effect.autoRun(),this.addChild(this.effect)},e.prototype.getPlayerLv=function(){return this.playerLv||1},e.prototype.addSkill=function(t){this.skillArr||(this.skillArr=[]),this.skillArr.push(t)},e.prototype.getSkillNum=function(){var t=this.skillArr&&0!=this.skillArr.length;return t?this.skillArr[0]:0},e.prototype.isHaveSkill=function(t){return-1!=this.skillArr.indexOf(t)?!0:!1},e.prototype.getPlayerArr=function(){return this.playerArr},e.prototype.getSkill2Number=function(){this.skill2_num=++this.skill2_num;var t=this.skillData[2].commonValue2||6;return this.skill2_num>=t&&(this.thisFun&&this.thisFun.call(this.thisObj),this.skill2_num=0),this.skill2_num},e.prototype.setData=function(t,i,e){if(t&&i&&e){if(this.fishData=i,this.playData=t,this.skillData=e,this.speed=t.playerSpeed||5,this.playerLv=t.initLv||1,this.maxLevel=t.maxLv||2,this.angle=0,this.maxSpeed=t.playerMaxSpeed||20,this.playerArr&&0!=this.playerArr.length)for(var s=0,h=this.playerArr;s<h.length;s++){var a=h[s];GObj.disposeObject(a)}this.playerArr=[],this.addGame14Avatar(this.playerLv)}},e.prototype.setSpeed=function(t){this.speed=t,this.speedx=this.speed*GMath.cos(this._angle),this.speedy=this.speed*GMath.sin(this._angle)},Object.defineProperty(e.prototype,"angle",{set:function(t){this.isMoved&&t!=this._angle&&(this._angle=Math.floor((t+360)%360),this.speedx=this.speed*GMath.cos(t),this.speedy=this.speed*GMath.sin(t),this.updateAngle())},enumerable:!0,configurable:!0}),e.prototype.getMove=function(){return this.isMoved},e.prototype.setMove=function(t){this.isMoved!=t&&(this.isMoved=t)},e.prototype.getMaxLevel=function(){return this.playerLv==this.maxLevel},e.prototype.setFun=function(t,i,e,s,h,a,n){this.thisObj=t,this.thisFun=i,this.thisFun2=e,this.thisFun3=s,this.thisFun4=h,this.thisFun5=a,this.thisFun6=n},e.prototype.reset=function(){for(var t=0,i=this.skillArr;t<i.length;t++){var e=i[t];GObj.disposeObject(e)}this.skillArr=[],this.skill2_num=0,this.thisFun=null,this.thisObj=null,this.thisFun2=null},e.prototype.addGame14Avatar=function(t,i){if(!(this.playerLv>=this.maxLevel)&&(t>this.playerLv&&(this.playerLv=t,i||(this.thisFun3&&this.thisFun3.call(this.thisObj,this.playerLv),!this.isPlayed&&this.thisFun5&&this.thisFun5.call(this.thisObj),this.thisFun&&1==this.getSkillNum()&&this.thisFun.call(this.thisObj))),t==this.maxLevel&&(this.updatePlayer(),this.thisFun6&&this.thisFun6.call(this.thisObj)),this.fishData[t])){for(var e=0,s=0;s<this.playerArr.length&&(this.playerArr[s].levelNum==t&&e++,2!=e);s++);if(2==e){for(var h=0;h<this.playerArr.length;h++)this.playerArr[h].levelNum==t&&(this.backPlayer(this.playerArr[h]),h--);!this.isPlayed&&this.thisFun5&&this.thisFun5.call(this.thisObj),this.addGame14Avatar(t+1)}else{var a=this.getPlayer();a.levelNum=t,this.thisFun4&&1==this.getSkillNum()&&this.thisFun4.call(this.thisObj,!0,a),a.scaleX=a.scaleY=this.fishData[t].scaleXY,a.setData(this.fishData[t]),a.initOver(),this.addChild(a),this.playerArr.push(a),this.changePos()}this.isPlayed=!0}},e.prototype.changModel=function(t){if(t)this.playerArr&&0!=this.playerArr.length&&this.playerArr[0].changeModel(t);else{var i=GMath.randomInt(this.playData.initLv||1,this.maxLevel);this.fishData[i]&&this.playerArr&&0!=this.playerArr.length&&this.playerArr[0].changeModel(this.fishData[i].model)}},e.prototype.updatePlayer=function(){for(var t,i=0,e=0;e<this.playerArr.length;e++)t=this.playerArr[e],t.levelNum!=this.playerLv||i>1?(this.backPlayer(t),e--):i++;this.changePos()},e.prototype.getAngle=function(){return this._angle},e.prototype.updateAngle=function(){for(var t=0;t<this.playerArr.length&&void 0!==this._angle;t++)this.playerArr[t].setAngle(this._angle),this.playerArr[t].rotation=this._angle+90;this.effect.rotation=this._angle+90,this.playerArr&&this.playerArr.length>0&&(this.effect.x=this.playerArr[0].x-this.playerArr[0].height/4*GMath.cos(this._angle),this.effect.y=this.playerArr[0].y-this.playerArr[0].height/4*GMath.sin(this._angle))},e.prototype.run=function(){for(var t=0;t<this.playerArr.length;t++)this.playerArr[t].setMove(!1);this.move()},e.prototype.setMoveArea=function(t,i,e,s){this.sx=t,this.sy=i,this.ex=e,this.ey=s},e.prototype.move=function(){if(this.isMoved){var t=this.x+(this.speedx||0),i=this.y+(this.speedy||0);t<this.sx?this.x=this.sx:t>this.ex?this.x=this.ex:this.x=t,i<this.sy?this.y=this.sy:i>this.ey?this.y=this.ey:this.y=i}},e.prototype.reduceGame14Avatar=function(t){var i=this.playerArr.indexOf(t);if(-1!=i&&this.backPlayer(t),this.playerArr&&0==this.playerArr.length)return void(this.thisFun2&&this.thisFun2.call(this.thisObj,!1));var e=this.getLevel();this.playerLv>e&&(this.playerLv=e,this.thisFun3&&this.thisFun3.call(this.thisObj,e)),this.playerLv=e,this.changePos()},e.prototype.getLevel=function(){for(var t=0,i=0;i<this.playerArr.length;i++)this.playerArr[i].levelNum>t&&(t=this.playerArr[i].levelNum);return t},e.prototype.getPlayer=function(){var i=this.playerPool.pop();return i||(i=GObj.create(t.IMiniGame14Avatar)),i},e.prototype.backPlayer=function(t){if(t&&-1==this.playerPool.indexOf(t)){t&&t.parent&&t.parent.removeChild(t),this.thisFun4&&1==this.getSkillNum()&&this.thisFun4.call(this.thisObj,!1,t);var i=this.playerArr.indexOf(t);-1!=i&&this.playerArr.splice(i,1),t.reSet(),this.playerPool.push(t)}},e.prototype.changePos=function(){this.playerArr.length>1&&this.playerArr.sort(this.hander);for(var i,e,s=this.playData.playerScaleXY||.6,h=this.width/2*s,a=this.height/2*s,n=0;n<this.playerArr.length;n++)i=this.playerArr[n],e=s-(this.playerLv-i.levelNum)*t.IMiniGame14Consts.level_diff,.1>e&&(e=.1),i.scaleX=this.playerArr[n].scaleY=e,i.x=0==n?this.width/2:this.width/2+h*Math.pow(-1,n),i.y=0==n?this.height/2:this.height/2+a*Math.ceil(n/2);this.updateAngle()},e.prototype.hander=function(t,i){return i.levelNum-t.levelNum},e.prototype.dispose=function(){if(GObj.disposeObject(this.effect),this.effect=null,this.fishData=null,this.skillData=null,this.playData=null,this.playerPool)for(var t=0,i=this.playerPool;t<i.length;t++){var e=i[t];GObj.disposeObject(e)}if(this.playerPool=null,this.playerArr)for(var s=0,h=this.playerArr;s<h.length;s++){var e=h[s];GObj.disposeObject(e)}this.playerArr=null,this.addArr=null,this.thisObj=null,this.thisFun=null,this.thisFun2=null,this.thisFun3=null,this.thisFun4=null,this.thisFun5=null,this.thisFun6=null},e}(egret.DisplayObjectContainer);t.IMiniGame14Player=i,__reflect(i.prototype,"miniGame.IMiniGame14Player")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var e=i.call(this)||this;return e.touchEnabled=!1,e.touchChildren=!1,e.pointerLab=GObj.create(eui.Label),e.pointerLab.size=30,e.pointerLab.textAlign=egret.HorizontalAlign.CENTER,e.pointerLab.verticalAlign=egret.VerticalAlign.MIDDLE,e.pointer=GObj.create(t.ImageOutside),e.pointer.loadCompleteCall(function(){var t=Math.min(e.pointer.iconWidth,e.pointer.iconHeight);e.pointer.anchorOffsetX=t/2,e.pointer.anchorOffsetY=t/2,e.width=t,e.height=t,e.anchorOffsetX=t/2,e.anchorOffsetY=t/2,e.pointer.x=t/2,e.pointer.y=t/2,e.pointerLab.width=t,e.pointerLab.height=t},e),e.pointer.setOutSrc("pointer"),e.addChild(e.pointer),e.addChild(e.pointerLab),e}return __extends(e,i),e.prototype.setPointer=function(t,i,e){this.pointer&&(this.x=t,this.y=i,this.pointer.rotation=e||0)},e.prototype.setWeaponNum=function(t){this.pointerLab.text=t+""},e.prototype.dispose=function(){GObj.disposeObject(this.pointerLab),this.pointerLab=null,GObj.disposeObject(this.pointer),this.pointer=null},e}(egret.DisplayObjectContainer);t.IMiniGame14Pointer=i,__reflect(i.prototype,"miniGame.IMiniGame14Pointer")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){return i.call(this)||this}return __extends(e,i),e.prototype.initSkins=function(){var e=this;this.isInit||(i.prototype.initSkins.call(this),this.mapGrp.touchEnabled=!0,this.mapGrp.touchChildren=!0,this.natureInfo.visible=!1,this.avatarGrp=GObj.create(egret.DisplayObjectContainer),this.avatarGrp.touchEnabled=!1,this.avatarGrp.touchChildren=!1,this.mapGrp.addChild(this.avatarGrp),this.vortex=GObj.create(t.ImageOutside),this.vortex.loadCompleteCall(function(){e.vortex.anchorOffsetX=e.vortex.width/2,e.vortex.anchorOffsetY=e.vortex.height/2},this),this.vortex.setOutSrc("vortex"),this.avatarGrp.addChild(this.vortex),this.initEffGrp(),this.imageGrp=GObj.create(eui.Group),this.imageGrp.touchEnabled=!1,this.imageGrp.touchChildren=!1,this.mapGrp.addChild(this.imageGrp),this.initUiGrp(),this.point_1=GObj.create(egret.Point),this.point_2=GObj.create(egret.Point),this.point_3=GObj.create(egret.Point),this.player=GObj.create(t.IMiniGame14Player),this.cameraFollow=this.player,this.skillView=GObj.create(t.IMiniGame14UpPop),this.skillView.horizontalCenter=this.skillView.verticalCenter=0,this.skillView.visible=!1,this.addChild(this.skillView))},e.prototype.initEffGrp=function(){this.effGrp=GObj.create(egret.DisplayObjectContainer),this.effGrp.touchEnabled=!1,this.effGrp.touchChildren=!1,this.mapGrp.addChild(this.effGrp),this.dragonEff=GObj.create(t.IMovie),this.effGrp.addChild(this.dragonEff),this.createEff=GObj.create(t.IMovie),this.effGrp.addChild(this.createEff),this.dynastyEff=GObj.create(t.IMovie),this.effGrp.addChild(this.dynastyEff),this.moneyEff=GObj.create(t.IMovie),this.addChild(this.moneyEff),this.dieEff=GObj.create(t.IMovie),this.effGrp.addChild(this.dieEff),this.upLevelE=GObj.create(t.IMovie),this.effGrp.addChild(this.upLevelE)},e.prototype.suspendEff=function(){this.dragonEff.stop(),this.createEff.stop(),this.dynastyEff.stop(),this.moneyEff.stop(),this.upLevelE.stop(),this.dieEff.stop()},e.prototype.initUiGrp=function(){var i=this;this.uiGrp=GObj.create(eui.Group),this.uiGrp.touchEnabled=!1,this.uiGrp.touchChildren=!1,this.uiGrp.width=this.width,this.uiGrp.height=this.height,this.addChild(this.uiGrp),this.light=GObj.create(t.ImageOutside),this.light.loadCompleteCall(function(){i.light.anchorOffsetX=i.light.width/2,i.light.anchorOffsetY=i.light.height/2},this),this.light.setOutSrc("light"),this.uiGrp.addChild(this.light),this.skill1_2Text=GObj.create(eui.Label),this.skill1_2Text.size=45,this.skill1_2Text.textColor=16776161,this.skill1_2Text.stroke=2,this.skill1_2Text.horizontalCenter=0,this.skill1_2Text.strokeColor=12017720,this.skill1_2Text.visible=!1,this.uiGrp.addChild(this.skill1_2Text),this.skill5NumberText=GObj.create(eui.Label),this.skill5NumberText.size=45,this.skill5NumberText.horizontalCenter=0,this.skill5NumberText.textColor=16776161,this.skill5NumberText.stroke=2,this.skill5NumberText.strokeColor=12017720,this.skill5NumberText.visible=!1,this.uiGrp.addChild(this.skill5NumberText),this.skill2Grp=GObj.create(eui.Group),this.skill2Grp.top=100,this.skill2Grp.left=15,this.uiGrp.addChild(this.skill2Grp),this.skill2Bg=GObj.create(t.ImageOutside),this.skill2Bg.loadCompleteCall(function(){i.skill2Grp.width=i.skill2Bg.width,i.skill2Grp.height=i.skill2Bg.height},this),this.skill2Bg.setOutSrc("tangmonkBg",FileConst.png),this.skill2Bg.x=this.skill2Bg.y=0,this.skill2Grp.addChild(this.skill2Bg),this.skill2Text=GObj.create(eui.Label),this.skill2Text.horizontalCenter=0,this.skill2Text.size=20,this.skill2Text.bottom=1,this.skill2Text.textColor=16776161,this.skill2Grp.addChild(this.skill2Text),this.timeGroup=GObj.create(eui.Group),this.timeGroup.top=210,this.timeGroup.right=15,this.uiGrp.addChild(this.timeGroup),this.timeBg=GObj.create(t.ImageOutside),this.timeBg.loadCompleteCall(function(){i.timeGroup.width=i.timeBg.width,i.timeGroup.height=i.timeBg.height},this),this.timeBg.setOutSrc("timebg"),this.timeGroup.addChild(this.timeBg),this.timelogo=GObj.create(t.ImageOutside),this.timeText=GObj.create(eui.Label),this.timelogo.loadCompleteCall(function(){i.timeText.x=i.timelogo.width+15},this),this.timelogo.setOutSrc("timelogo"),this.timelogo.verticalCenter=0,this.timeGroup.addChild(this.timelogo),this.timeText.size=18,this.timeText.textColor=65298,this.timeText.verticalCenter=0,this.timeGroup.addChild(this.timeText),this.broadcastImg=GObj.create(t.IMovie),this.broadcastImg.y=230,this.broadcastImg.visible=!1,this.uiGrp.addChild(this.broadcastImg),this.skillGroup=GObj.create(eui.Group),this.uiGrp.addChild(this.skillGroup),this.skillbg=GObj.create(t.ImageOutside),this.skillbg.loadCompleteCall(function(){i.skillGroup.height=i.skillbg.height,i.skillGroup.width=i.skillbg.width,i.skillGroup.anchorOffsetX=i.skillGroup.width/2,i.skillGroup.anchorOffsetY=i.skillGroup.height/2},this),this.skillbg.horizontalCenter=0,this.skillbg.verticalCenter=0,this.skillbg.setOutSrc("skillitem",FileConst.png),this.skillGroup.addChild(this.skillbg),this.skillIcon=GObj.create(t.ImageOutside),this.skillIcon.horizontalCenter=-8,this.skillIcon.verticalCenter=-2,this.skillGroup.addChild(this.skillIcon),this.container=GObj.create(egret.DisplayObjectContainer),this.allShape=GObj.create(egret.Shape),this.allShape.graphics.beginFill(0,.7),this.allShape.graphics.drawRect(0,0,StageManager.stageWidth,StageManager.stageHeight),this.allShape.graphics.endFill(),this.allShape.touchEnabled=!0,this.container.addChild(this.allShape),this.smallShape=GObj.create(egret.Shape),this.smallShape.graphics.beginFill(16777215,.8),this.smallShape.graphics.drawCircle(StageManager.stageWidthHalf,StageManager.stageHeightHalf,80),this.smallShape.graphics.endFill(),this.smallShape.blendMode=egret.BlendMode.ERASE,this.container.addChild(this.smallShape),this.renderTexture=GObj.create(egret.RenderTexture),this.blendBitmap=GObj.create(egret.Bitmap),this.renderTexture.drawToTexture(this.container),this.blendBitmap.texture=this.renderTexture,this.blendBitmap.touchEnabled=!0,this.blendBitmap.pixelHitTest=!0,this.addChild(this.blendBitmap),this.guideImg=GObj.create(t.ImageOutside),this.guideImg.loadCompleteCall(function(){i.guideImg.anchorOffsetX=i.guideImg.width/2,i.guideImg.anchorOffsetY=i.guideImg.height/2,i.guideImg.x=StageManager.stageWidthHalf,i.guideImg.y=StageManager.stageHeightHalf-80-i.guideImg.height},this),this.guideImg.setOutSrc("control",FileConst.png),this.addChild(this.guideImg),this.levelImg=GObj.create(t.ImageOutside),this.levelImg.loadCompleteCall(function(){i.levelImg.anchorOffsetX=i.levelImg.width/2,i.levelImg.anchorOffsetY=i.levelImg.height/2,i.levelImg.x=StageManager.stageWidthHalf,i.levelImg.y=StageManager.stageHeightHalf-145-i.levelImg.height/2},this),this.levelImg.setOutSrc("uplevel",FileConst.png),this.addChild(this.levelImg)},e.prototype.onBeginClick=function(t){this.isNewPlayer&&this.player&&4==this.player.getSkillNum()?this.skill4First=!0:this.skill4First=!1,this.startX=t.stageX,this.startY=t.stageY,this.addEventListener(egret.TouchEvent.TOUCH_END,this.onEndClick,this),this.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMoveClick,this)},e.prototype.onMoveClick=function(t){this.isNewPlayer&&(this.isNewPlayer=!1,this.hideNewPlayer()),this.skill4First?(this.player.setMove(!1),this.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBeginClick,this)):this.player.setMove(!0),this.isCanTime=!0,this.endX=t.stageX,this.endY=t.stageY,this.player.angle=GMath.angle(this.startX,this.startY,this.endX,this.endY)},e.prototype.onEndClick=function(t){this.removeEventListener(egret.TouchEvent.TOUCH_END,this.onEndClick,this),this.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMoveClick,this)},e.prototype.reSet=function(){i.prototype.reSet.call(this),this.stop(),this.trailing&&(this.trailing.stop(),this.trailing.rmAllTarget()),this.scaleFrame=.005,this.isOver=!1,this.canWin=!1,this.isCanRotate=!1,this.scaleVal=this.curData.player.sceneScaleXY||1.5,this.playerScalx=this.curData.player.playerScaleXY||.5,DispatcherManager.removeListener(HGEvent.HEARTBEAT,this.timeFunc,this)},e.prototype.setData=function(i){i&&(t.IMiniGame14.setDefaultData(i.passes[0]),this.data=i,this.curData=this.data.passes[0],this.initSkins(),this.popSkillView())},e.prototype.popSkillView=function(){App.sound.playBgm("");var t=this.curData.skills;this.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBeginClick,this),this.skillView&&this.skillView.setFun(this,this.updateView,t),this.skillView.visible=!0},e.prototype.updateView=function(i,e){this.guideAngle=0,this.levelImg.visible=!1,1==this.data.stageId?this.isNewPlayer=!0:this.isNewPlayer=!1,this.reSet(),App.sound.playBgm(t.IMiniGame14Consts.minigame14_bgm),this.canWin=!1,this.mapIdArr=this.curData.mapIdNumber||[1],this.mapIdNumber=this.curData.mapId||1,this.isCanTime=!1,this.loadMapImg(this.mapIdNumber,this.curData.map||t.IMiniGame14Consts.map),this.initPlayer(),this.initArr(),this.initMonsters(),this.changeMonsters(this.curData.player.initLv||1),IMiniGameMain.reqSocket(1,this.data.stageId),this.setCamera(),this.start(),this.player.addSkill(i),this.classReset(),this.skillBack(e),this.checkSkillRun(),this.isNewPlayer?this.openNewPlayer():this.hideNewPlayer()},e.prototype.openNewPlayer=function(){var t=this;this.blendBitmap.visible=!0,this.guideImg.visible=!0,ClockManager.setTimeout(function(){IMiniGameMain.getGuideView().playEffct(StageManager.stageWidthHalf-20,StageManager.stageHeightHalf+200),t.addChild(IMiniGameMain.getGuideView())},this,300)},e.prototype.hideNewPlayer=function(){this.blendBitmap.visible=!1,this.guideImg.visible=!1,1==this.data.stageId?(IMiniGameMain.rmGuideView(),this.levelImg.visible=!0,this.levelImg.alpha=1,egret.Tween.get(this.levelImg).wait(t.IMiniGame14Consts.guideTime).to({alpha:0},t.IMiniGame14Consts.guideTime)):this.levelImg.visible=!1;var i=this.player.getSkillNum();switch(i){case 0:case 3:case 4:case 6:this.broadcastHander(i)}this.skillUi(),this.skill4Fun(90,0)},e.prototype.classReset=function(){(this.isNewPlayer||4!=this.player.getSkillNum())&&this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBeginClick,this),this.timeNumer=0,this.times=this.curData.gameTime||60,this.timeText.text=this.getTime(this.times),this.isBig=!1,this.light.visible=!1,this.isShakeing=!1,this.light.scaleX=this.light.scaleY=1,this.light.alpha=1,this.mapGrp.scaleX=this.mapGrp.scaleY=this.curData.player.sceneScaleXY||1.5,this.vortex.visible=!1,this.vortex.scaleX=this.vortex.scaleY=1,this.skillView.visible=!1,this.skill2Grp.visible=!1,this.skill1_2Text.visible=!1,this.skill5NumberText.visible=!1,this.isSkilling=!1;for(var i,e=-1!=this.mapIdArr.indexOf(this.mapIdNumber),s=0;10>s;s++)i=GObj.create(t.ImageOutside),e?(i.visible=!0,i.loadCompleteCall(this.imageGrpFun,this,i),i.setOutSrc("map"+this.mapIdNumber+"_"+GMath.randomInt(1,3))):i.visible=!1,i.scaleX=i.scaleY=t.IMiniGame14Consts.img_Scalx,this.imageGrp.addChild(i),this.imageArr.push(i)},e.prototype.initPlayer=function(){var t=this.curData.player,i=this.curData.fish,e=this.curData.skills;this.player.reset(),this.player.setMove(!1),this.player&&this.player.setFun(this,this.skillFun,this.setResult,this.changeMonsters,this.addOrRemoveTarget,this.showUpLevel,this.maxLevelFun),this.player.setData(t,i,e),this.brushPosX=this.player.x=this.mapGrp.width/2,this.brushPosY=this.player.y=this.mapGrp.height/2,this.setMoveArea(this.player),this.avatarGrp.addChild(this.player)},e.prototype.initMonsters=function(){for(var i,e=t.IMiniGame14Consts.tQuantity||10,s=0;e>s;s++)i=GObj.create(t.IMiniGame14Monster),this.monstersPool.push(i)},e.prototype.maxLevelFun=function(){IMiniGameMain.reqSocket(2),3==this.player.getSkillNum()&&this.clearOne(this.skill3Arr),this.player.setMove(!1),this.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBeginClick,this),this.removeEventListener(egret.TouchEvent.TOUCH_END,this.onEndClick,this),this.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMoveClick,this),this.isCanTime=!1,this.stopSkill(),this.light.x=this.uiGrp.width/2,this.light.y=this.uiGrp.height/2,this.light.visible=!0,egret.Tween.get(this.light).to({scaleX:t.IMiniGame14Consts.lightScalx1,scaleY:t.IMiniGame14Consts.lightScalx1},t.IMiniGame14Consts.lightTime1).to({alpha:0},t.IMiniGame14Consts.lightAlphaTime1).call(this.afterLight,this)},e.prototype.afterLight=function(){this.light.visible=!1,this.vortex.visible=!0,this.vortex.x=this.player.x,this.vortex.y=this.player.y,this.isCanRotate=!0,this.lastScalx=this.scaleVal,this.setScale(this.minScale)},e.prototype.changeMonsters=function(i){this.changeMap(i);var e=this.curData.player.maxLv||2;if(!(i>=e)){this.high_grade=0;for(var s,h,a,n,o=t.IMiniGame14Consts.tQuantity-this.monstersIn.length,r=t.IMiniGame14Consts.quantity||5,l=t.IMiniGame14Consts.interval||2,p=0;p<this.monstersIn.length;p++)n=Math.abs(this.monstersIn[p].x-this.player.x)<this.width/2&&Math.abs(this.monstersIn[p].y-this.player.y)<this.height/2,n||(h=this.monstersIn[p],this.high_grade<r?(s=GMath.randomInt(i+1,i+l),this.high_grade++):(a=this.player.getPlayerLv()-t.IMiniGame14Consts.interval_low,1>a&&(a=1),s=GMath.randomInt(a,i)),h.setData(this.curData.fish[s]),h.updatePos(this.player.x,this.player.y),h.initOver(),h.setMove(!0));for(var c=0;o>c;c++)h=this.getMonsterFromPool(),this.high_grade<r?(s=GMath.randomInt(i+1,i+l),this.high_grade++):(a=this.player.getPlayerLv()-t.IMiniGame14Consts.interval_low,1>a&&(a=1),s=GMath.randomInt(a,i)),h.setData(this.curData.fish[s]),this.avatarGrp.addChild(h),h.updatePos(this.player.x,this.player.y),this.monstersIn.push(h),h.initOver(),h.setMove(!0);this.changeAllScalx()}},e.prototype.changeMap=function(i){if(t.IMiniGame14Consts.isNeedMap){var e=this.mapIdNumber-1,s=this.curData.changeLevel||[];if(0>e||e>=s.length)return;if(i!=s[e])return;this.loadMapImg(++this.mapIdNumber,this.curData.map||t.IMiniGame14Consts.map);for(var h=-1!=this.mapIdArr.indexOf(this.mapIdNumber),a=void 0,n=0;n<this.imageArr.length;n++)a=this.imageArr[n],h?(a.visible=!0,a.setOutSrc("map"+this.mapIdNumber+"_"+GMath.randomInt(1,3)),this.imageGrpFun(a)):a.visible=!1}},e.prototype.showUpLevel=function(){this.upLevelE.x=this.player.x,this.upLevelE.y=this.player.y,this.upLevelE.start(t.IMiniGame14Consts.ui_hechengshengji,1),this.upLevelE.autoRun()},e.prototype.run=function(){this.isRunning&&(this.playerRun(),this.effRun(),this.checkMonstor(),this.checkSkill6(),this.checkSkill3(),this.checkAvatarHit(),this.monstrun(),this.checkImgage(),this.trailing&&this.trailing.run(),this.rotateRun(),this.canWin&&this.checkWin(),this.isNewPlayer&&this.changeGuide())},e.prototype.changeGuide=function(){IMiniGameMain.getGuideView().x=StageManager.stageWidthHalf-10+40*GMath.cos(this.guideAngle),IMiniGameMain.getGuideView().y=StageManager.stageHeightHalf+150+40*GMath.sin(this.guideAngle),this.guideAngle=(this.guideAngle+t.IMiniGame14Consts.guideNumer)%360
},e.prototype.checkWin=function(){this.isOver||this.lastScalx==this.mapGrp.scaleX&&this.setResult(!0)},e.prototype.effRun=function(){switch(this.player.getSkillNum()){case 1:this.avatarGrp.localToGlobal(this.player.x,this.player.y,this.point_1),this.skill1_2Text.y=this.point_1.y-100;break;case 2:this.dynastyEff.x=this.player.x,this.dynastyEff.y=this.player.y;break;case 4:this.moneyEff.x=StageManager.stageWidthHalf,this.moneyEff.y=StageManager.stageHeightHalf;break;case 5:this.avatarGrp.localToGlobal(this.player.x,this.player.y,this.point_1),this.skill5NumberText.y=this.point_1.y-100;break;case 6:this.dragonEff.x=this.player.x,this.dragonEff.y=this.player.y}},e.prototype.timeFunc=function(){if(this.isSkilling)if(this.player&&this.player.isHaveSkill(3)){if(!this.skill3Arr||0==this.skill3Arr.length)return;if(this.skill3time!=this.curData.skills[3].duration)return void this.skill3time++;this.skill3time=0;for(var i=this.curData.skills[3].commonValue||1,e=this.curData.skills[3].commonValue2||2,s=void 0,h=(this.player.getAngle()||0)%360,a=0;a<this.skill3Arr.length;a++)s=this.skill3Arr[a],s.parent||this.avatarGrp.addChild(s),s.x=this.player.x-GMath.randomInt(180,230)*GMath.cos(h),s.y=this.player.y-GMath.randomInt(180,230)*GMath.sin(h),s.setData(this.curData.fish[i]),s.setSpeed(e),s.initOver(),s.setTarget(this.player),s.playMoive(),s.setMove(!0),s.scaleX=s.scaleY=this.playerScalx}else if(this.timeNumer-->0)this.player.isHaveSkill(1)?this.skill1_2Text.text=this.getTime(this.timeNumer):this.player.isHaveSkill(2)&&(this.skill2Text.text=this.getTime(this.timeNumer));else if(this.isSkilling=!1,this.player.isHaveSkill(1))DispatcherManager.removeListener(HGEvent.HEARTBEAT,this.timeFunc,this),this.skill1_2Text.visible=!1,this.trailing.stop(),this.player.getMaxLevel()||this.player.setSpeed(this.curData.player.playerSpeed||5);else if(this.player.isHaveSkill(2)){DispatcherManager.removeListener(HGEvent.HEARTBEAT,this.timeFunc,this),this.dynastyEff.stop(),this.player.getMaxLevel()||this.player.setSpeed(this.curData.player.playerSpeed||5);for(var a=0;a<this.skill2IconArr.length;a++)this.imageLoad(this.skill2IconArr[a]),this.skill2IconArr[a].visible=!0;this.skill2Text.text=IMiniGameMain.getString(t.IMiniGame14Consts.skill2Text,0,this.curData.skills[2].commonValue2||6)}},e.prototype.skillFun=function(){if(this.isSkilling=!0,1==this.player.getSkillNum())DispatcherManager.addListener(HGEvent.HEARTBEAT,this.timeFunc,this),this.player.setSpeed(this.curData.skills[1].commonValue||20),this.timeNumer=this.curData.skills[1].duration||5,this.skill1_2Text.text=this.getTime(this.timeNumer),this.broadcastHander(1),this.skill1_2Text.visible=!0,this.trailing.start();else if(2==this.player.getSkillNum()){DispatcherManager.addListener(HGEvent.HEARTBEAT,this.timeFunc,this);for(var i=0;i<this.skill2IconArr.length;i++)this.skill2IconArr[i].visible=!1;this.dynastyEff.autoRun(),this.dynastyEff.start(t.IMiniGame14Consts.ui_datang),this.timeNumer=this.curData.skills[2].duration||5,this.player.setSpeed(this.curData.skills[2].commonValue3||10),this.broadcastHander(2),this.skill2Text.text=this.getTime(this.timeNumer)}},e.prototype.checkNature=function(){if(!i.prototype.checkNature.call(this))return!1;if(this.isCanTime&&(this.times--,this.timeText.text=this.getTime(this.times),this.times<=0))if(t.IMiniGame14Consts.end_switch){var e=this.curData.player.maxLv||2;this.player.addGame14Avatar(e,!0)}else this.setResult(!1)},e.prototype.rotateRun=function(){this.isCanRotate&&(this.vortex.rotation=(this.vortex.rotation+t.IMiniGame14Consts.vortex_value)%360,this.vortex.scaleX>t.IMiniGame14Consts.vortexScalx||(this.vortex.scaleX=this.vortex.scaleX+.02,this.vortex.scaleY=this.vortex.scaleY+.02,this.jugdeMon()))},e.prototype.jugdeMon=function(){var i,e,s,h;if(this.player)for(var a=0;a<this.monstersIn.length;a++)i=this.monstersIn[a],e=Math.abs(i.x-this.vortex.x),s=Math.abs(i.y-this.vortex.y),h=e<=this.vortex.width*this.vortex.scaleX&&s<=this.vortex.height*this.vortex.scaleY,(h||this.vortex.scaleX>=2)&&(i.setTarget(this.player),i.setSpeed(t.IMiniGame14Consts.vortex_speed))},e.prototype.getTime=function(t){var i=Math.floor(t/60);i=i>=10?i:"0"+i;var e=t%60;return e=e>=10?e:"0"+e,i+":"+e||""},e.prototype.skill4Fun=function(t,i){if(this.player&&this.player.isHaveSkill(4)){if(i>=this.skill4Arr.length)return this.clearOne(this.skill4Arr),this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBeginClick,this),this.skill4Arr=[],void this.moneyEff.stop();var e;e=this.skill4Arr[i],e.parent||this.avatarGrp.addChildAt(e,0),e.x=this.player.x+300*GMath.cos(t),e.y=this.player.y+300*GMath.sin(t),e.setData(this.curData.fish[1]),e.scaleX=e.scaleY=this.playerScalx,e.setSpeed(this.curData.skills[4].commonValue2||2),e.initOver(),e.setMove(!0),e.setTarget(this.player),t+=25,i+=1,egret.Tween.get(this.moneyEff).wait(70).call(this.skill4Fun,this,[t,i])}},e.prototype.playerRun=function(){var i=this.player.getPlayerArr();if(i.length){for(var e,s=0;s<i.length&&(e=i[s],e);s++)e.isDie()&&(this.player.localToGlobal(e.x,e.y,this.point_1),this.effGrp.globalToLocal(this.point_1.x,this.point_1.y,this.point_2),this.dieEff.x=this.point_2.x,this.dieEff.y=this.point_2.y,this.dieEff.autoRun(),this.dieEff.start(t.IMiniGame14Consts.ui_die,1),this.player.reduceGame14Avatar(e),s--);i.length&&(this.player.run(),this.player.getMove&&this.setCamera())}},e.prototype.checkImgage=function(){if(this.player.isHaveSkill(2)&&this.skill2IconArr&&!this.isSkilling)for(var t,i,e,s,h,a=this.player.getPlayerArr(),n=0;n<a.length;n++)for(var o=0;o<this.skill2IconArr.length;o++)this.skill2IconArr[o].isTween||(t=this.player.localToGlobal(a[n].x,a[n].y),i=this.effGrp.localToGlobal(this.skill2IconArr[o].x,this.skill2IconArr[o].y),h=a[n].width/2*a[n].scaleX+this.skill2IconArr[o].width/2*this.skill2IconArr[o].scaleX,GMath.distance(t.x,t.y,i.x,i.y)<=h&&(e=this.uiGrp.localToGlobal(this.skill2Grp.x,this.skill2Grp.y),s=this.effGrp.globalToLocal(e.x,e.y),this.skill2IconArr[o].fly(this.setSkill2,this,s.x,s.y)))},e.prototype.skillBack=function(t){this.skillGroup.scaleX=this.skillGroup.scaleY=0;var i=this.player.getSkillNum();this.skillIcon&&this.skillIcon.setOutSrc("skill"+i,FileConst.png),this.skillCollisionPlayer(t)},e.prototype.skillCollisionPlayer=function(t){this.skillGroup&&(egret.Tween.removeTweens(this.skillGroup),this.skillGroup.x=t[0],this.skillGroup.y=t[1],this.skillGroup.scaleX=this.skillGroup.scaleY=1,egret.Tween.get(this.skillGroup).to({x:this.uiGrp.width/2,y:this.uiGrp.height/2},600).to({scaleX:0,scaleY:0},200).call(function(){},this))},e.prototype.monstrun=function(){if(!this.monstersIn||0!=this.monstersIn.length){var i=this.player.getPlayerLv(),e=t.IMiniGame14Consts.interval+i,s=i-t.IMiniGame14Consts.interval_low;1>s&&(s=1);for(var h,a,n=0;n<this.monstersIn.length;n++)a=this.monstersIn[n],a.levelNum<=e&&a.levelNum>=s||Math.abs(a.x-this.player.x)<this.width/2&&Math.abs(a.y-this.player.y)<this.height/2||(h=GMath.randomInt(s,this.player.getPlayerLv()),a.setData(this.curData.fish[h]),this.changeOneScalx(a),a.updatePos(this.player.x,this.player.y),a.initOver(),a.setMove(!0))}},e.prototype.getMonsterFromPool=function(){var i=this.monstersPool.pop();return i||(i=GObj.create(t.IMiniGame14Monster)),i},e.prototype.monsterBackPool=function(t){t&&(t.parent&&t.parent.removeChild(t),-1==this.monstersPool.indexOf(t)&&(t.reSet(),this.monstersPool.push(t)))},e.prototype.checkAvatarHit=function(){var i=this.player.getPlayerLv(),e=this.player.getPlayerArr();if(e&&0!=e.length){var s=this.monstersIn;if(s&&0!=s.length){for(var h,a,n,o=0;o<e.length;o++)for(var r=0;r<s.length;r++)if(!(GMath.distance(this.player.x,this.player.y,s[r].x,s[r].y)>t.IMiniGame14Consts.radiusRange)&&(h=this.player.localToGlobal(e[o].x,e[o].y),a=this.avatarGrp.localToGlobal(s[r].x,s[r].y),n=1==this.player.getPlayerLv()&&1==s[r].levelNum?e[o].width*e[o].scaleX+s[r].width*s[r].scaleX:e[o].width/2*e[o].scaleX+s[r].width/2*s[r].scaleX,GMath.distance(h.x,h.y,a.x,a.y)<=n)){var l;switch(this.player.getSkillNum()){case 2:l=this.isSkilling?99999:i;break;case 5:l=this.skill5Number>0?i+this.curData.skills[5].commonValue||1:i;break;default:l=i}l>=s[r].levelNum?(i<s[r].levelNum&&5==this.player.getSkillNum()&&(this.broadcastHander(5),this.skill5Number--,this.showSkill5Text()),IMiniGameMain.playEff(t.IMiniGame14Consts.minigame14_fish),this.player.addArr.push(s[r].levelNum),this.dieEff.x=s[r].x,this.dieEff.y=s[r].y,this.dieEff.autoRun(),this.dieEff.start(t.IMiniGame14Consts.ui_die,1),this.monsterBackPool(s[r]),this.monstersIn.splice(r,1),this.isCanRotate&&this.changeModel(),r--):(e[o].setDie(),IMiniGameMain.playEff(t.IMiniGame14Consts.minigame14_fishself));break}if(this.player.addArr)for(;0!=this.player.addArr.length;)this.player.isPlayed=!1,this.player.addGame14Avatar(this.player.addArr[0]),this.player.addArr.splice(0,1);this.updateMonstor()}}},e.prototype.checkSkill3=function(){var i=this.player.getSkillNum();if(3==i||4==i){var e,s;if(s=3==i?this.skill3Arr:this.skill4Arr,s&&0!=s.length)for(var h=0;h<s.length;h++)e=s[h],e.getMove()&&e.parent&&GMath.distance(this.player.x,this.player.y,e.x,e.y)<=this.player.width/2+e.width/2*e.scaleX&&(e.cancel(),e.parent&&e.parent.removeChild(e),this.player.isPlayed=!1,IMiniGameMain.playEff(t.IMiniGame14Consts.minigame14_fish),this.player.addGame14Avatar(e.levelNum))}},e.prototype.checkSkill6=function(){if(this.player.isHaveSkill(6)&&!this.isCanRotate)for(var t,i=this.curData.skills[6].commonValue||200,e=this.curData.skills[6].commonValue2||4,s=0;s<this.monstersIn.length;s++)this.monstersIn[s].getIsTween()||(t=GMath.distance(this.player.x,this.player.y,this.monstersIn[s].x,this.monstersIn[s].y)<=this.player.width/2+i,this.player.getPlayerLv()>this.monstersIn[s].levelNum&&t&&(this.monstersIn[s].setIsTween(!0),this.monstersIn[s].setSpeed(e),this.monstersIn[s].setTarget(this.player)))},e.prototype.changeModel=function(){var i=this;if(this.player.changModel(),!this.isShakeing){this.isShakeing=!0;var e=t.IMiniGame14Consts.shakeArr||[3,5],s=GMath.randomInt(e[0],e[1]);egret.Tween.get(this).to({x:this.x-s,y:this.y-s},20).to({x:this.x+s,y:this.y+s},40).to({x:this.x,y:this.y},20).call(function(){i.isShakeing=!1},this)}},e.prototype.showSkill5Text=function(){return this.skill5Number<1?void(this.skill5NumberText.visible=!1):(this.skill5NumberText.visible=!0,void(this.skill5NumberText.text=IMiniGameMain.getString(t.IMiniGame14Consts.skillText,this.skill5Number)))},e.prototype.removeFromStage=function(){App.sound.playBgm(""),this.reSet()},e.prototype.stopSkill=function(){if(this.isSkilling=!1,this.player){var t=this.player.getSkillNum();switch(t){case 1:this.skill1_2Text.visible=!1;break;case 2:this.dynastyEff.stop();break;case 4:this.moneyEff.stop();break;case 5:this.skill5NumberText.visible=!1;break;case 6:this.dragonEff.x=this.player.x,this.dragonEff.stop()}}},e.prototype.updateMonstor=function(){if(this.player&&this.player.getMaxLevel())return void(this.monstersIn&&this.monstersIn.length<1&&(this.light.visible=!0,this.light.scaleX=this.light.scaleY=this.light.alpha=1,egret.Tween.get(this.light).to({scaleX:t.IMiniGame14Consts.lightScalx2,scaleY:t.IMiniGame14Consts.lightScalx2},t.IMiniGame14Consts.lightTime2).call(this.lastLight,this)));if(!(this.monstersPool&&this.monstersPool.length<1)){var i,e,s=this.player.getPlayerLv()-t.IMiniGame14Consts.interval_low;1>s&&(s=1);for(var h=0;h<this.monstersPool.length;h++)i=this.getMonsterFromPool(),e=GMath.randomInt(s,this.player.getPlayerLv()),i.setData(this.curData.fish[e]),this.changeOneScalx(i),i.updatePos(this.player.x,this.player.y),this.avatarGrp.addChild(i),this.monstersIn.push(i),this.changeOneScalx(i),i.initOver(),i.setMove(!0),h--}},e.prototype.lastLight=function(){egret.Tween.get(this.light).to({alpha:0},t.IMiniGame14Consts.lightAlphaTime2),this.setScale(this.lastScalx),this.canWin=!0,this.player.changModel(this.curData.player.winModel||"ui_yu7")},e.prototype.addOrRemoveTarget=function(t,i){this.trailing&&(t?this.trailing.addTarget(i):this.trailing.rmTarget(i))},e.prototype.checkSkillRun=function(){if(this.player)switch(this.suspendEff(),this.player.getSkillNum()){case 0:break;case 1:this.trailing||(this.trailing=GObj.create(t.ILinearTrailing)),this.trailing.parent||this.avatarGrp.addChild(this.trailing),this.skill1_2Text.text=this.getTime(this.curData.skills[1].duration||5),this.trailing.setBaseAtt(16777215,.2,.3);break;case 2:this.skill2Text.text=this.getTime(this.timeNumer),this.skill2Text.text=IMiniGameMain.getString(t.IMiniGame14Consts.skill2Text,0,this.curData.skills[2].commonValue2||6);for(var i=this.curData.skills[2].commonValue||10,e=void 0,s=0;i>s;s++)e=GObj.create(t.IMiniGame14Image),e.loadCompleteCall(this.imageLoad,this,e),e.setOutSrc("tangmonk"),this.effGrp.addChild(e),this.skill2IconArr.push(e);break;case 3:DispatcherManager.addListener(HGEvent.HEARTBEAT,this.timeFunc,this),this.skill3time=0;for(var h=void 0,s=0;1>s;s++)h=GObj.create(t.IMiniGame14Monster),h.scaleX=h.scaleY=this.playerScalx,this.skill3Arr.push(h);break;case 4:for(var a=this.curData.skills[4].commonValue||10,n=void 0,s=0;a>s;s++)n=GObj.create(t.IMiniGame14Monster),n.scaleX=n.scaleY=this.playerScalx,this.skill4Arr.push(n);break;case 5:this.skill5Number=this.curData.skills[5].commonValue2||5;break;case 6:}},e.prototype.skillUi=function(){if(this.player)switch(this.player.getSkillNum()){case 0:break;case 1:this.trailing||(this.trailing=GObj.create(t.ILinearTrailing)),this.trailing.parent||this.avatarGrp.addChild(this.trailing),this.skill1_2Text.text=this.getTime(this.curData.skills[1].duration||5),this.trailing.setBaseAtt(16777215,.2,.3);break;case 2:this.skill2Grp.visible=!0;break;case 3:this.isSkilling=!0;break;case 4:this.moneyEff.start(t.IMiniGame14Consts.ui_zhaocaijinbao),this.moneyEff.autoRun();break;case 5:this.showSkill5Text();break;case 6:this.dragonEff.start(t.IMiniGame14Consts.ui_longxishui),this.dragonEff.autoRun()}},e.prototype.imageLoad=function(i){if(i){i.anchorOffsetX=i.width/2,i.anchorOffsetY=i.height/2;var e=StageManager.stageWidth/2+i.width/2,s=t.IMiniGame14Consts.skill2_radius,h=StageManager.stageHeight/2+i.height/2;i.x=0==GMath.randomInt(0,1)?GMath.randomInt(this.player.x-s-e,this.player.x-e):GMath.randomInt(this.player.x+e,this.player.x+e+s),i.y=0==GMath.randomInt(0,1)?GMath.randomInt(this.player.y-h-s,this.player.y-h):GMath.randomInt(this.player.y+h,this.player.y+h+s)}},e.prototype.setSkill2=function(i){var e=this.player.getSkill2Number();e&&(this.skill2Text.text=IMiniGameMain.getString(t.IMiniGame14Consts.skill2Text,e,this.curData.skills[2].commonValue2||6)),i&&this.imageLoad(i)},e.prototype.checkMonstor=function(){var i=t.IMiniGame14Consts.radius,e=Math.abs(this.player.x-this.brushPosX)>i+StageManager.stageWidth/2||Math.abs(this.player.y-this.brushPosY)>i+StageManager.stageHeight/2;if(e){this.brushPosX=this.player.x,this.brushPosY=this.player.y;for(var s,h=0;h<this.monstersIn.length;h++)s=this.monstersIn[h],Math.abs(s.x-this.player.x)<this.width/2&&Math.abs(s.y-this.player.y)<this.height/2||s.updatePos(this.player.x,this.player.y)}},e.prototype.initArr=function(){this.clearOne(this.monstersPool),this.monstersPool=[],this.clearOne(this.monstersIn),this.monstersIn=[],this.clearOne(this.skill3Arr),this.skill3Arr=[],this.clearOne(this.skill4Arr),this.skill4Arr=[],this.clearOne(this.skill2IconArr),this.skill2IconArr=[],this.clearOne(this.imageArr),this.imageArr=[]},e.prototype.clearOne=function(t){if(t)for(var i=t.length,e=0;i>e;e++)GObj.disposeObject(t[e])},e.prototype.setResult=function(i){if(!this.isOver)if(this.trailing&&this.trailing.stop(),DispatcherManager.removeListener(HGEvent.HEARTBEAT,this.timeFunc,this),this.isOver=!0,this.canWin=!1,this.initArr(),this.isCanTime=!1,i){IMiniGameMain.playEff(t.IMiniGame14Consts.minigame14_win),IMiniGameMain.reqSocket(3);var e=this.parent;e&&t.IMiniGameResult.showResult(IMiniGameResultType.type_1,e.outCloseClick,this)}else IMiniGameMain.playEff(t.IMiniGame14Consts.minigame14_die),t.IMiniGameResult.showResult(IMiniGameResultType.type_0,this.popSkillView,this)},e.prototype.imageGrpFun=function(i){i&&(i.anchorOffsetX=i.width/2,i.anchorOffsetY=i.height/2,i.x=GMath.randomInt(this.player.x-2*t.IMiniGame14Consts.radius,this.player.x+2*t.IMiniGame14Consts.radius),i.y=GMath.randomInt(this.player.y-2*t.IMiniGame14Consts.radius,this.player.y+2*t.IMiniGame14Consts.radius))},e.prototype.broadcastHander=function(i){this.broadcastImg&&(this.broadcastImg.stop(),egret.Tween.removeTweens(this.broadcastImg),this.broadcastImg.autoRun(),this.broadcastImg.start("broadcast"+i,1),this.broadcastImg.visible=!0,this.broadcastImg.x=-this.uiGrp.width/2,this.broadcastImg.alpha=0,IMiniGameMain.playEff(t.IMiniGame14Consts.minigame14_skill),egret.Tween.get(this.broadcastImg).wait(100).to({x:this.uiGrp.width/2+10,alpha:1},200).to({x:this.uiGrp.width/2},50).wait(1e3).to({x:3*this.uiGrp.width/2},200))},e.prototype.changeAllScalx=function(){for(var i=0;i<this.monstersIn.length;i++)this.changeOneScalx(this.monstersIn[i]);var e=this.curData.player.initLv||1,s=this.player.getPlayerLv(),h=this.curData.player.sceneScaleXY||1.5,a=h-(s-e)*t.IMiniGame14Consts.secne_diff;a<this.minScale&&(a=this.minScale),this.setScalx(a+.1),this.setScale(a);var n=t.IMiniGame14Consts.img_Scalx-t.IMiniGame14Consts.img_diff*(s-e);.1>n&&(n=.1);for(var o=0;o<this.imageArr.length;o++)this.imageArr[o].scaleX=this.imageArr[o].scaleY=n},e.prototype.setScalx=function(t){this.mapGrp.scaleX=this.mapGrp.scaleY=t,this.scaleVal=t},e.prototype.changeOneScalx=function(i){if(i){var e=this.player.getPlayerLv(),s=this.playerScalx+(i.levelNum-e)*t.IMiniGame14Consts.level_diff;.1>s&&(s=.1),i.scaleX=i.scaleY=s}},e.prototype.dispose=function(){this.isDestory||(this.removeEvent(),DispatcherManager.removeListener(HGEvent.HEARTBEAT,this.timeFunc,this),GObj.disposeObject(this.avatarGrp),this.avatarGrp=null,GObj.disposeObject(this.player),this.player=null,this.clearOne(this.monstersPool),this.monstersPool=null,this.clearOne(this.monstersIn),this.monstersIn=null,GObj.disposeObject(this.effGrp),this.effGrp=null,GObj.disposeObject(this.upLevelE),this.upLevelE=null,GObj.disposeObject(this.dragonEff),this.dragonEff=null,GObj.disposeObject(this.createEff),this.createEff=null,GObj.disposeObject(this.dynastyEff),this.dynastyEff=null,GObj.disposeObject(this.dieEff),this.dieEff=null,GObj.disposeObject(this.moneyEff),this.moneyEff=null,GObj.disposeObject(this.imageGrp),this.imageGrp=null,this.clearOne(this.imageArr),this.imageArr=null,GObj.disposeObject(this.uiGrp),this.uiGrp=null,GObj.disposeObject(this.skill1_2Text),this.skill1_2Text=null,this.clearOne(this.skill2IconArr),this.skill2IconArr=null,GObj.disposeObject(this.skill2Grp),this.skill2Grp=null,GObj.disposeObject(this.skill2Bg),this.skill2Bg=null,GObj.disposeObject(this.skill2Text),this.skill2Text=null,GObj.disposeObject(this.skill5NumberText),this.skill5NumberText=null,this.data=null,this.curData=null,this.clearOne(this.skill3Arr),this.skill3Arr=null,this.clearOne(this.skill4Arr),this.skill4Arr=null,GObj.disposeObject(this.skillView),this.skillView=null,GObj.disposeObject(this.broadcastImg),this.broadcastImg=null,GObj.disposeObject(this.skillGroup),this.skillGroup=null,GObj.disposeObject(this.skillbg),this.skillbg=null,GObj.disposeObject(this.skillIcon),this.skillIcon=null,GObj.disposeObject(this.trailing),this.trailing=null,GObj.disposeObject(this.light),this.light=null,GObj.disposeObject(this.vortex),this.vortex=null,GObj.disposeObject(this.timeText),this.timeText=null,GObj.disposeObject(this.timelogo),this.timelogo=null,GObj.disposeObject(this.timeBg),this.timeBg=null,GObj.disposeObject(this.levelImg),this.levelImg=null,GObj.disposeObject(this.guideImg),this.guideImg=null,this.point_1=null,this.point_2=null,this.point_3=null,i.prototype.dispose.call(this))},e}(t.IMiniGameSecne);t.IMiniGame14Secne=i,__reflect(i.prototype,"miniGame.IMiniGame14Secne")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function s(){var t=i.call(this)||this;return t.initSkins(),t.confirmBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,t.startGame,t),t.list.addEventListener(eui.ItemTapEvent.ITEM_TAP,t.onListClick,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.removedStage,t),t}return __extends(s,i),s.prototype.setFun=function(t,i,e){this.thisObj=t,this.closeBack=i,this.skillData=e,this.updateList()},s.prototype.removedStage=function(){egret.Tween.removeTweens(this.bg),egret.Tween.removeTweens(this.descLab),this.bg.height=this.descLab.size=0},s.prototype.initSkins=function(){var i=this;if(!this.isInit){this.isInit=!0,this.horizontalCenter=0,this.verticalCenter=0,this.width=StageManager.stageWidth,this.height=StageManager.stageHeight,this.touchEnabled=!1,this.bgRect=GObj.create(eui.Rect),this.bgRect.horizontalCenter=0,this.bgRect.verticalCenter=0,this.bgRect.width=StageManager.stageWidth,this.bgRect.height=StageManager.stageHeight+600,this.bgRect.touchEnabled=!1,this.addChild(this.bgRect),this.view_bg=GObj.create(t.ImageOutside),this.view_bg.horizontalCenter=0,this.view_bg.verticalCenter=0,this.view_bg.setOutSrc("skillview14bg",FileConst.jpg),this.addChild(this.view_bg),this.skillItemGrp=GObj.create(eui.Group),this.skillItemGrp.horizontalCenter=this.skillItemGrp.verticalCenter=0,this.addChild(this.skillItemGrp),this.skillBg=GObj.create(t.ImageOutside),this.skillBg.horizontalCenter=0,this.skillBg.verticalCenter=0,this.skillBg.loadCompleteCall(function(){i.skillItemGrp.width=i.skillBg.width,i.skillItemGrp.height=i.skillBg.height},this),this.skillBg.setOutSrc("skill14bg",FileConst.png),this.skillItemGrp.addChild(this.skillBg),this.scro=GObj.create(eui.Scroller),this.scro.horizontalCenter=2,this.scro.verticalCenter=5,this.scro.height=594,this.scro.width=470,this.skillItemGrp.addChild(this.scro),this.listData=GObj.create(eui.ArrayCollection),this.list=GObj.create(eui.List),this.list.height=594,this.list.width=470,this.list.horizontalCenter=this.list.verticalCenter=0,this.list.itemRenderer=e,this.list.dataProvider=this.listData;var s=GObj.create(eui.VerticalLayout);s.gap=0,this.list.layout=s,this.scro.viewport=this.list,this.confirmBtn=GObj.create(t.IBaseBtn),this.confirmBtn.horizontalCenter=0,this.confirmBtn.bottom=-20,this.confirmBtn.icon=IMiniGameMain.getIcon("confirm",FileConst.png),this.confirmBtn.labelDisplay.textColor=7751207,this.confirmBtn.labelDisplay.size=22,this.confirmBtn.label=t.IMiniGame14Consts.confirmString,this.skillItemGrp.addChild(this.confirmBtn),this.bg=GObj.create(t.ImageOutside),this.bg.setOutSrc("tipsBg",FileConst.png),this.bg.horizontalCenter=0,this.bg.verticalCenter=0,this.bg.height=0,this.bg.touchEnabled=!1,this.addChild(this.bg),this.descLab=GObj.create(eui.Label),this.descLab.horizontalCenter=0,this.descLab.verticalCenter=0,this.descLab.size=0,this.descLab.text=t.IMiniGame14Consts.tipsText,this.descLab.touchEnabled=!1,this.addChild(this.descLab)}},s.prototype.onListClick=function(t){if(t&&t.itemRenderer){var i=t.itemRenderer;this.skillIndex=i.skillindex,this.posArr=i.getXY()}},s.prototype.updateList=function(){this.list.selectedIndex=this.skillIndex=void 0;var t=[],i=this.skillData;if(this.skillData){for(var e in i)t.push({skillname:i[e].skillName,skilldes:i[e].skillDec,skillindex:i[e].idx,isShake:!0});this.list.scrollV=0,this.listData.replaceAll(t)}},s.prototype.startGame=function(){return this.list.selectedIndex<0?void this.showTips():(this.list.scrollV=0,void(this.closeBack&&this.closeBack.call(this.thisObj,this.skillIndex,this.posArr)))},s.prototype.showTips=function(){this.removedStage(),egret.Tween.get(this.bg).to({height:88},600).wait(t.IMiniGame14Consts.tipsTime).to({height:0},600),egret.Tween.get(this.descLab).to({size:36},600).wait(t.IMiniGame14Consts.tipsTime).to({size:0},600)},s.prototype.dispose=function(){if(this.thisObj=null,this.closeBack=null,this.confirmBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.startGame,this),this.list&&this.list.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onListClick,this),this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.removedStage,this),GObj.disposeObject(this.bgRect),this.bgRect=null,GObj.disposeObject(this.view_bg),this.view_bg=null,GObj.disposeObject(this.skillBg),this.skillBg=null,this.list){for(;this.list.$children.length>0;)GObj.disposeObject(this.list.$children[0]);this.list.dataProvider=null,GObj.disposeObject(this.list),this.list=null}GObj.disposeObject(this.listData),this.listData=null,this.scro&&(this.scro.stopAnimation(),this.scro.viewport=null,GObj.disposeObject(this.scro),this.scro=null),GObj.disposeObject(this.isInit),this.isInit=null,GObj.disposeObject(this.confirmBtn),this.confirmBtn=null,GObj.disposeObject(this.skillIndex),this.skillIndex=null,GObj.disposeObject(this.bg),this.bg=null,GObj.disposeObject(this.skillItemGrp),this.skillItemGrp=null},s}(eui.Component);t.IMiniGame14UpPop=i,__reflect(i.prototype,"miniGame.IMiniGame14UpPop");var e=function(i){function e(){var t=i.call(this)||this;return t.initskins(),t}return __extends(e,i),e.prototype.initskins=function(){var i=this;this.point=GObj.create(egret.Point),this.uigroup=GObj.create(eui.Group),this.uigroup.width=460,this.uigroup.anchorOffsetX=this.uigroup.width/2,this.uigroup.x=this.uigroup.width/2,this.uigroup.verticalCenter=0,this.addChild(this.uigroup),this.selectImage=GObj.create(t.ImageOutside),this.selectImage.horizontalCenter=0,this.selectImage.verticalCenter=0,this.selectImage.loadCompleteCall(function(){i.uigroup.width=i.width=i.selectImage.width,i.uigroup.height=i.height=i.selectImage.height,i.uigroup.anchorOffsetX=i.width/2,i.uigroup.anchorOffsetY=i.height/2,i.uigroup.x=i.uigroup.width/2},this),this.selectImage.setOutSrc("selected",FileConst.png),this.uigroup.addChild(this.selectImage),this.itemBg=GObj.create(t.ImageOutside),this.itemBg.horizontalCenter=0,this.itemBg.verticalCenter=0,this.itemBg.setOutSrc("itembg",FileConst.png),this.uigroup.addChild(this.itemBg),this.skillbg=GObj.create(t.ImageOutside),this.skillbg.left=15,this.skillbg.verticalCenter=0,this.skillbg.setOutSrc("skillitem",FileConst.png),this.uigroup.addChild(this.skillbg),this.skill=GObj.create(t.ImageOutside),this.skill.left=30,this.skill.verticalCenter=0,this.uigroup.addChild(this.skill),this.skillNameGroup=GObj.create(eui.Group),this.skillNameGroup.right=55,this.skillNameGroup.top=15,this.uigroup.addChild(this.skillNameGroup),this.skillnameBg=GObj.create(t.ImageOutside),this.skillnameBg.loadCompleteCall(function(){i.skillNameGroup.height=i.skillnameBg.height,i.skillNameGroup.width=i.skillnameBg.width},this),this.skillnameBg.setOutSrc("skillnamebg",FileConst.png),this.skillNameGroup.addChild(this.skillnameBg),this.skilldes=GObj.create(eui.Label),this.skilldesBg=GObj.create(t.ImageOutside),this.skilldesBg.right=15,this.skilldesBg.top=60,this.skilldesBg.setOutSrc("skillitemtextbg",FileConst.png),this.uigroup.addChild(this.skilldesBg),this.skillname=GObj.create(eui.Label),this.skillname.horizontalCenter=this.skillname.verticalCenter=0,this.skillname.size=20,this.skillname.bold=!0,this.skillname.fontFamily="Microsoft JhengHei",this.skillname.textColor=16769601,this.skillNameGroup.addChild(this.skillname),this.skilldes.right=22,this.skilldes.top=80,this.skilldes.textColor=16777215,this.skilldes.size=18,this.skilldes.width=220,this.skilldes.lineSpacing=12,this.skilldes.fontFamily="SimHei",this.skilldes.bold=!0,this.skilldes.wordWrap=!0,this.uigroup.addChild(this.skilldes),this.skinName=this.getSkin()},e.prototype.getXY=function(){return this.uigroup.localToGlobal(this.skillbg.left+this.skillbg.width/2,this.itemBg.height/2,this.point),[this.point.x,this.point.y]},e.prototype.getSkin=function(){var t=GObj.create(eui.Skin);return t.skinParts=["mcDisplay"],t.myself=this.uigroup,t.elementsContent=[this.uigroup],t.selectImg=this.selectImage,this.selectImage.visible=!1,t.states=[new eui.State("up",[]),new eui.State("down",[new eui.SetProperty("myself","scaleX",.99),new eui.SetProperty("myself","scaleY",.99),new eui.SetProperty("selectImg","visible",!0)]),new eui.State("upAndSelected",[new eui.SetProperty("myself","scaleX",.99),new eui.SetProperty("myself","scaleY",.99),new eui.SetProperty("selectImg","visible",!0)]),new eui.State("downAndSelected",[new eui.SetProperty("myself","scaleX",.99),new eui.SetProperty("myself","scaleY",.99),new eui.SetProperty("selectImg","visible",!0)])],t},e.prototype.dataChanged=function(){if(i.prototype.dataChanged.call(this),this.data&&this.uigroup&&(this.first=this.data.isShake,this.skillindex=this.data.skillindex,this.skillname.text=this.data.skillname,this.skilldes.text=this.data.skilldes,this.skill.setOutSrc("skill"+this.skillindex,FileConst.png),this.skillindex<3&&this.first)){egret.Tween.removeTweens(this.uigroup),this.first=this.data.isShake=!1,this.uigroup.x=0,this.uigroup.alpha=0;var t=150*(this.itemIndex+1);egret.Tween.get(this.uigroup).wait(t).to({x:this.uigroup.width/2+2,alpha:1},150).to({x:this.uigroup.width/2},50)}},e.prototype.dispose=function(){this.uigroup&&egret.Tween.removeTweens(this.uigroup),GObj.disposeObject(this.uigroup),this.uigroup=null,GObj.disposeObject(this.itemBg),this.itemBg=null,GObj.disposeObject(this.skillbg),this.skillbg=null,GObj.disposeObject(this.skill),this.skill=null,GObj.disposeObject(this.skillname),this.skillname=null,GObj.disposeObject(this.skilldes),this.skilldes=null,GObj.disposeObject(this.skillindex),this.skillindex=null,GObj.disposeObject(this.skillnameBg),this.skillnameBg=null,GObj.disposeObject(this.skilldesBg),this.skilldesBg=null,GObj.disposeObject(this.selectImage),this.selectImage=null},e}(eui.ItemRenderer);t.skill14Item=e,__reflect(e.prototype,"miniGame.skill14Item")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){return i.call(this)||this}return __extends(e,i),e.prototype.initSkins=function(){this.isInit||(this.isInit=!0,this.width=StageManager.stageWidth,this.height=StageManager.stageHeight,this.scene=GObj.create(t.IMiniGame14Secne),this.addChild(this.scene),this.exitBtn=GObj.create(t.IBaseBtn),this.exitBtn.icon=IMiniGameMain.getIcon("exit_btn",FileConst.png,"chapter"),this.exitBtn.right=20,this.exitBtn.top=100,this.addChild(this.exitBtn),this.addEvent())},e.prototype.setData=function(t){this.initSkins(),this.scene.setData(t)},e.prototype.addEvent=function(){this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.exitBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCloseClick,this)},e.prototype.removeEvent=function(){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.exitBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onCloseClick,this)},e.prototype.onAddToStage=function(){this.parent!=this.stage&&IMiniGameMain.addToStage(this)},e.prototype.onCloseClick=function(t){this.scene&&this.scene.removeFromStage(),i.prototype.onCloseClick.call(this,t)},e.prototype.dispose=function(){this.isDestory||(this.isDestory=!0,this.removeEvent(),GObj.disposeObject(this.scene),this.scene=null,GObj.disposeObject(this.exitBtn),this.exitBtn=null,i.prototype.dispose.call(this))},e}(t.IBaseView);t.IMiniGame14View=i,__reflect(i.prototype,"miniGame.IMiniGame14View")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(t){return i.call(this,t)||this}return __extends(e,i),e.prototype.getGameView=function(){return this.gameView||(this.gameView=GObj.create(t.IMiniGame15View)),this.gameView.setData(this.getCurGameData()),this.gameView},e.prototype.loadConfigComplete=function(e){if(e)for(var s in e.config)t.IMiniGame15Consts[s]=e.config[s];t.IMiniGame15Consts.speedPro||(t.IMiniGame15Consts.speedPro=1),i.prototype.loadConfigComplete.call(this,e)},e.prototype.dispose=function(){i.prototype.dispose.call(this)},e}(t.IMiniGameBaseCtr);t.IMiniGame15=i,__reflect(i.prototype,"miniGame.IMiniGame15")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var e=i.call(this)||this;return e.scaleX=t.IMiniGame15Consts.avatarScale,e.scaleY=t.IMiniGame15Consts.avatarScale,e.speed=t.IMiniGame15Consts.speed,e.gapFrame=0,e}return __extends(e,i),e.prototype.initModel=function(t){this.updatePart(t),this.setDirection(AvatarConsts.R_R),this.showWait()
},e.prototype.showDied=function(){this.setAction(AvatarConsts.ACTION_DIE),this._isMove=!1,this.isDrop=!0,IMiniGameMain.playEff(t.IMiniGame15Consts.minigame_die)},e.prototype.showWait=function(){this.setAction(AvatarConsts.ACTION_STAND),this._isMove=!1,this.isDrop=!1,this.gapFrame=-1},e.prototype.showWalk=function(){this.setAction(AvatarConsts.ACTION_WALK),this._isMove=!0,this.gapFrame=0,this.setAngle(0)},e.prototype.showStickUp=function(){this.setAction(AvatarConsts.ACTION_ATTACK,1,AvatarConsts.ACTION_ATTACK_I),this._isMove=!1,this.isDrop=!1},e.prototype.showEat=function(){this.setAction(AvatarConsts.ACTION_JUMP,1,AvatarConsts.ACTION_JUMP_II),this._isMove=!1,this.isDrop=!1},e.prototype.setMoveData=function(t){this.moveFrame=Math.floor(t/this.speed)},e.prototype.run=function(){i.prototype.run.call(this),this._action==AvatarConsts.ACTION_WALK&&--this.gapFrame<=0&&(this.gapFrame=t.IMiniGame15Consts.effGapWalkFrame,IMiniGameMain.playEff(t.IMiniGame15Consts.minigame_walk))},e.prototype.move=function(){this._isMove&&(this.x+=this.speedx||0,this.y+=this.speedy||0,--this.moveFrame<0&&(this.isMoveOver=!0,this._isMove=!1))},e}(t.IAvatarViewExt);t.IMiniGame15Avatar=i,__reflect(i.prototype,"miniGame.IMiniGame15Avatar")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.initSkins(),t}return __extends(e,i),e.prototype.initSkins=function(){var i=this;this.touchEnabled=!1,this.touchChildren=!1,this.bg=GObj.create(t.ImageOutside),this.bg.horizontalCenter=0,this.bg.loadCompleteCall(function(){i.width=i.bg.iconWidth,i.height=i.bg.iconHeight},this),this.bg.setOutSrc("perbar_0"),this.addChild(this.bg),this.thumb=GObj.create(t.ImageOutside),this.thumb.verticalCenter=0,this.thumb.setOutSrc("perbar_1"),this.addChild(this.thumb),this.endPoint=GObj.create(t.ImageOutside),this.endPoint.loadCompleteCall(function(){i.endPoint.anchorOffsetY=i.endPoint.iconHeight/2,i.endPoint.right=-i.endPoint.iconWidth/2},this),this.endPoint.setOutSrc("result0"),this.endPoint.verticalCenter=0,this.addChild(this.endPoint),this.point=GObj.create(t.ImageOutside),this.point.loadCompleteCall(function(){i.point.anchorOffsetX=t.IMiniGame15Consts.leftHead,i.point.anchorOffsetY=i.point.iconHeight/2},this),this.point.setOutSrc("head"),this.point.verticalCenter=0,this.addChild(this.point),this.slideDuration=500},e.prototype.setData=function(t,i){if(!(0>t||t>i)){var e=this.thumb.width;this.value=t/i*100,this.point.x=e*t/i+this.thumb.x}},e.prototype.dispose=function(){GObj.disposeObject(this.bg),this.bg=null,GObj.disposeObject(this.thumb),this.thumb=null,GObj.disposeObject(this.point),this.point=null,GObj.disposeObject(this.endPoint),this.endPoint=null},e}(eui.ProgressBar);t.IMiniGame15Bar=i,__reflect(i.prototype,"miniGame.IMiniGame15Bar")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.randomData(),t}return __extends(e,i),e.prototype.setStart=function(){this.setColumnByType(0),this.setColumnW(1)},e.prototype.randomData=function(t){this.setColumnByType(1),this.setColumnW(t)},e.prototype.setEnd=function(){this.setColumnByType(2),this.setColumnW(1)},e.prototype.loadOver=function(){i.prototype.loadOver.call(this),this.oldW=this.iconWidth,this.oldH=this.iconHeight,this.setColumnW(this.rd)},e.prototype.setColumnByType=function(t){this.oldH=void 0,this.oldW=void 0,this.rd=1,this.idxSrc=t,this.setOutSrc(null),this.setOutSrc("column"+t)},e.prototype.setColumnW=function(i){this.rd=i,this.oldW&&(i||(i=GMath.random(t.IMiniGame15Consts.scaleXY[0],t.IMiniGame15Consts.scaleXY[1])),this.width=this.oldW*i,this.height=this.oldH*i,this.anchorOffsetX=this.width/2,this.anchorOffsetY=t.IMiniGame15Consts.midPoints[this.idxSrc]*i)},e.prototype.dispose=function(){i.prototype.dispose.call(this),this.oldH=void 0,this.oldW=void 0,this.rd=void 0},e}(t.ImageOutside);t.IMiniGame15Column=i,__reflect(i.prototype,"miniGame.IMiniGame15Column")}(miniGame||(miniGame={}));var miniGame;!function(t){t.IMiniGame15Consts={model:"monster_lukuanghuan",bgMovie:"ui_yunwu",stickMovie:"ui_yan",avatarScale:.7,speed:4,dropSpeed:10,stickAdd:3,stickAngle:4,effGapFrame:100,effGapWalkFrame:100,speedPro:1.5,scaleXY:[.5,1],bgsrc:[],stick9Grid:[],midPoints:[18,22,44],lastItem:"result0",leftHead:20,trailingColor:0,minigame_bgm:"",minigame_stick_drop:"",minigame_stick:"",minigame_walk:"",minigame_die:"",minigame_win:"",minigame_lose:""}}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.initSkins(),t}return __extends(e,i),e.prototype.initSkins=function(){var i=this;this.width=540,this.height=960,this.bgSpeed=.2,this.bgScro=GObj.create(eui.Scroller),this.bgScro.touchEnabled=!1,this.bgScro.touchChildren=!1,this.bgScro.scrollPolicyH=eui.ScrollPolicy.OFF,this.bgScro.scrollPolicyV=eui.ScrollPolicy.OFF,this.bgScro.width=this.width,this.addChild(this.bgScro),this.bgGrp=GObj.create(eui.Group),this.bgScro.viewport=this.bgGrp,this.bg1=GObj.create(t.ImageOutside),this.bg1.exact=!0,this.bg1.x=0,this.bg1.width=this.width,this.bg1.height=this.height,this.bgGrp.addChild(this.bg1),this.bg2=GObj.create(t.ImageOutside),this.bg2.exact=!0,this.bg2.x=this.width,this.bg2.width=this.width,this.bg2.height=this.height,this.bgGrp.addChild(this.bg2),this.perbar=GObj.create(t.IMiniGame15Bar),this.perbar.x=0,this.perbar.y=50+IMiniGameMain.safeHeight,this.bgGrp.addChild(this.perbar),this.timeBg=GObj.create(t.ImageOutside),this.timeBg.x=2,this.timeBg.y=this.perbar.y+80,this.timeBg.setOutSrc("icon2"),this.bgGrp.addChild(this.timeBg),this.timeLab=GObj.create(eui.Label),this.timeLab.size=24,this.timeLab.x=this.timeBg.x+28,this.timeLab.y=this.timeBg.y,this.bgGrp.addChild(this.timeLab),this.column1=GObj.create(t.IMiniGame15Column),this.curColumn=this.column1,this.bgGrp.addChild(this.column1),this.column2=GObj.create(t.IMiniGame15Column),this.nextColumn=this.column2,this.bgGrp.addChild(this.column2),this.avatar=GObj.create(t.IMiniGame15Avatar),this.avatar.setActOverCallBack(this.avatarActionBack,this),this.bgGrp.addChild(this.avatar),this.trailing=GObj.create(t.ILinearTrailing),this.trailing.setBaseAtt(null,.3,.8),this.bgGrp.addChild(this.trailing),this.stick=GObj.create(t.IMiniGame15Stick),this.bgGrp.addChild(this.stick),this.trailing.addTarget(this.stick),this.peach=GObj.create(t.ImageOutside),this.peach.loadCompleteCall(function(){i.peach.anchorOffsetX=i.peach.iconWidth/2,i.peach.anchorOffsetY=i.peach.iconHeight/2},this),this.bgGrp.addChild(this.peach),this.bgEff=GObj.create(t.IMovieMore),this.bgEff.start(t.IMiniGame15Consts.bgMovie,0,300),this.bgEff.y=this.height/2,this.bgGrp.addChild(this.bgEff),this.pointLab=GObj.create(t.IBitNumMap),this.pointLab.y=this.height/5,this.pointLab.horizontalCenter=0,this.pointLab.setPath("num13"),this.addChild(this.pointLab),this.touchArea=GObj.create(eui.Rect),this.touchArea.width=this.width,this.touchArea.height=this.height,this.touchArea.alpha=.01,this.addChild(this.touchArea),this.touchArea.touchChildren=!1,this.addEvent(),this.setBg()},e.prototype.addEvent=function(){this.touchArea.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBeginClick,this),this.touchArea.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEndClick,this),EnterFrameManager.instance.registeRender(this.run,this)},e.prototype.removeEvent=function(){this.touchArea.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBeginClick,this),this.touchArea.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEndClick,this),EnterFrameManager.instance.unRegisteRender(this.run,this)},e.prototype.onTouchBeginClick=function(t){this.isRun&&(this.stick.status=1,this.showGuide(!1),this.avatar.showStickUp())},e.prototype.onTouchEndClick=function(t){this.isRun&&1==this.stick.status&&(this.stick.status=2,this.touchArea.touchEnabled=!1,this.trailing.start())},e.prototype.run=function(){return this.isRun?(this.avatar.run(),this.stick.run(),this.bgMove(),this.checkResult(),this.success(),this.defeated(),this.secOne(),this.bgEff.run(),this.trailing.run(),!1):void 0},e.prototype.secOne=function(){this.time<0||GApp.timer-this.logTime<1e3||(this.logTime=GApp.timer,this.setTime(),--this.time<0&&this.setResult(IMiniGameResultType.type_0))},e.prototype.setTime=function(){if(this.time>=0){var t=this.time,i=int(t/60),e=t%60;this.timeLab.text=(10>i?"0":"")+i+":"+(10>e?"0":"")+e}},e.prototype.updateInfo=function(){this.pointLab.setString(IMiniGameMain.getString(IMiniGameLanguage.c_27,this.score)),this.perbar.setData(this.score,this.curData.score)},e.prototype.checkResult=function(){if(this.stick.isOver()){var t=this.nextColumn,i=this.stick.height+this.stick.x;i<t.x-t.width/2?i=0:i>t.x+t.width/2&&(i=t.x),i&&this.showStickDropEff(i,t.y),this.startMove()}this.avatar.isMoveOver&&(this.trailing.stop(),this.avatar.isMoveOver=!1,this.checkAvatarPos()?(this.score++,this.updateInfo(),IMiniGameMain.reqSocket(2)):this.avatar.showDied())},e.prototype.success=function(){if(this.isAllMove){var t=this.moveSpeed;this.avatar.x-=t,this.curColumn.x-=t,this.nextColumn.x-=t,this.stick.x-=t,this.curColumn.x<=this.curColumn.width/2+10&&(this.isAllMove=!1,this.moveSpeed=0,this.score<this.curData.score&&(this.startWait(),this.randomNext()))}},e.prototype.defeated=function(){this.avatar.isDrop&&(this.avatar.y+=t.IMiniGame15Consts.dropSpeed,this.avatar.y>this.height+this.avatar.height&&(this.avatar.showWait(),this.setResult(IMiniGameResultType.type_0)))},e.prototype.bgMove=function(){this.bg1.x-=this.bgSpeed,this.bg2.x-=this.bgSpeed,this.bg1.x<=-this.width&&(this.bg1.x=this.bg2.x+(this.bg2.width||this.width)),this.bg2.x<=-this.width&&(this.bg2.x=this.bg1.x+(this.bg1.width||this.width))},e.prototype.setBg=function(){var i=GMath.randomInt(t.IMiniGame15Consts.bgsrc[0],t.IMiniGame15Consts.bgsrc[1]);this.bg1.setOutSrc("bg"+i,FileConst.jpg),this.bg2.setOutSrc("bg"+i,FileConst.jpg)},e.prototype.randomNext=function(){var i=this;if(this.nextColumn)if(this.nextColumn.x=this.width+this.nextColumn.width/2,this.nextColumn.loadCompleteCall(function(){var e=i.curData.pos&&i.curData.pos[i.curColumnIdx],s=i.curColumn.x+i.curColumn.width/2;(!e||e<i.stick.oldH)&&(e=GMath.randomInt(i.stick.oldH,i.width-s-i.nextColumn.width));var h=s+e+i.nextColumn.width/2;h-i.curColumn.x<=50&&(h=i.width/2),i.curColumnIdx++;var a=(i.nextColumn.x-h)*t.IMiniGame15Consts.speedPro;egret.Tween.removeTweens(i.nextColumn),egret.Tween.get(i.nextColumn).to({x:h},a).call(function(){i.score+1==i.curData.score&&(i.peach.visible=!0,i.peach.setOutSrc(t.IMiniGame15Consts.lastItem),i.peach.x=i.nextColumn.x,i.peach.y=i.nextColumn.y),i.touchArea.touchEnabled=!0},i),i.nextColumn.loadCompleteCall(null,null)},this),this.score<this.curData.score-1){var e=this.curData.scaleXYs&&this.curData.scaleXYs[this.curColumnIdx];this.nextColumn.randomData(e)}else this.nextColumn.setEnd()},e.prototype.checkAvatarPos=function(){var i=this.nextColumn;return this.avatar.x<i.x+i.width/2&&this.avatar.x>i.x-i.width/2?(this.nextColumn=this.curColumn,this.curColumn=i,this.avatar.showWait(),this.peach.visible?this.showEatPeach():(this.moveSpeed=Math.floor((this.curColumn.x-this.curColumn.width/2+10)/30/t.IMiniGame15Consts.speedPro),this.isAllMove=!0),!0):(this.avatar.x<i.x-i.width/2&&(this.stick.isDropDown=!0),!1)},e.prototype.showEatPeach=function(){var i=this,e=this.avatar,s=this.peach,h=e.y-e.height,a=h*t.IMiniGame15Consts.speedPro,n=.5*a;this.avatar.showEat(),egret.Tween.removeTweens(s),egret.Tween.get(s).to({y:h,scaleX:1.2,scaleY:1.2},a,egret.Ease.circOut).to({x:e.x,y:e.y,scaleX:.3,scaleY:.3},n,egret.Ease.circIn).call(function(){i.peach.scaleX=1,i.peach.scaleY=1,i.stick.visible=!1,i.peach.visible=!1,i.peach.setOutSrc(null)},this)},e.prototype.avatarActionBack=function(t){t==AvatarConsts.ACTION_JUMP_II&&this.score>=this.curData.score&&(this.checkNextStage(),this.stop())},e.prototype.setData=function(t){this.curIdx=0,this.data=t,this.updateView()},e.prototype.updateView=function(){var i=this;this.data&&(this.curColumnIdx=0,this.score=0,this.needScore=0,this.curData=this.data.passes[this.curIdx],this.time=this.curData.time,this.touchArea.touchEnabled=!1,this.peach.visible=!1,this.peach.setOutSrc(null),this.showGuide(!1),this.curColumn.loadCompleteCall(function(){i.curColumn.x=i.curColumn.width/2+10,i.curColumn.y=.6*i.height,i.nextColumn.x=i.width+i.nextColumn.width,i.nextColumn.y=.6*i.height,i.avatar.initModel(t.IMiniGame15Consts.model),i.avatar.showStickUp(),i.startWait(),i.showStickDrop(),i.curColumn.loadCompleteCall(null,null)},this),this.curColumn.setStart(),this.perbar.setData(0,this.curData.score),this.logTime=GApp.timer,this.updateInfo(),this.setTime(),this.isRun=!0,!this.curIdx&&IMiniGameMain.reqSocket(1,this.data.stageId))},e.prototype.stop=function(){this.isRun=!1,this.trailing.stop()},e.prototype.startWait=function(){this.stick.reSet(),this.stick.visible=!0,this.stick.x=this.curColumn.x+this.curColumn.width/2-5,this.stick.y=this.curColumn.y+5,this.avatar.x=this.curColumn.x,this.avatar.y=this.curColumn.y;var t=this.stick.x-this.curColumn.width/2;this.avatar.x>t&&(this.avatar.x=t)},e.prototype.showStickDrop=function(){var i=this;this.trailing.start();var e=(this.curColumn.y+5)*t.IMiniGame15Consts.speedPro;this.stick.y=0,egret.Tween.removeTweens(this.stick),egret.Tween.get(this.stick).to({y:this.curColumn.y+5},e).call(function(){i.touchArea.touchEnabled=!0,i.trailing.stop(),i.avatar.showWait(),i.showGuide(1==i.data.stageId),i.randomNext(),i.showStickDropEff(i.stick.x,i.stick.y),IMiniGameMain.playEff(t.IMiniGame15Consts.minigame_stick_drop)},this)},e.prototype.showStickDropEff=function(i,e){this.stickDropEff||(this.stickDropEff=GObj.create(t.IMovie),this.bgGrp.addChild(this.stickDropEff)),this.stickDropEff.x=i,this.stickDropEff.y=e,this.stickDropEff.start(t.IMiniGame15Consts.stickMovie,1),this.stickDropEff.autoRun()},e.prototype.startMove=function(){this.stick.status=0,this.avatar.y=this.curColumn.y-this.stick.width;var t=this.stick.x-this.avatar.x;this.avatar.setMoveData(t+this.stick.height),this.avatar.showWalk()},e.prototype.checkNextStage=function(){var t=this.data.passes[this.curIdx+1],i=IMiniGameResultType.type_1;t?(this.curIdx++,i=IMiniGameResultType.type_5):IMiniGameMain.reqSocket(3),this.setResult(i,t&&t.passId)},e.prototype.setResult=function(i,e){this.updateInfo(),this.time=-1,i?IMiniGameMain.playEff(t.IMiniGame15Consts.minigame_win):IMiniGameMain.playEff(t.IMiniGame15Consts.minigame_lose),t.IMiniGameResult.showResult(i,this.resultCallBack,this,3,e)},e.prototype.resultCallBack=function(t){switch(t){case IMiniGameResultType.type_0:this.curIdx=0,this.curColumnIdx=0,this.updateView();break;case IMiniGameResultType.type_1:var i=this.parent;i&&i.outCloseClick();break;case IMiniGameResultType.type_5:this.updateView()}},e.prototype.showGuide=function(i){return i?(this.guide||(this.guide=GObj.create(t.IMiniGame15Guide)),this.guide.x=this.width/2,this.guide.y=330,void this.bgGrp.addChild(this.guide)):void(this.guide&&this.guide.parent&&this.guide.parent.removeChild(this.guide))},e.prototype.dispose=function(){this.bgGrp&&(egret.Tween.removeTweens(this.stick),egret.Tween.removeTweens(this.peach),egret.Tween.removeTweens(this.nextColumn),this.removeEvent(),GObj.disposeObject(this.bgGrp),this.bgGrp=null,GObj.disposeObject(this.bgScro),this.bgScro=null,GObj.disposeObject(this.bg1),this.bg1=null,GObj.disposeObject(this.bg2),this.bg2=null,GObj.disposeObject(this.perbar),this.perbar=null,GObj.disposeObject(this.avatar),this.avatar=null,GObj.disposeObject(this.stick),this.stick=null,GObj.disposeObject(this.column1),this.column1=null,GObj.disposeObject(this.column2),this.column2=null,GObj.disposeObject(this.pointLab),this.pointLab=null,GObj.disposeObject(this.touchArea),this.touchArea=null,GObj.disposeObject(this.peach),this.peach=null,GObj.disposeObject(this.timeBg),this.timeBg=null,GObj.disposeObject(this.timeLab),this.timeLab=null,GObj.disposeObject(this.guide),this.guide=null,GObj.disposeObject(this.bgEff),this.bgEff=null,GObj.disposeObject(this.stickDropEff),this.stickDropEff=null,GObj.disposeObject(this.trailing),this.trailing=null,this.data=null,this.curData=null,this.nextColumn=null,this.curColumn=null)},e}(eui.Component);t.IMiniGame15Game=i,__reflect(i.prototype,"miniGame.IMiniGame15Game")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.initSkins(),t}return __extends(e,i),e.prototype.initSkins=function(){this.touchEnabled=!1,this.touchChildren=!1,this.img1=GObj.create(t.ImageOutside),this.img2=GObj.create(t.ImageOutside),this.img3=GObj.create(t.ImageOutside),this.img1.loadCompleteCall(this.setLayOut,this),this.img1.setOutSrc("point_1"),this.addChild(this.img1),this.img2.loadCompleteCall(this.setLayOut,this),this.img2.setOutSrc("point_2"),this.addChild(this.img2),this.img3.loadCompleteCall(this.setLayOut,this),this.img3.setOutSrc("point_0"),this.addChild(this.img3)},e.prototype.setLayOut=function(){this.img1.iconWidth&&this.img2.iconWidth&&this.img3.iconWidth&&(this.width=this.img1.iconWidth,this.img2.x=(this.width-this.img2.iconWidth)/2,this.img1.y=this.img2.iconHeight,this.img3.x=this.img1.iconWidth/2,this.img3.y=this.img1.y+this.img1.iconHeight/2,this.height=this.img2.y+this.img2.iconHeight,this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height/2)},e.prototype.dispose=function(){GObj.disposeObject(this.img1),this.img1=null,GObj.disposeObject(this.img2),this.img2=null,GObj.disposeObject(this.img3),this.img3=null},e}(egret.DisplayObjectContainer);t.IMiniGame15Guide=i,__reflect(i.prototype,"miniGame.IMiniGame15Guide")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var e=i.call(this)||this;e.addlen=t.IMiniGame15Consts.stickAdd,e.addAngle=t.IMiniGame15Consts.stickAngle,e.maxLen=540,e.leng=8*t.IMiniGame15Consts.speedPro,e.lineColor=t.IMiniGame15Consts.trailingColor,e.showTrailing=e.lineColor>0,e.trailingType=1,e.loadCompleteCall(e.loadComplete,e),e.setOutSrc("stick");var s=t.IMiniGame15Consts.stick9Grid,h=egret.Rectangle.create();return h.setTo(s[0],s[1],s[2],s[3]),e.scale9Grid=h,e}return __extends(e,i),e.prototype.loadComplete=function(){this.iconWidth&&(this.width=this.iconWidth,this.oldH||(this.oldH=this.iconHeight),this.anchorOffsetX=this.width,this.anchorOffsetY=this.height)},e.prototype.reSet=function(){this.height=void 0,this.loadComplete(),this.rotation=0,this.status=0,this.gapFrame=0,this.isDropDown=!1},e.prototype.runLength=function(){(this.height>this.maxLen||this.height<this.oldH)&&(this.addlen=-this.addlen),this.height+=this.addlen,this.loadComplete(),this.anchorOffsetY=this.height,--this.gapFrame<=0&&(this.gapFrame=t.IMiniGame15Consts.effGapFrame,IMiniGameMain.playEff(t.IMiniGame15Consts.minigame_stick))},e.prototype.runRotation=function(){this.isOver()||(this.rotation<90&&(this.rotation+=this.addAngle),this.rotation>=90&&(this.rotation=90,this.status=3,IMiniGameMain.playEff(t.IMiniGame15Consts.minigame_stick_drop)))},e.prototype.runDropDwon=function(){if(this.isDropDown){var t=this.rotation;180>t&&(t+=this.addAngle),t>=180&&(t=180,this.isDropDown=!1),this.rotation=t}},e.prototype.isOver=function(){return 3==this.status},e.prototype.run=function(){return this.isDropDown?void this.runDropDwon():void(1==this.status?this.runLength():2==this.status&&this.runRotation())},e.prototype.getAngle=function(){return this.rotation},e.prototype.getXYR=function(t){t||(t={});var i=this.getAngle(),e=this.height;return 0==i?(t.angle=i,t.cos=GMath.cos(i),t.sin=GMath.sin(i),t.x=this.x-this.anchorOffsetX/2,t.y=this.y-e+.5*this.leng):(i+=90,t.angle=i,t.cos=GMath.cos(i),t.sin=GMath.sin(i),t.x=this.x-this.anchorOffsetX/2-(t.angle?e*t.cos:0),t.y=this.y-e*t.sin),t},e.prototype.dispose=function(){this.scale9Grid=null,i.prototype.dispose.call(this)},e}(t.ImageOutside);t.IMiniGame15Stick=i,__reflect(i.prototype,"miniGame.IMiniGame15Stick",["ITrailingVo","egret.DisplayObject"])}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){return i.call(this)||this}return __extends(e,i),e.prototype.initSkins=function(){this.isInit||(this.isInit=!0,this.horizontalCenter=0,this.verticalCenter=0,this.width=540,this.height=960,this.gameView=GObj.create(t.IMiniGame15Game),this.addChild(this.gameView),this.exitBtn=GObj.create(t.IBaseBtn),this.exitBtn.icon=IMiniGameMain.getIcon("exit_btn",FileConst.png,"chapter"),this.exitBtn.right=20,this.exitBtn.y=150+IMiniGameMain.safeHeight,this.addChild(this.exitBtn),this.initEvent())},e.prototype.initEvent=function(){this.exitBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCloseClick,this)},e.prototype.removeEvent=function(){this.exitBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onCloseClick,this)},e.prototype.onCloseClick=function(t){i.prototype.onCloseClick.call(this,t),this.gameView&&this.gameView.stop()},e.prototype.setData=function(i){this.initSkins(),this.gameView.setData(i),IMiniGameMain.playBgm(t.IMiniGame15Consts.minigame_bgm)},e.prototype.dispose=function(){this.removeEvent(),this.exitBtn&&egret.Tween.removeTweens(this.exitBtn),GObj.disposeObject(this.exitBtn),this.exitBtn=null,GObj.disposeObject(this.gameView),this.gameView=null,i.prototype.dispose.call(this)},e}(t.IBaseView);t.IMiniGame15View=i,__reflect(i.prototype,"miniGame.IMiniGame15View")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(t){return i.call(this,t)||this}return __extends(e,i),e.prototype.getGameView=function(){return this.gameView||(this.gameView=GObj.create(t.IMiniGame16View)),this.gameView.setData(this.getCurGameData()),this.gameView},e.prototype.loadConfigComplete=function(e){if(e)for(var s in e.config)t.IMiniGame16Consts[s]=e.config[s];var h=[];h=h.concat([1,0,0,0,100]),h=h.concat([0,0,0,0,0]),h=h.concat([0,0,0,0,0]),h=h.concat([0,0,0,1,0]),t.IMiniGame16Consts.redFilter=new egret.ColorMatrixFilter(h),h=[],h=h.concat([1,0,0,0,150]),h=h.concat([0,1,0,0,150]),h=h.concat([0,0,1,0,150]),h=h.concat([0,0,0,1,0]),t.IMiniGame16Consts.flashFilter=new egret.ColorMatrixFilter(h),i.prototype.loadConfigComplete.call(this,e)},e.setDefMonsterVo=function(i){for(var e=0;e<i.length;e++){var s=i[e].index,h=t.IMiniGame16Consts.monsters[s];for(var a in h)i[e][a]||(i[e][a]=h[a])}},e.setDefSpecVo=function(i,e){for(var s=0;s<i.length;s++){var h=i[s].index,a=t.IMiniGame16Consts.specs[h];for(var n in a)i[s][n]||(i[s][n]=a[n]);i[s].specTime=e}},e.prototype.dispose=function(){i.prototype.dispose.call(this)},e}(t.IMiniGameBaseCtr);t.IMiniGame16=i,__reflect(i.prototype,"miniGame.IMiniGame16")}(miniGame||(miniGame={}));var miniGame;!function(t){t.IMiniGame16Consts={lineNum:3,minimumSpeed:10,ui_siwang:"ui_siwang",redFilter:null,flashFilter:null,extra:"",extraNum:0,playx_value:-20,playy_value:-20,mapSpeed:1,musicNum:30,musicMaxNum:45,countDown:200,dian:"ui_dian",huo:"ui_huo",player_y:750,moveArr:[150,600],monPos:[108,216,324,432],specPos:[108,216,324,432],minigame16_bgm:"bgm_login",minigame16_win:"win",minigame16_die:"minigame_lose",minigame16_attack:"att",minigame16_yanbao:"yanbao",minigame16_shandian:"yanbao",minigame16_mondie:"monstor_die",minigame16_uplevel1:"uplevel_1",minigame16_reduce:"minigame16_reduce",minigame16_uplevel2:"uplevel_2",addEff:"ui_shengji",reduceEff:"ui_jiangdi",skills:{},monsters:{},specs:{}}}(miniGame||(miniGame={}));var Spec16Type;!function(t){t[t.TYPE_1=1]="TYPE_1",t[t.TYPE_2=2]="TYPE_2",t[t.TYPE_3=3]="TYPE_3",t[t.TYPE_4=4]="TYPE_4",t[t.TYPE_5=5]="TYPE_5",t[t.TYPE_6=6]="TYPE_6"}(Spec16Type||(Spec16Type={}));var miniGame;!function(t){var i=function(t){function i(){return t.call(this)||this}return __extends(i,t),i.prototype.setHurt=function(t){this.setPath("num4"),this.setGap(-4),this.setString("-"+(t||0)),this.anchorOffsetX=this.width/2,this.isRun=!0,this.flappingMove=GMath.randomInt(60,80),this.angle=0==GMath.randomInt(0,1)?GMath.randomInt(200,245):GMath.randomInt(295,340),this.reTweenHurt()},i.prototype.reTweenHurt=function(){this.scaleX=this.scaleY=this.alpha=1,egret.Tween.removeTweens(this),this.totalX=this.x+this.flappingMove*GMath.cos(this.angle),this.totalY=this.y+this.flappingMove*GMath.sin(this.angle),egret.Tween.get(this).to({scaleX:2.3,scaleY:2.3},100).to({scaleX:1,scaleY:1},100).to({x:this.totalX,y:this.totalY,alpha:.5},400).call(this.callFun,this)},i.prototype.callFun=function(){this.isRun=!1},i.prototype.dispose=function(){egret.Tween.removeTweens(this),t.prototype.dispose.call(this)},i}(t.IBitNumMap);t.IminiGame16Hurt=i,__reflect(i.prototype,"miniGame.IminiGame16Hurt")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.initSkin(),t}return __extends(e,i),e.prototype.initSkin=function(){var i=this;this.isInit||(this.isInit=!0,this.stageImg=GObj.create(t.ImageOutside),this.monEff=GObj.create(t.IMovie),this.stageImg.loadCompleteCall(function(){i.width=i.stageImg.iconWidth,i.height=i.stageImg.iconHeight,i.anchorOffsetX=i.width/2,i.anchorOffsetY=i.height/2,i.stageImg.anchorOffsetX=i.width/2,i.stageImg.anchorOffsetY=i.height/2,i.stageImg.x=i.width/2,i.stageImg.y=i.height/2,i.monEff.setLoadCompleteBack(function(){i.monEff.x=i.anchorOffsetX,i.monEff.y=50},i)},this),this.stageImg.setOutSrc("stageImg"),this.addChild(this.stageImg),this.addChild(this.monEff),this.numB=GObj.create(t.IBitNumMap),this.numB.setGap(-7),this.numB.setPath("num12"),this.numB.horizontalCenter=0,this.numB.y=70,this.addChild(this.numB))},e.prototype.setData=function(t){this.data=t,t&&(this.monEff.start(t.model),this.monEff.autoRun(),this.monEff.scaleX=this.monEff.scaleY=this.data.scaleXY||1,this._hp=GMath.randomInt(t.hp[0],t.hp[1]),this.numB.setNumber(this._hp))},e.prototype.reset=function(){this._hp=0,this._isDie=!1},e.prototype.run=function(){this.y+=t.IMiniGame16Consts.mapSpeed,this.y>960+this.height&&(this._isDie=!0)},e.prototype.getCollisionPoint=function(){var t=this.x-40,i=this.x+40,e=this.y;return[{x:t,y:e},{x:i,y:e}]},e.prototype.isDie=function(){return this._isDie},e.prototype.setHit=function(i){var e=this;return this._hp-=i,egret.Tween.removeTweens(this),this.filters=[t.IMiniGame16Consts.redFilter],egret.Tween.get(this).wait(200).call(function(){e.filters=null}),egret.Tween.removeTweens(this.stageImg),egret.Tween.get(this.stageImg).to({scaleX:.7,scaleY:.7},80).call(function(){e.stageImg.scaleX=e.stageImg.scaleY=1}),this._hp<=0&&(this._hp=0,this._isDie=!0,IMiniGameMain.playEff(t.IMiniGame16Consts.minigame16_mondie)),this.numB.setNumber(this._hp),this._isDie},e.prototype.isCanRemove=function(){return this._isDie},e.prototype.dispose=function(){egret.Tween.removeTweens(this.stageImg),egret.Tween.removeTweens(this),this.data=null,this.reset(),GObj.disposeObject(this.stageImg),this.stageImg=null,GObj.disposeObject(this.monEff),this.monEff=null,GObj.disposeObject(this.numB),this.numB=null},e}(eui.Component);t.IMiniGame16Monster=i,__reflect(i.prototype,"miniGame.IMiniGame16Monster")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.data={},t}return __extends(e,i),e.prototype.getData=function(){return this.data},e.prototype.setData=function(t){for(var i in t)this.data[i]=t[i];this.initVo()},e.prototype.partComplete=function(t){i.prototype.partComplete.call(this,t),this.fixedWidth=t.jsonObj.frames[0].w,this.fixedHeight=t.jsonObj.frames[0].h,this.timeFrame=this._playInterval,void 0!=this.tempStartT&&(this.part.startTime=this.tempStartT)},e.prototype.getFrameTime=function(){return this.timeFrame||0},e.prototype.setFrameTime=function(t){this.timeFrame=t},e.prototype.initVo=function(){this.data&&(this.frameMax=20,this.countNum=0,this.targetEndX=0,this.isSlide=!1,this.targetObject=[],this.tempStartT=void 0,this.timeFrame?this.updatePart(this.data.model,this.timeFrame):this.updatePart(this.data.model),this.speed=this.data.speed||50,this.tempSpeed=this.atkSpeed=this.data.atkSpeed||80,this.scaleX=this.scaleY=this.data.scaleXY||1,this.skillArr=[],this.attackNum=this.data.hurt||1,this.setDirection(0),this.setAction(AvatarConsts.ACTION_ATTACK_I))},e.prototype.getStartTime=function(){return this.part.startTime},e.prototype.setTarget=function(t,i){this.targetObject=t,this.lineNum=i},e.prototype.setStartTime=function(t){this.part.frameSize?this.tempStartT=this.part.startTime=t:this.tempStartT=t},e.prototype.getAttNumber=function(){return this.attackNum},e.prototype.getSkill=function(){return this.skillArr||[]},e.prototype.setCallFun=function(t,i){this.callFun=t,this.thisObj=i},e.prototype.getTempSpeed=function(){return this.tempSpeed},e.prototype.getAtkSpeed=function(){return this.atkSpeed},e.prototype.getSpeed=function(){return this.speed},e.prototype.setPlayerData=function(i,e,s,h,a){this.attackNum=i||1,this.tempSpeed=e||t.IMiniGame16Consts.minimumSpeed,this.speed=s||1;for(var n=0;n<h.length;n++)-1==this.skillArr.indexOf(h[n])&&this.skillArr.push(h[n]);this.atkSpeed=a},e.prototype.addSkill=function(i,e){switch(i){case 3:this.attackNum=this.attackNum+t.IMiniGame16Consts.skills[i].num,this.attackNum<1&&(this.attackNum=1);break;case 4:this.speed=this.speed+t.IMiniGame16Consts.skills[i].num,this.speed<1&&(this.speed=1);break;case 5:this.atkSpeed=this.tempSpeed=this.tempSpeed-t.IMiniGame16Consts.skills[i].num,this.atkSpeed<=t.IMiniGame16Consts.minimumSpeed&&(this.tempSpeed=this.atkSpeed=t.IMiniGame16Consts.minimumSpeed);break;case 6:t.IMiniGame16Consts.skills[6].skillData[e]&&(this.atkSpeed=this.tempSpeed=this.tempSpeed-t.IMiniGame16Consts.skills[6].skillData[e].atttime,this.attackNum=this.attackNum+t.IMiniGame16Consts.skills[6].skillData[e].attack,this.attackNum<1&&(this.attackNum=1),this.atkSpeed<=t.IMiniGame16Consts.minimumSpeed&&(this.tempSpeed=this.atkSpeed=t.IMiniGame16Consts.minimumSpeed))}-1==this.skillArr.indexOf(i)&&this.skillArr.push(i)},e.prototype.manMove=function(){egret.Tween.get(this.partCont).to({x:this.partCont.x-20},15).to({x:this.partCont.x+40},30).to({x:this.partCont.x},15).to({x:this.partCont.x-20},15).to({x:this.partCont.x+40},30).to({x:this.partCont.x},15).to({x:this.partCont.x-20},15).to({x:this.partCont.x+40},30).to({x:this.partCont.x},15).to({x:this.partCont.x-20},15).to({x:this.partCont.x+40},30).to({x:this.partCont.x},15).call(this.callBack,this)},e.prototype.callBack=function(){this.callFun&&this.callFun.call(this.thisObj)},e.prototype.falsh=function(){var i=this;egret.Tween.removeTweens(this),this.filters=[t.IMiniGame16Consts.flashFilter],egret.Tween.get(this).wait(200).call(function(){i.filters=null})},e.prototype.setAngle=function(t){this._isMove&&(this.angle=t)},e.prototype.setMoveArea=function(t,i){this.ax=t,this.aw=i},e.prototype.setMove=function(t){this._isMove=t},e.prototype.run=function(){if(i.prototype.run.call(this),this.playerAtk(),this.targetObject&&this.targetObject.length>0){var e=this.targetObject[0].posIndex%this.lineNum,s=this.posIndex%this.lineNum,h=Math.ceil((this.posIndex+1)/this.lineNum),a=this.targetObject[0].x+(s-e)*(this.targetObject[0].fixedWidth+t.IMiniGame16Consts.playx_value)*this.targetObject[0].scaleX,n=t.IMiniGame16Consts.player_y-(h-1)*(this.targetObject[0].fixedHeight+t.IMiniGame16Consts.playy_value)*this.targetObject[0].scaleY;if(this.countNum>=this.frameMax)return this.x=a,this.y=n,this.countNum=0,void(this.targetObject=[]);var o=this.frameMax-this.countNum;if(0>=o)return;var r=Math.abs(a-this.x)/o,l=Math.abs(n-this.y)/o;a>this.x?this.x=this.x+r:this.x=this.x-r,n>this.y?this.y=this.y+l:this.y=this.y-l,this.countNum++}},e.prototype.getCollisionPoint=function(){var t=this.x-this.scaleX*this.width/2,i=this.x+this.scaleX*this.width/2,e=this.y-this.scaleX*this.height;return[{x:t,y:e},{x:i,y:e}]},e.prototype.playerAtk=function(){this.isAtking||--this.atkSpeed>0||(this.atkSpeed=this.tempSpeed,this.isAtking=!0)},e.prototype.addBySpec=function(i){switch(i.index){case Spec16Type.TYPE_2:this.atkSpeed=this.tempSpeed=this.tempSpeed-i.specValue,this.atkSpeed<=t.IMiniGame16Consts.minimumSpeed&&(this.tempSpeed=this.atkSpeed=t.IMiniGame16Consts.minimumSpeed);break;case Spec16Type.TYPE_4:this.attackNum=this.attackNum+i.specValue,this.attackNum<1&&(this.attackNum=1);
break;case Spec16Type.TYPE_5:this.addRoleSpeed(i.specValue)}},e.prototype.addRoleSpeed=function(t){this.speed+=t,this.speed<1&&(this.speed=1)},e.prototype.move=function(){if(this._isMove&&void 0!=this.endX){var t=this.x+(this.speed*this.angle||0);if(1==this.angle)t<this.aw&&(t<this.endX&&(this.x=t),this.isSlide&&this.x<this.targetEndX&&(this.x=t));else{if(-1!=this.angle)return;t>this.ax&&(this.endX<t&&(this.x=t),this.isSlide&&this.x>this.targetEndX&&(this.x=t))}}},e.prototype.reset=function(){this.filters=null,egret.Tween.removeTweens(this),this._isDie=!1,this.callFun=null,this.thisObj=null,this.initVo()},e.prototype.dispose=function(){egret.Tween.removeTweens(this),this.targetObject=null,this.partCont&&egret.Tween.removeTweens(this.partCont),this.data=null,this.attackNum=null,this.atkSpeed=null,this.isAtking=null,this.ax=null,this.aw=null,this.tempSpeed=null;for(var t=0,e=this.skillArr;t<e.length;t++){var s=e[t];GObj.disposeObject(s)}this.skillArr=null,this.callFun=null,this.thisObj=null,i.prototype.dispose.call(this)},e}(t.IAvatarViewCtr);t.IMiniGame16Player=i,__reflect(i.prototype,"miniGame.IMiniGame16Player")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.exact=!0,t.touchEnabled=!1,t.touchChildren=!1,t.isRun=!1,t.createImg(),t}return __extends(e,i),e.prototype.isRunning=function(){return this.isRun},e.prototype.setRunning=function(t){this.isRun=t},e.prototype.setSkillInfo=function(t){this.speed=t},e.prototype.setSkill9Lv=function(t){this.skill9Lv=t},e.prototype.createImg=function(){this.img=GObj.create(t.IMovie),this.addChild(this.img)},e.prototype.setPlayer=function(i,e){this.img.stop(),this.skill9Lv&&t.IMiniGame16Consts.skills[6].skillData[this.skill9Lv]?this.img.start(t.IMiniGame16Consts.skills[6].skillData[this.skill9Lv].attmodel,0):this.img.start("ui_b1",0),this.img.autoRun(),this.player=i,this.x=i.x,e&&(this.x=e),this.y=i.y-i.height*i.scaleY-10,this.isRun=!0},e.prototype.run=function(){this.isRun&&(this.realH=this.height||300,this.y<-this.realH&&(this.isRun=!1),this.y=this.y-this.speed)},e.prototype.reset=function(){this.isRun=!1,this.player=null,this.speed=0,this.realH=0/0},e.prototype.dispose=function(){GObj.disposeObject(this.img),this.img=null,GObj.disposeObject(this.skill9Lv),this.skill9Lv=null,GObj.disposeObject(this.isRun),this.isRun=null,GObj.disposeObject(this.img),this.img=null,this.player=null},e}(egret.DisplayObjectContainer);t.IMiniGame16Skill=i,__reflect(i.prototype,"miniGame.IMiniGame16Skill")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.initSkins(),t}return __extends(e,i),e.prototype.getIsPick=function(){return this._isPick},e.prototype.setPick=function(i){var e=this;void 0===i&&(i=!0),this._isPick=!0,i&&(egret.Tween.removeTweens(this),this.data.index==Spec16Type.TYPE_6?this.parent&&egret.Tween.get(this).to({x:this.parent.width/2,y:this.parent.height/2},300).to({scaleX:3,scaleY:3,alpha:0},500).call(this.callBack,this):(this.filters=[t.IMiniGame16Consts.flashFilter],egret.Tween.get(this).wait(200).call(function(){e.filters=null})))},e.prototype.setFun=function(t,i){this.thisObj=t,this.fun=i},e.prototype.callBack=function(){this.fun&&this.fun.call(this.thisObj),this.parent&&this.parent.removeChild(this)},e.prototype.initSkins=function(){this.touchEnabled=!1,this.bgImg=GObj.create(t.ImageOutside),this.addChild(this.bgImg),this.nameLab=GObj.create(eui.Label),this.nameLab.size=30,this.nameLab.textColor=16773025,this.nameLab.stroke=1,this.addChild(this.nameLab)},e.prototype.setData=function(i){if(this.data=i,this.alpha=1,this.scaleX=this.scaleY=this.data.scaleXY||1,this.bgImg.loadCompleteCall(this.loadCall,this),this.data.index==Spec16Type.TYPE_6){this.x=GMath.randomInt(t.IMiniGame16Consts.moveArr[0],t.IMiniGame16Consts.moveArr[1]),this.bgImg.setOutSrc(i.specName),this.nameLab.text="";var e=GMath.randomInt(10,20);egret.Tween.get(this.bgImg,{loop:!0}).to({y:this.bgImg.y-e},30*e).to({y:this.bgImg.y+e},60*e).to({y:this.bgImg.y},30*e)}else this.bgImg.setOutSrc(i.specEff?"addImg":"reduceImg"),this.nameLab.text=i.specName},e.prototype.loadCall=function(){this.width=this.bgImg.width,this.height=this.bgImg.height,this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height/2,this.nameLab.horizontalCenter=0,this.nameLab.top=10,this.bgImg.y=0},e.prototype.run=function(){this.isDie||(this.y+=t.IMiniGame16Consts.mapSpeed,this.y>960+this.height&&(this.isDie=!0))},e.prototype.isCanRemove=function(){return this.isDie},e.prototype.reset=function(){this.bgImg&&egret.Tween.removeTweens(this.bgImg),this.bgImg.y=0,this.isDie=!1,this._isPick=!1,this.data=null,this.thisObj=null,this.fun=null},e.prototype.dispose=function(){this.reset(),egret.Tween.removeTweens(this),this.bgImg&&egret.Tween.removeTweens(this.bgImg),GObj.disposeObject(this.bgImg),this.bgImg=null,GObj.disposeObject(this.nameLab),this.nameLab=null},e}(eui.Component);t.IMiniGame16Spec=i,__reflect(i.prototype,"miniGame.IMiniGame16Spec")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function s(){var t=i.call(this)||this;return t.initSkins(),t.addEventListener(egret.Event.ADDED_TO_STAGE,t.addToStageComplete,t),t.list.addEventListener(eui.ItemTapEvent.ITEM_TAP,t.onListClick,t),t}return __extends(s,i),s.prototype.setskill=function(t){this.level=0,this.initSkill=[],this.showSkill=[];for(var i=0;i<t.length;i++)this.initSkill.push(t[i])},s.prototype.setFun=function(t,i){this.thisObj=t,this.closeBack=i},s.prototype.initSkins=function(){if(!this.isInit){this.isInit=!0,this.horizontalCenter=0,this.verticalCenter=0,this.width=540,this.height=960,this.touchEnabled=!1,this.bgRect=GObj.create(eui.Rect),this.bgRect.horizontalCenter=0,this.bgRect.verticalCenter=0,this.bgRect.width=StageManager.stageWidth,this.bgRect.height=StageManager.stageHeight+600,this.bgRect.touchEnabled=!1,this.addChild(this.bgRect),this.view_bg=GObj.create(t.ImageOutside),this.view_bg.horizontalCenter=0,this.view_bg.verticalCenter=0,this.view_bg.setOutSrc("skill16bg",FileConst.png),this.addChild(this.view_bg),this.skillText=GObj.create(t.ImageOutside),this.skillText.horizontalCenter=0,this.skillText.verticalCenter=-58,this.skillText.setOutSrc("skilltext",FileConst.png),this.addChild(this.skillText),this.listData=GObj.create(eui.ArrayCollection),this.list=GObj.create(eui.List),this.list.horizontalCenter=7,this.list.bottom=120,this.list.width=510,this.list.height=347,this.list.itemRenderer=e,this.list.dataProvider=this.listData;var i=GObj.create(eui.VerticalLayout);i.gap=10,this.list.layout=i,this.addChild(this.list)}},s.prototype.addToStageComplete=function(){this.updateList()},s.prototype.onListClick=function(t){if(t&&t.itemRenderer){var i=t.itemRenderer;this.callFun(i.index,i.skillindex,i.getXY())}},s.prototype.updateList=function(){if(0!=this.initSkill.length){this.list.selectedIndex=void 0;var i,e=[];if(0==this.level){this.showSkill=[];for(var s=0;3>s;s++)this.initSkill.length>s&&this.showSkill.push(this.initSkill[s])}for(var h=this.showSkill,a=0;a<h.length;a++)i=a,i<h.length&&e.push({index:i,skillname:t.IMiniGame16Consts.skills[h[i]].name,skilldes:t.IMiniGame16Consts.skills[h[i]].des,skillindex:t.IMiniGame16Consts.skills[h[i]].skillType,thisObj:this,fun:this.callFun});this.listData.replaceAll(e)}},s.prototype.callFun=function(t,i,e){var s=3+this.level;this.showSkill.length>t&&this.initSkill.length>s?this.showSkill[t]=this.initSkill[s]:this.showSkill.length>t&&this.showSkill.splice(t,1),this.level++,this.closeBack&&this.thisObj&&this.closeBack.call(this.thisObj,i,e),this.parent&&this.parent.removeChild(this)},s.prototype.dispose=function(){if(this.thisObj=null,this.closeBack=null,this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.addToStageComplete,this),this.list&&this.list.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onListClick,this),GObj.disposeObject(this.bgRect),this.bgRect=null,GObj.disposeObject(this.view_bg),this.view_bg=null,GObj.disposeObject(this.skillText),this.skillText=null,this.list){for(;this.list.$children.length>0;)GObj.disposeObject(this.list.$children[0]);this.list.dataProvider=null,GObj.disposeObject(this.list),this.list=null}GObj.disposeObject(this.listData),this.listData=null,GObj.disposeObject(this.isInit),this.isInit=null;for(var t=0,i=this.showSkill;t<i.length;t++){var e=i[t];GObj.disposeObject(e)}this.showSkill=null;for(var s=0,h=this.initSkill;s<h.length;s++){var e=h[s];GObj.disposeObject(e)}this.initSkill=null},s}(eui.Component);t.IMiniGame16UpPop=i,__reflect(i.prototype,"miniGame.IMiniGame16UpPop");var e=function(i){function e(){var t=i.call(this)||this;return t.initskins(),t}return __extends(e,i),e.prototype.initskins=function(){var i=this;this.point=GObj.create(egret.Point),this.uigroup=GObj.create(eui.Group),this.uigroup.width=500,this.uigroup.anchorOffsetX=this.uigroup.width/2,this.uigroup.x=this.uigroup.width/2,this.uigroup.verticalCenter=0,this.addChild(this.uigroup),this.itemBg=GObj.create(t.ImageOutside),this.itemBg.horizontalCenter=0,this.itemBg.verticalCenter=0,this.skilldes=GObj.create(eui.Label),this.skilldes.width=this.uigroup.width-180,this.itemBg.loadCompleteCall(function(){i.uigroup.width=i.width=i.itemBg.width,i.uigroup.height=i.height=i.itemBg.height,i.uigroup.anchorOffsetX=i.width/2,i.uigroup.anchorOffsetY=i.height/2,i.uigroup.x=i.uigroup.width/2,i.skilldes.width=i.width-180},this),this.itemBg.setOutSrc("noselected",FileConst.png),this.uigroup.addChild(this.itemBg),this.skillbg=GObj.create(t.ImageOutside),this.skillbg.left=15,this.skillbg.verticalCenter=0,this.skillbg.setOutSrc("skillitembg",FileConst.png),this.uigroup.addChild(this.skillbg),this.skill=GObj.create(t.ImageOutside),this.skill.left=27,this.skill.verticalCenter=0,this.uigroup.addChild(this.skill),this.skillname=GObj.create(eui.Label),this.skillname.left=150,this.skillname.top=15,this.skillname.size=35,this.skillname.bold=!0,this.skillname.fontFamily="Microsoft JhengHei",this.skillname.textColor=4601382,this.uigroup.addChild(this.skillname),this.skilldes.left=150,this.skilldes.top=60,this.skilldes.textColor=10053171,this.skilldes.size=20,this.skilldes.fontFamily="SimHei",this.skilldes.bold=!0,this.skilldes.wordWrap=!0,this.uigroup.addChild(this.skilldes),this.skinName=this.getSkin()},e.prototype.getXY=function(){return this.uigroup.localToGlobal(this.skillbg.left+this.skillbg.width/2,this.itemBg.height/2,this.point),[this.point.x,this.point.y]},e.prototype.getSkin=function(){var t=GObj.create(eui.Skin);return t.skinParts=["mcDisplay"],t.myself=this.uigroup,t.elementsContent=[this.uigroup],t.states=[new eui.State("up",[]),new eui.State("down",[new eui.SetProperty("myself","scaleX",.92),new eui.SetProperty("myself","scaleY",.92)]),new eui.State("disabled",[])],t},e.prototype.dataChanged=function(){if(i.prototype.dataChanged.call(this),this.data){this.uigroup.x=0,this.uigroup.alpha=0;var t=150*(this.itemIndex+1);egret.Tween.get(this.uigroup).wait(t).to({x:this.uigroup.width/2+2,alpha:1},150).to({x:this.uigroup.width/2},50),this.index=this.data.index,this.thisObj=this.data.thisObj,this.fun=this.data.fun,this.skillindex=this.data.skillindex,this.skillname.text=this.data.skillname,this.skilldes.text=this.data.skilldes,this.skill.setOutSrc("skill"+this.skillindex,FileConst.png)}},e.prototype.dispose=function(){this.uigroup&&egret.Tween.removeTweens(this.uigroup),GObj.disposeObject(this.uigroup),this.uigroup=null,GObj.disposeObject(this.itemBg),this.itemBg=null,GObj.disposeObject(this.skillbg),this.skillbg=null,GObj.disposeObject(this.skill),this.skill=null,GObj.disposeObject(this.skillname),this.skillname=null,GObj.disposeObject(this.skilldes),this.skilldes=null,GObj.disposeObject(this.index),this.index=null,GObj.disposeObject(this.skillindex),this.skillindex=null,this.thisObj=null,this.fun=null},e}(eui.ItemRenderer);t.skillItem16=e,__reflect(e.prototype,"miniGame.skillItem16")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){return i.call(this)||this}return __extends(e,i),e.prototype.addEvent=function(){this.uiGrp.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBeginClick,this),this.exitBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCloseClick,this)},e.prototype.removeEvent=function(){this.uiGrp&&(this.uiGrp.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBeginClick,this),this.uiGrp.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMoveClick,this),this.uiGrp.removeEventListener(egret.TouchEvent.TOUCH_END,this.onEndClick,this)),this.exitBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onCloseClick,this),this.suspendEvent()},e.prototype.setData=function(i){i&&(this.stageData=i,IMiniGameMain.playBgm(t.IMiniGame16Consts.minigame16_bgm),this.initSkins(),this.updateView())},e.prototype.initSkins=function(){var i=this;if(!this.isInit){this.isInit=!0,this.width=540,this.height=960,this.horizontalCenter=this.verticalCenter=0,this.skillArr=[],this.skillPool=[],this.monsterArr=[],this.monsterPool=[],this.specArr=[],this.specPool=[],this.playerArr=[],this.playerPool=[],this.hitEffPool=[],this.hitEffIn=[],this.hurtPool=[],this.hurtIn=[],this.gameBg=[];for(var e=-1;1>=e;e++){var s=GObj.create(t.ImageOutside);s.y=-this.height*e,s.setOutSrc("game16bg",FileConst.jpg),this.gameBg.push(s),this.addChild(s)}this.endImg=GObj.create(t.ImageOutside),this.endImg.horizontalCenter=0,this.endImg.loadCompleteCall(function(){i.endImg.anchorOffsetY=i.endImg.height},this),this.endImg.setOutSrc("end"),this.addChild(this.endImg),this.monsterGrp=GObj.create(egret.DisplayObjectContainer),this.monsterGrp.width=this.width,this.monsterGrp.height=this.height,this.monsterGrp.touchEnabled=!1,this.monsterGrp.touchChildren=!1,this.addChild(this.monsterGrp),this.avatarGrp=GObj.create(egret.DisplayObjectContainer),this.avatarGrp.width=this.width,this.avatarGrp.height=this.height,this.avatarGrp.touchEnabled=!1,this.avatarGrp.touchChildren=!1,this.addChild(this.avatarGrp),this.playerGrp=GObj.create(egret.DisplayObjectContainer),this.playerGrp.width=this.width,this.playerGrp.height=this.height,this.playerGrp.touchEnabled=!1,this.playerGrp.touchChildren=!1,this.addChild(this.playerGrp),this.skillGrp=GObj.create(egret.DisplayObjectContainer),this.skillGrp.width=this.width,this.skillGrp.height=this.height,this.addChild(this.skillGrp),this.hitEffGrp=GObj.create(egret.DisplayObjectContainer),this.hitEffGrp.touchEnabled=!1,this.hitEffGrp.touchChildren=!1,this.hitEffGrp.width=this.width,this.hitEffGrp.height=this.height,this.addChild(this.hitEffGrp),this.hurtGrp=GObj.create(egret.DisplayObjectContainer),this.hurtGrp.touchEnabled=!1,this.hurtGrp.touchChildren=!1,this.hurtGrp.width=this.width,this.hurtGrp.height=this.height,this.addChild(this.hurtGrp),this.skillGroup=GObj.create(eui.Group),this.addChild(this.skillGroup),this.skillbg=GObj.create(t.ImageOutside),this.skillbg.loadCompleteCall(function(){i.skillGroup.height=i.skillbg.height,i.skillGroup.width=i.skillbg.width,i.skillGroup.anchorOffsetX=i.skillGroup.width/2,i.skillGroup.anchorOffsetY=i.skillGroup.height/2},this),this.skillbg.horizontalCenter=0,this.skillbg.verticalCenter=0,this.skillbg.setOutSrc("skillitembg",FileConst.png),this.skillGroup.addChild(this.skillbg),this.skillIcon=GObj.create(t.ImageOutside),this.skillIcon.horizontalCenter=0,this.skillIcon.verticalCenter=0,this.skillGroup.addChild(this.skillIcon),this.headBg=GObj.create(t.ImageOutside),this.headBg.setOutSrc("headBg_1"),this.headBg.left=10,this.headBg.top=25,this.addChild(this.headBg),this.headImg=GObj.create(t.ImageOutside),this.headImg.setOutSrc("headImg_1"),this.headImg.left=-10,this.headImg.top=10,this.addChild(this.headImg),this.nameLab=GObj.create(eui.Label),this.nameLab.size=20,this.nameLab.top=35,this.nameLab.text=App.player.playerVo.name,this.nameLab.x=110,this.nameLab.fontFamily="SimHei",this.nameLab.textColor=12640510,this.nameLab.stroke=1,this.addChild(this.nameLab),this.scoreLab=GObj.create(eui.Label),this.scoreLab.size=16,this.scoreLab.top=60,this.scoreLab.x=110,this.scoreLab.fontFamily="SimHei",this.scoreLab.stroke=1,this.addChild(this.scoreLab),this.timeGroup=GObj.create(eui.Group),this.timeGroup.top=110,this.timeGroup.left=0,this.addChild(this.timeGroup),this.timeBg=GObj.create(t.ImageOutside),this.timeBg.loadCompleteCall(function(){i.timeGroup.width=i.timeBg.width,i.timeGroup.height=i.timeBg.height},this),this.timeBg.setOutSrc("timebg",FileConst.png),this.timeBg.verticalCenter=0,this.timeBg.horizontalCenter=0,this.timeGroup.addChild(this.timeBg),this.timeLabel=GObj.create(eui.Label),this.timeLabel.verticalCenter=0,this.timeLabel.horizontalCenter=0,this.timeLabel.size=20,this.timeLabel.bold=!0,this.timeLabel.textColor=16777215,this.timeGroup.addChild(this.timeLabel),this.uiGrp=GObj.create(egret.DisplayObjectContainer),this.uiRect=GObj.create(eui.Rect),this.uiGrp.width=this.uiRect.width=this.width,this.uiGrp.height=this.uiRect.height=this.height,this.addChild(this.uiGrp),this.uiRect.fillAlpha=.001,this.uiGrp.addChild(this.uiRect),this.guide=GObj.create(t.ImageOutside),this.guide.horizontalCenter=0,this.guide.y=this.height-360,this.guide.setOutSrc("guide"),this.addChild(this.guide),this.exitBtn=GObj.create(t.IBaseBtn),this.exitBtn.icon=IMiniGameMain.getIcon("exit_btn",FileConst.png,"chapter"),this.exitBtn.right=10,this.exitBtn.top=150,this.exitBtn.touchEnabled=!0,this.addChild(this.exitBtn),this.addEvent()}},e.prototype.updateView=function(){if(this.isStartGame=!0,this.isMoved=!1,this.lineNum=t.IMiniGame16Consts.lineNum||3,this.hitEffGrp.removeChildren(),this.mapSpeed=t.IMiniGame16Consts.mapSpeed||2,this.addOnceNum=0,this.clearOne(this.playerArr),this.bulletNum=1,this.playerArr=[],this.allScore=0,this.updateScore(),0==this.playerArr.length){var i=GObj.create(t.IMiniGame16Player);i.setData(this.stageData.player),i.y=t.IMiniGame16Consts.player_y,i.setMoveArea(t.IMiniGame16Consts.moveArr[0],t.IMiniGame16Consts.moveArr[1]),i.posIndex=0,this.playerArr.push(i),this.playerGrp.addChild(i),i.x=this.width/2}this.musicNum=this.getMusNum(),this.skillGroup.scaleX=this.skillGroup.scaleY=0,this.endImg.visible=!1,this.endImg.y=0,IMiniGameMain.reqSocket(1,this.stageData.stageId),this.isOver=!1,this.skillSpeed=this.stageData.player.skillspeed||20,this.skill9Lv=this.stageData.player.skill9lv||1,this.startTime=0,this.timeLabel.text=this.format(this.startTime),this.skillView||(this.skillView=GObj.create(t.IMiniGame16UpPop),this.skillView.horizontalCenter=this.skillView.verticalCenter=0),this.skillView.setskill(this.stageData.player.initSkills),this.skillView&&this.skillView.parent&&this.skillView.parent.removeChild(this.skillView),this.showGuide(),this.recovery()},e.prototype.update=function(){this.mapMove(),this.checkEnd(),this.playerRun(),this.createSkill(),this.skillRun(),this.checkHit(),this.monsterRun(),this.specRun(),this.hurtRun(),this.hitEffRun()},e.prototype.playerRun=function(){if(this.playerArr)for(var t,i=this.playerArr.length,e=0;i>e;e++)t=this.playerArr[e],t.run(),t.setMove(this.isMoved)},e.prototype.specRun=function(){var i=this.playerArr.length;if(0!=i&&0!=this.specArr.length)for(var e,s,h,a,n,o,r=this.playerArr[0],l=0;l<this.specArr.length;l++)if(e=this.specArr[l])if(e.isCanRemove())this.specArr.splice(l,1),this.backSpecObj(e),l--;else{e.run(),n=e.x-e.width/2*e.scaleX,o=e.x+e.width/2*e.scaleX;for(var p=0;i>p&&!e.getIsPick();p++)s=this.playerArr[p],s&&!s.isDie()&&(h=s.x-r.fixedWidth/2*s.scaleX/2,a=s.x+r.fixedWidth/2*s.scaleX/2,Math.abs(s.y-e.y)<=e.height*e.scaleY&&(n>=h&&a>=n||o>=h&&a>=o||h>=n&&o>=a)&&(e.setPick(),this.setSpecTimeOfPick(e.data.specTime),e.data.index==Spec16Type.TYPE_1?(this.tempData=e.data,this.tempPlayer=s,this.playerShake()):this.playArrSpec(e.data),e.data.index==Spec16Type.TYPE_6?(this.hitEffAll(t.IMiniGame16Consts.addEff),IMiniGameMain.playEff(t.IMiniGame16Consts.minigame16_uplevel1)):e.data.specEff?(this.hitEffAll(t.IMiniGame16Consts.addEff),IMiniGameMain.playEff(t.IMiniGame16Consts.minigame16_uplevel2)):(IMiniGameMain.playEff(t.IMiniGame16Consts.minigame16_reduce),this.hitEffAll(t.IMiniGame16Consts.reduceEff))))}},e.prototype.hitEffAll=function(t){for(var i=0;i<this.playerArr.length;i++)this.hitEffAddToScene({atkx:this.playerArr[i].x,atky:this.playerArr[i].y,eff:t})},e.prototype.playArrSpec=function(t,i,e){if(t&&t.index!=Spec16Type.TYPE_6)if(t.index==Spec16Type.TYPE_3)this.bulletNum+=t.specValue,this.bulletNum<1&&(this.bulletNum=1);else for(var s=0;s<this.playerArr.length;s++)this.playerArr[s].addBySpec(t)},e.prototype.getMusNum=function(){var i=30;if(!this.playerArr||!this.stageData||!this.stageData.player)return i;if(this.playerArr.length<1)return i;var e=this.stageData.player.atkSpeed-10;if(!e)return i;var s=this.playerArr[0].getTempSpeed()-10;return i=t.IMiniGame16Consts.musicNum+Math.ceil(s/e*(t.IMiniGame16Consts.musicMaxNum-t.IMiniGame16Consts.musicNum))},e.prototype.shakeCall=function(){if(!(this.playerArr.length<1)&&this.tempData&&(this.playerArr[0].setCallFun(null,null),this.tempData.index==Spec16Type.TYPE_1))switch(this.tempData.specMan){case 0:this.addOnceNum=this.tempData.specValue||0,this.addPlayer(this.addOnceNum);break;case 1:this.reducePlayer(this.tempData.specValue);break;case 2:this.addOnceNum=this.playerArr.length*(this.tempData.specValue-1)||0,this.addPlayer(this.addOnceNum);break;case 3:this.reducePlayer(Math.floor(this.playerArr.length/this.tempData.specValue*(this.tempData.specValue-1)))}},e.prototype.createSkill=function(){if(!(this.playerArr.length<1)){for(var i,e=this.playerArr.length,s=0;e>s;s++)if(i=this.playerArr[s],i.isAtking){i.isAtking=!1;for(var h=void 0,a=0;a<this.bulletNum;a++){var n=Math.floor(this.bulletNum/2),o=this.bulletNum%2,r=void 0;h=this.getSkillObj(),h.setSkillInfo(this.skillSpeed),h.setSkill9Lv(this.skill9Lv),0!=o?h.setPlayer(i,i.x+60*(n-a)):(r=a>=n?a-n+1:a-n,h.setPlayer(i,i.x+60*r+30*(r>=0?-1:1))),this.skillGrp.addChild(h),this.skillArr.push(h)}}--this.musicNum<0&&(IMiniGameMain.playEff(t.IMiniGame16Consts.minigame16_attack),this.musicNum=this.getMusNum())}},e.prototype.createMonster=function(i){for(var e=i.length,s=0;e>s;s++){var h=void 0;h=this.getMonsterObj(),h.y=-50,h.x=i[s].monLR<t.IMiniGame16Consts.monPos.length?t.IMiniGame16Consts.monPos[i[s].monLR]:250,h.setData(i[s]),this.monsterArr.push(h)}},e.prototype.skillRun=function(){if(0!=this.skillArr.length)for(var t,i=0;i<this.skillArr.length;i++)t=this.skillArr[i],t.isRunning()?t.run():(t.parent&&t.parent.removeChild(t),this.skillArr.splice(i,1),this.backSkillObj(t),i--)},e.prototype.clearOne=function(t){if(t)for(var i=t.length,e=0;i>e;e++)t[e].parent&&t[e].parent.removeChild(t[e]),GObj.disposeObject(t[e]),t[e]=null},e.prototype.getSkillObj=function(){var i=this.skillPool.pop();return i||(i=GObj.create(t.IMiniGame16Skill)),i},e.prototype.backSkillObj=function(t){t&&-1==this.skillPool.indexOf(t)&&(t.reset(),this.skillPool.push(t))},e.prototype.getMonsterObj=function(){var i=this.monsterPool.pop();return i||(i=GObj.create(t.IMiniGame16Monster)),this.monsterGrp.addChild(i),i},e.prototype.backMonsterObj=function(t){t&&-1==this.monsterPool.indexOf(t)&&(t.reset(),t.parent&&t.parent.removeChild(t),this.monsterPool.push(t))},e.prototype.monsterRun=function(){if(0!=this.playerArr.length&&0!=this.monsterArr.length)for(var i,e,s,h,a,n,o=this.playerArr[0],r=0;r<this.monsterArr.length;r++)if(i=this.monsterArr[r])if(i.isCanRemove())this.monsterArr.splice(r,1),this.backMonsterObj(i),r--;else if(i.run(),!i.isDie()){a=i.x-i.width/2*i.scaleX,n=i.x+i.width/2*i.scaleX;for(var l=0;l<this.playerArr.length&&i;l++)e=this.playerArr[l],e&&!e.isDie()&&(s=e.x-o.fixedWidth/2*e.scaleX/2,h=e.x+o.fixedWidth/2*e.scaleX/2,Math.abs(e.y-i.y)<=i.height*i.scaleY&&(a>=s&&h>=a||n>=s&&h>=n||s>=a&&n>=h)&&(this.hitEffAddToScene({atkx:e.x,atky:e.y,eff:t.IMiniGame16Consts.ui_siwang}),e.died(),this.playerArr.splice(l,1),this.backPlayerObj(e),0==this.playerArr.length?this.setResult(!1):IMiniGameMain.playEff(t.IMiniGame16Consts.minigame16_mondie),this.updateMoveArea(),l--))}},e.prototype.hurtAddToScene=function(t,i,e){var s=this.createHurt();s.x=i,s.y=e,s.setHurt(t),this.hurtIn.push(s),this.hurtGrp.addChild(s)},e.prototype.createHurt=function(){var i=this.hurtPool.pop();return i||(i=GObj.create(t.IminiGame16Hurt)),i},e.prototype.hurtRun=function(){if(0!=this.hurtIn.length)for(var t,i=0;i<this.hurtIn.length;i++)t=this.hurtIn[i],t&&(t.isRun||(t.parent&&t.parent.removeChild(t),this.hurtIn.splice(i,1),this.backHurtObj(t),i--))},e.prototype.backHurtObj=function(t){t&&-1==this.hurtPool.indexOf(t)&&(t.isRun=!1,this.hurtPool.push(t))},e.prototype.hitEffAddToScene=function(t){var i=this.gethitEffObj();i.x=t.atkx,i.y=t.atky,i.start(t.eff,1),this.hitEffIn.push(i),this.hitEffGrp.addChild(i)},e.prototype.mapMove=function(){if(this.isStartGame)for(var t=0;t<this.gameBg.length;t++){var i=this.gameBg[t];i.y=i.y+this.mapSpeed,i.y>=StageManager.stageHeight&&(i.y-=3*this.height)}},e.prototype.setSpecTimeOfPick=function(t){var i=this.specArr.length;if(0!=i)for(var e,s=0;i>s;s++)e=this.specArr[s],e&&e.data.specTime==t&&e.setPick(!1)},e.prototype.showGuide=function(){1==this.stageData.stageId?(this.isStartGame=!1,this.guide.alpha=1,this.guide.visible=!0):this.guide.visible=!1},e.prototype.checkHit=function(){if(0!=this.playerArr.length&&0!=this.monsterArr.length)for(var i,e,s,h,a,n,o=0;o<this.skillArr.length;o++){i=this.skillArr[o],s=i.x-i.anchorOffsetX,h=i.x+i.anchorOffsetX;for(var r=0;r<this.monsterArr.length;r++)if(e=this.monsterArr[r],a=e.x-e.width/2,n=e.x+e.width/2,(s>=a&&n>=s||h>=a&&n>=h)&&Math.abs(e.y-i.y)<i.height/2+e.height*e.scaleY/2){if(i.setRunning(!1),e.setHit(this.playerArr[0].getAttNumber()),this.hurtAddToScene(this.playerArr[0].getAttNumber(),e.x,e.y),this.allScore+=this.playerArr[0].getAttNumber(),this.updateScore(),i.skill9Lv&&t.IMiniGame16Consts.skills[6].skillData[i.skill9Lv]?this.hitEffAddToScene({atkx:e.x,atky:e.y,eff:t.IMiniGame16Consts.skills[6].skillData[i.skill9Lv].hitmodel}):this.hitEffAddToScene({atkx:e.x,atky:e.y,eff:"ui_s1"}),-1!=this.playerArr[0].getSkill().indexOf(1)&&Math.floor(100*Math.random())<t.IMiniGame16Consts.skills[1].num){IMiniGameMain.playEff(t.IMiniGame16Consts.minigame16_shandian),this.hitEffAddToScene({atkx:e.x,atky:e.y,eff:t.IMiniGame16Consts.dian});var l=0,p=t.IMiniGame16Consts.skills[1].hurt;p&&(l=1==p.length?p[0]:p[0]+Math.floor(Math.random()*(p[1]-p[0]+1)),e.setHit(l))}if(e.isDie())if(-1!=this.playerArr[0].getSkill().indexOf(2)){IMiniGameMain.playEff(t.IMiniGame16Consts.minigame16_yanbao),this.hitEffAddToScene({atkx:e.x,atky:e.y,eff:t.IMiniGame16Consts.huo});var c=t.IMiniGame16Consts.skills[2].num,l=0,u=t.IMiniGame16Consts.skills[2].hurt;u&&(l=1==u.length?u[0]:u[0]+Math.floor(Math.random()*(u[1]-u[0]+1)));for(var d=void 0,m=0;m<this.monsterArr.length;m++)d=GMath.distance(e.x,e.y,this.monsterArr[m].x,this.monsterArr[m].y),c>d&&!this.monsterArr[m].isDie()&&this.monsterArr[m].setHit(l)}else this.hitEffAddToScene({atkx:e.x,atky:e.y,eff:t.IMiniGame16Consts.ui_siwang})}}},e.prototype.onBeginClick=function(i){var e=this;1==this.stageData.stageId&&(this.isStartGame=!0,DispatcherManager.addListener(HGEvent.HEARTBEAT,this.timeFun,this),this.guide.alpha=1,egret.Tween.get(this.guide).to({alpha:0},t.IMiniGame16Consts.countDown).call(function(){e.guide.visible=!1})),this.tempoint||(this.tempoint=GObj.create(egret.Point)),this.uiGrp.globalToLocal(i.stageX,i.stageY,this.tempoint),this.startX=this.tempoint.x,this.uiGrp.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMoveClick,this),this.uiGrp.addEventListener(egret.TouchEvent.TOUCH_END,this.onEndClick,this)},e.prototype.onMoveClick=function(i){if(this.playerArr){this.uiGrp.globalToLocal(i.stageX,i.stageY,this.tempoint),this.endX=this.tempoint.x,this.isMoved=!0;var e,s=this.playerArr[0],h=this.getMaxLineNum(),a=this.endX-this.startX;this.playerGrp.globalToLocal(i.stageX,i.stageY,this.tempoint);var n,o=this.tempoint.x;if(a>0){var r=void 0;e=h[1];for(var l=0;l<this.playerArr.length;l++)n=this.playerArr[l],r=n.posIndex%this.lineNum,n.endX=o-(e-r)*(s.fixedWidth+t.IMiniGame16Consts.playx_value)*s.scaleX,n.endX<n.x&&(n.isSlide=!0,n.targetEndX=n.x+a),n.setAngle(1)}else{var r=void 0;e=h[0];for(var l=0;l<this.playerArr.length;l++)n=this.playerArr[l],r=n.posIndex%this.lineNum,n.endX=o+(r-e)*(s.fixedWidth+t.IMiniGame16Consts.playx_value)*s.scaleX,n.x<n.endX&&(n.isSlide=!0,n.targetEndX=n.x+a),n.setAngle(-1)}this.startX=this.endX}},e.prototype.onEndClick=function(){for(var t,i=0;i<this.playerArr.length;i++)t=this.playerArr[i],t.isSlide=!1;this.isMoved=!1,this.uiGrp.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMoveClick,this),this.uiGrp.removeEventListener(egret.TouchEvent.TOUCH_END,this.onEndClick,this)},e.prototype.suspendEvent=function(){DispatcherManager.removeListener(HGEvent.HEARTBEAT,this.timeFun,this),EnterFrameManager.instance.unRegisteRender(this.update,this)},e.prototype.recovery=function(){this.isStartGame&&DispatcherManager.addListener(HGEvent.HEARTBEAT,this.timeFun,this),EnterFrameManager.instance.registeRender(this.update,this)},e.prototype.timeFun=function(){if(this.startTime++,this.timeLabel.text=this.format(this.startTime),this.startTime>=this.stageData.time)return this.endImg.visible=!0,void IMiniGameMain.reqSocket(2);var i=this.stageData.monsters[this.startTime];i&&(t.IMiniGame16.setDefMonsterVo(i),this.createMonster(i));var e=this.stageData.specs[this.startTime];e&&(t.IMiniGame16.setDefSpecVo(e,this.startTime),this.createSpec(e))},e.prototype.createSpec=function(i){for(var e=i.length,s=0;e>s;s++){var h=void 0;h=this.getSpecObj(),h.y=-50,h.x=i[s].specLR<t.IMiniGame16Consts.specPos.length?t.IMiniGame16Consts.specPos[i[s].specLR]:250,h.setData(i[s]),i[s].specX&&(h.x=i[s].specX),h.setFun(this,this.openSkill),this.specArr.push(h)}},e.prototype.getSpecObj=function(){var i=this.specPool.pop();return i||(i=GObj.create(t.IMiniGame16Spec)),this.avatarGrp.addChildAt(i,0),i},e.prototype.backSpecObj=function(t){t&&-1==this.specPool.indexOf(t)&&(t.reset(),t.parent&&t.parent.removeChild(t),this.specPool.push(t))},e.prototype.getPlayer=function(){var i=this.playerPool.pop();return i||(i=GObj.create(t.IMiniGame16Player)),i},e.prototype.backPlayerObj=function(t){t&&-1==this.playerPool.indexOf(t)&&(t.parent&&t.parent.removeChild(t),t.reset(),this.playerPool.push(t))},e.prototype.clearObject=function(){this.suspendEvent();for(var t,i=0;i<this.monsterArr.length;i++)t=this.monsterArr[i],t.parent&&t.parent.removeChild(t),this.backMonsterObj(t);this.monsterArr=[];for(var e,i=0;i<this.skillArr.length;i++)e=this.skillArr[i],e.parent&&e.parent.removeChild(e),this.backSkillObj(e);this.skillArr=[];for(var s,i=0;i<this.specArr.length;i++)s=this.specArr[i],s.parent&&s.parent.removeChild(s),this.backSpecObj(s);this.specArr=[];for(var h,i=0;i<this.hurtIn.length;i++)h=this.hurtIn[i],h.parent&&h.parent.removeChild(h),this.backHurtObj(h);this.hurtIn=[]},e.prototype.setResult=function(i){this.isOver||(this.isOver=!0,i&&IMiniGameMain.reqSocket(3),this.skillView&&this.skillView.parent&&this.skillView.parent.removeChild(this.skillView),this.clearObject(),i?(t.IMiniGame16Consts.extraNum=this.allScore,IMiniGameMain.playEff(t.IMiniGame16Consts.minigame16_win),t.IMiniGameResult.showResult(IMiniGameResultType.type_1,this.onCloseClick,this,3,0/0,t.IMiniGame16Consts.extra,t.IMiniGame16Consts.extraNum)):(IMiniGameMain.playEff(t.IMiniGame16Consts.minigame16_die),t.IMiniGameResult.showResult(IMiniGameResultType.type_0,this.updateView,this)))},e.prototype.updateScore=function(){this.scoreLab.text="分数："+this.allScore},e.prototype.hitEffRun=function(){var t=this.hitEffIn.length;if(0!=t)for(var i=0;t>i;i++){var e=this.hitEffIn[i];e&&(e.run(),e.isOver&&(this.hitEffIn.splice(i,1),i--,this.backHitEffObj(e)))}},e.prototype.reducePlayer=function(t){if(this.tempPlayer){var i,e,s,h=t;s=h>=this.playerArr.length?0:GMath.randomInt(0,this.playerArr.length-h-1);for(var a=0;h>a&&!(this.playerArr.length<2);a++)i=this.getMaxPlayer(),e=this.playerArr.indexOf(i),-1!=e&&(this.playerArr.splice(e,1),egret.Tween.get(i).to({x:this.playerArr[s].x,y:this.playerArr[s].y},200).call(this.backPlayerObj,this,[i]));
this.updateMoveArea()}},e.prototype.addPlayer=function(i){for(var e=[],s=this.getMaxIndex(),h=0;s>h;h++)this.getIsExit(h)||e.push(h);for(var a,n,o,r,l,p=this.playerArr[0],c=p.posIndex%this.lineNum,u=0;i>u;u++)a=this.getPlayer(),a.setFrameTime(p.timeFrame),a.setData(p.getData()),a.setPlayerData(p.getAttNumber(),p.getTempSpeed(),p.getSpeed(),p.getSkill(),p.getAtkSpeed()),u<e.length?a.posIndex=e[u]:a.posIndex=s+u-e.length+1,n=Math.ceil((a.posIndex+1)/this.lineNum),a.y=this.tempPlayer.y,o=a.posIndex%this.lineNum,r=p.x+(o-c)*(p.fixedWidth+t.IMiniGame16Consts.playx_value)*p.scaleX,r>t.IMiniGame16Consts.moveArr[1]&&(l=1),r<t.IMiniGame16Consts.moveArr[0]&&(l=2),a.x=this.tempPlayer.x,this.playerArr.push(a),this.playerGrp.addChildAt(a,0);this.updateMoveArea(l)},e.prototype.updateMoveArea=function(i){var e=this.getMaxLineNum();if(999!=e[0]&&-1!=e[1]){for(var s,h,a=this.stageData.player.scaleXY||1,n=this.lineNum,o=t.IMiniGame16Consts.moveArr[0],r=t.IMiniGame16Consts.moveArr[1],l=this.playerArr[0],p=l.fixedWidth+t.IMiniGame16Consts.playx_value,c=this.playerArr.length,u=0;u<this.playerArr.length;u++)s=this.playerArr[u],h=s.posIndex%n,u>=c-this.addOnceNum||(1==i&&(s.x=r-(e[1]-h)*p*a),2==i&&(s.x=o+h*p*a)),s.setMoveArea(o+(h-e[0])*p*a,r-(e[1]-h)*p*a),s.setStartTime(l.getStartTime());for(var u=c-this.addOnceNum;c>u;u++)s=this.playerArr[u],s.setTarget(this.playerArr,this.lineNum);this.addOnceNum=0}},e.prototype.skillCollisionPlayer=function(i){var e=this;if(this.skillGroup){egret.Tween.removeTweens(this.skillGroup),this.skillGroup.x=i[0],this.skillGroup.y=i[1],this.skillGroup.scaleX=this.skillGroup.scaleY=this.skillGroup.alpha=1;var s=GMath.randomInt(0,this.playerArr.length-1),h=this.playerArr[s];egret.Tween.get(this.skillGroup).to({x:h.x,y:h.y-h.height/2},600).to({scaleX:2.5,scaleY:2.5,alpha:0},200).call(function(){e.hitEffAll(t.IMiniGame16Consts.addEff),e.playerSkillAdd(),IMiniGameMain.playEff(t.IMiniGame16Consts.minigame16_uplevel2),e.flashFun()},this)}},e.prototype.playerShake=function(){this.playerArr[0].setCallFun(this.timeFunT,this);for(var t=0;t<this.playerArr.length;t++)this.playerArr[t].manMove()},e.prototype.timeFunT=function(){egret.Tween.get(this).wait(300).call(this.shakeCall,this)},e.prototype.flashFun=function(){for(var t=0;t<this.playerArr.length;t++)this.playerArr[t].falsh()},e.prototype.getMaxLineNum=function(){for(var t,i,e=999,s=-1,h=0;h<this.playerArr.length;h++)t=this.playerArr[h],i=t.posIndex%this.lineNum,e>i&&(e=i),i>s&&(s=i);return[e,s]},e.prototype.getMaxIndex=function(){for(var t=-1,i=0;i<this.playerArr.length;i++)this.playerArr[i].unAutoRun(),this.playerArr[i].posIndex>t&&(t=this.playerArr[i].posIndex);return t},e.prototype.getMaxPlayer=function(){for(var t=this.playerArr[0],i=0;i<this.playerArr.length;i++)this.playerArr[i].posIndex>t.posIndex&&(t=this.playerArr[i]);return t},e.prototype.getIsExit=function(t){for(var i=!1,e=0;e<this.playerArr.length;e++)if(this.playerArr[e].posIndex==t){i=!0;break}return i},e.prototype.skillCall=function(t,i){this.skillNumber=t,this.uiGrp.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBeginClick,this),this.recovery(),this.skillIcon&&this.skillIcon.setOutSrc("skill"+t,FileConst.png),this.skillCollisionPlayer(i)},e.prototype.playArrSkill=function(t,i){for(var e=0;e<this.playerArr.length;e++)this.playerArr[e].addSkill(t,i)},e.prototype.playerSkillAdd=function(){if(void 0!=this.skillNumber){if(6==this.skillNumber){this.skill9Lv++;for(var i=void 0,e=0;e<this.skillArr.length;e++)i=this.skillArr[e],i.setSkill9Lv(this.skill9Lv),this.skill9Lv&&t.IMiniGame16Consts.skills[6].skillData[this.skill9Lv]&&(this.skillSpeed=this.skillSpeed+t.IMiniGame16Consts.skills[6].skillData[this.skill9Lv].flyspeed),i.setSkillInfo(this.skillSpeed)}this.playArrSkill(this.skillNumber,this.skill9Lv)}},e.prototype.gethitEffObj=function(){var i=this.hitEffPool.pop();return i||(i=GObj.create(t.IMovie)),i},e.prototype.backHitEffObj=function(t){t&&-1==this.hitEffPool.indexOf(t)&&(t.parent&&t.parent.removeChild(t),this.hitEffPool.push(t))},e.prototype.openSkill=function(){this.isOver||(this.skillView||(this.skillView=GObj.create(t.IMiniGame16UpPop),this.skillView.setskill(this.stageData.player.initSkills),this.skillView.horizontalCenter=this.skillView.verticalCenter=0),this.uiGrp.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBeginClick,this),this.suspendEvent(),this.skillView.setFun(this,this.skillCall),this.skillView.scaleX=this.skillView.scaleY=0,this.addChild(this.skillView),egret.Tween.get(this.skillView).to({scaleX:1,scaleY:1},200))},e.prototype.format=function(t){var i=Math.floor(t/60)>=10?Math.floor(t/60):"0"+Math.floor(t/60);t-=60*i;var e=t>=10?t:"0"+t;return i+":"+e},e.prototype.clearTween=function(){this.skillGroup&&egret.Tween.removeTweens(this.skillView),this.skillView&&egret.Tween.removeTweens(this.skillView),this.guide&&egret.Tween.removeTweens(this.guide),egret.Tween.removeTweens(this)},e.prototype.onCloseClick=function(){this.parent&&(this.clearObject(),i.prototype.onCloseClick.call(this))},e.prototype.checkEnd=function(){this.endImg.visible&&!this.isOver&&0!=this.playerArr.length&&(this.endImg.y+=this.mapSpeed,this.endImg.y>=this.getMaxPlayer().y&&this.setResult(!0))},e.prototype.clearArr=function(){for(var t=0,i=this.playerArr;t<i.length;t++){var e=i[t];GObj.disposeObject(e)}this.playerArr=null;for(var s=0,h=this.playerPool;s<h.length;s++){var e=h[s];GObj.disposeObject(e)}this.playerPool=null;for(var a=0,n=this.skillArr;a<n.length;a++){var o=n[a];GObj.disposeObject(o)}this.skillArr=null;for(var r=0,l=this.skillPool;r<l.length;r++){var o=l[r];GObj.disposeObject(o)}this.skillPool=null;for(var p=0,c=this.monsterPool;p<c.length;p++){var u=c[p];GObj.disposeObject(u)}this.monsterPool=null;for(var d=0,m=this.monsterArr;d<m.length;d++){var u=m[d];GObj.disposeObject(o)}this.monsterArr=null;for(var g=0,f=this.gameBg;g<f.length;g++){var b=f[g];GObj.disposeObject(b)}this.gameBg=null;for(var y=0,G=this.specArr;y<G.length;y++){var v=G[y];GObj.disposeObject(v)}this.specArr=null;for(var I=0,O=this.specPool;I<O.length;I++){var v=O[I];GObj.disposeObject(v)}this.specPool=null;for(var C=0,M=this.hitEffPool;C<M.length;C++){var k=M[C];GObj.disposeObject(k)}this.hitEffPool=null;for(var x=0,j=this.hitEffIn;x<j.length;x++){var k=j[x];GObj.disposeObject(k)}this.hitEffIn=null;for(var w=0,T=this.hurtPool;w<T.length;w++){var _=T[w];GObj.disposeObject(_)}this.hurtPool=null;for(var S=0,E=this.hurtIn;S<E.length;S++){var _=E[S];GObj.disposeObject(_)}this.hurtIn=null},e.prototype.dispose=function(){this.isDestory||(this.isDestory=!0,this.removeEvent(),this.clearTween(),this.clearArr(),this.stageData=null,GObj.disposeObject(this.endImg),this.endImg=null,GObj.disposeObject(this.headBg),this.headBg=null,GObj.disposeObject(this.headImg),this.headImg=null,GObj.disposeObject(this.nameLab),this.nameLab=null,GObj.disposeObject(this.avatarGrp),this.avatarGrp=null,GObj.disposeObject(this.playerGrp),this.playerGrp=null,GObj.disposeObject(this.uiGrp),this.uiGrp=null,GObj.disposeObject(this.bulletNum),this.bulletNum=null,GObj.disposeObject(this.uiRect),this.uiRect=null,GObj.disposeObject(this.scoreLab),this.scoreLab=null,this.startTime=null,GObj.disposeObject(this.timeLabel),this.timeLabel=null,GObj.disposeObject(this.skillView),this.skillView=null,GObj.disposeObject(this.monsterGrp),this.monsterGrp=null,GObj.disposeObject(this.hitEffGrp),this.hitEffGrp=null,GObj.disposeObject(this.skillGrp),this.skillGrp=null,GObj.disposeObject(this.guide),this.guide=null,GObj.disposeObject(this.timeBg),this.timeBg=null,GObj.disposeObject(this.timeGroup),this.timeGroup=null,GObj.disposeObject(this.skillGroup),this.skillGroup=null,GObj.disposeObject(this.skillbg),this.skillbg=null,GObj.disposeObject(this.skillIcon),this.skillIcon=null,GObj.disposeObject(this.exitBtn),this.exitBtn=null,this.musicNum=null,this.mapSpeed=null,this.lineNum=null,this.allScore=null,this.skillSpeed=null,this.skill9Lv=null,this.tempPlayer=null,this.isOver=null,i.prototype.dispose.call(this))},e}(t.IBaseView);t.IMiniGame16View=i,__reflect(i.prototype,"miniGame.IMiniGame16View")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(t){return i.call(this,t)||this}return __extends(e,i),e.prototype.getGameView=function(){return this.gameView||(this.gameView=GObj.create(t.IMiniGame17View)),this.gameView.setData(this.getCurGameData()),this.gameView},e.setLocalStorage=function(t){t.date=GApp.clockMgr.serverSecond;var i=JSON.stringify(t);return egret.localStorage.setItem("IMiniGame17_ls_"+App.player.playerVo.uid,i)},e.getLocalStorage=function(){var i;try{i=egret.localStorage.getItem("IMiniGame17_ls_"+App.player.playerVo.uid)}catch(e){console.error("IMiniGame17 egret.localStorage.getItem('IMiniGame17_ls')错误")}var s,h=IMiniGameMain.curMiniGame.gameData.funny,a=h.actData.p5,n=t.IMiniGame17Consts.defaults;if(i||a){i&&(s=JSON.parse(i)),(!s||a&&a.date>s.date)&&(s=a);for(var o=0,r=n.skills;o<r.length;o++)for(var l=r[o],p=0,c=s.skills;p<c.length;p++){var u=c[p];if(l.id==u.id){l.level=u.level;break}}s.skills=n.skills}else s=n,s.date=GApp.clockMgr.serverSecond;return s.skills.sort(function(t,i){return t.id-i.id}),s},e.prototype.loadConfigComplete=function(e){if(e)for(var s in e.config)t.IMiniGame17Consts[s]=e.config[s];i.prototype.loadConfigComplete.call(this,e)},e}(t.IMiniGameBaseCtr);t.IMiniGame17=i,__reflect(i.prototype,"miniGame.IMiniGame17")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.backFrame=0,t.shadowGap=5,t}return __extends(e,i),e.prototype.run=function(){i.prototype.run.call(this)},e.prototype.move=function(){if(this._isMove)switch(this.state){case 0:this.runBrith();break;case 1:this.runMove();break;case 2:this.runFight();break;case 3:this.runDie()}},e.prototype.setData=function(i,e){this.id=i.id,this.kind=i.kind,this.updatePart(i.model),this.scaleX=i.scaleXY,this.scaleY=i.scaleXY,this.speed=i.speed,this.oldSpeed=this.speed,this.hp=i.hp,this.atk=i.atk,this.filters=null,e&&this.superArms(),this.setPlayInterval();var s=t.IMiniGame17Consts.armsBirthXY,h=s[0];1==this.kind&&(h+=GMath.randomInt(0,20)),this.setBirth(h,s[1])},e.prototype.speedDouble=function(t){this.speed=(t>this.floor?3:1)*this.oldSpeed,this.angle=void 0,this.setAngle(0)},e.prototype.superArms=function(){if(1==this.kind){var i=t.IMiniGame17Consts.superArms;this.scaleX*=i.scaleXY,this.scaleY*=i.scaleXY,this.atk*=i.atk,this.hp*=i.hp,this.speed*=i.speed,this.filters=[IMiniGameMain.getRedFilter()]}},e.prototype.setPlayInterval=function(){this.setFrameGap(Math.max(100-7*this.speed,20))},e.prototype.enterNextFloor=function(){this._isMove=!0,this.isFinishPoint=!1,this.x=-this.anchorOffsetX+t.IMiniGame17Consts.doorGap,this.setMove()},e.prototype.setBoss=function(t){this.boss=t},e.prototype.setBirth=function(i,e){this.angle=void 0,this._isDie=!1,this._isMove=!0,this.isFinishPoint=!1,this.lossHp=0,this.state=0,this.x=i,this.y=t.IMiniGame17Consts.groundY,this.anchorOffsetY=e,this.setDirection(AvatarConsts.R_R),this.setAction(AvatarConsts.ACTION_WALK)},e.prototype.setMove=function(){this.state=1,this.setAngle(0),this.setDirection(AvatarConsts.R_R),this.setAction(AvatarConsts.ACTION_WALK)},e.prototype.setFight=function(i){this.state=2,this.backFrame=t.IMiniGame17Consts.fightBackFrame,this.fightX=t.IMiniGame17Consts.fightBack,this.fightY=this.fightX+3,this.fightYd=2*this.fightY/t.IMiniGame17Consts.fightBackFrame,this.lossHp=i,this.hp-=i,this.hp<=0&&(this.hp=0,this.setDie())},e.prototype.setDie=function(){this.state=3,this.setAction(AvatarConsts.ACTION_DIE),this.backFrame=t.IMiniGame17Consts.fightBackFrame/2,this.fightX=t.IMiniGame17Consts.fightBack/2,this.fightY=this.fightX+1,this.fightYd=2*this.fightY/t.IMiniGame17Consts.fightBackFrame},e.prototype.runBrith=function(){this.anchorOffsetY-=t.IMiniGame17Consts.dropSpeedY,this.anchorOffsetY<=0&&(this.anchorOffsetY=0,this.setMove())},e.prototype.runMove=function(){if(this.x+=this.speedx*this.scaleZ||0,this.y+=this.speedy*this.scaleZ||0,this.boss&&!this.boss.isDie()){var i=20;if(this.x>=this.boss.x-i&&this.x<this.boss.x+i)return this.setFight(this.boss.atk),void this.boss.setFight(this.atk)}this.x+t.IMiniGame17Consts.doorGap>t.IMiniGame17Consts.floorWidth+this.anchorOffsetX&&(this.isFinishPoint=!0,this._isMove=!1)},e.prototype.runFight=function(){this.backFrame--<=0&&this.hp&&this.setMove(),this.x-=this.fightX,this.anchorOffsetY+=this.fightY,this.fightY-=this.fightYd},e.prototype.runDie=function(){this.backFrame--<=0&&(this.boss=null,this.died()),this.x-=this.fightX,this.anchorOffsetY+=this.fightY,this.fightY-=this.fightYd},e.prototype.dispose=function(){this.filters=null,this.boss=null,i.prototype.dispose.call(this)},e}(t.IMiniGame17Avatar);t.IMiniGame17Arms=i,__reflect(i.prototype,"miniGame.IMiniGame17Arms")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.shadowScal=2,t.isRunFirst=!0,t}return __extends(e,i),e.prototype.partComplete=function(t){i.prototype.partComplete.call(this,t),this.bloodCup.y=-this.partCont.height-(this.bloodCup.height||20)},e.prototype.isJustDie=function(){return this.parent&&this._isDie},e.prototype.run=function(){switch(i.prototype.run.call(this),this.state){case 0:this.runBrith();break;case 2:this.runFight();break;case 3:this.runDie();break;case 4:this.runUpHp()}},e.prototype.setData=function(i,e,s){if(i){null!=s?(this.id=i.id,this.kind=i.kind,this.updatePart(i.model),this.scaleX=i.scaleXY,this.scaleY=i.scaleXY,this.scaleZ=this.scaleY):s=this.floor,this.hp=Math.floor((i.hp+i.hpPro*s)*(1+(e.hp||0)/100)),this.atk=Math.floor((i.atk+i.atkPro*s)*(1+(e.atk||0)/100)),this.gold=Math.floor((i.gold+i.goldPro*s)*(1+(e.gold||0)/100)),this.cd=Math.floor((i.cd+i.cdPro*s)*(1+(e.cd||0)/100)),this.cd=Math.max(this.cd,t.IMiniGame17Consts.minCreateGap),this.cd*=IMiniGameMain.sysFrame(),this.part.filters=null,this.scaleY=this.scaleZ,this.alpha=1,this.curHp=this.hp,this.curCd=0,this.lossHp=0,this.bloodFrame=IMiniGameMain.sysFrame(),this.noFightFrame=3;var h=t.IMiniGame17Consts.bossBirthXY;this.setBirth(h[0],h[1]),this.initBlood(),this.updateBlood()}},e.prototype.setBirth=function(i,e){this._isDie=!1,this.state=0,this.x=i,this.y=t.IMiniGame17Consts.groundY,this.anchorOffsetY=e,this.setDirection(AvatarConsts.L_L),this.setAction(AvatarConsts.ACTION_STAND)},e.prototype.setFight=function(i){this.noFightFrame=3,this.state=2,this.anchorOffsetY=5*t.IMiniGame17Consts.dropSpeedY,this.curHp-=i,this.lossHp=i,this.curHp<=0?(this.curHp=0,this.setDie()):this.part.filters=[IMiniGameMain.getRedFilter()],this.updateBlood()},e.prototype.setBloodScalx=function(t){this.bloodCup&&(this.bloodCup.scaleX=t)},e.prototype.setDie=function(){this.state=3},e.prototype.runBrith=function(){this.anchorOffsetY-=t.IMiniGame17Consts.dropSpeedY,this.anchorOffsetY<=0&&(this.anchorOffsetY=0,this.state=1)},e.prototype.runFight=function(){this.anchorOffsetY-=t.IMiniGame17Consts.dropSpeedY,this.anchorOffsetY<=0&&(this.anchorOffsetY=0,this.part.filters=null,this.state=4)},e.prototype.runDie=function(){this.scaleY-=.1,this.alpha-=.1,this.scaleY<=0&&(this.died(),this.curCd=this.cd)},e.prototype.runUpHp=function(){this.curHp>=this.hp||--this.bloodFrame>0||(this.bloodFrame=IMiniGameMain.sysFrame(),--this.noFightFrame>0||(this.curHp+=this.hp/100,this.updateBlood()))},e.prototype.initBlood=function(){var i=this;this.bloodCup||(this.bloodCup=GObj.create(egret.DisplayObjectContainer),this.addChild(this.bloodCup),this.bloodBg=GObj.create(t.ImageOutside),this.bloodBg.loadCompleteCall(function(){i.bloodBg.anchorOffsetX=i.bloodBg.iconWidth/2,i.bloodBg.anchorOffsetY=i.bloodBg.iconHeight/2},this),this.bloodBg.setOutSrc("hp_0"),this.bloodCup.addChild(this.bloodBg),this.blood=GObj.create(t.ImageOutside),this.blood.loadCompleteCall(function(){i.bloodCup.width=i.blood.iconWidth,i.bloodCup.height=i.blood.iconHeight,i.bloodCup.anchorOffsetX=i.blood.iconWidth/2,i.bloodBg.x=i.bloodCup.width/2,i.bloodBg.y=i.bloodCup.height/2},this),this.blood.setOutSrc("hp_1"),this.bloodCup.addChild(this.blood))},e.prototype.updateBlood=function(){var t=this.curHp/this.hp;this.blood.scaleX=t,this.bloodCup.visible=.98>t},e.prototype.dispose=function(){GObj.disposeObject(this.bloodCup),this.bloodCup=null,GObj.disposeObject(this.bloodBg),this.bloodBg=null,GObj.disposeObject(this.blood),this.blood=null,this.part.filters=null,i.prototype.dispose.call(this)},e}(t.IMiniGame17Avatar);t.IMiniGame17Boss=i,__reflect(i.prototype,"miniGame.IMiniGame17Boss")}(miniGame||(miniGame={}));var miniGame;!function(t){t.IMiniGame17Consts={event_1:"iminigame17_pop_1",minigame_bgm:"",offLineRare:.1,boxFloor:5,minCreateGap:.2,floorFrame:500,floorWidth:540,floorHeight:250,groundY:210,bottomH:60,hideFloor:1,armsBirthXY:[40,0],bossBirthXY:[440,40],doorGap:0,dropSpeedY:7,fightBack:5,fightBackFrame:30,heroId:1001,bossIds:2e3,bossLoop:1,armsHurt:"num1",bossHurt:"num10",floorSrc:"num9",floorName:"floor/floor_",doorMovie:"",brithMovie:"",defaults:{},avatars:{},skills:{},equips:{},boxIds:[],superArms:{}}}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.init(),t}return __extends(e,i),e.prototype.init=function(){i.prototype.init.call(this),this.curHeroNum=0,this.maxHeroNum=0,this.skillHeroRare=0,this.equipHeroRare=0,this.curGoldMinut=0,this.autoCreatGap=0,this.autoCreateFrame=0,this.addUpGold=0,this.maxOffLine=8,this.onLineFrame=IMiniGameMain.sysFrame(),this.getGoldTime=GApp.timer,this.avatarMaps={},this.hurtMaps={},this.bossMaps={},this.minFrameGap=t.IMiniGame17Consts.minCreateGap||1,this.armsVo=t.IMiniGame17Consts.avatars,this.skillsVo=t.IMiniGame17Consts.skills,this.equipsVo=t.IMiniGame17Consts.equips;for(var e in this.equipsVo)if(12==this.equipsVo[e]){this.maxOffLine=this.equipsVo[e].param1;break}this.getSevenData()},e.prototype.getSevenData=function(){this.saveFrame=60,this.gameData=t.IMiniGame17.getLocalStorage(),e.gameData=this.gameData,this.initUnLockArms(),this.initUnLockSkills(),this.initEquips(),this.countOffLine()},e.prototype.saveServenData=function(i){--this.saveFrame>0&&!i||(this.saveFrame=60*IMiniGameMain.sysFrame(),t.IMiniGame17.setLocalStorage(this.gameData),IMiniGameMain.reqSocket(7,null,this.gameData))},e.prototype.countOffLine=function(){var i=GApp.clockMgr.serverSecond-this.gameData.date;if(i>=this.saveFrame){var e=3600*this.maxOffLine,s=GObj.create(t.IMiniGame17Offline),h=this.getOffLineMinuteGold(),a=h*Math.floor(Math.min(i,e)/60);this.gameData.gold+=a,s.setData({gold:a,time:i,maxTime:e}),this.saveServenData(!0)}},e.prototype.getOffLineMinuteGold=function(){var i=this.getMinFloor(),e=t.IMiniGame17Consts.bossIds+(i-1)%t.IMiniGame17Consts.bossLoop+1,s=this.armsVo[e],h=this.attSubBoss,a=Math.floor((s.gold+s.goldPro*i)*(1+(h.gold||0)/100)),n=Math.floor((s.cd+s.cdPro*i)*(1+(h.cd||0)/100));return n=Math.max(n,t.IMiniGame17Consts.minCreateGap),Math.floor(60*a/n*t.IMiniGame17Consts.offLineRare)},e.prototype.getMinuteGold=function(){return this.curGoldMinut||0},e.prototype.initUnLockArms=function(){for(var t=this.gameData.arms,i=0,e=t;i<e.length;i++){var s=e[i];this.updateArmsData(s.id,s.level)}s&&s.level>0&&this.armsVo[s.id+1]&&(this.gameData.arms.push({id:s.id+1,level:0}),this.updateArmsData(s.id+1,0))},e.prototype.updateArmsData=function(t,i){var e=this.armsVo[t];if(e){var s=this.arms[t]||{};s.id=e.id,s.name=e.name,s.desc=e.desc,s.kind=e.kind,s.qua=e.qua,s.model=e.model,s.level=i,s.scaleXY=e.scaleXY,this.updateArmsByobj(s),s.curCd||(s.curCd=0),this.arms[t]=s}},e.prototype.upGradeArmsData=function(t,i){var e=this.arms[t];if(e&&this.subGold(e.gold)){if(0==e.level&&1!=e.kind){var s=t+1;this.armsVo[s]&&(this.gameData.arms.push({id:s,level:0}),this.updateArmsData(s,0))}this.updateArmsData(t,e.level+i);for(var h=0,a=this.gameData.arms;h<a.length;h++){var n=a[h];if(n.id==t){n.level=e.level;break}}}},e.prototype.initUnLockSkills=function(){for(var t=this.gameData.skills,i=0,e=t;i<e.length;i++){var s=e[i];this.updateSkillsData(s.id,s.level)}this.updateUpAtt()},e.prototype.updateSkillsData=function(t,i){var e=this.skillsVo[t];if(e){4==e.kind&&(this.autoLockId=t);var s=this.skills[t]||{};s.id=e.id,s.name=e.name,s.desc=e.desc,s.kind=e.kind,s.qua=e.qua,s.maxLevel=e.maxLevel||1/0,s.level=Math.min(i,s.maxLevel),s.param1=e.param1,s.param2=e.param2,s.param3=e.param3,s.gold=Math.floor(e.gold+e.goldPro*s.level),this.updateAtt(s,e),this.skills[t]=s;var h,a=IMiniGameMain.getLanguageObj();switch(s.kind){case 1:this.maxHeroNum=Math.floor(s.param1+s.param2*s.level),s.attStr=a[13]+"+"+this.maxHeroNum;break;case 2:h=Math.floor(s.param1+s.param2*s.level),s.attStr=IMiniGameMain.getString(a[21],h),this.skillHeroRare=h;break;case 3:h=Math.floor(s.param1+s.param2*s.level),s.level<=s.maxLevel&&s.level>0&&(this.gameData.minFloor=h),s.attStr=IMiniGameMain.getString(a[22],h-1);break;case 4:this.autoLockFloor();break;default:s.attStr=this.getAttStr(s.addVal||{})}}},e.prototype.upGradeSkillsData=function(t,i){var e=this.skills[t];if(e&&this.subGold(e.gold)){this.updateSkillsData(t,e.level+i);for(var s=0,h=this.gameData.skills;s<h.length;s++){var a=h[s];if(a.id==t){a.level=e.level;break}}}this.updateUpAtt()},e.prototype.initEquips=function(){for(var t=this.gameData.equips,i=0,e=t;i<e.length;i++){var s=e[i];this.updateEquipData(s.id,s.level)}this.updateUpAtt()},e.prototype.updateEquipData=function(t,i){var e=this.equipsVo[t];if(e){var s=this.equips[t]||{};s.id=e.id,s.name=e.name,s.desc=e.desc,s.kind=e.kind,s.qua=e.qua,s.maxLevel=e.maxLevel,s.level=Math.min(i,e.maxLevel||1/0),s.param1=e.param1,s.param2=e.param2,s.param3=e.param3,this.updateAtt(s,e),this.equips[t]=s;var h,a=IMiniGameMain.getLanguageObj();switch(s.kind){case 1:this.maxHeroNum=Math.floor(s.param1+s.param2*s.level),s.attStr=a[13]+"+"+this.maxHeroNum;break;case 2:h=Math.floor(s.param1+s.param2*s.level),s.attStr=IMiniGameMain.getString(a[21],h),this.equipHeroRare=h;break;case 3:h=Math.floor(s.param1+s.param2*s.level),s.level<=s.maxLevel&&s.level>0&&(this.gameData.minFloor=h),s.attStr=IMiniGameMain.getString(a[22],h-1);break;case 4:this.autoLockFloor();break;case 11:h=s.param1+s.param2*s.level,h=Math.max(h,s.param3),this.autoCreatGap=h*IMiniGameMain.sysFrame(),s.attStr=IMiniGameMain.getString(a[27],h);break;case 12:this.maxOffLine=s.param1+s.param2*s.level;var n=Math.floor(this.maxOffLine),o=Math.floor(60*(this.maxOffLine-n));s.attStr=IMiniGameMain.getString(a[28],n,o);break;default:s.attStr=this.getAttStr(s.addVal||{})}}},e.prototype.upGradeEquipata=function(t,i){for(var e,s=0,h=this.gameData.equips;s<h.length;s++){var a=h[s];if(a.id==t){a.level+=i,e=a;break}}e||(e={id:t,level:i},this.gameData.equips.push(e)),this.updateEquipData(t,e.level),this.updateUpAtt()},e.prototype.getBoxView=function(){var i=this.getMaxFloor()-1;if(i>0&&i%t.IMiniGame17Consts.boxFloor!=0)return!1;var e=this.countEquipWeight(i);if(null==e)return!1;this.upGradeEquipata(e,1);var s=GObj.create(t.IMiniGame17GetBox),h=this.equips[e]?this.equips[e].level:1;return s.setData(this.equipsVo[e],h),this.saveServenData(!0),!0},e.prototype.countEquipWeight=function(i){var e=i%t.IMiniGame17Consts.boxFloor;if(0!=e)return null;e=Math.floor(i/t.IMiniGame17Consts.boxFloor)-1;var s=t.IMiniGame17Consts.boxIds[e];if(s)return s;var h,a,n=0,o={};for(var r in this.equipsVo)h=this.equips[r],a=this.equipsVo[r],(!h||h&&a.maxLevel>h.level)&&(o[r]=[n,n+=a.weight]);if(0==n)return null;var l,p=GMath.randomInt(0,n);for(r in o)if(l=o[r],l[0]<=p&&l[1]>p){s=+r;break}return s},e.prototype.getAttStr=function(t){var i=IMiniGameMain.getLanguageObj(),e="";for(var s in t)e+=i[s]+(t[s]>=0?"+":"")+t[s]+"% ";return e},e.prototype.getData=function(){return this.gameData},e.prototype.autoLockFloor=function(){var t=this.skills[this.autoLockId];if(t){var i=this.gameData.maxFloor-this.gameData.minFloor,e=Math.floor(t.param1+t.param2*t.level);t.level>0&&i>e&&(this.gameData.minFloor=this.gameData.maxFloor-e),t.attStr=IMiniGameMain.getString(IMiniGameMain.getLanguage(23),e);var s=this.skills[this.autoLockId-1];t.param3=0,s&&(s.level<s.maxLevel?t.param3=0:e>i?t.param3=this.gameData.minFloor+e:t.param3=-1)}},e.prototype.getMaxFloor=function(){return this.gameData.maxFloor},e.prototype.getMinFloor=function(){return this.gameData.minFloor},e.prototype.getGoldNum=function(){return this.gameData.gold},e.prototype.subGold=function(t){return this.gameData.gold>=t?(this.gameData.gold-=t,!0):!1},e.prototype.addGold=function(t){t&&(this.addUpGold+=t.gold,this.gameData.gold+=t.gold)},e.prototype.countOnLineGold=function(){if(!(--this.onLineFrame>0||this.addUpGold<=0)){this.onLineFrame=IMiniGameMain.sysFrame();var t=GApp.timer-this.getGoldTime;this.curGoldMinut=0,t>0&&(this.curGoldMinut=Math.ceil(6e4*this.addUpGold/t)),this.getGoldTime=GApp.timer,this.addUpGold=0}},e.prototype.run=function(){i.prototype.run.call(this),this.countDownTime(),this.floorAvatarRun(),this.floorBossRun(),this.floorHurtRun(),this.autoCreateRun(),this.saveServenData(),this.countOnLineGold()},e.prototype.autoCreateRun=function(){this.autoCreatGap&&(--this.autoCreateFrame>0||(this.autoCreateFrame=this.autoCreatGap,this.createHero(this.gameData.minFloor)))},e.prototype.countDownTime=function(){var t;for(var i in this.arms)t=this.arms[i],1!=t.kind&&t.level&&--t.curCd<0&&(t.curCd=t.cd*IMiniGameMain.sysFrame()*(1-(this.attUpArms.cd||0)/100),this.createAvatar(t,this.gameData.minFloor));for(var e,s=this.getMinFloor(),h=this.getMaxFloor(),a=s;h>=a;a++)e=this.bossMaps[a],e?e.isDie()&&--e.curCd<0&&e.setData(this.armsVo[e.id],this.attSubBoss):this.createBoss(a)},e.prototype.floorAvatarRun=function(){if(this.avatarMaps){var t,i,e,s;for(var h in this.avatarMaps)for(t=this.avatarMaps[h],s=this.bossMaps[h],i=0;i<t.length;i++)e=t[i],e.lossHp&&(this.createHurt(h,e),e.lossHp=0),e.isDie()?(1==e.kind&&this.curHeroNum>0&&this.curHeroNum--,e.removeMe(),this.backObjByClass(e),t.splice(i,1),i--):e.isFinishPoint?(this.enterNextFloor(e),t.splice(i,1),i--):(e.setBoss(s),e.run())}},e.prototype.enterNextFloor=function(t){var i=t.floor,s=i+1;s>this.gameData.maxFloor&&(this.gameData.maxFloor+=1,e.showAdd=!0),this.avatarMaps[s]||(this.avatarMaps[s]=[]),this.avatarMaps[s].push(t),t.removeMe(),t.floor=s,t.enterNextFloor()},e.prototype.createAvatar=function(i,e,s){var h=this.getObjByClass(t.IMiniGame17Arms);h.floor=e,h.setData(i,s);var a=this.avatarMaps[e];a||(a=[]),a.push(h),this.avatarMaps[e]=a},e.prototype.showAvatar=function(t){var i=this.avatarMaps[t.floor];if(i)for(var e=this.getMinFloor(),s=0,h=i;s<h.length;s++){var a=h[s];a&&(a.speedDouble(e),a.parent!=t&&(t.addAvatarObj(a),t.addShadowObj(a.getShadow())))}},e.prototype.createHero=function(i){if(!(this.curHeroNum>=this.maxHeroNum)){this.curHeroNum++;var e=this.arms[t.IMiniGame17Consts.heroId];if(e){var s=100*Math.random();this.createAvatar(e,i,s<=this.skillHeroRare)}}},e.prototype.floorBossRun=function(){var t,i=this.getMinFloor();for(var e in this.bossMaps)t=this.bossMaps[e],t?(t.lossHp&&(this.createHurt(e,t),t.lossHp=0),t.floor<i?(this.addGold(t),t.removeMe(),this.backObjByClass(t),this.bossMaps[e]=null,delete this.bossMaps[e]):t.isDie()?t.isJustDie()&&(this.addGold(t),t.removeMe()):t.run()):delete this.bossMaps[e]},e.prototype.createBoss=function(i){if(this.bossMaps[i])return this.bossMaps[i];var e=t.IMiniGame17Consts.bossIds+(i-1)%t.IMiniGame17Consts.bossLoop+1,s=this.getObjByClass(t.IMiniGame17Boss);return s.floor=i,s.setData(this.armsVo[e],this.attSubBoss,i),this.bossMaps[i]=s,s},e.prototype.showBoss=function(t){var i=this.bossMaps[t.floor];i&&!i.isDie()&&i.parent!=t&&(t.addBossObj(i),t.addShadowObj(i.getShadow()))},e.prototype.floorHurtRun=function(){if(this.hurtMaps){var t,i,e;for(var s in this.hurtMaps)for(t=this.hurtMaps[s],i=0;i<t.length;i++)e=t[i],e.isRun?e.run():(e.removeMe(),this.backObjByClass(e),t.splice(i,1),i--)}},e.prototype.createHurt=function(i,e){var s=this.getObjByClass(t.IMiniGame17Hurt);s.x=e.x,s.y=e.y,2==e.kind?(s.y=e.y-e.height/2*e.scaleY,s.setHurt(e.lossHp,t.IMiniGame17Consts.bossHurt,2)):s.setHurt(e.lossHp,t.IMiniGame17Consts.armsHurt,1);var h=this.hurtMaps[i]||[];h.push(s),this.hurtMaps[i]=h},e.prototype.showHurt=function(t){var i=this.hurtMaps[t.floor];if(i)for(var e=0,s=i;e<s.length;e++){var h=s[e];h&&h.parent!=t&&t.addHurtObj(h)}},e.prototype.allObjBackPool=function(){this.saveServenData(!0);var t,i;for(var e in this.avatarMaps){for(t=this.avatarMaps[e],i=0;i<t.length;i++)t[i].removeMe(),this.backObjByClass(t[i]);this.avatarMaps[e]=null}this.avatarMaps={};var s;for(e in this.bossMaps)s=this.bossMaps[e],s.removeMe(),this.backObjByClass(s),this.bossMaps[e]=null;this.bossMaps={};var h,a;for(e in this.hurtMaps){for(h=this.hurtMaps[e],i=0;i<h.length;i++)a=h[i],a.removeMe(),this.backObjByClass(a);this.hurtMaps[e]=null}this.hurtMaps={}},e.prototype.dispose=function(){this.allObjBackPool(),this.hurtMaps=null,this.avatarMaps=null,this.bossMaps=null,this.gameData=null,e.gameData=null,e.showAdd=void 0,i.prototype.dispose.call(this)},e}(t.IEndLessBase);t.IMiniGame17Data=i,__reflect(i.prototype,"miniGame.IMiniGame17Data")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.once(egret.Event.REMOVED_FROM_STAGE,t.dispose,t),t}return __extends(e,i),e.prototype.initSkins=function(){var i=this;this.bgImg||(this.touchChildren=!1,this.height=t.IMiniGame17Consts.floorHeight,this.width=t.IMiniGame17Consts.floorWidth,this.bgGrp=GObj.create(eui.Group),this.bgGrp.width=this.width,this.bgGrp.height=this.height,this.bgGrp.anchorOffsetX=this.width/2,this.bgGrp.horizontalCenter=0,this.bgGrp.bottom=0,this.addChild(this.bgGrp),this.bgImg=GObj.create(t.ImageOutside),this.bgGrp.addChild(this.bgImg),this.box=GObj.create(t.ImageOutside),this.box.loadCompleteCall(function(){i.box.anchorOffsetX=i.box.iconWidth/2,i.box.anchorOffsetY=i.box.iconHeight},this),this.box.setOutSrc("box"),this.bgGrp.addChild(this.box),this.shadowGrp=GObj.create(egret.DisplayObjectContainer),this.shadowGrp.width=this.width,this.shadowGrp.height=this.height,this.bgGrp.addChild(this.shadowGrp),this.avatarGrp=GObj.create(egret.DisplayObjectContainer),this.avatarGrp.width=this.width,this.avatarGrp.height=this.height,this.bgGrp.addChild(this.avatarGrp),this.hurtGrp=GObj.create(egret.DisplayObjectContainer),this.hurtGrp.width=this.width,this.hurtGrp.height=this.height,this.bgGrp.addChild(this.hurtGrp),this.door1=GObj.create(t.IMovie),this.door1.x=t.IMiniGame17Consts.doorGap,this.door1.y=t.IMiniGame17Consts.groundY-20,this.door1.start(t.IMiniGame17Consts.doorMovie),this.bgGrp.addChild(this.door1),this.door2=GObj.create(t.IMovie),this.door2.x=this.width-t.IMiniGame17Consts.doorGap,this.door2.y=t.IMiniGame17Consts.groundY-20,this.door2.start(t.IMiniGame17Consts.doorMovie),this.bgGrp.addChild(this.door2),this.floorMap=GObj.create(t.IBitNumMap),this.floorMap.setPath(t.IMiniGame17Consts.floorSrc),this.floorMap.horizontalCenter=0,this.floorMap.y=30,this.bgGrp.addChild(this.floorMap))},e.prototype.dataChanged=function(){i.prototype.dataChanged.call(this),this.updateView()},e.prototype.updateView=function(){this.initSkins(),this.bgGrp.filters=null;var i=this.data;this.floor=i;var e=t.IMiniGame17Data.gameData;if(this.box.visible=!1,e){if(i>e.maxFloor)return void(this.visible=!1);i==e.maxFloor?(this.box.visible=i%t.IMiniGame17Consts.boxFloor==0,this.showEff()):i<e.minFloor&&(this.bgGrp.filters=[IMiniGameMain.getGrayFilter()]),this.visible=!0;var s,h=(i-1)%20;switch(h){case 0:case 1:case 2:case 3:s=1;break;case 4:s=5;break;case 5:case 6:case 7:case 8:s=6;break;case 9:s=10;break;case 10:case 11:case 12:case 13:s=11;break;case 14:s=15;break;case 15:case 16:case 17:case 18:s=16;break;case 19:s=20}this.bgImg.setOutSrc(t.IMiniGame17Consts.floorName+s,FileConst.jpg),this.floorMap.setString(IMiniGameMain.getString(IMiniGameLanguage.c_16,i)),this.scalX=i%2==1?1:-1,this.bgGrp.scaleX=this.scalX,this.floorMap.scaleX=this.scalX,this.cleanAllObj()}},e.prototype.cleanAllObj=function(){this.shadowGrp&&this.shadowGrp.removeChildren(),this.avatarGrp&&this.avatarGrp.removeChildren(),this.hurtGrp&&this.hurtGrp.removeChildren()
},e.prototype.addBossObj=function(t){this.avatarGrp&&(t.setBloodScalx(this.scalX||1),this.avatarGrp.addChildAt(t,0),this.box.x=t.x+50,this.box.y=t.y)},e.prototype.addAvatarObj=function(t){this.avatarGrp&&this.avatarGrp.addChild(t)},e.prototype.addShadowObj=function(t){this.shadowGrp&&this.shadowGrp.addChild(t)},e.prototype.addHurtObj=function(t){this.hurtGrp&&(t.scalx=this.scalX||1,this.hurtGrp.addChild(t))},e.prototype.run=function(){this.door1&&this.door1.run(),this.door2&&this.door2.run()},e.prototype.showEff=function(){t.IMiniGame17Data.showAdd&&(t.IMiniGame17Data.showAdd=!1,egret.Tween.removeTweens(this.bgGrp),this.bgGrp.scaleY=0,this.bgGrp.alpha=.3,egret.Tween.get(this.bgGrp).to({scaleY:1,alpha:1},t.IMiniGame17Consts.floorFrame))},e.prototype.dispose=function(){this.bgImg&&(this.cleanAllObj(),this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.dispose,this),egret.Tween.removeTweens(this.bgGrp),GObj.disposeObject(this.bgGrp),this.bgGrp=null,GObj.disposeObject(this.bgImg),this.bgImg=null,GObj.disposeObject(this.shadowGrp),this.shadowGrp=null,GObj.disposeObject(this.avatarGrp),this.avatarGrp=null,GObj.disposeObject(this.hurtGrp),this.hurtGrp=null,GObj.disposeObject(this.floorMap),this.floorMap=null,GObj.disposeObject(this.door1),this.door1=null,GObj.disposeObject(this.door2),this.door2=null)},e}(eui.ItemRenderer);t.IMiniGame17Floor=i,__reflect(i.prototype,"miniGame.IMiniGame17Floor")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){return i.call(this)||this}return __extends(e,i),e.prototype.initSkins=function(){var i=this;this.bgMask||(this.width=StageManager.stageWidth,this.height=StageManager.stageHeight,this.bgMask=GObj.create(eui.Rect),this.bgMask.width=this.width,this.bgMask.height=this.height,this.bgMask.alpha=.5,this.addChild(this.bgMask),this.grp=GObj.create(eui.Group),this.grp.width=this.width,this.grp.horizontalCenter=0,this.grp.verticalCenter=0,this.addChild(this.grp),this.bgImg=GObj.create(t.ImageOutside),this.bgImg.horizontalCenter=0,this.bgImg.verticalCenter=0,this.bgImg.setOutSrc("offLine/bg"),this.grp.addChild(this.bgImg),this.box=GObj.create(t.ImageOutside),this.box.verticalCenter=-30,this.box.horizontalCenter=-100,this.box.loadCompleteCall(function(){i.box.anchorOffsetX=i.box.iconWidth,i.box.anchorOffsetY=i.box.iconHeight/2},this),this.grp.addChild(this.box),this.boxName=GObj.create(eui.Label),this.boxName.size=20,this.boxName.textColor=6507273,this.boxName.horizontalCenter=10,this.boxName.verticalCenter=this.box.verticalCenter-20,this.grp.addChild(this.boxName),this.boxLevel=GObj.create(eui.Label),this.boxLevel.size=20,this.boxLevel.textColor=16773120,this.boxLevel.horizontalCenter=10,this.boxLevel.verticalCenter=this.box.verticalCenter+10,this.grp.addChild(this.boxLevel),this.desc=GObj.create(eui.Label),this.desc.maxWidth=250,this.desc.size=20,this.desc.textColor=293918,this.desc.bottom=100,this.desc.horizontalCenter=0,this.grp.addChild(this.desc),this.sureBtn=GObj.create(t.IBaseBtn),this.sureBtn.horizontalCenter=0,this.sureBtn.bottom=20,this.sureBtn.icon=IMiniGameMain.getIcon("offLine/btn_1"),this.sureBtn.label=IMiniGameMain.getLanguage(16),this.sureBtn.labelDisplay.textColor=6507273,this.grp.addChild(this.sureBtn),this.addEvent())},e.prototype.addEvent=function(){this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.dispose,this),this.sureBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSureBtnClick,this)},e.prototype.removeEvent=function(){this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.dispose,this),this.sureBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSureBtnClick,this)},e.prototype.onSureBtnClick=function(){this.bgMask.visible=!1,egret.Tween.removeTweens(this.grp),egret.Tween.get(this.grp).to({scaleX:0,scaleY:0},300).call(this.dispose,this)},e.prototype.setData=function(t,i){var e=this;this.initSkins(),this.updateView(t,i),this.parent||(IMiniGameMain.addToStage(this),egret.Tween.removeTweens(this.grp),this.grp.scaleX=0,this.grp.scaleY=0,this.bgMask.visible=!1,egret.Tween.get(this.grp).to({scaleX:1,scaleY:1},300).call(function(){e.bgMask&&(e.bgMask.visible=!0)},this))},e.prototype.updateView=function(t,i){this.box.setOutSrc("equip/"+t.id),this.boxName.text=t.name,this.boxLevel.text=IMiniGameMain.getLanguage(3)+i,this.desc.text=t.desc},e.prototype.dispose=function(){this.bgMask&&(egret.Tween.removeTweens(this.grp),this.removeEvent(),GObj.disposeObject(this.bgMask),this.bgMask=null,GObj.disposeObject(this.grp),this.grp=null,GObj.disposeObject(this.bgImg),this.bgImg=null,GObj.disposeObject(this.box),this.box=null,GObj.disposeObject(this.boxLevel),this.boxLevel=null,GObj.disposeObject(this.desc),this.desc=null,GObj.disposeObject(this.boxName),this.boxName=null,GObj.disposeObject(this.sureBtn),this.sureBtn=null)},e}(eui.Component);t.IMiniGame17GetBox=i,__reflect(i.prototype,"miniGame.IMiniGame17GetBox")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(t){function i(){var i=t.call(this)||this;return i.scalx=1,i}return __extends(i,t),i.prototype.setHurt=function(t,i,e){switch(this.setPath(i||"num4"),this.setGap(-4),this.setNumber(t||0),this.anchorOffsetX=this.width/2,e){case 1:this.endAngle=GMath.randomInt(200,220);break;default:case 2:this.endAngle=GMath.randomInt(320,340)}this.initMove(),this.isRun=!0},i.prototype.setAngle=function(t){this.angle!=t&&(this.angle=t,this.speedx=this.speed*GMath.cos(t),this.speedy=this.speed*GMath.sin(t))},i.prototype.run=function(){this.isRun&&this.showMove()},i.prototype.showMove=function(){this.x+=this.speedx,this.y+=this.speedy,this.scaleY+=this.show2p1,this.scaleX=this.scaleY*this.scalx,this.alpha+=this.show2p2,this.scaleY>=1.5&&(this.show2p1=-.01,this.show2p2=-.02,this.speed=1,this.setAngle(this.endAngle)),this.alpha<.3&&(this.isRun=!1)},i.prototype.initMove=function(){this.show2p1=.1,this.show2p2=0,this.speed=2,this.scaleY=.3,this.scaleX=this.scaleY*this.scalx,this.alpha=1,this.setAngle(GMath.randomInt(260,280))},i}(t.IBitNumMap);t.IMiniGame17Hurt=i,__reflect(i.prototype,"miniGame.IMiniGame17Hurt")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){return i.call(this)||this}return __extends(e,i),e.prototype.initSkins=function(){var i=this;this.bgMask||(this.width=StageManager.stageWidth,this.height=StageManager.stageHeight,this.bgMask=GObj.create(eui.Rect),this.bgMask.width=this.width,this.bgMask.height=this.height,this.bgMask.alpha=.5,this.addChild(this.bgMask),this.grp=GObj.create(eui.Group),this.grp.width=this.width,this.grp.horizontalCenter=0,this.grp.verticalCenter=0,this.addChild(this.grp),this.bgImg=GObj.create(t.ImageOutside),this.bgImg.horizontalCenter=0,this.bgImg.verticalCenter=0,this.bgImg.setOutSrc("offLine/bg"),this.grp.addChild(this.bgImg),this.goldImg=GObj.create(t.ImageOutside),this.goldImg.verticalCenter=-30,this.goldImg.loadCompleteCall(function(){i.goldImg.anchorOffsetX=i.goldImg.iconWidth,i.goldImg.anchorOffsetY=i.goldImg.iconHeight/2},this),this.goldImg.setOutSrc("offLine/gold"),this.grp.addChild(this.goldImg),this.offlineBg=GObj.create(t.ImageOutside),this.offlineBg.horizontalCenter=0,this.offlineBg.verticalCenter=35,this.offlineBg.setOutSrc("offLine/bg_1"),this.grp.addChild(this.offlineBg),this.goldNum=GObj.create(eui.Label),this.goldNum.bold=!0,this.goldNum.size=35,this.goldNum.textColor=16773120,this.goldNum.horizontalCenter=0,this.goldNum.verticalCenter=this.goldImg.verticalCenter,this.grp.addChild(this.goldNum),this.offlineLab=GObj.create(eui.Label),this.offlineLab.size=20,this.offlineLab.textColor=293918,this.offlineLab.horizontalCenter=0,this.offlineLab.verticalCenter=this.offlineBg.verticalCenter+1,this.grp.addChild(this.offlineLab),this.offlineMax=GObj.create(eui.Label),this.offlineMax.size=17,this.offlineMax.textColor=6507273,this.offlineMax.horizontalCenter=0,this.offlineMax.verticalCenter=this.offlineLab.verticalCenter+25,this.grp.addChild(this.offlineMax),this.sureBtn=GObj.create(t.IBaseBtn),this.sureBtn.horizontalCenter=0,this.sureBtn.verticalCenter=this.offlineMax.verticalCenter+50,this.sureBtn.icon=IMiniGameMain.getIcon("offLine/btn_1"),this.sureBtn.label=IMiniGameMain.getLanguage(16),this.sureBtn.labelDisplay.textColor=6507273,this.grp.addChild(this.sureBtn),this.addEvent())},e.prototype.addEvent=function(){this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.dispose,this),this.sureBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSureBtnClick,this)},e.prototype.removeEvent=function(){this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.dispose,this),this.sureBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSureBtnClick,this)},e.prototype.onSureBtnClick=function(){this.bgMask.visible=!1,egret.Tween.removeTweens(this.grp),egret.Tween.get(this.grp).to({scaleX:0,scaleY:0},300).call(this.dispose,this)},e.prototype.setData=function(t){var i=this;this.initSkins(),this.updateView(t),this.parent||(IMiniGameMain.addToStage(this),egret.Tween.removeTweens(this.grp),this.grp.scaleX=0,this.grp.scaleY=0,this.bgMask.visible=!1,egret.Tween.get(this.grp).to({scaleX:1,scaleY:1},300).call(function(){i.bgMask&&(i.bgMask.visible=!0)},this))},e.prototype.updateView=function(t){this.goldNum.text=IMiniGameMain.numberToStr(t.gold,2),this.goldImg.right=this.grp.width/2+this.goldNum.width/2+10,this.offlineLab.text=IMiniGameMain.getLanguage(17)+this.getTimerMin(t.time),this.offlineMax.text=IMiniGameMain.getString(IMiniGameMain.getLanguage(18),this.getTimerMin(t.maxTime))},e.prototype.getTimerMin=function(t){t=t>=60?60*Math.floor(t/60):0;var i=Math.floor(t/60%60),e=Math.floor(t/3600);return IMiniGameMain.getString(IMiniGameMain.getLanguage(19),e,i)},e.prototype.dispose=function(){this.bgMask&&(egret.Tween.removeTweens(this.grp),this.removeEvent(),GObj.disposeObject(this.bgMask),this.bgMask=null,GObj.disposeObject(this.grp),this.grp=null,GObj.disposeObject(this.bgImg),this.bgImg=null,GObj.disposeObject(this.goldImg),this.goldImg=null,GObj.disposeObject(this.offlineBg),this.offlineBg=null,GObj.disposeObject(this.goldNum),this.goldNum=null,GObj.disposeObject(this.offlineLab),this.offlineLab=null,GObj.disposeObject(this.offlineMax),this.offlineMax=null,GObj.disposeObject(this.sureBtn),this.sureBtn=null)},e}(eui.Component);t.IMiniGame17Offline=i,__reflect(i.prototype,"miniGame.IMiniGame17Offline")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){return i.call(this)||this}return __extends(e,i),e.prototype.initSkins=function(){var i=this;if(!this.bgImg){this.visible=!1,this.bgImg=GObj.create(t.ImageOutside),this.addChild(this.bgImg),this.scro=GObj.create(eui.Scroller),this.scro.scrollPolicyH=eui.ScrollPolicy.OFF,this.scro.horizontalCenter=0,this.scro.width=522,this.scro.y=20,this.addChild(this.scro),this.closeBtn=GObj.create(t.IBaseBtn),this.closeBtn.right=5,this.closeBtn.top=-20,this.closeBtn.icon=IMiniGameMain.getIcon("pop/btnClose"),this.addChild(this.closeBtn),this.list=GObj.create(eui.DataGroup),this.scro.viewport=this.list;var e=GObj.create(eui.VerticalLayout);e.gap=2,this.list.layout=e,this.datas=GObj.create(eui.ArrayCollection),this.list.dataProvider=this.datas,this.bgImg.loadCompleteCall(function(){i.width=i.bgImg.iconWidth,i.height=i.bgImg.iconHeight,i.scro.height=i.height-40,i.openShow()},this),this.bgImg.setOutSrc("pop/bg_1"),this.initSet(),this.addEvent()}},e.prototype.initSet=function(){},e.prototype.addEvent=function(){this.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickBtn,this)},e.prototype.removeEvent=function(){this.closeBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickBtn,this)},e.prototype.openShow=function(){if(!this.visible){this.visible=!0,this.parentCub&&!this.parent&&this.parentCub.addChildAt(this,0),egret.Tween.removeTweens(this);var i=StageManager.stageHeight;this.y=i,egret.Tween.get(this).to({y:i-this.height-t.IMiniGame17Consts.bottomH},300)}},e.prototype.onClickBtn=function(){if(!this.isDestory||this.parent){egret.Tween.removeTweens(this);var t=StageManager.stageHeight;egret.Tween.get(this).to({y:t},300).call(this.closeHide,this)}},e.prototype.closeHide=function(){this.isDestory||(this.visible=!1,DispatcherManager.dispatch(t.IMiniGame17Consts.event_1))},e.prototype.setData=function(t){this.initSkins(),this.bgImg.iconWidth&&this.openShow()},e.prototype.updateView=function(){if(this.list)for(var t,i=this.list.$children,e=0;e<i.length;e++)t=i[e],t&&t.updateView()},e.prototype.dispose=function(){this.isDestory||(this.removeEvent(),this.closeHide(),this.scro&&(this.scro.stopAnimation(),this.scro.viewport=null,GObj.disposeObject(this.scro),this.scro=null),this.list&&(this.list.layout=null,GObj.disposeObject(this.list),this.list=null),GObj.disposeObject(this.bgImg),this.bgImg=null,GObj.disposeObject(this.closeBtn),this.closeBtn=null,this.datas=null,this.parentCub=null)},e}(eui.Component);t.IMiniGame17ViewBase=i,__reflect(i.prototype,"miniGame.IMiniGame17ViewBase");var e=function(i){function e(){return i.call(this)||this}return __extends(e,i),e.prototype.initSkins=function(){var i=this;this.bg||(this.bg=GObj.create(t.ImageOutside),this.bg.loadCompleteCall(function(){i.width=i.bg.iconWidth,i.height=i.bg.iconHeight},this),this.addChild(this.bg),this.icon=GObj.create(t.ImageOutside),this.addChild(this.icon),this.labName=GObj.create(eui.Label),this.labName.textAlign=egret.HorizontalAlign.CENTER,this.addChild(this.labName),this.level=GObj.create(eui.Label),this.addChild(this.level),this.desc=GObj.create(eui.Label),this.addChild(this.desc),this.initSet(),this.addEvent())},e.prototype.initSet=function(){},e.prototype.addEvent=function(){this.upBtn&&this.upBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onUpBtnClick,this),this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.dispose,this)},e.prototype.removeEvent=function(){this.upBtn&&this.upBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onUpBtnClick,this),this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.dispose,this)},e.prototype.onUpBtnClick=function(t){},e.prototype.dataChanged=function(){i.prototype.dataChanged.call(this),this.initSkins()},e.prototype.updateView=function(){this.data&&this.dataChanged()},e.prototype.dispose=function(){this.isDestory||(this.isDestory=!0,GObj.disposeObject(this.bg),this.bg=null,GObj.disposeObject(this.icon),this.icon=null,GObj.disposeObject(this.labName),this.labName=null,GObj.disposeObject(this.level),this.level=null,GObj.disposeObject(this.desc),this.desc=null,GObj.disposeObject(this.needGold),this.needGold=null,GObj.disposeObject(this.upBtn),this.upBtn=null)},e}(eui.ItemRenderer);t.IMiniGame17ItemBase=e,__reflect(e.prototype,"miniGame.IMiniGame17ItemBase");var s=function(i){function e(){return i.call(this)||this}return __extends(e,i),e.prototype.initSet=function(){this.headImg=GObj.create(t.ImageOutside),this.headImg.setOutSrc("pop/bg_2"),this.headImg.x=7,this.headImg.y=3,this.addChildAt(this.headImg,1),this.icon.x=this.headImg.x+7,this.icon.y=this.headImg.y+7,this.labName.x=this.icon.x+70,this.labName.y=this.icon.y+10,this.labName.width=80,this.labName.stroke=1,this.labName.size=18,this.labName.textAlign=egret.HorizontalAlign.CENTER,this.level.x=this.icon.x+70,this.level.y=this.labName.y+25,this.level.textColor=1244928,this.level.stroke=1,this.level.size=18,this.desc.width=180,this.desc.size=20,this.desc.textColor=8673090,this.desc.lineSpacing=3,this.desc.x=this.level.x+120,this.desc.verticalCenter=0,this.createGap=GObj.create(eui.Label),this.createGap.width=150,this.createGap.bottom=7,this.createGap.stroke=1,this.createGap.size=16,this.createGap.textAlign=egret.HorizontalAlign.CENTER,this.addChild(this.createGap),this.needGold=GObj.create(eui.Label),this.needGold.right=0,this.needGold.width=125,this.needGold.textAlign=egret.HorizontalAlign.CENTER,this.needGold.top=20,this.needGold.size=20,this.addChild(this.needGold),this.upBtn=GObj.create(t.IBaseBtn),this.upBtn.icon=IMiniGameMain.getIcon("pop/btn_1"),this.upBtn.right=15,this.upBtn.bottom=15,this.upBtn.labelDisplay.size=18,this.upBtn.labelDisplay.textColor=8673090,this.addChild(this.upBtn)},e.prototype.onUpBtnClick=function(i){if(!this.isCanUse)return void App.msgtip.show(IMiniGameMain.getLanguage(12));var e={kind:1,id:this.id,times:1,unlock:!this.unlock};DispatcherManager.dispatch(t.IMiniGame17Consts.event_1,e)},e.prototype.dataChanged=function(){i.prototype.dataChanged.call(this);var e=this.data;this.bg.setOutSrc("pop/qua_"+(e.qua||2)),this.id=e.id,this.unlock=e.level>0,this.icon.setOutSrc("hero/"+e.id),this.icon.filters=this.unlock?null:[IMiniGameMain.getGrayFilter()],this.labName.text=e.name;var s=IMiniGameMain.getLanguageObj()||{};this.level.text=s[3]+e.level,this.desc.text=s[6]+(this.unlock?e.hp:"???")+"\n"+s[7]+(this.unlock?e.atk:"???")+"\n"+s[8]+(this.unlock?e.speed:"???"),this.createGap.text=s[9]+(this.unlock?e.cd||s[10]:"???"),this.needGold.text=s[5]+e.gold;var h=t.IMiniGame17Data.gameData&&t.IMiniGame17Data.gameData.gold;this.isCanUse=h>=e.gold,this.needGold.textColor=this.isCanUse?65280:16711680,this.upBtn.label=this.unlock?s[4]:s[11]},e.prototype.dispose=function(){this.isDestory||(GObj.disposeObject(this.headImg),this.headImg=null,GObj.disposeObject(this.createGap),this.createGap=null,i.prototype.dispose.call(this))},e}(e);__reflect(s.prototype,"IMiniGame17ArmsItem");var h=function(i){function e(){return i.call(this)||this}return __extends(e,i),e.prototype.initSet=function(){this.icon.x=7,this.icon.y=7,this.labName.bottom=7,this.labName.width=100,this.labName.stroke=1,this.labName.size=18,this.labName.textAlign=egret.HorizontalAlign.CENTER,this.level.x=this.icon.x+75,this.level.y=this.labName.y+40,this.level.textColor=1244928,this.level.stroke=1,this.level.size=18,this.desc.width=220,this.desc.size=20,this.desc.textColor=8673090,this.desc.lineSpacing=3,this.desc.x=this.level.x+110,this.desc.verticalCenter=0,this.needGold=GObj.create(eui.Label),this.needGold.right=0,this.needGold.width=125,this.needGold.textAlign=egret.HorizontalAlign.CENTER,this.needGold.top=25,this.needGold.size=18,this.addChild(this.needGold),this.upBtn=GObj.create(t.IBaseBtn),this.upBtn.icon=IMiniGameMain.getIcon("pop/btn_1"),this.upBtn.right=15,this.upBtn.bottom=15,this.upBtn.labelDisplay.size=18,this.upBtn.labelDisplay.textColor=8673090,this.addChild(this.upBtn)},e.prototype.onUpBtnClick=function(i){if(!this.isCanUse)return void App.msgtip.show(IMiniGameMain.getLanguage(12));var e={kind:2,id:this.id,times:1,unlock:!this.unlock};DispatcherManager.dispatch(t.IMiniGame17Consts.event_1,e)},e.prototype.dataChanged=function(){i.prototype.dataChanged.call(this);var t=this.data;this.bg.setOutSrc("pop/qua_"+(t.qua||2)),this.id=t.id,this.unlock=t.level>0,this.icon.setOutSrc("skill/"+t.id),this.icon.filters=this.unlock?null:[IMiniGameMain.getGrayFilter()],this.labName.text=t.name;var e=IMiniGameMain.getLanguageObj()||{};this.level.text=e[3]+t.level,this.level.visible=this.unlock,this.desc.text=t.desc+(this.unlock?"\n"+e[20]+t.attStr:""),this.needGold.text=e[5]+t.gold,this.checkCanUse(),this.needGold.textColor=this.isCanUse?65280:16711680,this.upBtn.label=this.unlock?e[4]:e[11],this.upBtn.visible=this.isCanUse},e.prototype.checkCanUse=function(){var i=this.data,e=t.IMiniGame17Data.gameData;if(e){var s=e.gold>=i.gold,h=i.maxLevel<=i.level,a=IMiniGameMain.getLanguageObj();switch(i.kind){case 3:var n=i.param2+i.param3+e.minFloor,o=e.maxFloor>=n;this.isCanUse=s&&o&&!h,this.isCanUse||(h?this.needGold.text=a[25]:o||(this.needGold.text=IMiniGameMain.getString(a[29],n)));break;case 4:this.isCanUse=s&&-1==i.param3&&!h,this.isCanUse||(h?this.needGold.text=a[25]:0==i.param3?this.needGold.text=a[30]:i.param3>0&&(this.needGold.text=IMiniGameMain.getString(a[29],i.param3)));break;default:this.isCanUse=s&&!h}}},e}(e);__reflect(h.prototype,"IMiniGame17SkillItem");var a=function(t){function i(){return t.call(this)||this}return __extends(i,t),i.prototype.initSet=function(){this.icon.x=7,this.icon.y=7,this.labName.bottom=7,this.labName.width=100,this.labName.stroke=1,this.labName.size=18,this.labName.textAlign=egret.HorizontalAlign.CENTER,this.level.x=this.icon.x+75,this.level.y=this.labName.y+40,this.level.textColor=1244928,this.level.stroke=1,this.level.size=18,this.desc.width=280,this.desc.size=20,this.desc.textColor=8673090,this.desc.lineSpacing=3,this.desc.x=this.level.x+110,this.desc.verticalCenter=0},i.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var i=this.data;this.bg.setOutSrc("pop/qua_"+(i.qua||2)),this.id=i.id,this.icon.setOutSrc("equip/"+i.id),this.labName.text=i.name;var e=IMiniGameMain.getLanguageObj()||{};this.level.text=e[3]+i.level,this.desc.text=i.desc+"\n"+e[20]+i.attStr},i}(e);__reflect(a.prototype,"IMiniGame17EquipItem");var n=function(t){function i(){return t.call(this)||this}return __extends(i,t),i.prototype.initSet=function(){this.list.itemRenderer=s},i.prototype.setData=function(i){t.prototype.setData.call(this,i);var e=i.map(function(t){return t});this.datas.replaceAll(e)},i}(i);t.IMiniGame17ArmsView=n,__reflect(n.prototype,"miniGame.IMiniGame17ArmsView");var o=function(t){function i(){return t.call(this)||this}return __extends(i,t),i.prototype.initSet=function(){this.list.itemRenderer=h},i.prototype.setData=function(i){t.prototype.setData.call(this,i);var e=i.map(function(t){return t});this.datas.replaceAll(e)},i}(i);t.IMiniGame17SKillView=o,__reflect(o.prototype,"miniGame.IMiniGame17SKillView");var r=function(t){function i(){return t.call(this)||this}return __extends(i,t),i.prototype.initSet=function(){this.list.itemRenderer=a},i.prototype.setData=function(i){t.prototype.setData.call(this,i);var e=i.map(function(t){return t});this.datas.replaceAll(e)},i}(i);t.IMiniGame17EquipView=r,__reflect(r.prototype,"miniGame.IMiniGame17EquipView")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){return i.call(this)||this}return __extends(e,i),e.prototype.initSkins=function(){var i=this;this.dataMgr||(this.width=540,this.height=StageManager.stageHeight,this.dataMgr=GObj.create(t.IMiniGame17Data),this.bg=GObj.create(t.ImageOutside),this.bg.setOutSrc("bg"),this.addChild(this.bg),this.scro=GObj.create(eui.Scroller),this.scro.scrollPolicyH=eui.ScrollPolicy.OFF,this.scro.bounces=!1,this.scro.width=this.width,this.addChild(this.scro),this.list=GObj.create(eui.DataGroup),this.scro.viewport=this.list,this.dataSource=GObj.create(eui.ArrayCollection),this.list.dataProvider=this.dataSource,this.list.itemRenderer=t.IMiniGame17Floor,this.topGrp=GObj.create(eui.Group),this.topGrp.touchThrough=!0,this.topGrp.y=IMiniGameMain.safeHeight,this.addChild(this.topGrp),this.topBg=GObj.create(t.ImageOutside),this.topBg.setOutSrc("topBg"),this.topGrp.addChild(this.topBg),this.goldImg=GObj.create(t.ImageOutside),this.goldImg.x=5,this.goldImg.y=36,this.goldImg.setOutSrc("gold"),this.topGrp.addChild(this.goldImg),this.goldLab=GObj.create(eui.Label),this.goldLab.x=this.goldImg.x+25,this.goldLab.y=this.goldImg.y-8,this.goldLab.size=35,this.goldLab.textColor=16773120,this.goldLab.bold=!0,this.topGrp.addChild(this.goldLab),this.goldMinLab=GObj.create(eui.Label),this.goldMinLab.width=150,this.goldMinLab.textAlign=egret.HorizontalAlign.CENTER,this.goldMinLab.x=this.goldImg.x,this.goldMinLab.y=this.goldImg.y+35,this.topGrp.addChild(this.goldMinLab),this.floorNameLab=GObj.create(eui.Label),this.floorNameLab.horizontalCenter=0,this.floorNameLab.y=38,this.floorNameLab.size=20,this.floorNameLab.textColor=5523491,this.floorNameLab.text=IMiniGameMain.getLanguage(14),this.topGrp.addChild(this.floorNameLab),this.floorLab=GObj.create(eui.Label),this.floorLab.y=this.floorNameLab.y+27,this.floorLab.horizontalCenter=0,this.floorLab.size=16,this.topGrp.addChild(this.floorLab),this.headImg=GObj.create(t.ImageOutside),this.headImg.y=85,this.headImg.x=405,this.headImg.loadCompleteCall(function(){i.headImg.anchorOffsetX=i.headImg.iconWidth/2,i.headImg.anchorOffsetY=i.headImg.iconHeight/2},this),this.headImg.setOutSrc("headImg"),this.topGrp.addChild(this.headImg),this.heroNameLab=GObj.create(eui.Label),this.heroNameLab.size=20,this.heroNameLab.y=23,this.heroNameLab.right=15,this.heroNameLab.width=130,this.heroNameLab.textAlign=egret.HorizontalAlign.CENTER,this.heroNameLab.text=IMiniGameMain.getLanguage(13),this.topGrp.addChild(this.heroNameLab),this.heroLab=GObj.create(eui.Label),this.heroLab.y=this.heroNameLab.y+52,this.heroLab.right=15,this.heroLab.size=20,this.heroLab.width=100,this.heroLab.textAlign=egret.HorizontalAlign.RIGHT,this.topGrp.addChild(this.heroLab),this.btmGrp=GObj.create(eui.Group),this.btmGrp.touchThrough=!0,this.btmGrp.width=this.width,this.btmGrp.height=this.height,this.addChild(this.btmGrp),this.btmBg=GObj.create(t.ImageOutside),this.btmBg.bottom=0,this.btmBg.setOutSrc("btmBg"),this.btmGrp.addChild(this.btmBg),this.armsBtn=GObj.create(t.IBaseBtn),this.armsBtn.left=50,this.armsBtn.bottom=30,this.armsBtn.icon=IMiniGameMain.getIcon("icon_arms"),this.btmGrp.addChild(this.armsBtn),this.skillBtn=GObj.create(t.IBaseBtn),this.skillBtn.horizontalCenter=0,this.skillBtn.bottom=5,this.skillBtn.icon=IMiniGameMain.getIcon("icon_skill"),this.btmGrp.addChild(this.skillBtn),this.equipBtn=GObj.create(t.IBaseBtn),this.equipBtn.right=50,this.equipBtn.bottom=30,this.equipBtn.icon=IMiniGameMain.getIcon("icon_equip"),this.btmGrp.addChild(this.equipBtn),this.addEvent())},e.prototype.addEvent=function(){this.list.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onListClick,this),this.armsBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnClick,this),this.skillBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnClick,this),this.equipBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnClick,this),DispatcherManager.addListener(t.IMiniGame17Consts.event_1,this.popCallBack,this),EnterFrameManager.instance.registeRender(this.run,this)},e.prototype.removeEvent=function(){this.list.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onListClick,this),this.armsBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnClick,this),this.skillBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnClick,this),this.equipBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnClick,this),DispatcherManager.removeListener(t.IMiniGame17Consts.event_1,this.popCallBack,this),EnterFrameManager.instance.unRegisteRender(this.run,this)},e.prototype.onListClick=function(t){var i=t.target,e=i.floor,s=this.dataMgr.getMinFloor(),h=this.dataMgr.getMaxFloor();e>=s&&h>=e&&this.dataMgr.createHero(e)},e.prototype.onBtnClick=function(i){this.curView&&this.curView.onClickBtn();var e;switch(i.target){case this.armsBtn:this.armsView||(this.armsView=GObj.create(t.IMiniGame17ArmsView),this.armsView.parentCub=this.btmGrp),this.armsView!=this.curView&&(this.armsView.setData(this.dataMgr.getOpenArmsArr()),e=this.armsView);break;case this.skillBtn:this.skillView||(this.skillView=GObj.create(t.IMiniGame17SKillView),this.skillView.parentCub=this.btmGrp),this.skillView!=this.curView&&(this.skillView.setData(this.dataMgr.getOpenSkillArr()),e=this.skillView);break;case this.equipBtn:this.equipView||(this.equipView=GObj.create(t.IMiniGame17EquipView),this.equipView.parentCub=this.btmGrp),this.equipView!=this.curView&&(this.equipView.setData(this.dataMgr.getOpenEquipArr()),e=this.equipView)}this.curView=e},e.prototype.popCallBack=function(t){if(t||!this.curView||this.curView.visible||(this.curView=null),t){switch(t.kind){case 1:this.dataMgr.upGradeArmsData(t.id,t.times),t.unlock&&this.armsView.setData(this.dataMgr.getOpenArmsArr());break;case 2:var i=this.dataMgr.getMinFloor();this.dataMgr.upGradeSkillsData(t.id,t.times),t.unlock&&this.skillView.setData(this.dataMgr.getOpenSkillArr()),i<this.dataMgr.getMinFloor()&&this.setScroV();break;case 3:}!t.unlock&&this.updateInfo()}},e.prototype.run=function(){this.isRun&&(this.dataMgr.run(),this.runFloor(),this.addOneFloor(),this.runOne())},e.prototype.runOne=function(){GApp.timer<this.lastTime+1e3||(this.lastTime=GApp.timer,this.updateInfo())},e.prototype.updateInfo=function(){var t=IMiniGameMain.getLanguageObj(),i=this.dataMgr.getGoldNum();this.goldLab.text=IMiniGameMain.numberToStr(i,2);var e=this.dataMgr.getMinuteGold(),s=e?IMiniGameMain.numberToStr(e):t[26];this.goldMinLab.text=IMiniGameMain.getString(t[15],s);var h=this.dataMgr.getMinFloor(),a=this.dataMgr.getMaxFloor();this.floorLab.text=IMiniGameMain.getString(t[1],h,a);var n=this.dataMgr.curHeroNum,o=this.dataMgr.maxHeroNum;this.heroLab.text=IMiniGameMain.getString(t[2],n,o),this.curView&&this.curView.parent&&this.curView.updateView()},e.prototype.setScroPos=function(){this.scro.stopAnimation();var i=this.dataSource.length,e=this.height-t.IMiniGame17Consts.bottomH,s=i*t.IMiniGame17Consts.floorHeight;s>e&&(s=e),this.scro.height<s&&(egret.Tween.removeTweens(this.scro),egret.Tween.get(this.scro).to({y:e-s,height:s},t.IMiniGame17Consts.floorFrame))},e.prototype.runFloor=function(){for(var t,i=this.list.$children,e=0;e<i.length;e++)t=i[e],t&&(t.run(),this.dataMgr.showAvatar(t),this.dataMgr.showBoss(t),this.dataMgr.showHurt(t))},e.prototype.addOneFloor=function(){var i=this.dataMgr.getMaxFloor(),e=this.dataSource.length;if(e<i+t.IMiniGame17Consts.hideFloor)if(this.dataMgr.getBoxView()&&this.dataSource.itemUpdated(i-1),this.dataMgr.autoLockFloor(),this.dataSource.addItemAt(e+1,0),this.setScroPos(),this.list.scrollV>t.IMiniGame17Consts.floorHeight)this.list.scrollV+=t.IMiniGame17Consts.floorHeight;else{var s=this.list.scrollV;this.list.scrollV+=t.IMiniGame17Consts.floorHeight,egret.Tween.removeTweens(this.list),egret.Tween.get(this.list).to({scrollV:s},t.IMiniGame17Consts.floorFrame),this.dataSource.itemUpdated(i)}},e.prototype.initFloor=function(){var i=this;if(!(this.dataSource.length>0)){for(var e=this.dataMgr.getMaxFloor()+t.IMiniGame17Consts.hideFloor,s=this.dataMgr.getMinFloor(),h=[],a=e;a>=1;a--)h.push(a);this.dataSource.replaceAll(h);var n=this.height-t.IMiniGame17Consts.bottomH;if(this.scro.y=n,this.setScroPos(),e*t.IMiniGame17Consts.floorHeight>n){var o=(e-s+1)*t.IMiniGame17Consts.floorHeight-n,r=Math.min(o,n);egret.Tween.removeTweens(this.list),egret.Tween.get(this.list).wait(2*t.IMiniGame17Consts.floorFrame).to({scrollV:r},t.IMiniGame17Consts.floorFrame).call(function(){i.list&&(i.list.scrollV=o)},this)}}},e.prototype.setScroV=function(){var i=this.height-t.IMiniGame17Consts.bottomH,e=this.dataMgr.getMaxFloor()+t.IMiniGame17Consts.hideFloor,s=this.dataMgr.getMinFloor();if(e*t.IMiniGame17Consts.floorHeight>i){var h=(e-s+1)*t.IMiniGame17Consts.floorHeight-i-5;egret.Tween.removeTweens(this.list),egret.Tween.get(this.list).to({scrollV:h},t.IMiniGame17Consts.floorFrame)}},e.prototype.setData=function(t){this.initSkins(),this.initFloor(),this.updateInfo(),this.isRun=!0,this.lastTime=GApp.timer},e.prototype.stop=function(){this.isRun=!1,this.dataMgr.allObjBackPool()},e.prototype.dispose=function(){this.dataMgr&&(this.removeEvent(),GObj.disposeObject(this.dataMgr),this.dataMgr=null,GObj.disposeObject(this.bg),this.bg=null,GObj.disposeObject(this.topGrp),this.topGrp=null,GObj.disposeObject(this.topBg),this.topBg=null,GObj.disposeObject(this.goldImg),this.goldImg=null,GObj.disposeObject(this.goldLab),this.goldLab=null,GObj.disposeObject(this.headImg),this.headImg=null,GObj.disposeObject(this.heroLab),this.heroLab=null,GObj.disposeObject(this.floorLab),this.floorLab=null,GObj.disposeObject(this.btmGrp),this.btmGrp=null,GObj.disposeObject(this.btmBg),this.btmBg=null,GObj.disposeObject(this.armsBtn),this.armsBtn=null,GObj.disposeObject(this.armsView),this.armsView=null,GObj.disposeObject(this.skillBtn),this.skillBtn=null,GObj.disposeObject(this.skillView),this.skillView=null,GObj.disposeObject(this.equipBtn),this.equipBtn=null,GObj.disposeObject(this.equipView),this.equipView=null,this.scro&&(egret.Tween.removeTweens(this.scro),this.scro.stopAnimation(),this.scro.viewport=null,GObj.disposeObject(this.scro),this.scro=null),this.list&&(egret.Tween.removeTweens(this.list),this.list.dataProvider=null,this.list.itemRenderer=null,GObj.disposeObject(this.list),this.list=null),this.dataSource=null,this.curView=null)
},e}(egret.DisplayObjectContainer);t.IMiniGame17Scene=i,__reflect(i.prototype,"miniGame.IMiniGame17Scene")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){return i.call(this)||this}return __extends(e,i),e.prototype.initSkins=function(){this.isInit||(this.isInit=!0,this.horizontalCenter=0,this.verticalCenter=0,this.width=540,this.height=StageManager.stageHeight,this.gameView=GObj.create(t.IMiniGame17Scene),this.addChild(this.gameView),this.exitBtn=GObj.create(t.IBaseBtn),this.exitBtn.icon=IMiniGameMain.getIcon("exit_btn",FileConst.png,"chapter"),this.exitBtn.right=20,this.exitBtn.y=150+IMiniGameMain.safeHeight,this.addChild(this.exitBtn),this.initEvent())},e.prototype.initEvent=function(){this.exitBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCloseClick,this)},e.prototype.removeEvent=function(){this.exitBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onCloseClick,this)},e.prototype.onCloseClick=function(t){i.prototype.onCloseClick.call(this,t),this.gameView&&this.gameView.stop()},e.prototype.setData=function(t){this.initSkins(),this.gameView.setData(t)},e.prototype.dispose=function(){this.removeEvent(),this.exitBtn&&egret.Tween.removeTweens(this.exitBtn),GObj.disposeObject(this.exitBtn),this.exitBtn=null,GObj.disposeObject(this.gameView),this.gameView=null,i.prototype.dispose.call(this)},e}(t.IBaseView);t.IMiniGame17View=i,__reflect(i.prototype,"miniGame.IMiniGame17View")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(t){return i.call(this,t)||this}return __extends(e,i),e.prototype.getGameView=function(){return this.gameView||(this.gameView=GObj.create(t.IMiniGame18View)),this.gameView.setData(this.gameData.funny,this.configData.chapters),this.gameView},e.prototype.loadConfigComplete=function(e){if(e)for(var s in e.config)t.IMiniGame18Consts[s]=e.config[s];i.prototype.loadConfigComplete.call(this,e)},e.prototype.getMiniGameView=function(){if(!this.configData)return null;if(this.gameData&&this.gameData.funny){var t=this.gameData.funny.bagList[0];if(t&&2==t.status)return App.msgtip.show(IMiniGameLanguage.c_8),null}return this.gameView||this.getGameView(),this.gameView},e.prototype.onExitBtnClick=function(t){this.gameView&&this.gameView.sendData(),i.prototype.onExitBtnClick.call(this,t)},e}(t.IMiniGameBaseCtr);t.IMiniGame18=i,__reflect(i.prototype,"miniGame.IMiniGame18")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.once(egret.Event.REMOVED_FROM_STAGE,t.dispose,t),t}return __extends(e,i),e.prototype.initSkins=function(){this.descLab&&(this.width=360,this.descLab=GObj.create(eui.Label),this.descLab.size=18,this.descLab.textColor=7638115,this.descLab.width=360,this.descLab.lineSpacing=3,this.addChild(this.descLab))},e.prototype.dataChanged=function(){if(i.prototype.dataChanged.call(this),this.initSkins(),this.data){var e,s=this.data,h=t.IMiniGame18Consts.lang,a=s.key,n=s.value;e="type"==a?h.attr_name[a]+"："+h.type[n]:"qua"==a?h.attr_name[a]+"："+h.qua[n]:h.attr_name[a]+"："+n,this.descLab.textFlow=IMiniGameMain.parserHtml(IMiniGameMain.getString(e))}},e.prototype.dispose=function(){this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.dispose,this),GObj.disposeObject(this.descLab)},e}(eui.ItemRenderer);t.IMiniGame18AttrItem=i,__reflect(i.prototype,"miniGame.IMiniGame18AttrItem")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){return null!==i&&i.apply(this,arguments)||this}return __extends(e,i),e.prototype.initSkins=function(){this.horizontalCenter=0,this.verticalCenter=0,this.width=505,this.height=696,this.bgRect=GObj.create(eui.Rect),this.bgRect.horizontalCenter=0,this.bgRect.verticalCenter=0,this.bgRect.alpha=.8,this.bgRect.width=StageManager.stageWidth,this.bgRect.height=StageManager.stageHeight,this.addChild(this.bgRect),this.group=GObj.create(eui.Group),this.group.width=this.width,this.group.height=this.height,this.group.horizontalCenter=0,this.group.verticalCenter=0,this.group.scaleX=.6,this.group.scaleY=.6,this.addChild(this.group),this.bgImg=GObj.create(t.ImageOutside),this.bgImg.horizontalCenter=0,this.bgImg.verticalCenter=0,this.bgImg.setOutSrc("attrpop",FileConst.png),this.group.addChild(this.bgImg),this.descBg=GObj.create(t.ImageOutside),this.descBg.horizontalCenter=-2,this.descBg.y=300,this.descBg.setOutSrc("descBg",FileConst.png),this.group.addChild(this.descBg),this.nameLab=GObj.create(eui.Label),this.nameLab.horizontalCenter=-2,this.nameLab.y=78,this.nameLab.textColor=16777215,this.nameLab.size=24,this.nameLab.stroke=2,this.nameLab.strokeColor=6787924,this.group.addChild(this.nameLab),this.mapItem=GObj.create(t.IMiniGame18MapSmallItem),this.mapItem.horizontalCenter=-2,this.mapItem.y=120,this.mapItem.touchEnabled=!1,this.group.addChild(this.mapItem),this.priceLab=GObj.create(eui.Label),this.priceLab.horizontalCenter=-2,this.priceLab.y=575,this.priceLab.size=18,this.priceLab.textColor=16777215,this.priceLab.stroke=2,this.priceLab.strokeColor=6787924,this.group.addChild(this.priceLab),this.scro=GObj.create(eui.Scroller),this.group.addChild(this.scro),this.listData=GObj.create(eui.ArrayCollection),this.list=GObj.create(eui.List),this.list.dataProvider=this.listData,this.list.itemRenderer=t.IMiniGame18AttrItem,this.scro.viewport=this.list,this.unlockImg=GObj.create(t.ImageOutside),this.unlockImg.horizontalCenter=-2,this.unlockImg.y=600,this.unlockImg.setOutSrc("lock1",FileConst.png),this.group.addChild(this.unlockImg),this.yesBtn=GObj.create(t.IBaseBtn),this.yesBtn.icon=IMiniGameMain.getIcon("btn_1",FileConst.png),this.yesBtn.horizontalCenter=-2,this.yesBtn.y=600,this.yesBtn.labelDisplay.textColor=9655570,this.yesBtn.label=IMiniGameMain.getString(t.IMiniGame18Consts.lang[24]),this.group.addChild(this.yesBtn),this.closeBtn=GObj.create(t.IBaseBtn),this.closeBtn.right=0,this.closeBtn.top=0,this.closeBtn.icon=IMiniGameMain.getIcon("close",FileConst.png),this.group.addChild(this.closeBtn),egret.Tween.get(this.group).to({scaleX:1,scaleY:1},300),this.setLayout(),this.addEvent()},e.prototype.setLayout=function(){this.scro.horizontalCenter=-2,this.scro.y=320,this.scro.width=360,this.scro.height=240;var t=GObj.create(eui.VerticalLayout);t.gap=5,this.list.layout=t},e.prototype.addEvent=function(){this.yesBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.__yesBtnHandler,this),this.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.__closeBtnHandler,this)},e.prototype.removeEvent=function(){this.yesBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.__yesBtnHandler,this),this.closeBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.__closeBtnHandler,this)},e.prototype.show=function(i){this.initSkins(),this.data=i,this.mapItem.data=i,this.listData.source.length=0,this.priceLab.text=IMiniGameMain.getString(t.IMiniGame18Consts.lang[25],i.unlockPrice);var e=t.IMiniGame18Consts.lang.attr_name;this.nameLab.text=i.name;for(var s in i)if(e[s]){var h={};h.key=s,h.value=i[s],this.listData.source.push(h)}this.listData.refresh(),this.updateState()},e.prototype.updateState=function(){t.IMiniGame18Consts.maxLevelByType[this.data.type]>=this.data.grade?(this.unlockImg.visible=!0,this.yesBtn.visible=!1,this.priceLab.visible=!1,this.mapItem.unlock()):(this.unlockImg.visible=!1,this.yesBtn.visible=!0,this.priceLab.visible=!0)},e.prototype.__yesBtnHandler=function(){return IMiniGameMain.playEff(t.IMiniGame18Consts.minigame_btn),t.IMiniGame18Consts.haveMoney<this.data.unlockPrice?App.msgtip.show(t.IMiniGame18Consts.lang[3]):t.IMiniGame18Consts.maxLevelByType[this.data.type]+1<this.data.grade?App.msgtip.show(t.IMiniGame18Consts.lang[27]):(t.IMiniGame18Consts.maxLevelByType[this.data.type]++,t.IMiniGame18Consts.haveMoney-=this.data.unlockPrice,App.msgtip.show(t.IMiniGame18Consts.lang[26]),DispatcherManager.dispatch(IMiniGame18Event.IMiniGame18Gold),this.updateState(),void(this.parent&&this.parent.removeChild(this)))},e.prototype.__closeBtnHandler=function(){IMiniGameMain.playEff(t.IMiniGame18Consts.minigame_btn),this.parent&&this.parent.removeChild(this)},e.prototype.dispose=function(){if(this.removeEvent(),GObj.disposeObject(this.bgRect),this.bgRect=null,GObj.disposeObject(this.group),this.group=null,GObj.disposeObject(this.bgImg),this.bgImg=null,GObj.disposeObject(this.descBg),this.descBg=null,GObj.disposeObject(this.nameLab),this.nameLab=null,GObj.disposeObject(this.mapItem),this.mapItem=null,GObj.disposeObject(this.priceLab),this.priceLab=null,GObj.disposeObject(this.unlockImg),this.unlockImg=null,GObj.disposeObject(this.yesBtn),this.yesBtn=null,GObj.disposeObject(this.closeBtn),this.closeBtn=null,this.list){for(;this.list.$children.length>0;)GObj.disposeObject(this.list.$children[0]);this.list.dataProvider=null,GObj.disposeObject(this.list),this.list=null}GObj.disposeObject(this.listData),this.listData=null},e}(eui.Component);t.IMiniGame18AttrPop=i,__reflect(i.prototype,"miniGame.IMiniGame18AttrPop")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.showHit=-1,t}return __extends(e,i),e.prototype.setSelected=function(){},e.prototype.setHit=function(t){var t=Math.min(t,this.hp);this.hp-=t,this.hp<=0&&(this.hp=0)},e.prototype.setScleaZ=function(t){},e.prototype.updateZ=function(){if(!isNaN(this.z)){var t=this.z*(this.z<0?IMiniGameConfig.scaleZLess:IMiniGameConfig.scaleZLarge);this.scaleZ=1+t,this.scaleZ<0?this.scaleZ=.1:this.scaleZ>2&&(this.scaleZ=2),this.scaleX=this.scaleZ,this.scaleY=this.scaleZ}},e.prototype.hit=function(){this.addHitFliter()},e.prototype.addHitFliter=function(){if(t.IMiniGame18Consts.hitFilter>0){if(this.showHit>0)return void(this.showHit=t.IMiniGame18Consts.hitFilter);this.showHit=t.IMiniGame18Consts.hitFilter,this.filters=[IMiniGameMain.getRedFilter()]}},e.prototype.endHitFilter=function(){this.showHit<=0||--this.showHit<=0&&(this.filters=[])},e.prototype.run=function(){i.prototype.run.call(this),this.endHitFilter()},e.prototype.dispose=function(){i.prototype.dispose.call(this),this.filters=null},e}(t.IAvatarViewCtr);t.IMiniGame18Avatar=i,__reflect(i.prototype,"miniGame.IMiniGame18Avatar")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.skinName=t.getSkin(),t}return __extends(e,i),e.prototype.getSkin=function(){var i=this,e=GObj.create(eui.Skin);e.skinParts=["mcDisplay"];var s=GObj.create(t.ImageOutside);s.touchEnabled=!1,s.loadCompleteCall(function(){i.width=i.iconDisplay.iconWidth,i.height=i.iconDisplay.iconHeight},this),s.horizontalCenter=0,s.verticalCenter=0,this.iconDisplay=s;var h=GObj.create(eui.Label);h.touchEnabled=!1,h.top=2,h.horizontalCenter=40,h.size=18,h.textColor=16777215,h.text="",this.labelDisplay=h;var a=GObj.create(t.ImageOutside);return a.top=0,a.right=-20,this.tipsImg=a,e.icon=s,e.label=h,e.tipsImg=a,e.elementsContent=[s],e.states=[new eui.State("up",[]),new eui.State("down",[new eui.SetProperty("label","scaleX",.92),new eui.SetProperty("label","scaleY",.92),new eui.SetProperty("label","top",4),new eui.SetProperty("label","horizontalCenter",38),new eui.SetProperty("icon","scaleX",.92),new eui.SetProperty("icon","scaleY",.92),new eui.SetProperty("tipsImg","scaleX",.92),new eui.SetProperty("tipsImg","scaleY",.92),new eui.SetProperty("tipsImg","right",-18),new eui.SetProperty("tipsImg","top",2)]),new eui.State("disabled",[])],e},Object.defineProperty(e.prototype,"label",{set:function(t){this.labelDisplay&&(this.labelDisplay.parent||this.addChild(this.labelDisplay),this.labelDisplay.text=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tipsIcon",{set:function(t){this.tipsImg&&(this.tipsImg.parent||this.addChild(this.tipsImg),this.tipsImg.source=t)},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){i.prototype.dispose.call(this),GObj.disposeObject(this.tipsImg),this.tipsImg=null},e}(t.IBaseBtn);t.IMiniGame18Btn=i,__reflect(i.prototype,"miniGame.IMiniGame18Btn")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.exact=!0,t.scaleZ=1,t.touchEnabled=!1,t.touchChildren=!1,t.speed=6,t.lockGap=0,t.distance=100,t.createImg(),t}return __extends(e,i),e.prototype.isRunning=function(){return this.isRun},e.prototype.setTowerInfo=function(t,i){this.reSet(),this.data=t,i?(this.speed=i,this.hurt=this.data.big.att,this.isBigBullet=!0):(this.speed=t.bSpeed,this.isBigBullet=!1,this.hurt=this.data.att),this.autoRoation=this.data.rotation||0,this.scaleX=this.scaleY=this.data.scaleXY||1,this.type=this.data.type,this.money=this.data.money,this.img||this.createImg()},e.prototype.createImg=function(){var i=this;this.img=GObj.create(t.ImageOutside),this.img.loadCompleteCall(function(){i.width=i.img.iconWidth,i.height=i.img.iconHeight,i.anchorOffsetX=i.width/2,i.anchorOffsetY=i.height/2},this),this.addChild(this.img)},e.prototype.setTarget=function(t){return this.hitTarget=null,t?(this.target=t,void this.setSkillPoint()):(this.isRun=!1,void(this.target=null))},e.prototype.checkTarget=function(){return this.target?!this.target.isDie():!1},e.prototype.setPlayer=function(t){if(this.player=t,this.x=t.x+25,this.y=t.y+25,t.isBiging)switch(this.img.setOutSrc(this.data.big.bModel),this.data.big.bScale?(this.img.scaleX=this.img.scaleY=this.data.big.bScale,this.anchorOffsetX=this.width*this.data.big.bScale/2):(this.img.scaleX=this.img.scaleY=1,this.anchorOffsetX=this.width/2),this.type){case TowerType.TYPE_1:this.anchorOffsetY=this.height*this.data.big.bScale/4;break;case TowerType.TYPE_2:this.anchorOffsetY=this.height*this.data.big.bScale/2;break;case TowerType.TYPE_3:this.anchorOffsetY=this.height*this.data.big.bScale/2;break;case TowerType.TYPE_4:}else this.img.setOutSrc(this.data.bModel);this.setSkillPoint()},e.prototype.setSkillPoint=function(){if(this.player&&this.target){var t=this.target.scaleX*this.target.width*.3;this.px=GMath.randomInt(-t,t);var i=this.target.scaleY*this.target.height;this.py=GMath.randomInt(0,.7*i),this.isRun||(this.isRun=!0,this.trackPathSet1())}},e.prototype.run=function(){this.isRun&&this.trackPath1()},e.prototype.trackPath1=function(){this.isRun&&(this.lockTarget(),this.updateAngle(),this.x+=this.speedx*this.scaleZ||0,this.y+=this.speedy*this.scaleZ||0,this.updateDistance(),this.distance<5*this.speed&&(this.isRun=!1,this.hitTarget=this.target,this.target.hit(this.data,!1),this.target.setHit(this.hurt,this.type),this.isBigBullet||this.player.setEnergy()))},e.prototype.trackPathSet1=function(){var t=GMath.angle(this.x,this.y,this.target.x-this.px,this.target.y-this.py);this.rotation=t+90;var i=20;this.x+=i*GMath.cos(t)*this.player.scaleX,this.y+=i*GMath.sin(t)*this.player.scaleY,this.lockTarget(),this.setAngle(t),this.scaleZ=1},e.prototype.updateDistance=function(){var t=this.x-this.target.x+this.px,i=this.y-this.target.y+this.py;this.distance=Math.sqrt(Math.pow(t,2)+Math.pow(i,2))},e.prototype.lockTarget=function(){--this.lockGap>0||(this.lockGap=Math.ceil(egret.ticker.$frameRate/5),this.angleTarget=GMath.angle(this.x,this.y,this.target.x-this.px,this.target.y-this.py))},e.prototype.setAngle=function(t){t!=this.angle&&(this.angle=Math.floor((t+360)%360),this.autoRoation||(this.rotation=t+90),this.speedx=this.speed*GMath.cos(t),this.speedy=this.speed*GMath.sin(t))},e.prototype.updateAngle=function(){this.autoRoation&&(this.rotation+=this.autoRoation);var t=this.angleTarget-this.angle;if(this.distance>30&&Math.abs(t)>2*this.speed){var i=t/Math.abs(t);(t>180||-180>t)&&(i=-i),t=this.angle+Math.ceil(this.speed*i)}else t=this.angleTarget;this.setAngle(t)},e.prototype.isHit=function(){return null!=this.hitTarget},e.prototype.getHitModel=function(){return this.data?this.data.hitmodel||"":""},e.prototype.getBigModel=function(){return this.data?this.data.big.eff||"":""},e.prototype.getBigHitModel=function(){return this.data?this.data.big.bigHitEff||"":""},e.prototype.getpoisonModel=function(){return this.data?this.data.big.poisonEff||"":""},e.prototype.setScleaZ=function(t){this.z=this.y-t,this.updateZ()},e.prototype.updateZ=function(){if(!isNaN(this.z)){var t=this.z*(this.z<0?IMiniGameConfig.scaleZLess:IMiniGameConfig.scaleZLarge);this.scaleZ=1+t,this.scaleZ<0?this.scaleZ=.1:this.scaleZ>2&&(this.scaleZ=2),this.scaleX=this.scaleZ,this.scaleY=this.scaleZ}},e.prototype.removeMe=function(){this.parent&&this.parent.removeChild(this)},e.prototype.reSet=function(){this.isRun=!1,this.rotation=0,this.lockGap=0,this.angle=null,this.target=null,this.player=null,this.data=null,this.px=0,this.py=0,this.distance=9999,this.autoRoation=0},e.prototype.dispose=function(){this.reSet(),GObj.disposeObject(this.img),this.img=null},e}(egret.DisplayObjectContainer);t.IMiniGame18Bullet=i,__reflect(i.prototype,"miniGame.IMiniGame18Bullet")}(miniGame||(miniGame={}));var miniGame;!function(t){t.IMiniGame18Consts={unlockGap:1,standPrice:100,standAdd:100,initMoney:2e4,offlineHours:12,tower:{},lang:{},map:{},maxLevel:10,roadWH:[46,38],standLevel:0,tipTime:2e3,createTime:12,poisonFrame:40,hitFilter:10,UI_SIWANG:"ui_siwang",UI_BB_HUO:"ui_bb_huo",UI_BB_BING:"ui_bb_bing",UI_BB_DU:"ui_bb_du",UI_BB_LEI:"ui_bb_lei",minigame18_mondie:"monstor_die",UI_DOOR:"ui_door",minigame_win:"game18_minigame_win",minigame_lose:"game18_minigame_lose",minigame_bgm:"game18_minigame_bgm",minigame_monster_die:"game18_minigame_monster_die",minigame_player_die:"game18_minigame_player_die",minigame_gold:"game18_minigame_gold",minigame_btn:"game18_minigame_btn",minigame_upgrade:"game18_minigame_upgrade",minigame_put:"game18_minigame_put",minigame_sell:"game18_minigame_sell",fireNum:"num16",iceNum:"num17",poisonNum:"num18",thunderNum:"num19",chapterNum:"num20",goldNum:"num21",hpNum:"num4",monsters:{0:{model:"monster_1",hp:10,speed:2},1:{model:"monster_2",hp:10,speed:2},2:{model:"monster_3",hp:10,speed:2}},maxLevelByType:{},haveMoney:0}}(miniGame||(miniGame={}));var TowerType;!function(t){t[t.TYPE_1=1]="TYPE_1",t[t.TYPE_2=2]="TYPE_2",t[t.TYPE_3=3]="TYPE_3",t[t.TYPE_4=4]="TYPE_4"}(TowerType||(TowerType={}));var IMiniGame18Event=function(){function t(){}return t.IMiniGame18Gold="IMiniGame18Gold",t.IMiniGame18Blood="IMiniGame18Blood",t}();__reflect(IMiniGame18Event.prototype,"IMiniGame18Event");var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.initSkins(),t}return __extends(e,i),e.prototype.initSkins=function(){var i=this;this.touchEnabled=!1,this.touchChildren=!1,this.width=18,this.height=62,this.thumbImg=GObj.create(t.ImageOutside),this.thumbImg.loadCompleteCall(function(){i.thumbImg.x=-2,i.thumbImg.y=-3},this),this.thumbImg.setOutSrc("energy2"),this.addChild(this.thumbImg),this.thumb=GObj.create(t.ImageOutside),this.thumb.loadCompleteCall(function(){i.thumb.x=0},this),this.thumb.setOutSrc("energy1"),this.addChild(this.thumb),this.slideDuration=2e3/egret.ticker.$frameRate,this.direction=eui.Direction.BTT},e.prototype.setData=function(t,i){t>i||(0>t&&(t=0),this.value=t/i*100)},e.prototype.dispose=function(){GObj.disposeObject(this.thumbImg),this.thumbImg=null,GObj.disposeObject(this.thumb),this.thumb=null},e}(eui.ProgressBar);t.IMiniGame18Energy=i,__reflect(i.prototype,"miniGame.IMiniGame18Energy")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(t){function i(){var i=t.call(this)||this;return i.endFrame=0,i.bitMap.fillMode=egret.BitmapFillMode.SCALE,i}return __extends(i,t),i.prototype.setData=function(t){this.data=t},i.prototype.setTarget=function(t){return this.hitTarget=null,t?(this.target=t,void this.setSkillPoint()):(this.isFrameOver=!1,void(this.target=null))},i.prototype.setFrame=function(t){this.endFrame=t,this.isKeep=!0},i.prototype.effRun=function(){this.setSkillPoint()},i.prototype.setSkillPoint=function(){this.target&&(--this.endFrame<0&&this.isKeep&&(this.isFrameOver=!0),this.x=this.target.x,this.y=this.target.y)},i.prototype.checkTarget=function(){return this.target?!this.target.isDie():!1},i.prototype.reset=function(){egret.Tween.removeTweens(this),this.touchChildren=!1,this.touchEnabled=!1,this.endFrame=0,this._startTime=0},i.prototype.dispose=function(){this.isDestory||(t.prototype.dispose.call(this),this.endFrame=null)},i}(t.IMovie);t.IMiniGame18HitEff=i,__reflect(i.prototype,"miniGame.IMiniGame18HitEff")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.initSkins(),t}return __extends(e,i),e.prototype.initSkins=function(){var i=this;this.touchEnabled=!1,this.touchChildren=!1,this.labHp=GObj.create(eui.Label),this.thumbImg=GObj.create(t.ImageOutside),this.thumbImg.loadCompleteCall(function(){i.labHp.width=i.thumbImg.width},this),this.addChild(this.thumbImg),this.thumb=GObj.create(t.ImageOutside),this.thumb.loadCompleteCall(function(){i.thumb.x=2,i.thumb.y=1},this),this.addChild(this.thumb),this.labHp.y=-2,this.labHp.size=16,this.labHp.textAlign=egret.HorizontalAlign.CENTER,this.labHp.visible=!1,this.addChild(this.labHp),this.slideDuration=2e3/egret.ticker.$frameRate},e.prototype.setUI=function(t){t?(this.thumb.setOutSrc("hp3"),this.thumbImg.setOutSrc("hp4")):(this.thumb.setOutSrc("hp1"),this.thumbImg.setOutSrc("hp2"))},e.prototype.setData=function(t,i){t>i||(0>t&&(t=0),this.value=t/i*100,this.labHp.text=t+"")},e.prototype.showHpNum=function(t){this.labHp.visible=t},e.prototype.dispose=function(){GObj.disposeObject(this.thumbImg),this.thumbImg=null,GObj.disposeObject(this.thumb),this.thumb=null,GObj.disposeObject(this.labHp),this.labHp=null},e}(eui.ProgressBar);t.IMiniGame18Hp=i,__reflect(i.prototype,"miniGame.IMiniGame18Hp")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){return i.call(this)||this}return __extends(e,i),e.prototype.setHurt=function(i,e){switch(this.speed=1,this.anchorOffsetX=this.width/2,e){case TowerType.TYPE_1:this.setPath(t.IMiniGame18Consts.fireNum),this.setString("-"+i||"0");break;case TowerType.TYPE_2:this.setPath(t.IMiniGame18Consts.iceNum),this.setString("-"+i||"0");break;case TowerType.TYPE_3:this.setPath(t.IMiniGame18Consts.poisonNum),this.setString("-"+i||"0");break;case TowerType.TYPE_4:this.setPath(t.IMiniGame18Consts.thunderNum),this.setString("-"+i||"0");break;case 5:this.setPath(t.IMiniGame18Consts.goldNum),this.setString("+"+i||"0");break;case 6:this.setPath(t.IMiniGame18Consts.hpNum),this.setString("-"+i||"0")}this.initMove1(),this.setGap(-4),this.isRun=!0},e.prototype.setAngle=function(t){this.speedx=this.speed*GMath.cos(-90),this.speedy=this.speed*GMath.sin(-90)},e.prototype.run=function(){this.isRun&&this.showMove1()},e.prototype.initMove1=function(){this.alpha=1,this.setAngle(90)},e.prototype.showMove1=function(){this.x+=this.speedx,this.y+=this.speedy,this.alpha-=.02,this.alpha<.3&&(this.isRun=!1)},e}(t.IBitNumMap);t.IMiniGame18Hurt=i,__reflect(i.prototype,"miniGame.IMiniGame18Hurt")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){return i.call(this)||this}return __extends(e,i),e.prototype.initSkins=function(){this.width=540,this.height=228,this.typeImg=GObj.create(t.ImageOutside),this.typeImg.x=171,this.addChild(this.typeImg),this.arrowImg=GObj.create(t.ImageOutside),this.arrowImg.right=20,this.arrowImg.y=40,this.arrowImg.setOutSrc("arrow"),this.addChild(this.arrowImg),this.scro=GObj.create(eui.Scroller),this.addChild(this.scro),this.listData=GObj.create(eui.ArrayCollection),this.list=GObj.create(eui.List),this.list.dataProvider=this.listData,this.list.itemRenderer=t.IMiniGame18MapSmallItem,this.scro.viewport=this.list,this.setLayout(),this.addEvent()},e.prototype.setLayout=function(){this.scro.x=20,this.scro.y=70,this.scro.width=500,this.scro.height=159;var t=GObj.create(eui.HorizontalLayout);t.gap=18,this.list.layout=t},e.prototype.addEvent=function(){this.list.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.__openAttrPop,this),DispatcherManager.addListener(IMiniGame18Event.IMiniGame18Gold,this.updateData,this)},e.prototype.removeEvent=function(){this.list.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.__openAttrPop,this),DispatcherManager.removeListener(IMiniGame18Event.IMiniGame18Gold,this.updateData,this)},e.prototype.dataChanged=function(){i.prototype.dataChanged.call(this),this.isInit||(this.isInit=!0,this.initSkins(),this.data&&(this.updateData(),this.typeImg.setOutSrc("core/title_"+this.data,FileConst.png)))},e.prototype.updateData=function(){this.listData.source.length=0;var i=t.IMiniGame18Consts.tower[this.data],e=[];for(var s in i)e.push(i[s]);this.listData.replaceAll(e)},e.prototype.__openAttrPop=function(i){i&&i.itemRenderer&&(this.attrPop=GObj.create(t.IMiniGame18AttrPop),this.attrPop.show(i.item),IMiniGameMain.addToStage(this.attrPop))},e.prototype.dispose=function(){if(this.removeEvent(),GObj.disposeObject(this.typeImg),this.typeImg=null,GObj.disposeObject(this.arrowImg),this.arrowImg=null,GObj.disposeObject(this.attrPop),this.attrPop=null,this.list){for(;this.list.$children.length>0;)GObj.disposeObject(this.list.$children[0]);this.list.dataProvider=null,GObj.disposeObject(this.list),this.list=null}GObj.disposeObject(this.listData),this.listData=null},e}(eui.ItemRenderer);t.IMiniGame18MapBigItem=i,__reflect(i.prototype,"miniGame.IMiniGame18MapBigItem")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){return null!==i&&i.apply(this,arguments)||this}return __extends(e,i),e.prototype.initSkins=function(){this.horizontalCenter=0,this.verticalCenter=0,this.width=540,this.height=960,this.bgRect=GObj.create(eui.Rect),this.bgRect.horizontalCenter=0,this.bgRect.verticalCenter=0,this.bgRect.alpha=.8,this.bgRect.width=StageManager.stageWidth,this.bgRect.height=StageManager.stageHeight,this.addChild(this.bgRect),this.titleImg=GObj.create(t.ImageOutside),this.titleImg.setOutSrc("title",FileConst.png),this.titleImg.horizontalCenter=0,this.titleImg.y=50,this.addChild(this.titleImg),this.goldBg=GObj.create(t.ImageOutside),this.goldBg.setOutSrc("goldBg",FileConst.png),this.goldBg.horizontalCenter=0,this.goldBg.y=137,this.addChild(this.goldBg),this.goldImg=GObj.create(t.ImageOutside),this.goldImg.setOutSrc("gold",FileConst.png),this.goldImg.x=218,this.goldImg.y=140,this.addChild(this.goldImg),this.goldLab=GObj.create(eui.Label),this.goldLab.horizontalCenter=10,this.goldLab.y=143,this.goldLab.size=18,this.goldLab.textColor=16777215,this.addChild(this.goldLab),this.offlineLab=GObj.create(eui.Label),this.offlineLab.horizontalCenter=0,this.offlineLab.y=180,this.offlineLab.size=18,this.offlineLab.textColor=16777215,this.addChild(this.offlineLab),this.scro=GObj.create(eui.Scroller),this.addChild(this.scro),this.listData=GObj.create(eui.ArrayCollection),this.list=GObj.create(eui.List),this.list.dataProvider=this.listData,this.list.itemRenderer=t.IMiniGame18MapBigItem,this.scro.viewport=this.list,this.closeBtn=GObj.create(t.IBaseBtn),this.closeBtn.x=470,this.closeBtn.y=115,this.closeBtn.icon=IMiniGameMain.getIcon("close",FileConst.png),this.addChild(this.closeBtn),this.setLayout(),this.addEvent()},e.prototype.setLayout=function(){this.scro.horizontalCenter=0,this.scro.y=216,this.scro.width=540,this.scro.height=720;var t=GObj.create(eui.VerticalLayout);t.gap=30,this.list.layout=t},e.prototype.addEvent=function(){this.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.__closeBtnHandler,this),DispatcherManager.addListener(IMiniGame18Event.IMiniGame18Gold,this.updateMoney,this)},e.prototype.removeEvent=function(){this.closeBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.__closeBtnHandler,this),DispatcherManager.removeListener(IMiniGame18Event.IMiniGame18Gold,this.updateMoney,this)},e.prototype.show=function(){this.initSkins(),this.listData.source.length=0;for(var t=[],i=1;4>=i;i++)t.push(i);this.listData.replaceAll(t),this.updateMoney(),this.updateASecondMoney()},e.prototype.updateASecondMoney=function(){var i=0;for(var e in t.IMiniGame18Consts.maxLevelByType)for(var s=e,h=t.IMiniGame18Consts.maxLevelByType[e],a=1;h>=a;a++)i+=t.IMiniGame18Consts.tower[s][h].money;this.offlineLab.text=IMiniGameMain.getString(t.IMiniGame18Consts.lang[34],60*i)},e.prototype.__closeBtnHandler=function(){IMiniGameMain.playEff(t.IMiniGame18Consts.minigame_btn),GObj.disposeObject(this)},e.prototype.updateMoney=function(){this.goldLab.text=IMiniGameMain.numberToStr(t.IMiniGame18Consts.haveMoney,1),this.updateASecondMoney()},e.prototype.dispose=function(){if(this.removeEvent(),GObj.disposeObject(this.bgRect),this.bgRect=null,GObj.disposeObject(this.titleImg),this.titleImg=null,GObj.disposeObject(this.goldBg),this.goldBg=null,GObj.disposeObject(this.goldImg),this.goldImg=null,GObj.disposeObject(this.goldLab),this.goldLab=null,GObj.disposeObject(this.offlineLab),this.offlineLab=null,GObj.disposeObject(this.scro),this.scro=null,this.list){for(;this.list.$children.length>0;)GObj.disposeObject(this.list.$children[0]);this.list.dataProvider=null,GObj.disposeObject(this.list),this.list=null}GObj.disposeObject(this.listData),this.listData=null},e}(eui.Component);t.IMiniGame18MapPop=i,__reflect(i.prototype,"miniGame.IMiniGame18MapPop")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){return i.call(this)||this}return __extends(e,i),e.prototype.initSkins=function(){this.isInit||(this.isInit=!0,this.width=111,this.height=159,this.quaBg=GObj.create(t.ImageOutside),this.quaBg.x=10,this.quaBg.y=7,this.addChild(this.quaBg),this.quaFrame=GObj.create(t.ImageOutside),this.addChild(this.quaFrame),this.headImg=GObj.create(t.ImageOutside),this.headImg.horizontalCenter=1,this.headImg.verticalCenter=3,this.addChild(this.headImg),this.nameLab=GObj.create(eui.Label),this.nameLab.horizontalCenter=4,this.nameLab.y=13,this.nameLab.size=20,this.nameLab.textColor=16777215,this.addChild(this.nameLab),this.gradeLab=GObj.create(eui.Label),this.gradeLab.horizontalCenter=-42,this.gradeLab.y=5,this.gradeLab.size=18,this.gradeLab.textColor=16777215,this.addChild(this.gradeLab),this.maskImg=GObj.create(t.ImageOutside),this.maskImg.setOutSrc("mask",FileConst.png),this.addChild(this.maskImg),this.lockImg=GObj.create(t.ImageOutside),this.lockImg.horizontalCenter=2,this.lockImg.y=62,this.lockImg.setOutSrc("lock",FileConst.png),this.addChild(this.lockImg),this.addEvent())},e.prototype.addEvent=function(){},e.prototype.removeEvent=function(){},e.prototype.dataChanged=function(){if(i.prototype.dataChanged.call(this),this.initSkins(),this.data){var e=this.data;this.quaFrame.setOutSrc("core/frame_"+e.type,FileConst.png),this.quaBg.setOutSrc("core/qua_"+e.qua,FileConst.png),this.headImg.setOutSrc("items/"+e.res,FileConst.png),this.nameLab.text=e.name,this.gradeLab.text=e.grade.toString(),t.IMiniGame18Consts.maxLevelByType[e.type]>=e.grade?(this.maskImg.visible=!1,this.lockImg.visible=!1):(this.maskImg.visible=!0,this.lockImg.visible=!0)}},e.prototype.unlock=function(){this.maskImg.visible=!1,this.lockImg.visible=!1},e.prototype.dispose=function(){this.removeEvent(),GObj.disposeObject(this.quaFrame),this.quaFrame=null,GObj.disposeObject(this.quaBg),this.quaBg=null,GObj.disposeObject(this.headImg),this.headImg=null,GObj.disposeObject(this.nameLab),this.nameLab=null,GObj.disposeObject(this.gradeLab),this.gradeLab=null,GObj.disposeObject(this.maskImg),this.maskImg=null,GObj.disposeObject(this.lockImg),this.lockImg=null,this.isInit=null},e}(eui.ItemRenderer);t.IMiniGame18MapSmallItem=i,__reflect(i.prototype,"miniGame.IMiniGame18MapSmallItem")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t._isDie=!1,t.addEvent(),t}return __extends(e,i),e.prototype.addEvent=function(){DispatcherManager.addListener(IMiniGame18Event.IMiniGame18Blood,this.setHp,this)},e.prototype.removeEvent=function(){DispatcherManager.removeListener(IMiniGame18Event.IMiniGame18Blood,this.setHp,this)},e.prototype.initSkins=function(){var i=this;this.monkeyKing||(this.monkeyKing=GObj.create(t.ImageOutside),this.monkeyKing.loadCompleteCall(function(){i.anchorOffsetX=i.monkeyKing.width/2,i.anchorOffsetY=i.monkeyKing.height+i.monkeyKing.y
},this),this.monkeyKing.y=20,this.monkeyKing.setOutSrc("monkey",FileConst.png),this.addChild(this.monkeyKing),this.hpBar=GObj.create(t.IMiniGame18Hp),this.hpBar.x=5,this.hpBar.showHpNum(!0),this.hpBar.setUI(!1),this.addChild(this.hpBar))},e.prototype.setData=function(t){this.initSkins(),this._isDie=!1,this.hp=t,this.hpBar.setData(t,t)},e.prototype.setHp=function(t){var i=this;this.hp-=t,this.hpBar.setData(this.hp,10);var e=this.parent;e.hurtAddToScene(null,6,t),e.shake(),this.hp<=0&&(this._isDie=!0),this.monkeyKing.filters=[IMiniGameMain.getRedFilter()],egret.Tween.get(this).wait(200).call(function(){i.monkeyKing.filters=null})},e.prototype.isDie=function(){return this._isDie},e.prototype.dispose=function(){this.removeEvent(),this.filters=null,GObj.disposeObject(this.monkeyKing),this.monkeyKing=null,GObj.disposeObject(this.hpBar),this.hpBar=null},e}(eui.Component);t.IMiniGame18MonkeyKing=i,__reflect(i.prototype,"miniGame.IMiniGame18MonkeyKing")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t._isMove=!0,t.posIndex=0,t.icePassFrame=0,t.iceBigFrame=0,t.poisonFrame=0,t.poisonHurtFrame=0,t.poisonBigHurt=0,t.showHit=-1,t.exact=!0,t}return __extends(e,i),e.prototype.setData=function(i,e,s,h){var a=this;this.data=i,this.atkSpeed=0,this.hp=i.hp,this.maxHp=this.hp,this.initSpeed=i.speed,this.setSpeed(this.initSpeed),this.scaleX=this.scaleY=i.scaleXY,this.chapter=e,this.wave=s,this.roadPosArr=t.IMiniGame18Consts.map[h].road,this.x=this.roadPosArr[this.posIndex][0],this.y=this.roadPosArr[this.posIndex][1],this.filtersArr=[],this.filtersArr.push(this.getRedFilter()),this.filtersArr.push(this.getBlueFilter()),this.filtersArr.push(this.getGreenFilter()),this.filtersArr.push(this.getPurpleFilter()),this.monImg=GObj.create(t.ImageOutside),this.monImg.loadCompleteCall(function(){a.width=a.monImg.iconWidth,a.height=a.monImg.iconHeight,a.monImg.x=0,a.monImg.y=a.monImg.iconHeight/2-10,a.monImg.anchorOffsetX=a.monImg.iconWidth/2,a.monImg.anchorOffsetY=a.monImg.iconHeight,a.hpBar=GObj.create(t.IMiniGame18Hp),a.hpBar.setUI(!0),a.hpBar.y=-a.monImg.y-38,a.hpBar.x=a.monImg.iconWidth/2-22-a.monImg.anchorOffsetX,a.hpBar.setData(10,10),a.addChild(a.hpBar)},this),this.monImg.setOutSrc("monster/"+i.model),this.addChild(this.monImg),this.dieEff=GObj.create(t.IMovie),this.dieEff.setCompleteBack(this.complate,this),this.addChild(this.dieEff)},e.prototype.setSpeed=function(t){this.speed=t},e.prototype.getHurt=function(){return this.data?this.data.hurt:null},e.prototype.run=function(){this.monsterMove(),this.endHitFilter(),this.strike()},e.prototype.strike=function(){this.icePassFrame--,this.iceBigFrame--,this.poisonFrame--,this.poisonHurtFrame--,this.icePassFrame<=0&&(this.speed=this.initSpeed),this.iceBigFrame<=0&&(this._isMove=!0),this.poisonFrame>0&&this.poisonHurtFrame<0&&(this.poisonHurtFrame=t.IMiniGame18Consts.poisonFrame,this.passPoison())},e.prototype.monsterMove=function(){if(!this.isDie()&&this._isMove){var t=this.roadPosArr.length-1,i=Math.min(t,this.posIndex+1),e=this.roadPosArr[this.posIndex][0],s=this.roadPosArr[this.posIndex][1],h=this.roadPosArr[i][0],a=this.roadPosArr[i][1];if(e==h&&s==a)return void(this._isMove=!1);e==h?a>s?(this.y+=this.speed,this.y>=a&&(this.posIndex++,this.monsterJump()),this.boo=1):s>a&&(this.y-=this.speed,this.y<=a&&(this.posIndex++,this.monsterJump()),this.boo=-1):s==a&&(h>e?(this.x+=this.speed,this.x>=h&&(this.posIndex++,this.monsterJump()),1==this.monImg.scaleX&&(this.monImg.scaleX=-1),this.boo=1):e>h&&(this.x-=this.speed,this.x<=h&&(this.posIndex++,this.monsterJump()),-1==this.monImg.scaleX&&(this.monImg.scaleX=1),this.boo=-1)),this.posIndex==t&&(this._isMove=!1,DispatcherManager.dispatch(IMiniGame18Event.IMiniGame18Blood,this.data.hurt),this._isDie=!0,this.isDieShow=!1)}},e.prototype.monsterJump=function(){egret.Tween.get(this.monImg).to({y:this.monImg.iconHeight/2-15,scaleY:1.3},200).to({y:this.monImg.iconHeight/2-10,scaleY:1},200)},e.prototype.setHit=function(i,e){if(i){var i=Math.min(i,this.hp);this.hp-=i,this.updateHp(),this.hp<=0&&(this.hp=0,this.isDieShow=!0,this.monImg.visible=!1,this.hpBar.visible=!1,this.dieEff.start(t.IMiniGame18Consts.UI_SIWANG,1),this.dieEff.autoRun(),this.died(),IMiniGameMain.playEff(t.IMiniGame18Consts.minigame18_mondie))}},e.prototype.updateHp=function(){this.hpBar&&this.hpBar.setData(this.hp,this.maxHp)},e.prototype.complate=function(){this.isDieShow=!1},e.prototype.checkSelected=function(){return!this._isDie},e.prototype.canRemove=function(){return!this.isDieShow&&this.isDie()},e.prototype.hit=function(t,i){this.towerVo=t,i&&this.addHitFliter(t.type);var e=100*Math.random();switch(t.type){case TowerType.TYPE_1:e<=this.towerVo.passvie.rate;break;case TowerType.TYPE_2:e<=this.towerVo.passvie.rate&&(this.monImg.filters!=[this.getBlueFilter()]&&this.addHitFliter(t.type,this.towerVo.passvie.duration),this.icePassFrame=this.towerVo.passvie.duration,this.speed=this.initSpeed*this.towerVo.passvie.slowRate/100);break;case TowerType.TYPE_3:e<=this.towerVo.passvie.rate&&(this.poisonFrame=this.towerVo.passvie.duration,this.poisonPassHurt=this.towerVo.passvie.att);break;case TowerType.TYPE_4:}},e.prototype.ice=function(t){this.iceBigFrame=t.big.duration,this._isMove=!1,this.towerVo=t,this.addHitFliter(TowerType.TYPE_2,t.big.duration)},e.prototype.passPoison=function(){if(!this._isDie){var i=Math.min((this.poisonPassHurt||0)+(this.poisonBigHurt||0),this.hp);if(this.hp-=i,this.updateHp(),this.addHitFliter(TowerType.TYPE_3),i>0){var e=this.parent.parent;e.poisonHurtAddToScene(this.x,this.y-this.height,i,TowerType.TYPE_3)}this.hp<=0&&(this.hp=0,this.isDieShow=!0,this.monImg.visible=!1,this.hpBar.visible=!1,this.dieEff.start(t.IMiniGame18Consts.UI_SIWANG,1),this.dieEff.autoRun(),this.died(),IMiniGameMain.playEff(t.IMiniGame18Consts.minigame18_mondie)),this.poisonBigHurt=0}},e.prototype.setPoisonBigHurt=function(t){t&&(this.poisonBigHurt=t,this.poisonFrame=2)},e.prototype.addHitFliter=function(t,i){var e=this;this.monImg.filters=[this.filtersArr[t-1]];var s=i?i/60*1e3:200;egret.Tween.get(this).wait(s).call(function(){e.monImg&&(e.monImg.filters=null)});var h=this.parent.parent;if(this.towerVo)switch(t){case TowerType.TYPE_2:h.bigHitEffAddToScene(this,this.towerVo.big.bigHitEff,i);break;case TowerType.TYPE_3:h.bigHitEffAddToScene(this,this.towerVo.big.bigHitEff);break;case TowerType.TYPE_4:h.bigHitEffAddToScene(this,this.towerVo.big.bigHitEff,null,TowerType.TYPE_4)}},e.prototype.getRedFilter=function(){if(null==this._redFilter){var t=[];t=t.concat([1,0,0,0,100]),t=t.concat([0,0,0,0,0]),t=t.concat([0,0,0,0,0]),t=t.concat([0,0,0,1,0]),this._redFilter=new egret.ColorMatrixFilter(t)}return this._redFilter},e.prototype.getBlueFilter=function(){if(null==this._blueFilter){var t=[];t=t.concat([0,0,0,0,0]),t=t.concat([0,0,0,0,0]),t=t.concat([0,0,1,0,100]),t=t.concat([0,0,0,1,0]),this._blueFilter=new egret.ColorMatrixFilter(t)}return this._blueFilter},e.prototype.getGreenFilter=function(){if(null==this._greenFilter){var t=[];t=t.concat([0,0,0,0,0]),t=t.concat([0,1,0,0,100]),t=t.concat([0,0,0,0,0]),t=t.concat([0,0,0,1,0]),this._greenFilter=new egret.ColorMatrixFilter(t)}return this._greenFilter},e.prototype.getPurpleFilter=function(){if(null==this._purpleFilter){var t=[];t=t.concat([.5,0,0,0,100]),t=t.concat([0,0,0,0,0]),t=t.concat([0,0,.5,0,100]),t=t.concat([0,0,0,1,0]),this._purpleFilter=new egret.ColorMatrixFilter(t)}return this._purpleFilter},e.prototype.endHitFilter=function(){this.showHit<=0||--this.showHit<=0&&(this.filters=[])},e.prototype.died=function(){this._isDie=!0,this._isMove=!1},e.prototype.isDie=function(){return this._isDie},e.prototype.removeMe=function(){this.parent&&this.parent.removeChild(this)},e.prototype.reset=function(){this.isDieShow=!1,this._isDie=!1,this._isMove=!1,this.distance=99999,this.hp=0,this.data=null,this.speed=0,this.alpha=1},e.prototype.dispose=function(){this.reset(),this.dieEff.unAutoRun(),this.filters=null,this._isMove=!1,this._redFilter=null,this._blueFilter=null,this._greenFilter=null,this._purpleFilter=null,GObj.disposeObject(this.hpBar),this.hpBar=null,GObj.disposeObject(this.monImg),this.monImg=null,GObj.disposeObject(this.dieEff),this.dieEff=null},e}(egret.DisplayObjectContainer);t.IMiniGame18Monster=i,__reflect(i.prototype,"miniGame.IMiniGame18Monster")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){return null!==i&&i.apply(this,arguments)||this}return __extends(e,i),e.prototype.initSkins=function(){this.horizontalCenter=0,this.verticalCenter=0,this.width=StageManager.stageWidth,this.height=StageManager.stageHeight,this.bgRect=GObj.create(eui.Rect),this.bgRect.horizontalCenter=0,this.bgRect.verticalCenter=0,this.bgRect.alpha=.8,this.bgRect.width=StageManager.stageWidth,this.bgRect.height=StageManager.stageHeight,this.addChild(this.bgRect),this.group=GObj.create(eui.Group),this.group.width=505,this.group.height=516,this.group.horizontalCenter=0,this.group.verticalCenter=0,this.group.scaleX=.6,this.group.scaleY=.6,this.addChild(this.group),this.bgImg=GObj.create(t.ImageOutside),this.bgImg.horizontalCenter=0,this.bgImg.verticalCenter=0,this.bgImg.setOutSrc("pop",FileConst.png),this.group.addChild(this.bgImg),this.titleImg=GObj.create(t.ImageOutside),this.titleImg.horizontalCenter=0,this.titleImg.y=13,this.titleImg.setOutSrc("tips2",FileConst.png),this.group.addChild(this.titleImg),this.moneyLab=GObj.create(eui.Label),this.moneyLab.horizontalCenter=-3,this.moneyLab.y=100,this.moneyLab.size=24,this.moneyLab.textColor=16777215,this.moneyLab.stroke=2,this.moneyLab.strokeColor=6787924,this.group.addChild(this.moneyLab),this.towerImg=GObj.create(t.ImageOutside),this.towerImg.horizontalCenter=-3,this.towerImg.y=160,this.group.addChild(this.towerImg),this.timeBg=GObj.create(t.ImageOutside),this.timeBg.horizontalCenter=-3,this.timeBg.y=280,this.timeBg.setOutSrc("descBg2",FileConst.png),this.group.addChild(this.timeBg),this.timeLab=GObj.create(eui.Label),this.timeLab.horizontalCenter=-3,this.timeLab.y=305,this.timeLab.textColor=7636835,this.timeLab.size=18,this.group.addChild(this.timeLab),this.goldLab=GObj.create(eui.Label),this.goldLab.horizontalCenter=-3,this.goldLab.y=330,this.goldLab.textColor=14318917,this.goldLab.size=18,this.group.addChild(this.goldLab),this.yesBtn=GObj.create(t.IBaseBtn),this.yesBtn.icon=IMiniGameMain.getIcon("btn_1",FileConst.png),this.yesBtn.horizontalCenter=-3,this.yesBtn.y=400,this.yesBtn.labelDisplay.textColor=9655570,this.yesBtn.label=IMiniGameMain.getString(t.IMiniGame18Consts.lang[8]),this.group.addChild(this.yesBtn),egret.Tween.get(this.group).to({scaleX:1,scaleY:1},300),this.addEvent()},e.prototype.addEvent=function(){this.yesBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.__yesBtnHandler,this)},e.prototype.removeEvent=function(){this.yesBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.__yesBtnHandler,this)},e.prototype.show=function(i){this.initSkins();var e=Math.round(this.updateASecondMoney()*i),s=IMiniGameMain.numberToStr(e,1);this.moneyLab.text=IMiniGameMain.getString(t.IMiniGame18Consts.lang[13],s),t.IMiniGame18Consts.haveMoney+=e,this.towerImg.setOutSrc("money",FileConst.png),this.timeLab.text=this.lableChange(i),this.goldLab.text=IMiniGameMain.getString(t.IMiniGame18Consts.lang[18],t.IMiniGame18Consts.offlineHours)},e.prototype.lableChange=function(i){if(i>0){var e="",s=int(i/86400),h=int(i%86400/3600),a=int(i%86400%3600/60),n=int(i%86400%3600%60);return e=s>0?IMiniGameMain.getString(t.IMiniGame18Consts.lang[15],s,h):h>0?IMiniGameMain.getString(t.IMiniGame18Consts.lang[16],h,a):IMiniGameMain.getString(t.IMiniGame18Consts.lang[17],a,n),IMiniGameMain.getString(t.IMiniGame18Consts.lang[14],e)}},e.prototype.updateASecondMoney=function(){var i=0;for(var e in t.IMiniGame18Consts.maxLevelByType)for(var s=e,h=t.IMiniGame18Consts.maxLevelByType[e],a=1;h>=a;a++)i+=t.IMiniGame18Consts.tower[s][a].money;return i},e.prototype.__yesBtnHandler=function(){IMiniGameMain.playEff(t.IMiniGame18Consts.minigame_btn),this.parent&&this.parent.removeChild(this)},e.prototype.dispose=function(){this.removeEvent(),GObj.disposeObject(this.bgRect),this.bgRect=null,GObj.disposeObject(this.group),this.group=null,GObj.disposeObject(this.bgImg),this.bgImg=null,GObj.disposeObject(this.titleImg),this.titleImg=null,GObj.disposeObject(this.moneyLab),this.moneyLab=null,GObj.disposeObject(this.towerImg),this.towerImg=null,GObj.disposeObject(this.timeBg),this.timeBg=null,GObj.disposeObject(this.timeLab),this.timeLab=null,GObj.disposeObject(this.yesBtn),this.yesBtn=null,GObj.disposeObject(this.goldLab),this.goldLab=null},e}(eui.Component);t.IMiniGame18OfflinePop=i,__reflect(i.prototype,"miniGame.IMiniGame18OfflinePop")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return __extends(i,t),i.showResult=function(t,h,a,n,o,r){var l;switch(t){default:case IMiniGameResultType.type_0:i.lose||(i.lose=GObj.create(e)),i.lose.setData(h,a,n,o,r),l=i.lose;break;case IMiniGameResultType.type_1:i.win||(i.win=GObj.create(s)),i.win.setData(h,a,n,o,r),l=i.win}IMiniGameMain.addToStage(l)},i.dispose=function(){GObj.disposeObject(i.win),i.win=null,GObj.disposeObject(i.lose),i.lose=null},i}(eui.Component);t.IMiniGame18ResultPop=i,__reflect(i.prototype,"miniGame.IMiniGame18ResultPop");var e=function(i){function e(){var t=i.call(this)||this;return t.result=IMiniGameResultType.type_0,t}return __extends(e,i),e.prototype.initSkins=function(){this.isInit||(this.isInit=!0,this.horizontalCenter=0,this.verticalCenter=0,this.width=StageManager.stageWidth,this.height=StageManager.stageHeight,this.bgRect=GObj.create(eui.Rect),this.bgRect.touchEnabled=!1,this.bgRect.horizontalCenter=0,this.bgRect.verticalCenter=0,this.bgRect.alpha=.5,this.bgRect.width=this.width,this.bgRect.height=this.height,this.addChild(this.bgRect),this.eff=GObj.create(t.IMovie),this.eff.isLast=!0,this.eff.y=300,this.eff.x=this.width/2,this.addChild(this.eff),this.grp=GObj.create(eui.Group),this.grp.horizontalCenter=0,this.grp.y=this.eff.y+10,this.addChild(this.grp),this.bgReward=GObj.create(t.ImageOutside),this.bgReward.horizontalCenter=0,this.bgReward.setOutSrc("lose_bg_1",FileConst.png,"chapter"),this.grp.addChild(this.bgReward),this.btnBack=GObj.create(t.IBaseBtn),this.btnBack.x=37,this.btnBack.y=180,this.btnBack.icon=IMiniGameMain.getIcon("btn_2",FileConst.png,"chapter"),this.btnBack.labelDisplay.textColor=2054448,this.grp.addChild(this.btnBack),this.btnNext=GObj.create(t.IBaseBtn),this.btnNext.x=257,this.btnNext.y=180,this.btnNext.icon=IMiniGameMain.getIcon("btn_1",FileConst.png,"chapter"),this.btnNext.labelDisplay.textColor=7751207,this.grp.addChild(this.btnNext),this.labTime=GObj.create(eui.Label),this.labTime.horizontalCenter=0,this.labTime.y=280,this.labTime.size=22,this.labTime.textColor=16777215,this.grp.addChild(this.labTime),this.timeText=IMiniGameMain.curMiniGame.configData.loseBackMain?IMiniGameLanguage.c_12:IMiniGameLanguage.c_7,this.addEvent())},e.prototype.addEvent=function(){this.btnBack.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnBackClick,this),this.btnNext.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnNextClick,this)},e.prototype.removeEvent=function(){DispatcherManager.removeListener(HGEvent.HEARTBEAT,this.countDown,this),this.btnBack.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnBackClick,this),this.btnNext.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnNextClick,this)},e.prototype.countDown=function(){return this.time<1?void(this.result==IMiniGameResultType.type_0&&IMiniGameMain.curMiniGame.configData.loseBackMain?this.sendMsg(2):this.countDownOver()):void(this.labTime.text=IMiniGameMain.getString(this.timeText,this.time--))},e.prototype.countDownOver=function(){this.rmParent(),this.closeBack&&this.closeBack.call(this.thisObj,this.result)},e.prototype.rmParent=function(){DispatcherManager.removeListener(HGEvent.HEARTBEAT,this.countDown,this),this.parent&&this.parent.removeChild(this)},e.prototype.onBtnBackClick=function(){this.sendMsg(2)},e.prototype.sendMsg=function(t){DispatcherManager.dispatch(IMiniGameEvent.IMiniGameResultBack,t),this.rmParent()},e.prototype.onBtnNextClick=function(){this.countDownOver()},e.prototype.setData=function(t,i,e,s,h){this.closeBack=t,this.thisObj=i,this.time=e||3,this.chapter=s,this.wave=h,this.initSkins(),this.setBtnNext(),this.showEff(),this.labTime.text="",DispatcherManager.removeListener(HGEvent.HEARTBEAT,this.countDown,this),DispatcherManager.addListener(HGEvent.HEARTBEAT,this.countDown,this)},e.prototype.showEff=function(){var i=this;this.lose||(this.lose=GObj.create(t.ImageOutside),this.addChild(this.lose)),this.lose.loadCompleteCall(function(){i.lose&&(i.lose.x=-i.lose.iconWidth,i.lose.y=100,egret.Tween.removeTweens(i.lose),egret.Tween.get(i.lose).to({x:i.width+i.lose.iconWidth},2e3))},this),this.lose.setOutSrc("lose",FileConst.png,"chapter"),this.eff.start(IMiniGameConfig.result_lose,1,100,IMiniGameMain.getCommonPath()),this.eff.autoRun()},e.prototype.setBtnNext=function(){this.btnNext.label=IMiniGameMain.getString(IMiniGameLanguage.c_13);var t=IMiniGameMain.curMiniGame.gameData.backGame,i=2==t||3==t;this.nextStage=this.checkHaveNext(),this.btnBack.label=IMiniGameMain.getString(i||!this.nextStage?IMiniGameLanguage.c_11:IMiniGameLanguage.c_10)},e.prototype.checkHaveNext=function(){var t=IMiniGameMain.curMiniGame.configData,i=this.chapter,e=t.chapters.stages[i];return e},e.prototype.dispose=function(){this.isInit&&(this.isDestory||(this.isDestory=!0,this.removeEvent(),GObj.disposeObject(this.bgRect),this.bgRect=null,GObj.disposeObject(this.grp),this.grp=null,GObj.disposeObject(this.bgReward),this.bgReward=null,GObj.disposeObject(this.bgRect),this.bgRect=null,GObj.disposeObject(this.btnBack),this.btnBack=null,GObj.disposeObject(this.btnNext),this.btnNext=null,this.lose&&(egret.Tween.removeTweens(this.lose),GObj.disposeObject(this.lose),this.lose=null),this.eff&&(this.eff.stop(),GObj.disposeObject(this.eff),this.eff=null),this.closeBack=null,this.thisObj=null,this.nextStage=null))},e}(eui.Component);__reflect(e.prototype,"IMiniGame18Lose");var s=function(i){function e(){var t=i.call(this)||this;return t.result=IMiniGameResultType.type_1,t}return __extends(e,i),e.prototype.initSkins=function(){if(!this.isInit){i.prototype.initSkins.call(this),this.rewards=[],this.grp.y=this.eff.y+50,this.bgReward.setOutSrc("win_bg_1",FileConst.png,"chapter"),this.bgFlag=GObj.create(t.ImageOutside),this.bgFlag.horizontalCenter=0,this.bgFlag.y=30,this.bgFlag.setOutSrc("win_bg_2",FileConst.png,"chapter"),this.grp.addChild(this.bgFlag),this.scro=GObj.create(eui.Scroller),this.scro.maxWidth=366,this.scro.height=90,this.scro.y=65,this.scro.horizontalCenter=0,this.scro.scrollPolicyV=eui.ScrollPolicy.OFF,this.grp.addChild(this.scro),this.rewardList=GObj.create(eui.Group),this.scro.viewport=this.rewardList;var e=GObj.create(eui.HorizontalLayout);e.gap=6,e.paddingTop=2,e.paddingLeft=2,this.rewardList.layout=e}},e.prototype.countDownOver=function(){this.onBtnNextClick()},e.prototype.onBtnBackClick=function(){this.rmParent(),DispatcherManager.dispatch(IMiniGameEvent.IMiniGameResultBack,2)},e.prototype.onBtnNextClick=function(){this.rmParent(),this.nextStage?this.closeBack&&this.closeBack.call(this.thisObj,this.result):DispatcherManager.dispatch(IMiniGameEvent.IMiniGameResultBack,2)},e.prototype.rmParent=function(){i.prototype.rmParent.call(this),this.autoGetReward()},e.prototype.setData=function(t,e,s,h,a){i.prototype.setData.call(this,t,e,s,h,a),this.setReward(),this.chapter=h,this.wave=a,this.btnBack.horizontalCenter=this.nextStage&&1!=this.chapter?void 0:0,this.btnBack.x=37,this.nextStage||(this.timeText=IMiniGameLanguage.c_12),this.autoGetReward()},e.prototype.showEff=function(){this.eff.start(IMiniGameConfig.result_win,1,100,IMiniGameMain.getCommonPath()),this.eff.autoRun()},e.prototype.setReward=function(){this.rewardList.removeChildren();var t=IMiniGameMain.curMiniGame.gameData,i=t.funny;if(i){var e=i.bagList[0],s=e?e.rewardList:[];if(!s||0==s.length)return[];for(var h,a,n=s.length,o=0;n>o;o++)a=this.getReward(o),h=a.data,h||(h=GObj.create(GoodsInfo)),h.tid=s[o].tempId,h.count=s[o].count,a.data=h,this.rewardList.addChild(a)}},e.prototype.getReward=function(t){var i=this.rewards[t];return i||(i=GObj.create(GoodsItemView),this.rewards.push(i)),i},e.prototype.setBtnNext=function(){this.nextStage=null,this.timeText=IMiniGameLanguage.c_6;var t=this.checkHaveNext();this.nextStage=t,this.btnNext.visible=null!=t&&1!=this.chapter,this.btnNext.label=IMiniGameMain.getString(IMiniGameLanguage.c_9);var i=IMiniGameMain.curMiniGame.gameData.backGame,e=1==i||3==i,s=!t||e?IMiniGameLanguage.c_11:IMiniGameLanguage.c_10;this.btnBack.label=IMiniGameMain.getString(s)},e.prototype.autoGetReward=function(){if(IMiniGameMain.curMiniGame){var t=IMiniGameMain.curMiniGame.gameData,i=t.funny;if(i)for(var e,s=0,h=i.bagList;s<h.length;s++){var a=h[s];if(e=a.conditionList[0],e&&e.p2==this.chapter){2!=a.status&&IMiniGameMain.reqSocket(6,a.id);break}}}},e.prototype.dispose=function(){if(this.isInit&&!this.isDestory){GObj.disposeObject(this.bgFlag),this.bgFlag=null,this.scro.stopAnimation(),this.scro.viewport=null,GObj.disposeObject(this.scro),this.scro=null,GObj.disposeObject(this.rewardList),this.rewardList=null;for(var t=0,e=this.rewards;t<e.length;t++){var s=e[t];GObj.disposeObject(s)}this.rewards=null,this.codeP4=null,i.prototype.dispose.call(this)}},e}(e);__reflect(s.prototype,"IMiniGame18Win")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.isPassNew=!1,t.monsterIndex=0,t.timeSeconds=0,t.poisonArr=[],t}return __extends(e,i),e.prototype.addEvent=function(){this.buyBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.buyBtnHandler,this),this.mapBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.mapBtnHandler,this),DispatcherManager.addListener(IMiniGame18Event.IMiniGame18Gold,this.updateData,this),DispatcherManager.addListener(HGEvent.HEARTBEAT,this.__heartHandler,this)},e.prototype.removeEvent=function(){this.buyBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.buyBtnHandler,this),this.mapBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.mapBtnHandler,this),DispatcherManager.removeListener(IMiniGame18Event.IMiniGame18Gold,this.updateData,this),DispatcherManager.removeListener(HGEvent.HEARTBEAT,this.__heartHandler,this),EnterFrameManager.instance.unRegisteRender(this.run,this)},e.prototype.initSkins=function(){this.isInit||(this.width=540,this.height=960,this.towerArr=[],this.monsterArr=[],this.sceneIn={},this.pools={},this.isCreateMontersOver=!1,this.createMonsterFrame=30,this.bgImg=GObj.create(t.ImageOutside),this.bgImg.setOutSrc("game18_bg_1",FileConst.jpg),this.addChild(this.bgImg),this.bottomBg=GObj.create(t.ImageOutside),this.bottomBg.y=857,this.bottomBg.x=0,this.bottomBg.setOutSrc("bottom",FileConst.png),this.addChild(this.bottomBg),this.roadGroup=GObj.create(egret.DisplayObjectContainer),this.roadGroup.width=this.width,this.roadGroup.height=this.height,this.addChildAt(this.roadGroup,1),this.poisonEffGrp=GObj.create(egret.DisplayObjectContainer),this.poisonEffGrp.touchEnabled=!1,this.poisonEffGrp.touchChildren=!1,this.addChild(this.poisonEffGrp),this.towerGroup=GObj.create(egret.DisplayObjectContainer),this.towerGroup.width=540,this.towerGroup.height=960,this.addChild(this.towerGroup),this.monsterGrp=GObj.create(egret.DisplayObjectContainer),this.monsterGrp.touchEnabled=!1,this.monsterGrp.touchChildren=!1,this.addChild(this.monsterGrp),this.hitEffGroup=GObj.create(egret.DisplayObjectContainer),this.hitEffGroup.touchEnabled=!1,this.hitEffGroup.touchChildren=!1,this.addChild(this.hitEffGroup),this.skillGrp=GObj.create(egret.DisplayObjectContainer),this.skillGrp.touchEnabled=!1,this.skillGrp.touchChildren=!1,this.addChild(this.skillGrp),this.effGrp=GObj.create(egret.DisplayObjectContainer),this.effGrp.touchEnabled=!1,this.effGrp.touchChildren=!1,this.addChild(this.effGrp),this.hurtGrp=GObj.create(egret.DisplayObjectContainer),this.hurtGrp.touchEnabled=!1,this.hurtGrp.touchChildren=!1,this.addChild(this.hurtGrp),this.goldGrp=GObj.create(egret.DisplayObjectContainer),this.goldGrp.touchEnabled=!1,this.goldGrp.touchChildren=!1,this.addChild(this.goldGrp),this.sellImg=GObj.create(t.ImageOutside),this.sellImg.x=390,this.sellImg.y=875,this.sellImg.setOutSrc("sell",FileConst.png),this.sellImg.filters=[],this.addChild(this.sellImg),this.buyBg=GObj.create(t.ImageOutside),this.buyBg.x=210,this.buyBg.y=870,this.addChild(this.buyBg),this.buyBtn=GObj.create(t.IMiniGame18Btn),this.buyBtn.icon=IMiniGameMain.getIcon("buy",FileConst.png),this.buyBtn.tipsIcon=IMiniGameMain.getIcon("gradeBg1",FileConst.png),this.buyBtn.x=240,this.buyBtn.y=875,this.addChild(this.buyBtn),this.priceBg=GObj.create(t.ImageOutside),this.priceBg.x=220,this.priceBg.y=936,this.priceBg.setOutSrc("buyBg",FileConst.png),this.addChild(this.priceBg),this.priceLab=GObj.create(eui.Label),this.priceLab.x=270,this.priceLab.y=938,this.priceLab.size=18,this.priceLab.textColor=16777215,this.addChild(this.priceLab),this.priceGold=GObj.create(t.ImageOutside),this.priceGold.x=228,this.priceGold.y=939,this.priceGold.scaleX=.7,this.priceGold.scaleY=.7,this.priceGold.setOutSrc("gold",FileConst.png),this.addChild(this.priceGold),this.mapBtn=GObj.create(t.IBaseBtn),this.mapBtn.icon=IMiniGameMain.getIcon("map",FileConst.png),this.mapBtn.x=80,this.mapBtn.y=875,this.addChild(this.mapBtn),this.goldBg=GObj.create(t.ImageOutside),this.goldBg.x=15,this.goldBg.y=15,this.goldBg.setOutSrc("goldBg",FileConst.png),this.addChild(this.goldBg),this.goldImg=GObj.create(t.ImageOutside),this.goldImg.setOutSrc("gold",FileConst.png),this.goldImg.x=25,this.goldImg.y=19,this.addChild(this.goldImg),this.goldLab=GObj.create(eui.Label),this.goldLab.x=55,this.goldLab.y=22,this.goldLab.textColor=16777215,this.goldLab.size=18,this.addChild(this.goldLab),this.chapterBg=GObj.create(t.ImageOutside),this.chapterBg.x=180,this.chapterBg.y=15,this.chapterBg.setOutSrc("chapterBg",FileConst.png),this.addChild(this.chapterBg),this.chapterBitMap=GObj.create(t.IBitNumMap),this.chapterBitMap.x=195,this.chapterBitMap.y=19,this.chapterBitMap.setGap(-2),this.chapterBitMap.setPath(t.IMiniGame18Consts.chapterNum),this.addChild(this.chapterBitMap),this.waveBitMap=GObj.create(t.IBitNumMap),this.waveBitMap.x=270,this.waveBitMap.y=19,this.waveBitMap.setGap(-2),this.waveBitMap.setPath(t.IMiniGame18Consts.chapterNum),this.addChild(this.waveBitMap),this.broadcast1=GObj.create(t.IMovie),this.broadcast1.x=0,this.broadcast1.y=150,this.addChild(this.broadcast1),this.broadcast2=GObj.create(t.IMovie),this.broadcast2.x=0,this.broadcast2.y=250,this.addChild(this.broadcast2),this.broadcast3=GObj.create(t.IMovie),this.broadcast3.x=0,this.broadcast3.y=350,this.addChild(this.broadcast3),this.broadcast4=GObj.create(t.IMovie),this.broadcast4.x=0,this.broadcast4.y=450,this.addChild(this.broadcast4),this.towersVo={},this.saveVo={},this.towersBuyTimesVo={},this.serverVo={},this.addEvent())},e.prototype.newPlayerMask=function(t,i){i&&(this.blendShape.graphics.clear(),this.blendShape.graphics.beginFill(0,.7),this.blendShape.graphics.drawRect(0,0,this.width,this.height),this.blendShape.graphics.endFill(),this.container.addChild(this.blendShape)),this.container.addChild(t),t.blendMode=egret.BlendMode.ERASE,this.renderTexture.drawToTexture(this.container),this.blendBitmap.texture=this.renderTexture,this.blendBitmap.touchEnabled=!0,this.blendBitmap.pixelHitTest=!0},e.prototype.setData=function(i,e){var s=this;this.initSkins(),this.reSet(),this.funnyVo=i,this.towerData=t.IMiniGame18Consts.tower,this.lang=t.IMiniGame18Consts.lang,this.map=t.IMiniGame18Consts.map,this.chapterData=e.stages,IMiniGameMain.playBgm(t.IMiniGame18Consts.minigame_bgm),this.initTowersData(),this.updateData(),this.loadImg||(this.monkey=GObj.create(t.IMiniGame18MonkeyKing),this.loadImg=GObj.create(t.ImageOutside)),this.loadImg.loadCompleteCall(function(){s.loadImg.anchorOffsetX=s.loadImg.iconWidth/2,s.loadImg.anchorOffsetY=s.loadImg.iconHeight/2,s.setMonsterRoad()},this),this.loadImg.setOutSrc("road",FileConst.png)},e.prototype.initTowersData=function(){if(!this.isInit){if(this.isInit=!0,this.funnyVo&&this.funnyVo.actData.p5)this.serverVo=this.funnyVo.actData.p5,this.towersVo=this.serverVo.towersVo,t.IMiniGame18Consts.haveMoney=this.serverVo.money,this.towersBuyTimesVo=this.serverVo.towersBuyTimesVo,this.isPassNew=this.serverVo.isPassNew,t.IMiniGame18Consts.maxLevelByType=this.serverVo.top,this.currChap=this.serverVo.chapter,this.saveVo=this.serverVo.saveVo,this.currWave=1,this.currChapData=this.chapterData[this.currChap-1];else{this.currChap=1,this.currWave=1,this.currChapData=this.chapterData[this.currChap-1],this.serverVo.chapter=this.currChap;for(var i=1;15>=i;i++)this.towersVo[i]={},this.towersVo[i].isBattle=!1,this.towersVo[i].isUnlock=!0,this.saveVo[i]={},this.saveVo[i].isBattle=!1,this.saveVo[i].isUnlock=!0;var e=t.IMiniGame18Consts.map[this.currChapData.mapId].tower;for(var s in e)this.towersVo[s]={},this.towersVo[s].isBattle=!0,e[s].need?this.towersVo[s].isUnlock=!1:this.towersVo[s].isUnlock=!0,this.saveVo[s]={},this.saveVo[s].isBattle=!0,e[s].need?this.saveVo[s].isUnlock=!1:this.saveVo[s].isUnlock=!0;for(var i=1;4>=i;i++){t.IMiniGame18Consts.maxLevelByType[i]=0;var h=t.IMiniGame18Consts.tower[i];for(var s in h)0==h[s].unlockPrice&&t.IMiniGame18Consts.maxLevelByType[i]++}for(var s in this.towerData){this.towersBuyTimesVo[s]||(this.towersBuyTimesVo[s]={});for(var a in this.towerData[s])this.towersBuyTimesVo[s][a]=0}t.IMiniGame18Consts.haveMoney=t.IMiniGame18Consts.initMoney,this.serverVo.towersVo=this.towersVo,this.serverVo.money=t.IMiniGame18Consts.haveMoney,this.serverVo.top=t.IMiniGame18Consts.maxLevelByType,this.serverVo.towersBuyTimesVo=this.towersBuyTimesVo,this.serverVo.isPassNew=this.isPassNew,this.serverVo.saveVo=this.saveVo}if(this.updateChapter(),this.nextType=1,this.buyBg.setOutSrc("core/btnbg_"+this.nextType,FileConst.png),this.serverVo.time&&this.serverVo.time<GApp.clockMgr.serverSecond-60){this.offlinePop=GObj.create(t.IMiniGame18OfflinePop);var n=GApp.clockMgr.serverSecond-this.serverVo.time,o=3600*t.IMiniGame18Consts.offlineHours,r=n>o?o:n;this.offlinePop.show(r),IMiniGameMain.addToStage(this.offlinePop)}this.initTowersItemData()}},e.prototype.initTowersItemData=function(){var i;this.lockArr=[],this.towerArr=[],this.towerGroup.removeChildren();for(var e in this.towersVo){if(i=GObj.create(t.IMiniGame18TowerItem),i.$children[1].addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBeginClick,this),i.$children[2].addEventListener(egret.TouchEvent.TOUCH_TAP,this.__openLockHandler,this),i.setData(this.towersVo[e],parseInt(e),this.currChap,this.currChapData.mapId),parseInt(e)>15){var s=t.IMiniGame18Consts.map[this.currChapData.mapId].tower;i.x=s[e].pos[0],i.y=s[e].pos[1],this.lockArr.push(i)}else{var h=parseInt(e)%5-1;-1==h&&(h=4);var a=Math.ceil(parseInt(e)/5)-1;i.x=60+90*h,i.y=660+73*a}this.towerGroup.addChild(i),this.towerArr.push(i)}},e.prototype.updateData=function(){this.goldLab.text=IMiniGameMain.numberToStr(t.IMiniGame18Consts.haveMoney,1),this.serverVo.money=t.IMiniGame18Consts.haveMoney,this.buyBg.setOutSrc("core/btnbg_"+this.nextType,FileConst.png),this.buyBtn.label=this.getNextTowerData().grade.toString(),this.priceLab.text=this.getNextTowerData().price.toString()},e.prototype.onBeginClick=function(t){this._downTarget=t.target;var i=this._downTarget.parent;if(this.index=i.index,this.towersVo[this.index].grade){this.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMoveClick,this),this.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onEndClick,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.onEndClick,this);var e=this._downTarget.localToGlobal();this.globalToLocal(e.x,e.y,e),this._downTarget.x=e.x,this._downTarget.y=e.y,this.addChild(this._downTarget)}},e.prototype.waveTips=function(i,e){if(0!=i){this.tipPop=GObj.create(t.IMiniGame18Tips);
var s;s=1==e?IMiniGameMain.getString(t.IMiniGame18Consts.lang[32],i):IMiniGameMain.getString(t.IMiniGame18Consts.lang[33],i),this.tipPop.show(s,e),this.addChild(this.tipPop)}},e.prototype.onMoveClick=function(t){this.movePoint||(this.movePoint=GObj.create(egret.Point)),this.globalToLocal(t.stageX,t.stageY,this.movePoint),this._downTarget.x=this.movePoint.x-33,this._downTarget.y=this.movePoint.y-33,this._downTarget.$children[0].visible=!0,this._downTarget.$children[1].visible=!0;var i=this.checkSellPos(t.stageX,t.stageY);i?this.sellImg.filters=[IMiniGameMain.getRedFilter()]:this.sellImg.filters=[]},e.prototype.onEndClick=function(i){this.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMoveClick,this),this.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onEndClick,this),this.removeEventListener(egret.TouchEvent.TOUCH_END,this.onEndClick,this),this._downTarget.x=-12,this._downTarget.y=-20,this._downTarget.$children[0].visible=!1,this._downTarget.$children[1].visible=!1,this.towerArr[this.index-1].addChildAt(this._downTarget,1);for(var e,s,h=0,a=this.towerArr;h<a.length;h++){s=a[h],e=s.checkPos(i.stageX,i.stageY);var n=s.index;if(e){if(n==this.index)break;if(!s.vo&&!this.towersVo[n].isUnlock){App.msgtip.show(IMiniGameMain.getString(t.IMiniGame18Consts.lang[30]));break}if(!s.vo){this.towersVo[n]=this.towersVo[this.index],this.towersVo[this.index]=this.saveVo[this.index],this.updateTowersItemData();break}if(this.towersVo[n].type!=this.towersVo[this.index].type){var o=this.towersVo[n],r=this.towersVo[this.index];this.towersVo[n]=r,this.towersVo[this.index]=o,this.updateTowersItemData();break}if(this.towersVo[n].grade!=this.towersVo[this.index].grade){var o=this.towersVo[n],r=this.towersVo[this.index];this.towersVo[n]=r,this.towersVo[this.index]=o,this.updateTowersItemData();break}if(s.vo&&this.towersVo[n].grade==this.towersVo[this.index].grade){if(this.towersVo[n].grade>=t.IMiniGame18Consts.maxLevel){App.msgtip.show(IMiniGameMain.getString(t.IMiniGame18Consts.lang[19]));break}if(this.towersVo[n].grade+1>t.IMiniGame18Consts.maxLevelByType[this.towersVo[n].type]){App.msgtip.show(IMiniGameMain.getString(t.IMiniGame18Consts.lang[28]));break}var l=this.funnyVo.bagList[0].conditionList[0].p3,p=this.funnyVo.bagList[0].conditionList[0].p4;if(l&&p&&!IMiniGameMain.checkOpen(l,p)){IMiniGameMain.checkOpenTip(l,p);break}var c=this.towersVo[n].type,u=this.towersVo[n].grade;this.towersVo[n].grade++,this.towersVo[n].money=this.towerData[c][u].money,this.towersVo[n].sell=this.towerData[c][u].sell,this.towersVo[n].qua=this.towerData[c][u].qua,this.towersVo[n].type=this.towerData[c][u].type,this.towersVo[this.index]=this.saveVo[this.index],15>=n?(s.hide(),this.play(this.towersVo[n],s),this.towerArr[this.index-1].setData(this.towersVo[this.index],this.index,this.currChap,this.currChapData.mapId),ClockManager.setTimeout(this.updateTowersItemData,this,400)):(this.towerArr[this.index-1].setData(this.towersVo[this.index],this.index,this.currChap,this.currChapData.mapId),this.updateTowersItemData());break}}}if(!this.isPassNew&&(2==this.towersVo[1].grade||2==this.towersVo[2].grade)){var d=GObj.create(egret.Shape);d.x=this.towerArr[15].x+25,d.y=this.towerArr[15].y+25,d.graphics.clear(),d.graphics.beginFill(16777215),d.graphics.drawCircle(0,0,100),d.graphics.endFill(),this.newPlayerMask(d,!1),this.guide(165,680,1),egret.Tween.get(this.guideMove,{loop:!0}).to({x:this.towerArr[15].x+25,y:this.towerArr[15].y+25},1500)}var m=this.checkSellPos(i.stageX,i.stageY);m&&this.sellTower(),this.sellImg.filters=[]},e.prototype.play=function(i,e){IMiniGameMain.playEff(t.IMiniGame18Consts.minigame_upgrade),e.hide();var s=GObj.create(t.ImageOutside);s.setOutSrc("items/"+this.towerData[i.type][i.grade-1].res,FileConst.png),s.x=this.towerArr[e.index-1].x,s.y=this.towerArr[e.index-1].y-10,this.addChild(s);var h=GObj.create(t.ImageOutside);h.setOutSrc("core/headframe_"+i.type,FileConst.png),h.x=this.towerArr[e.index-1].x-9,h.y=this.towerArr[e.index-1].y-19,this.addChild(h);var a=GObj.create(t.ImageOutside);a.setOutSrc("items/"+this.towerData[i.type][i.grade-1].res,FileConst.png),a.x=this.towerArr[e.index-1].x,a.y=this.towerArr[e.index-1].y-10,this.addChild(a);var n=GObj.create(t.ImageOutside);n.setOutSrc("core/headframe_"+i.type,FileConst.png),n.x=this.towerArr[e.index-1].x-9,n.y=this.towerArr[e.index-1].y-19,this.addChild(n),egret.Tween.get(s).to({x:s.x-50},200).to({x:s.x},200).call(function(){GObj.disposeObject(s),GObj.disposeObject(a),GObj.disposeObject(h),GObj.disposeObject(n),e.show()}),egret.Tween.get(a).to({x:a.x+50},200).to({x:a.x},200),egret.Tween.get(h).to({x:h.x-50},200).to({x:h.x},200),egret.Tween.get(n).to({x:n.x+50},200).to({x:n.x},200)},e.prototype.setMonsterRoad=function(){this.roadGroup.$children.length&&this.roadGroup.removeChildren(),this.roadArr=[];for(var i=this.map[this.currChapData.mapId].road,e=t.IMiniGame18Consts.roadWH[0],s=t.IMiniGame18Consts.roadWH[1],h=0;h<i.length-1;h++){var a=i[h],n=i[h+1],o=a[0],r=a[1],l=n[0],p=n[1];if(o==l){var c=void 0;c=h!=i.length-2?Math.abs(p-r)/s:Math.abs(p-r)/s+1;for(var u=0;c>u;u++){var d=GObj.create(t.ImageOutside);d.source=this.loadImg.source,d.x=o,p>r?d.y=r+u*s:d.y=r-(c-1-u)*s,d.anchorOffsetX=this.loadImg.anchorOffsetX,d.anchorOffsetY=this.loadImg.anchorOffsetY,this.roadGroup.addChild(d)}for(var u=0;c>u;u++){var d=GObj.create(t.ImageOutside);d.source=this.loadImg.source,d.x=o,p>r?d.y=r+u*s:d.y=r-u*s,this.roadArr.push(d)}}else if(r==p){var c=void 0;c=h!=i.length-2?Math.abs(l-o)/e:Math.abs(l-o)/e+1;for(var m=0;c>m;m++){var d=GObj.create(t.ImageOutside);d.source=this.loadImg.source,l>o?d.x=o+m*e:d.x=o-(c-1-m)*e,d.y=r,d.anchorOffsetX=this.loadImg.anchorOffsetX,d.anchorOffsetY=this.loadImg.anchorOffsetY,this.roadGroup.addChild(d)}for(var m=0;c>m;m++){var d=GObj.create(t.ImageOutside);d.source=this.loadImg.source,l>o?d.x=o+m*e:d.x=o-m*e,d.y=r,this.roadArr.push(d)}}}if(this.monkey.x=i[i.length-1][0]+2,this.monkey.y=i[i.length-1][1]+36,this.monkey.setData(this.currChapData.myHp),this.addChild(this.monkey),this.isPassNew)this.waveTips(this.currWave,1);else{this.shape=GObj.create(egret.Shape),this.shape.x=275,this.shape.y=920,this.shape.graphics.clear(),this.shape.graphics.beginFill(16777215),this.shape.graphics.drawCircle(0,0,60),this.shape.graphics.endFill(),this.addChild(this.shape),this.container=GObj.create(egret.DisplayObjectContainer),this.blendShape=GObj.create(egret.Shape),this.renderTexture=GObj.create(egret.RenderTexture),this.blendBitmap=GObj.create(egret.Bitmap),this.addChild(this.blendBitmap),this.newPlayerMask(this.shape,!0),this.guide(275,920);var g=this.parent;g.hideExitBtn()}},e.prototype.updateTowersItemData=function(){var t;this.lockArr=[];for(var i in this.towerArr)t=this.towerArr[i],t.setData(this.towersVo[parseInt(i)+1],parseInt(i)+1,this.currChap,this.currChapData.mapId),parseInt(i)+1>15&&this.lockArr.push(t);if(this.serverVo.towersVo=this.towersVo,!this.isPassNew&&this.towersVo[16].grade){this.isPassNew=!0,this.serverVo.isPassNew=this.isPassNew,egret.Tween.removeTweens(this.guideMove),IMiniGameMain.rmGuideView(),this.blendBitmap.visible=!1;var e=this.parent;e.showExitBtn(),this.waveTips(this.currWave,1)}this.updateData()},e.prototype.buyBtnHandler=function(){IMiniGameMain.playEff(t.IMiniGame18Consts.minigame_btn);var i=this.getNextTowerData();if(t.IMiniGame18Consts.haveMoney<i.price)return App.msgtip.show(this.lang[3]);var e=0;for(var s in this.towersVo)if(!this.towersVo[s].grade&&parseInt(s)<=15){e++,this.towersVo[s]=i,this.towersVo[s].buyTimes++,this.towersBuyTimesVo[this.towersVo[s].type][this.towersVo[s].grade]++,this.addMoney(!1,this.towersVo[s].price),this.towerArr[parseInt(s)-1].playBuy(),this.isPassNew&&this.nextType++,this.nextType>4&&(this.nextType=1),this.checkNextType();break}return this.serverVo.towersBuyTimesVo=this.towersBuyTimesVo,0==e?App.msgtip.show(this.lang[2]):(!this.isPassNew&&this.towersVo[2].grade&&(this.shape.x=125,this.shape.y=680,this.shape.graphics.clear(),this.shape.graphics.beginFill(16777215),this.shape.graphics.drawCircle(0,0,100),this.shape.graphics.endFill(),this.newPlayerMask(this.shape,!0),this.guide(83,680,1),egret.Tween.get(this.guideMove,{loop:!0}).to({x:165},1e3)),void this.updateTowersItemData())},e.prototype.checkNextType=function(){for(var i=this.nextType,e=i;4>=e&&!t.IMiniGame18Consts.maxLevelByType[e];e++)this.nextType++,this.nextType>4&&(this.nextType=1)},e.prototype.mapBtnHandler=function(){this.mapPop=GObj.create(t.IMiniGame18MapPop),this.mapPop.show(),IMiniGameMain.addToStage(this.mapPop)},e.prototype.addMoney=function(i,e){if(i)t.IMiniGame18Consts.haveMoney+=e,IMiniGameMain.playEff(t.IMiniGame18Consts.minigame_gold);else{t.IMiniGame18Consts.haveMoney-=e;var s=GObj.create(eui.Label);s.x=275,s.y=285,s.textColor=16777215,s.size=20,s.stroke=2,s.strokeColor=1275078,s.text="-"+e,egret.Tween.get(s).to({y:260,alpha:0},500).call(function(){GObj.disposeObject(s)}),this.updateData()}},e.prototype.getNextTowerData=function(){var i=t.IMiniGame18Consts.maxLevelByType[this.nextType],e=i-t.IMiniGame18Consts.unlockGap<=1?1:i-t.IMiniGame18Consts.unlockGap,s={},h=this.towersBuyTimesVo?this.towersBuyTimesVo[this.nextType][e]:0,a=this.towerData[this.nextType][e];return s.price=a.price+a.add*h,s.grade=e,s.buyTimes=h,s.money=a.money,s.sell=a.sell,s.qua=a.qua,s.type=a.type,s},e.prototype.sellTower=function(){this.sellPop=GObj.create(t.IMiniGame18SellPop);var i=IMiniGameMain.numberToStr(this.towersVo[this.index].sell,1);this.sellPop.show(i,this.towersVo[this.index],this.yesCallBack,this),IMiniGameMain.addToStage(this.sellPop)},e.prototype.yesCallBack=function(i){this.towersVo[this.index]=this.saveVo[this.index],t.IMiniGame18Consts.haveMoney+=i,IMiniGameMain.playEff(t.IMiniGame18Consts.minigame_sell),this.updateData(),this.updateTowersItemData()},e.prototype.checkSellPos=function(t,i){var e=this.sellImg.localToGlobal();return t>e.x&&i>e.y&&t<e.x+this.sellImg.width&&i<e.y+this.sellImg.height},e.prototype.createMonster=function(){if(!(this.isCreateMontersOver||--this.createMonsterFrame>0)){this.createMonsterFrame=t.IMiniGame18Consts.createTime,this.currWaveData=this.currChapData.passes[this.currWave-1];var i=this.currWaveData.monsterType;if(i.length<=this.monsterIndex)return this.isCreateMontersOver=!0,void(this.monsterIndex=0);var e=GObj.create(t.IMiniGame18Monster);e.setData(t.IMiniGame18Consts.monsters[i[this.monsterIndex]],this.currChap,this.currWave,this.currChapData.mapId),this.monsterArr.push(e),this.monsterGrp.addChild(e),this.pushSceneInByObject(e),this.monsterIndex++}},e.prototype.startRun=function(){EnterFrameManager.instance.registeRender(this.run,this)},e.prototype.monsterRun=function(){if(this.monkey.isDie()){this.isRunning=!1;var i=void 0;for(var e in this.monsterGrp.$children)i=this.monsterGrp.$children[e],i.reset();return this.monsterGrp.removeChildren(),void this.setResult(0)}var s=this.getSceneInByClass(t.IMiniGame18Monster);if(0==s.length&&this.isCreateMontersOver)return this.changeNextWave(),void(this.isRunning=!1);if(0!=s.length)for(var h,a=0;a<s.length;){if(h=s[a],h.canRemove())h.removeMe(),s.splice(a,1),this.backPoolByObject(h),a--;else{h.run();var n=this.poisonArr;if(n.length&&this.poisonArr)for(var o in n){var r=this.roadArr[o];if(h.x>r.x&&h.y>r.y&&h.x<r.x+r.width&&h.y<r.y+r.height){var l=0;for(var p in this.poisonArr[o]){var c=t.IMiniGame18Consts.tower[TowerType.TYPE_3][this.poisonArr[o][p]];l+=c.big.att}h.setPoisonBigHurt(l)}}}a++}},e.prototype.__openLockHandler=function(i){var e=i.target.parent;this.unlockPop=GObj.create(t.IMiniGame18UnlockPop),this.unlockPop.show(e.index,this.unlockStand,this),IMiniGameMain.addToStage(this.unlockPop)},e.prototype.unlockStand=function(i,e){return t.IMiniGame18Consts.haveMoney<i?App.msgtip.show(IMiniGameMain.getString(t.IMiniGame18Consts.lang[3])):(this.addMoney(!1,i),this.towersVo[e].isUnlock=!0,this.saveVo[e].isUnlock=!0,this.serverVo.saveVo=this.saveVo,t.IMiniGame18Consts.standLevel++,App.msgtip.show(IMiniGameMain.getString(t.IMiniGame18Consts.lang[26])),void this.updateTowersItemData())},e.prototype.start=function(){this.monsterArr&&(this.startRun(),this.updateChapter(),this.isRunning=!0,this.isCreateMontersOver=!1)},e.prototype.run=function(){return this.hurtRun(),this.isRunning?(this.monsterRun(),this.checkCreateButtle(),this.bulletRun(),this.createMonster(),this.hitEffRun(),!1):void 0},e.prototype.changeNextWave=function(){return this.currWave!=this.currChapData.passes.length&&this.waveTips(this.currWave,2),this.currWave++,this.currWave>this.currChapData.passes.length?(this.isRunning=!1,this.changeNextChapter(),void(this.currWave=0)):(1==this.currWave?this.waveTips(this.currWave,1):ClockManager.setTimeout(this.waveTips,this,1200+t.IMiniGame18Consts.tipTime,this.currWave,1),void this.removePoison())},e.prototype.changeNextChapter=function(){this.currChapData=this.chapterData[this.currChap],this.checkNextStage()},e.prototype.updateChapter=function(){this.chapterBitMap.setString(IMiniGameMain.getString(IMiniGameLanguage.c_17,this.currChap)),this.waveBitMap.setString(IMiniGameMain.getString(IMiniGameLanguage.c_18,this.currWave,this.currChapData.passes.length))},e.prototype.checkCreateButtle=function(){var i=this.getSceneInByClass(t.IMiniGame18Monster);if(0!=i.length){i.sort(this.monstersSort);var e=[];for(var s in this.lockArr)this.lockArr[s].vo&&this.lockArr[s].vo.grade&&e.push(this.lockArr[s]);for(var h in e){var a=e[h];if(!(--a.vo.frame>0)){var n=t.IMiniGame18Consts.tower[a.vo.type][a.vo.grade],o=n.big.ballistic;for(var r in i){var l=i[r];if(l.checkSelected()){var p=GMath.distance(a.x+25,a.y+25,l.x,l.y);if(p<=n.range){if(!a.isBiging){a.vo.frame=n.attRate,this.bulletAddScene(1,l,a);break}switch(n.type){case TowerType.TYPE_1:if(--o<=0)break;a.vo.frame=n.big.attRate,this.bulletAddScene(1,l,a,n.big.bSpeed);break;case TowerType.TYPE_2:this.bulletAddScene(1,l,a,n.big.bSpeed),a.changeEnergyNum();break;case TowerType.TYPE_3:this.bulletAddScene(1,l,a,n.big.bSpeed),a.changeEnergyNum();break;case TowerType.TYPE_4:if(--o<=0)break;a.vo.frame=n.big.attRate,this.bulletAddScene(1,l,a,n.big.bSpeed),n.big.ballistic>=a.thunderNum&&(this.thunderBig(l,a),a.thunderNum++)}}}}}}}},e.prototype.monstersSort=function(t,i){var e=t.posIndex||0,s=i.posIndex||0;return e>s?-1:e==s?1==t.boo?t.x>i.x||t.y>i.y?-1:1:t.x<i.x||t.y<i.y?-1:1:1},e.prototype.bulletAddScene=function(i,e,s,h){for(var a,n=0;i>n&&e;n++)a=this.getPoolByClass(t.IMiniGame18Bullet),a.setTowerInfo(t.IMiniGame18Consts.tower[s.vo.type][s.vo.grade],h),a.setTarget(e),a.setPlayer(s),a.run(),this.skillGrp.addChild(a),this.pushSceneInByObject(a)},e.prototype.bulletRun=function(){var i=this.getSceneInByClass(t.IMiniGame18Bullet),e=0;if(0!=i.length)for(;e<i.length;){var s=i[e];if(s.isHit())if(s.hitTarget,s.isBigBullet&&s.data.type==TowerType.TYPE_2)this.iceBig(s);else{this.hurtAddToScene(s),this.hitEffAddToScene(s,s.getHitModel()),s.checkTarget()||(this.hurtAddToScene(s,5),this.goldAddToScene(s));var h=100*Math.random(),a=s.isBigBullet?s.data.big.rate:s.data.passvie.rate;a>h&&s.data.type==TowerType.TYPE_1&&this.firePassive(s),s.isBigBullet&&s.data.type==TowerType.TYPE_3&&this.poisonBig(s),h<s.data.passvie.rate&&s.data.type==TowerType.TYPE_4&&!s.isBigBullet&&this.thunderPassive(s,s.data),s.isBigBullet&&s.data.type==TowerType.TYPE_4&&s.hitTarget.hit(s.data,!0)}s.isRunning()?(s.checkTarget()||s.setTarget(null),s.run()):(s.parent&&s.parent.removeChild(s),i.splice(e,1),this.backPoolByObject(s),e--),e++}},e.prototype.firePassive=function(i){var e=this.getSceneInByClass(t.IMiniGame18Monster),s=[];if(0!=e.length){for(var h in e)if(e[h].checkSelected()){var a=GMath.distance(i.x+25,i.y+25,e[h].x,e[h].y);60>=a&&s.push(e[h])}for(var h in s)s[h].checkSelected()&&(s[h].hit(i.data,!0),this.poisonHurtAddToScene(s[h].x,s[h].y-s[h].height,i.data.passvie.att,TowerType.TYPE_1),this.hitEffAddToScene(i,i.getBigModel()))}},e.prototype.iceBig=function(i){var e=this.getSceneInByClass(t.IMiniGame18Monster),s=[];if(0!=e.length){for(var h in e)if(e[h].checkSelected()){var a=GMath.distance(i.x+25,i.y+25,e[h].x,e[h].y);60>=a&&s.push(e[h])}for(var h in s)s[h].checkSelected()&&(s[h].ice(i.data),this.hitEffAddToScene(i,i.getBigModel()))}},e.prototype.poisonBig=function(i){var e=this.getSceneInByClass(t.IMiniGame18Monster),s=[];if(0!=e.length){e.sort(this.monstersSort);for(var h in e)if(e[h].checkSelected()){var a=GMath.distance(i.x+25,i.y+25,e[h].x,e[h].y);60>=a&&s.push(e[h])}for(var h in s)s[h].checkSelected()&&(s[h].hit(i.data,!0),this.hitEffAddToScene(i,i.getBigModel()),this.poisonEffAddToScene(i,i.getpoisonModel(),i.data.big.duration,i.data.big.grid))}},e.prototype.thunderPassive=function(i,e){var s=this.getSceneInByClass(t.IMiniGame18Monster);if(0!=s.length){s.sort(this.monstersSort);for(var h in s){var a=void 0;if(s[h].checkSelected()){var n=GMath.distance(i.hitTarget.x,i.hitTarget.y,s[h].x,s[h].y);if(25>=n){a=s[h],a.hit(i.data,!0),this.poisonHurtAddToScene(s[h].x,s[h].y-s[h].height,i.data.passvie.att,TowerType.TYPE_4),this.hitEffAddToScene(i,e.hitmodel);for(var o=1;o<=e.passvie.ballistic;o++)if(a.checkSelected()){var r=Math.max(parseInt(h)+o-1,0),l=parseInt(h)+o;if(!s[l])break;var p=this.getPoolByClass(t.IMiniGame18SmallThunder);p.setData(e),p.setTarget(s[l]),p.setPlayer(s[r]),p.start(e.big.eff,1),p.run(),this.pushSceneInByObject(p),this.effGrp.addChild(p),s[l].hit(i.data,!0),this.poisonHurtAddToScene(s[l].x,s[l].y-s[l].height,i.data.passvie.att,TowerType.TYPE_4),this.hitEffAddToScene(i,e.hitmodel)}break}}}}},e.prototype.thunderBig=function(i,e){var s=this.getPoolByClass(t.IMiniGame18Thunder),h=t.IMiniGame18Consts.tower[e.vo.type][e.vo.grade];s.setData(h),s.setTarget(i),s.setPlayer(e),s.start(h.big.eff),s.run(),this.pushSceneInByObject(s),this.effGrp.addChild(s)},e.prototype.hurtAddToScene=function(i,e,s){var h=this.getPoolByClass(t.IMiniGame18Hurt);switch(e){case 5:h.x=i.x,h.y=i.y-i.height-20,h.setHurt(i.money,e),this.addMoney(!0,i.money);break;case 6:h.x=this.monkey.x,h.y=this.monkey.y-this.monkey.height-20,h.setHurt(s,e);break;default:h.x=i.x,h.y=i.y-i.height,h.setHurt(i.hurt,i.type)}this.pushSceneInByObject(h),this.hurtGrp.addChild(h)},e.prototype.poisonHurtAddToScene=function(i,e,s,h){var a=this.getPoolByClass(t.IMiniGame18Hurt);a.x=i,a.y=e-20,a.setHurt(s,h),this.pushSceneInByObject(a),this.hurtGrp.addChild(a)},e.prototype.hurtRun=function(){var i=this.getSceneInByClass(t.IMiniGame18Hurt);if(0!=i.length)for(var e,s=0;s<i.length;s++)e=i[s],e&&(e.run(),e.isRun||(e.removeMe(),i.splice(s,1),this.backPoolByObject(e),s--))},e.prototype.goldAddToScene=function(i,e){var s=this.getPoolByClass(t.IMiniGame18Tween);s.x=i.x,s.y=i.y-i.height,s.setData(this.goldImg.localToGlobal()),s["do"](),this.pushSceneInByObject(s),this.goldGrp.addChild(s)},e.prototype.hitEffAddToScene=function(i,e){var s=this.getPoolByClass(t.IMovie);s.x=i.x,s.y=i.y,s.start(e,1),this.pushSceneInByObject(s),this.effGrp.addChild(s)},e.prototype.bigHitEffAddToScene=function(i,e,s,h){var a=this.getPoolByClass(t.IMiniGame18HitEff);a.x=i.x,a.y=i.y,s&&(a.isLast=!0),a.start(e,1),a.setTarget(i),this.pushSceneInByObject(a),this.hitEffGroup.addChild(a)},e.prototype.poisonEffAddToScene=function(i,e,s,h){for(var a in this.roadArr)if(this.checkMonster(i.hitTarget.x,i.hitTarget.y,parseInt(a))){for(var n=Math.max(parseInt(a)-h,0),o=Math.min(parseInt(a)+h,this.roadArr.length-1),r=[],l=[],p=n;o>=p;p++){var c=this.getPoolByClass(t.IMovie);c.x=this.roadArr[p].x,c.y=this.roadArr[p].y-2,c.start(e),this.pushSceneInByObject(c),this.poisonEffGrp.addChild(c),r.push(c),this.poisonArr[p]||(this.poisonArr[p]=[]),this.poisonArr[p].push(i.data.grade),l.push(p)}ClockManager.setTimeout(this.deleteData,this,s/60*1e3,r,l);break}},e.prototype.deleteData=function(t,i){for(var e in t)t[e].isOver=!0;for(var e in i)this.poisonArr[i[e]].splice(0,1)},e.prototype.checkMonster=function(t,i,e){var s=this.roadArr[e];return t>=s.x&&i>=s.y&&t<=s.x+s.width&&i<=s.y+s.height},e.prototype.hitEffRun=function(){var i=this.getSceneInByClass(t.IMovie);if(i.length>0)for(var e,s=0;s<i.length;s++)e=i[s],e&&(e.run(),e.isOver&&(e.removeMe(),i.splice(s,1),this.backPoolByObject(e),s--));var h=this.getSceneInByClass(t.IMiniGame18Thunder);if(h.length>0)for(var a,s=0;s<h.length;s++)a=h[s],a&&(a.run(),a.thunderRun(),a.isThunderRun?a.checkTarget()||a.setTarget(null):(a.removeMe(),h.splice(s,1),this.backPoolByObject(a),s--));var n=this.getSceneInByClass(t.IMiniGame18SmallThunder);if(n.length>0)for(var o,s=0;s<n.length;s++)o=n[s],o&&(o.run(),o.thunderRun(),o.isOver?(o.removeMe(),n.splice(s,1),this.backPoolByObject(o),s--):o.checkTarget()||o.setTarget(null));var r=this.getSceneInByClass(t.IMiniGame18HitEff);if(r.length>0)for(var l,s=0;s<r.length;s++)l=r[s],l&&(l.run(),l.effRun(),l.isOver||l.isFrameOver?(l.removeMe(),r.splice(s,1),this.backPoolByObject(l),s--):l.checkTarget()||l.setTarget(null))},e.prototype.getPoolByClass=function(t,i){var e=egret.getQualifiedClassName(t);this.pools||(this.pools={});var s=this.pools[e]||[],h=s.pop()||GObj.create(t,i);return h},e.prototype.backPoolByObject=function(t){var i=egret.getQualifiedClassName(t),e=this.pools[i]||[];e.push(t),this.pools[i]=e},e.prototype.destoryPool=function(){if(this.pools){var t,i;for(var e in this.pools)if(t=this.pools[e]){for(;t.length>0;)i=t.pop(),GObj.disposeObject(i),i=null;t=null,delete this.pools[e]}this.pools={}}},e.prototype.getSceneInByClass=function(t,i){return!i&&(i=egret.getQualifiedClassName(t)),this.sceneIn[i]||[]},e.prototype.pushSceneInByObject=function(t,i){!i&&(i=egret.getQualifiedClassName(t)),this.sceneIn||(this.sceneIn={});var e=this.sceneIn[i]||[];e.push(t),this.sceneIn[i]=e},e.prototype.backPoolAllObject=function(){if(this.sceneIn){var t,i;for(var e in this.sceneIn)if(t=this.sceneIn[e]){for(;t.length>0;)i=t.pop(),i&&(i.removeMe&&i.removeMe(),i.parent&&i.parent.removeChild(i),this.backPoolByObject(i));t=null,delete this.sceneIn[e]}this.sceneIn={}}},e.prototype.checkNextStage=function(){var t=this.chapterData[this.currChap-1],i=IMiniGameResultType.type_1;t||IMiniGameMain.reqSocket(3),this.setResult(i)},e.prototype.setResult=function(i){t.IMiniGame18ResultPop.showResult(i,this.resultCallBack,this,3,this.currChap,this.currWave)},e.prototype.resultCallBack=function(t){switch(t){case IMiniGameResultType.type_0:this.reSet(),this.currWave=1,this.monkey.setData(this.currChapData.myHp),this.waveTips(this.currWave,1);break;case IMiniGameResultType.type_1:if(1==this.currChap){this.saveData(),DispatcherManager.dispatch(IMiniGameEvent.IMiniGameResultBack,2);break}this.currWave=1,this.waveTips(this.currWave,1),this.reSet(),this.currChap++,this.serverVo.chapter=this.currChap,this.resetRoad();break;case IMiniGameResultType.type_5:}},e.prototype.resetRoad=function(){this.currChapData=this.chapterData[this.currChap-1];var i=t.IMiniGame18Consts.map[this.currChapData.mapId].tower;for(var e in i)this.towersVo[e]||(this.towersVo[e]={},this.towersVo[e].isBattle=!0,i[e].need?this.towersVo[e].isUnlock=!1:this.towersVo[e].isUnlock=!0,this.saveVo[e]={},this.saveVo[e].isBattle=!0,i[e].need?this.saveVo[e].isUnlock=!1:this.saveVo[e].isUnlock=!0);this.serverVo.saveVo=this.saveVo,this.setMonsterRoad(),this.initTowersItemData()},e.prototype.reSet=function(){this.monsterArr=[],this.backPoolAllObject()},e.prototype.removePoison=function(){this.poisonArr=[];var i=this.getSceneInByClass(t.IMovie);if(0!=i.length)for(var e,s=0;s<i.length;s++)e=i[s],e&&(e.removeMe(),i.splice(s,1),this.backPoolByObject(e),s--)},e.prototype.__heartHandler=function(){this.timeSeconds<10?this.timeSeconds++:(this.timeSeconds=0,this.sendData())},e.prototype.sendData=function(){this.serverVo.time=GApp.clockMgr.serverSecond,IMiniGameMain.reqSocket(7,null,this.serverVo)},e.prototype.saveData=function(){this.currChap++,this.serverVo.chapter=this.currChap,this.sendData()},e.prototype.shake=function(){egret.Tween.get(this).to({x:2,y:2},100).to({x:-2,y:-2},100).to({x:2,y:-2},100).to({x:-2,y:2},100).to({x:0,y:0},100)},e.prototype.guide=function(t,i,e){this.guideMove||(this.guideMove=IMiniGameMain.getGuideView()),this.guideMove.playEffct(t,i,e),this.addChild(this.guideMove)},e.prototype.broadcast=function(i){switch(i){case TowerType.TYPE_1:this.broadcast1.stop(),this.broadcast1.start(t.IMiniGame18Consts.UI_BB_HUO,1),this.broadcast1.autoRun();break;case TowerType.TYPE_2:this.broadcast2.stop(),this.broadcast2.start(t.IMiniGame18Consts.UI_BB_BING,1),this.broadcast2.autoRun();break;case TowerType.TYPE_3:this.broadcast3.stop(),this.broadcast3.start(t.IMiniGame18Consts.UI_BB_DU,1),this.broadcast3.autoRun();break;case TowerType.TYPE_4:this.broadcast4.stop(),this.broadcast4.start(t.IMiniGame18Consts.UI_BB_LEI,1),this.broadcast4.autoRun()}},e.prototype.dispose=function(){if(this.removeEvent(),this.reSet(),GObj.disposeObject(this.bgImg),this.bgImg=null,GObj.disposeObject(this.bottomBg),this.bottomBg=null,GObj.disposeObject(this.monsterGrp),this.monsterGrp=null,GObj.disposeObject(this.skillGrp),this.skillGrp=null,GObj.disposeObject(this.hurtGrp),this.hurtGrp=null,GObj.disposeObject(this.effGrp),this.effGrp=null,GObj.disposeObject(this.goldGrp),this.goldGrp=null,GObj.disposeObject(this.poisonEffGrp),this.poisonEffGrp=null,GObj.disposeObject(this.hitEffGroup),this.hitEffGroup=null,GObj.disposeObject(this.loadImg),this.loadImg=null,GObj.disposeObject(this.goldImg),this.goldImg=null,GObj.disposeObject(this.goldLab),this.goldLab=null,GObj.disposeObject(this.goldBg),this.goldBg=null,GObj.disposeObject(this.buyBg),this.buyBg=null,GObj.disposeObject(this.buyBtn),this.buyBtn=null,GObj.disposeObject(this.priceBg),this.priceBg=null,GObj.disposeObject(this.priceLab),this.priceLab=null,GObj.disposeObject(this.priceGold),this.priceGold=null,GObj.disposeObject(this.mapBtn),this.mapBtn=null,GObj.disposeObject(this.sellImg),this.sellImg=null,GObj.disposeObject(this.movePoint),this.movePoint=null,GObj.disposeObject(this.chapterLab),this.chapterLab=null,GObj.disposeObject(this.chapterBg),this.chapterBg=null,GObj.disposeObject(this.chapterBitMap),this.chapterBitMap=null,GObj.disposeObject(this.waveBitMap),this.waveBitMap=null,GObj.disposeObject(this.monkey),this.monkey=null,this.mapPop&&(GObj.disposeObject(this.mapPop),this.mapPop=null),this.tipPop&&(GObj.disposeObject(this.tipPop),this.tipPop=null),this.unlockPop&&(GObj.disposeObject(this.unlockPop),this.unlockPop=null),this.offlinePop&&(GObj.disposeObject(this.offlinePop),this.offlinePop=null),this.sellPop&&(GObj.disposeObject(this.sellPop),this.sellPop=null),this.container&&(GObj.disposeObject(this.container),this.container=null),this.blendShape&&(GObj.disposeObject(this.blendShape),this.blendShape=null),this.shape&&(GObj.disposeObject(this.shape),this.shape=null),this.renderTexture&&(GObj.disposeObject(this.renderTexture),this.renderTexture=null),this.blendBitmap&&(GObj.disposeObject(this.blendBitmap),this.blendBitmap=null),this.guideMove&&(GObj.disposeObject(this.guideMove),this.guideMove=null),this.towerGroup){for(;this.towerGroup.$children.length>0;)GObj.disposeObject(this.towerGroup.$children[0]);GObj.disposeObject(this.towerGroup),this.towerGroup=null}if(this.roadGroup){for(;this.roadGroup.$children.length>0;)GObj.disposeObject(this.roadGroup.$children[0]);GObj.disposeObject(this.roadGroup),this.roadGroup=null}this.broadcast1.unAutoRun(),this.broadcast2.unAutoRun(),this.broadcast3.unAutoRun(),this.broadcast4.unAutoRun(),GObj.disposeObject(this.broadcast1),this.broadcast1=null,GObj.disposeObject(this.broadcast2),this.broadcast2=null,GObj.disposeObject(this.broadcast3),this.broadcast3=null,GObj.disposeObject(this.broadcast4),this.broadcast4=null,this.funnyVo=null,this.towerArr=null,this.towersVo=null,this.saveVo=null,this.lang=null,this.map=null,this.lockArr=null,this.topLevel=null,this.towersBuyTimesVo=null,this.serverVo=null,this.monsterArr=null,this.nextType=null,this.chapterData=null,this.backPoolAllObject(),this.destoryPool(),this.pools=null,this.sceneIn=null,this.isInit=null},e}(egret.DisplayObjectContainer);t.IMiniGame18Scene=i,__reflect(i.prototype,"miniGame.IMiniGame18Scene")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){return null!==i&&i.apply(this,arguments)||this}return __extends(e,i),e.prototype.initSkins=function(){this.horizontalCenter=0,this.verticalCenter=0,this.width=StageManager.stageWidth,this.height=StageManager.stageHeight,this.bgRect=GObj.create(eui.Rect),this.bgRect.horizontalCenter=0,this.bgRect.verticalCenter=0,this.bgRect.alpha=.8,this.bgRect.width=StageManager.stageWidth,this.bgRect.height=StageManager.stageHeight,this.addChild(this.bgRect),this.group=GObj.create(eui.Group),this.group.width=505,this.group.height=516,this.group.horizontalCenter=0,this.group.verticalCenter=0,this.group.scaleX=.6,this.group.scaleY=.6,this.addChild(this.group),this.bgImg=GObj.create(t.ImageOutside),this.bgImg.setOutSrc("pop",FileConst.png),this.bgImg.horizontalCenter=0,this.bgImg.verticalCenter=0,this.group.addChild(this.bgImg),this.promptImg=GObj.create(t.ImageOutside),this.promptImg.horizontalCenter=0,this.promptImg.y=13,this.promptImg.setOutSrc("tips1",FileConst.png),this.group.addChild(this.promptImg),this.mapItem=GObj.create(t.IMiniGame18MapSmallItem),this.mapItem.horizontalCenter=-3,this.mapItem.y=90,this.mapItem.touchEnabled=!1,this.group.addChild(this.mapItem),this.descBg=GObj.create(t.ImageOutside),this.descBg.horizontalCenter=-3,this.descBg.y=280,this.descBg.setOutSrc("descBg2",FileConst.png),this.group.addChild(this.descBg),this.descLab=GObj.create(eui.Label),this.descLab.horizontalCenter=-3,this.descLab.y=305,this.descLab.textColor=7636835,this.descLab.size=18,this.descLab.lineSpacing=5,this.descLab.textAlign="center",this.group.addChild(this.descLab),this.yesBtn=GObj.create(t.IBaseBtn),this.yesBtn.icon=IMiniGameMain.getIcon("btn_1",FileConst.png),this.yesBtn.x=270,this.yesBtn.y=400,this.yesBtn.labelDisplay.textColor=9655570,this.yesBtn.label=IMiniGameMain.getString(t.IMiniGame18Consts.lang[8]),this.group.addChild(this.yesBtn),this.noBtn=GObj.create(t.IBaseBtn),this.noBtn.icon=IMiniGameMain.getIcon("btn_2",FileConst.png),this.noBtn.x=115,this.noBtn.y=400,this.noBtn.labelDisplay.textColor=1535244,this.noBtn.label=IMiniGameMain.getString(t.IMiniGame18Consts.lang[9]),this.group.addChild(this.noBtn),egret.Tween.get(this.group).to({scaleX:1,scaleY:1},300),this.addEvent()},e.prototype.addEvent=function(){this.yesBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.__yesBtnHandler,this),this.noBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.__noBtnHandler,this)},e.prototype.removeEvent=function(){this.yesBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.__yesBtnHandler,this),this.noBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.__noBtnHandler,this)},e.prototype.show=function(i,e,s,h){this.initSkins(),this.descLab.textFlow=IMiniGameMain.parserHtml(IMiniGameMain.getString(t.IMiniGame18Consts.lang[1],i));var a=t.IMiniGame18Consts.tower[e.type][e.grade];this.mapItem.data=a,this.yesCall=s,this.thisObj=h,this.price=parseInt(i)},e.prototype.__yesBtnHandler=function(){IMiniGameMain.playEff(t.IMiniGame18Consts.minigame_btn),this.yesCall&&(this.yesCall.call(this.thisObj,this.price),this.parent&&this.parent.removeChild(this))},e.prototype.__noBtnHandler=function(){IMiniGameMain.playEff(t.IMiniGame18Consts.minigame_btn),this.parent&&this.parent.removeChild(this)},e.prototype.dispose=function(){this.removeEvent(),GObj.disposeObject(this.bgRect),this.bgRect=null,GObj.disposeObject(this.group),this.group=null,GObj.disposeObject(this.bgImg),this.bgImg=null,GObj.disposeObject(this.promptImg),this.promptImg=null,GObj.disposeObject(this.mapItem),this.mapItem=null,GObj.disposeObject(this.descBg),this.descBg=null,GObj.disposeObject(this.descLab),this.descLab=null,GObj.disposeObject(this.yesBtn),this.yesBtn=null,GObj.disposeObject(this.noBtn),this.noBtn=null,this.yesCall=null,this.thisObj=null,this.price=null},e}(eui.Component);t.IMiniGame18SellPop=i,__reflect(i.prototype,"miniGame.IMiniGame18SellPop")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(t){function i(){var i=t.call(this)||this;
return i.enterFrame=0,i.bitMap.fillMode=egret.BitmapFillMode.SCALE,i}return __extends(i,t),i.prototype.setData=function(t){this.data=t},i.prototype.setTarget=function(t){return this.hitTarget=null,t?(this.target=t,void this.setSkillPoint()):(this.isThunderRun=!1,void(this.target=null))},i.prototype.setPlayer=function(t){this.player=t,this.x=t.x+25,this.y=t.y+25,this.setSkillPoint(),this.isThunderRun=!0},i.prototype.thunderRun=function(){this.setSkillPoint()},i.prototype.setSkillPoint=function(){if(this.player&&this.target){this.x=this.player.x,this.y=this.player.y;var t=this.target.scaleX*this.target.width*.3;this.px=GMath.randomInt(-t,t);var i=this.target.scaleY*this.target.height;this.py=GMath.randomInt(0,.7*i);var e=GMath.angle(this.x,this.y,this.target.x,this.target.y);this.rotation=e,this.updateDistance(),this.bitMap.width=this.distance}},i.prototype.updateDistance=function(){var t=this.x-this.target.x+this.px,i=this.y-this.target.y+this.py;this.distance=Math.sqrt(Math.pow(t,2)+Math.pow(i,2))},i.prototype.checkTarget=function(){return this.target?!this.target.isDie():!1},i.prototype.reset=function(){egret.Tween.removeTweens(this),this.touchChildren=!1,this.touchEnabled=!1,this.enterFrame=0,this._startTime=0},i.prototype.dispose=function(){this.isDestory||(t.prototype.dispose.call(this),this.enterFrame=null)},i}(t.IMovie);t.IMiniGame18SmallThunder=i,__reflect(i.prototype,"miniGame.IMiniGame18SmallThunder")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(t){function i(){var i=t.call(this)||this;return i.enterFrame=0,i.bitMap.fillMode=egret.BitmapFillMode.REPEAT,i}return __extends(i,t),i.prototype.setData=function(t){this.data=t},i.prototype.setTarget=function(t){return this.hitTarget=null,t?(this.target=t,void this.setSkillPoint()):(this.isThunderRun=!1,void(this.target=null))},i.prototype.setPlayer=function(t){this.player=t,this.x=t.x+25,this.y=t.y+25,this.setSkillPoint(),this.isThunderRun=!0},i.prototype.thunderRun=function(){this.isThunderRun&&this.setSkillPoint()},i.prototype.setSkillPoint=function(){if(this.player&&this.target){this.x=this.player.x+25,this.y=this.player.y+25;var t=this.target.scaleX*this.target.width*.3;this.px=GMath.randomInt(-t,t);var i=this.target.scaleY*this.target.height;this.py=GMath.randomInt(0,.7*i);var e=GMath.angle(this.x,this.y,this.target.x,this.target.y);return this.rotation=e,this.updateDistance(),this.distance>this.data.range||!this.player.isBiging?(this.isThunderRun=!1,this.target=null,void this.player.thunderNum--):void(this.bitMap.width=this.distance)}},i.prototype.updateDistance=function(){var t=this.x-this.target.x+this.px,i=this.y-this.target.y+this.py;this.distance=Math.sqrt(Math.pow(t,2)+Math.pow(i,2))},i.prototype.checkTarget=function(){return this.target?!this.target.isDie():!1},i.prototype.reset=function(){egret.Tween.removeTweens(this),this.touchChildren=!1,this.touchEnabled=!1,this.enterFrame=0,this._startTime=0},i.prototype.dispose=function(){this.isDestory||(t.prototype.dispose.call(this),this.enterFrame=null)},i}(t.IMovie);t.IMiniGame18Thunder=i,__reflect(i.prototype,"miniGame.IMiniGame18Thunder")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){return null!==i&&i.apply(this,arguments)||this}return __extends(e,i),e.prototype.initSkins=function(){var i=this;this.width=540,this.height=960,this.touchEnabled=!1,this.bg=GObj.create(t.ImageOutside),this.bg.setOutSrc("tipsBg",FileConst.png),this.bg.horizontalCenter=0,this.bg.verticalCenter=0,this.bg.height=0,this.bg.touchEnabled=!1,this.addChild(this.bg),this.descLab=GObj.create(eui.Label),this.descLab.horizontalCenter=0,this.descLab.verticalCenter=0,this.descLab.size=0,this.descLab.touchEnabled=!1,this.addChild(this.descLab),egret.Tween.get(this.bg).to({height:88},600).wait(t.IMiniGame18Consts.tipTime).to({height:0},600).call(function(){i.monstersGo()}),egret.Tween.get(this.descLab).to({size:36},600).wait(t.IMiniGame18Consts.tipTime).to({size:0},600),this.addEvent()},e.prototype.addEvent=function(){},e.prototype.removeEvent=function(){},e.prototype.show=function(t,i){this.initSkins(),this.type=i,this.descLab.text=t,1==i?this.descLab.textColor=16768512:this.descLab.textColor=8453940},e.prototype.monstersGo=function(){if(1==this.type&&this.parent){var t=this.parent;t.start(),GObj.disposeObject(this)}},e.prototype.dispose=function(){this.removeEvent(),GObj.disposeObject(this.bg),this.bg=null,GObj.disposeObject(this.descLab),this.descLab=null},e}(eui.Component);t.IMiniGame18Tips=i,__reflect(i.prototype,"miniGame.IMiniGame18Tips")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.isThundering=!1,t.thunderNum=0,t.initSkins(),t}return __extends(e,i),e.prototype.initSkins=function(){this.width=this.height=59,this.standImg=GObj.create(t.ImageOutside),this.standImg.setOutSrc("stand",FileConst.png),this.addChild(this.standImg),this.group=GObj.create(eui.Group),this.group.x=-14,this.group.y=-20,this.group.touchChildren=!1,this.addChild(this.group),this.shape=GObj.create(egret.Shape),this.shape.alpha=.7,this.shape.visible=!1,this.group.addChild(this.shape),this.attLab=GObj.create(eui.Label),this.attLab.horizontalCenter=0,this.attLab.y=-20,this.attLab.text=IMiniGameMain.getString(t.IMiniGame18Consts.lang[29]),this.attLab.size=20,this.attLab.visible=!1,this.group.addChild(this.attLab),this.towerImg=GObj.create(t.ImageOutside),this.towerImg.horizontalCenter=0,this.towerImg.verticalCenter=-1,this.group.addChild(this.towerImg),this.quaImg=GObj.create(t.ImageOutside),this.quaImg.touchEnabled=!1,this.quaImg.horizontalCenter=0,this.quaImg.verticalCenter=0,this.group.addChild(this.quaImg),this.gradeBg=GObj.create(t.ImageOutside),this.gradeBg.horizontalCenter=0,this.gradeBg.bottom=5,this.gradeBg.setOutSrc("gradeBg2",FileConst.png),this.group.addChild(this.gradeBg),this.gradeLab=GObj.create(eui.Label),this.gradeLab.horizontalCenter=-1,this.gradeLab.bottom=5,this.gradeLab.touchEnabled=!1,this.gradeLab.size=14,this.gradeLab.textColor=16777215,this.group.addChild(this.gradeLab),this.lockImg=GObj.create(t.ImageOutside),this.lockImg.horizontalCenter=0,this.lockImg.verticalCenter=-4,this.lockImg.setOutSrc("lock2",FileConst.png),this.addChild(this.lockImg),this.emptyLab=GObj.create(eui.Label),this.emptyLab.horizontalCenter=0,this.emptyLab.verticalCenter=-4,this.emptyLab.size=18,this.emptyLab.stroke=2,this.emptyLab.textColor=16777215,this.emptyLab.strokeColor=232461,this.emptyLab.text=IMiniGameMain.getString(t.IMiniGame18Consts.lang[31]),this.addChild(this.emptyLab),this.energyBar=GObj.create(t.IMiniGame18Energy),this.energyBar.right=-15,this.energyBar.y=10,this.group.addChild(this.energyBar),this.eff=GObj.create(t.IMovie),this.eff.x=33,this.eff.y=37,this.addChild(this.eff),this.buyEff=GObj.create(t.IMovie),this.buyEff.x=33,this.buyEff.y=37,this.addChild(this.buyEff),this.energy=0},e.prototype.setData=function(i,e,s,h){var a,n=t.IMiniGame18Consts.map[h].tower;i&&(i.grade?(a=t.IMiniGame18Consts.tower[i.type][i.grade],this.towerImg.setOutSrc("items/"+a.res,FileConst.png),this.vo=i,this.gradeLab.visible=!0,this.gradeBg.visible=!0,this.gradeLab.text=i.grade.toString(),this.shape.graphics.clear(),this.shape.graphics.beginFill(1462625),this.shape.graphics.drawCircle(41,38,a.range),this.shape.graphics.endFill(),this.lockImg.visible=!1,this.emptyLab.visible=!1,this.energyBar.visible=e>15&&1==a.haveBig,this.maxEnergy=a.anger,this.energyBar.visible&&this.energyBar.setData(0,a.anger),this.quaImg.setOutSrc("core/headframe_"+i.type,FileConst.png)):(this.towerImg.source=null,this.vo=null,this.gradeLab.visible=!1,this.gradeBg.visible=!1,this.energyBar.visible=!1,this.quaImg.source="",e>15&&n[e].need?(this.lockImg.visible=!i.isUnlock,this.emptyLab.visible=i.isUnlock,this.price=n[e].need):e>15&&!n[e].need?(this.lockImg.visible=!1,this.emptyLab.visible=i.isUnlock):(this.lockImg.visible=!1,this.emptyLab.visible=!1))),this.index=e},e.prototype.setEnergy=function(){if(this.energyBar.visible&&!this.isBiging){this.energy++,this.energyBar.setData(this.energy,this.maxEnergy);var i=this.parent.parent,e=t.IMiniGame18Consts.tower[this.vo.type][this.vo.grade];if(this.energy>=this.maxEnergy)switch(this.isBiging=!0,this.vo.type){case TowerType.TYPE_1:this.duration=this.durationNum=e.big.duration,i.broadcast(TowerType.TYPE_1),EnterFrameManager.instance.registeRender(this.run,this);break;case TowerType.TYPE_2:this.duration=this.durationNum=e.big.duration,i.broadcast(TowerType.TYPE_2);break;case TowerType.TYPE_3:i.broadcast(TowerType.TYPE_3);break;case TowerType.TYPE_4:this.duration=this.durationNum=e.big.duration,i.broadcast(TowerType.TYPE_4),EnterFrameManager.instance.registeRender(this.run,this)}}},e.prototype.changeEnergyNum=function(){if(this.isBiging){switch(this.vo.type){case TowerType.TYPE_1:break;case TowerType.TYPE_2:this.energy=0,this.isBiging=!1;break;case TowerType.TYPE_3:this.energy=0,this.isBiging=!1;break;case TowerType.TYPE_4:}this.energyBar.setData(this.energy,this.maxEnergy)}},e.prototype.run=function(){this.isBiging&&(--this.duration>0?(this.energy-=this.maxEnergy/this.durationNum,this.energyBar.setData(this.energy,this.maxEnergy)):(this.isBiging=!1,this.isThundering=!1,EnterFrameManager.instance.unRegisteRender(this.run,this)))},e.prototype.show=function(){this.eff.autoRun(),this.towerImg.visible=!0,this.quaImg.visible=!0,this.gradeBg.visible=!0,this.gradeLab.visible=!0},e.prototype.hide=function(){this.towerImg.visible=!1,this.quaImg.visible=!1,this.gradeBg.visible=!1,this.gradeLab.visible=!1},e.prototype.playBuy=function(){this.eff.autoRun()},e.prototype.showRange=function(){this.shape.visible=!0,this.attLab.visible=!0},e.prototype.hideRange=function(){this.shape.visible=!1,this.attLab.visible=!1},e.prototype.checkPos=function(t,i){var e=this,s=e.localToGlobal();return t>s.x&&i>s.y&&t<s.x+e.width&&i<s.y+e.height},e.prototype.dispose=function(){EnterFrameManager.instance.unRegisteRender(this.run,this),GObj.disposeObject(this.quaImg),this.quaImg=null,GObj.disposeObject(this.standImg),this.standImg=null,GObj.disposeObject(this.shape),this.shape=null,GObj.disposeObject(this.attLab),this.attLab=null,GObj.disposeObject(this._pos),this._pos=null,GObj.disposeObject(this.towerImg),this.towerImg=null,GObj.disposeObject(this.gradeBg),this.gradeBg=null,GObj.disposeObject(this.gradeLab),this.gradeLab=null,GObj.disposeObject(this.eff),this.eff=null,GObj.disposeObject(this.buyEff),this.buyEff=null,GObj.disposeObject(this.lockImg),this.lockImg=null,GObj.disposeObject(this.emptyLab),this.emptyLab=null,GObj.disposeObject(this.energyBar),this.energyBar=null,GObj.disposeObject(this.group),this.group=null},e}(eui.Component);t.IMiniGame18TowerItem=i,__reflect(i.prototype,"miniGame.IMiniGame18TowerItem")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.total=3,t._count=0,t.isOver=!1,t.touchEnabled=!1,t.touchChildren=!1,t}return __extends(e,i),e.prototype.setData=function(t){this.endPoint=t},e.prototype["do"]=function(){this._arr=[];var t=GObj.create(eui.Rect);t.width=30,t.height=30,t.x=0,t.y=100;for(var i=0;i<this.total;i++)ClockManager.setTimeout(this.createItem,this,30*i,t)},e.prototype.createItem=function(i){var e=GObj.create(t.IMiniGame18TweenItem);if(e.x=50,e.y=0,e.anchorOffsetX=11.5,e.anchorOffsetY=11.5,e.scaleX=e.scaleY=.01,this.addChild(e),this._arr){this._arr.push(e);var s=360*Math.random(),h=100*Math.random(),a=this.getCirclePos2(e.x,e.y,h,s);e.x=Math.max(i.x,Math.min(a.x,i.x+i.width)),e.y=Math.max(i.y,Math.min(a.y,i.y+i.height));var n=GMath.rate(50)?GMath.randomInt(0,30):GMath.randomInt(330,360);e.rotation=n,egret.Tween.get(e).to({scaleX:.7,scaleY:.7,y:a.y+50},500,egret.Ease.backOut).call(this.scaleEnd,this,[e])}},e.prototype.getCirclePos2=function(t,i,e,s,h){return this.getCirclePos(t,i,e,this.angleToRadian(s),h)},e.prototype.getCirclePos=function(t,i,e,s,h){var a=h||{x:0,y:0};return a.x=t+Math.cos(s)*e,a.y=i+Math.sin(s)*e,a},e.prototype.angleToRadian=function(t){return t=t||0,t*Math.PI/180},e.prototype.scaleEnd=function(t){this._count++,t.beginPos=GObj.create(egret.Point),t.beginPos.x=t.x,t.beginPos.y=t.y,this._count>=this.total&&this.tween2()},e.prototype.tween2=function(){if(this._arr){var t=this._arr,i=this.endPoint;t=t.sort(function(t,i){return t.x-i.x});var e=this.globalToLocal(i.x,i.y);this._count=0;for(var s=0,h=t.length;h>s;s++){var a=t[s];ClockManager.setTimeout(this.move,this,30*s,a,e,s)}}},e.prototype.move=function(t,i,e){t.beginPos=GObj.create(egret.Point),t.beginPos.x=t.x,t.beginPos.y=t.y,t.endPos=i,t.anchorPos=GObj.create(egret.Point),t.anchorPos.x=e%2?i.x+20:i.x-20,i.y>t.y?t.anchorPos.y=i.y-100:t.anchorPos.y=i.y+100,egret.Tween.get(t).to({curveTo:1,scaleY:1},1e3,egret.Ease.cubicIn).call(this.moveEnd,this,[t])},e.prototype.moveEnd=function(t){if(GObj.disposeObject(t),t=null,this._count++,this.parent){var i=this.parent.parent;i.goldImg&&i.goldLab&&(egret.Tween.get(i.goldLab).to({scaleX:1.1,scaleY:1.1},200).to({scaleX:1,scaleY:1},200),egret.Tween.get(i.goldImg).to({scaleX:1.1,scaleY:1.1},200).to({scaleX:1,scaleY:1},200),i.updateData())}this._arr&&this._count==this._arr.length&&(this.isOver=!0)},e.prototype.dispose=function(){GObj.disposeObject(this._arr),this._arr=null},e}(eui.Component);t.IMiniGame18Tween=i,__reflect(i.prototype,"miniGame.IMiniGame18Tween")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var e=i.call(this)||this;return e._isFirst=!0,e._iconView=GObj.create(t.ImageOutside),e._iconView.setOutSrc("gold",FileConst.png),e.addChild(e._iconView),e._t=0,e._startTime=GApp.timer,e._flowy=GMath.randomInt(5,8),e.exact=!0,e.addEvent(),e}return __extends(e,i),e.prototype.addEvent=function(){EnterFrameManager.instance.registeRender(this.__enterFrameHandler,this)},e.prototype.removeEvent=function(){EnterFrameManager.instance.unRegisteRender(this.__enterFrameHandler,this)},e.prototype.__enterFrameHandler=function(){if(this.beginPos){var t=GApp.timer+this._startTime,i=t%1300;this.y=this.beginPos.y+Math.sin(i*(2*Math.PI/1300))*this._flowy}},Object.defineProperty(e.prototype,"curveTo",{get:function(){return this._t},set:function(t){this.beginPos&&this.endPos&&this.anchorPos&&(this.removeEvent(),this._isFirst&&(this.beginPos.y=this.y,this._isFirst=!1),this._t=t,this.x=GEase.bezier(this.beginPos.x,this.anchorPos.x,this.endPos.x,t),this.y=GEase.bezier(this.beginPos.y,this.anchorPos.y,this.endPos.y,t))},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this.removeEvent(),this.parent&&this.parent.removeChild(this),GObj.disposeObject(this._iconView),this._iconView=null,GObj.disposeObject(this.beginPos),this.beginPos=null,GObj.disposeObject(this.endPos),this.endPos=null,GObj.disposeObject(this.anchorPos),this.anchorPos=null,GObj.disposeObject(this._t),this._t=null,GObj.disposeObject(this._startTime),this._startTime=null,GObj.disposeObject(this._flowy),this._flowy=null,GObj.disposeObject(this._isFirst),this._isFirst=null},e}(egret.DisplayObjectContainer);t.IMiniGame18TweenItem=i,__reflect(i.prototype,"miniGame.IMiniGame18TweenItem")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){return null!==i&&i.apply(this,arguments)||this}return __extends(e,i),e.prototype.initSkins=function(){this.horizontalCenter=0,this.verticalCenter=0,this.width=505,this.height=516,this.bgRect=GObj.create(eui.Rect),this.bgRect.horizontalCenter=0,this.bgRect.verticalCenter=0,this.bgRect.alpha=.8,this.bgRect.width=StageManager.stageWidth,this.bgRect.height=StageManager.stageHeight,this.addChild(this.bgRect),this.group=GObj.create(eui.Group),this.group.width=this.width,this.group.height=this.height,this.group.horizontalCenter=0,this.group.verticalCenter=0,this.group.scaleX=.6,this.group.scaleY=.6,this.addChild(this.group),this.bgImg=GObj.create(t.ImageOutside),this.bgImg.horizontalCenter=0,this.bgImg.verticalCenter=0,this.bgImg.setOutSrc("pop",FileConst.png),this.group.addChild(this.bgImg),this.titleImg=GObj.create(t.ImageOutside),this.titleImg.horizontalCenter=0,this.titleImg.y=13,this.titleImg.setOutSrc("tips1",FileConst.png),this.group.addChild(this.titleImg),this.gradeLab=GObj.create(eui.Label),this.gradeLab.size=24,this.gradeLab.textColor=16777215,this.gradeLab.stroke=2,this.gradeLab.strokeColor=6787924,this.gradeLab.horizontalCenter=-3,this.gradeLab.y=100,this.group.addChild(this.gradeLab),this.standImg=GObj.create(t.ImageOutside),this.standImg.horizontalCenter=-3,this.standImg.y=170,this.standImg.setOutSrc("stand",FileConst.png),this.group.addChild(this.standImg),this.descBg=GObj.create(t.ImageOutside),this.descBg.horizontalCenter=-3,this.descBg.y=280,this.descBg.setOutSrc("descBg2",FileConst.png),this.group.addChild(this.descBg),this.descLab=GObj.create(eui.Label),this.descLab.horizontalCenter=-3,this.descLab.y=315,this.descLab.textColor=7636835,this.descLab.size=18,this.group.addChild(this.descLab),this.yesBtn=GObj.create(t.IBaseBtn),this.yesBtn.icon=IMiniGameMain.getIcon("btn_1",FileConst.png),this.yesBtn.x=270,this.yesBtn.y=400,this.yesBtn.labelDisplay.textColor=9655570,this.yesBtn.label=IMiniGameMain.getString(t.IMiniGame18Consts.lang[8]),this.group.addChild(this.yesBtn),this.noBtn=GObj.create(t.IBaseBtn),this.noBtn.icon=IMiniGameMain.getIcon("btn_2",FileConst.png),this.noBtn.x=115,this.noBtn.y=400,this.noBtn.labelDisplay.textColor=1535244,this.noBtn.label=IMiniGameMain.getString(t.IMiniGame18Consts.lang[9]),this.group.addChild(this.noBtn),egret.Tween.get(this.group).to({scaleX:1,scaleY:1},300),this.addEvent()},e.prototype.addEvent=function(){this.yesBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.__yesBtnHandler,this),this.noBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.__noBtnHandler,this)},e.prototype.removeEvent=function(){this.yesBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.__yesBtnHandler,this),this.noBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.__noBtnHandler,this)},e.prototype.show=function(i,e,s){if(i){this.initSkins(),this.price=t.IMiniGame18Consts.standPrice+t.IMiniGame18Consts.standLevel*t.IMiniGame18Consts.standAdd,this.yesCall=e,this.thisObj=s,this.index=i;var h=IMiniGameMain.numberToStr(this.price,1);this.descLab.text=IMiniGameMain.getString(t.IMiniGame18Consts.lang[23],h),this.gradeLab.text=IMiniGameMain.getString(t.IMiniGame18Consts.lang[22],t.IMiniGame18Consts.standLevel+1)}},e.prototype.__yesBtnHandler=function(){IMiniGameMain.playEff(t.IMiniGame18Consts.minigame_btn),this.yesCall&&(this.yesCall.call(this.thisObj,this.price,this.index),this.parent&&this.parent.removeChild(this))},e.prototype.__noBtnHandler=function(){IMiniGameMain.playEff(t.IMiniGame18Consts.minigame_btn),this.parent&&this.parent.removeChild(this)},e.prototype.dispose=function(){this.removeEvent(),GObj.disposeObject(this.bgRect),this.bgRect=null,GObj.disposeObject(this.group),this.group=null,GObj.disposeObject(this.bgImg),this.bgImg=null,GObj.disposeObject(this.titleImg),this.titleImg=null,GObj.disposeObject(this.standImg),this.standImg=null,GObj.disposeObject(this.descBg),this.descBg=null,GObj.disposeObject(this.descLab),this.descLab=null,GObj.disposeObject(this.yesBtn),this.yesBtn=null},e}(eui.Component);t.IMiniGame18UnlockPop=i,__reflect(i.prototype,"miniGame.IMiniGame18UnlockPop")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){return i.call(this)||this}return __extends(e,i),e.prototype.addEvent=function(){this.exitBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCloseClick,this)},e.prototype.removeEvent=function(){this.exitBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onCloseClick,this)},e.prototype.initSkins=function(){this.isInit||(this.isInit=!0,this.horizontalCenter=0,this.verticalCenter=0,this.width=540,this.height=960,this.gameScene=GObj.create(t.IMiniGame18Scene),this.addChild(this.gameScene),this.exitBtn=GObj.create(t.IBaseBtn),this.exitBtn.icon=IMiniGameMain.getIcon("exit_btn",FileConst.png,"chapter"),this.exitBtn.right=20,this.exitBtn.top=20,this.addChild(this.exitBtn),this.addEvent())},e.prototype.setData=function(i,e){this.initSkins(),this.gameScene.setData(i,e),IMiniGameMain.playBgm(t.IMiniGame18Consts.minigame_bgm)},e.prototype.sendData=function(){this.gameScene.sendData()},e.prototype.hideExitBtn=function(){this.exitBtn.visible=!1},e.prototype.showExitBtn=function(){this.exitBtn.visible=!0},e.prototype.dispose=function(){this.removeEvent(),GObj.disposeObject(this.gameScene),this.gameScene=null,GObj.disposeObject(this.exitBtn),this.exitBtn=null,i.prototype.dispose.call(this)},e}(t.IBaseView);t.IMiniGame18View=i,__reflect(i.prototype,"miniGame.IMiniGame18View")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(t){return i.call(this,t)||this}return __extends(e,i),e.prototype.getGameView=function(){return this.gameView||(this.gameView=GObj.create(t.IMiniGame19View)),this.gameView.setData(this.getCurGameData()),this.gameView},e.prototype.loadConfigComplete=function(e){if(e)for(var s in e.config)t.IMiniGame19Consts[s]=e.config[s];i.prototype.loadConfigComplete.call(this,e)},e}(t.IMiniGameBaseCtr);t.IMiniGame19=i,__reflect(i.prototype,"miniGame.IMiniGame19")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.keyFrame=0,t}return __extends(e,i),e.prototype.setData=function(t){this.data=t,this.frame=10,this.keyFrame=t.keyFrame,this.isKeyFrame=!1,this.start(t.model,t.times),t.follow||(this.rotation=0)},e.prototype.run=function(){i.prototype.run.call(this),this.data&&((this.data.keyFrame<0||0==--this.keyFrame)&&(this.data.keyFrame>0&&(this.keyFrame=this.data.keyFrame),this.isKeyFrame=!0),--this.frame<=0&&(this.frame=this.data.musicGap||2*IMiniGameMain.sysFrame(),IMiniGameMain.playEff(this.data.music||t.IMiniGame19Consts.minigame_attack)))},e}(t.IMovieMore);t.IMiniGame19BigSkill=i,__reflect(i.prototype,"miniGame.IMiniGame19BigSkill")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){return i.call(this)||this}return __extends(e,i),e.prototype.initSkins=function(){var i=this;this.bg||(this.touchEnabled=!1,this.touchChildren=!1,this.thumbGrp=GObj.create(eui.Group),this.thumbGrp.x=75,this.thumbGrp.y=36,this.thumbGrp.width=326,this.addChild(this.thumbGrp),this.thumb1=GObj.create(t.ImageOutside),this.thumbGrp.addChild(this.thumb1),this.thumb2=GObj.create(t.ImageOutside),this.thumbGrp.addChild(this.thumb2),this.label=GObj.create(eui.Label),this.label.size=22,this.label.stroke=1,this.label.strokeColor=0,this.label.verticalCenter=0,this.label.right=15,this.thumbGrp.addChild(this.label),this.bg=GObj.create(t.ImageOutside),this.bg.horizontalCenter=0,this.bg.loadCompleteCall(function(){i.width=i.bg.iconWidth,i.height=i.bg.iconHeight,i.anchorOffsetX=i.width/2,i.anchorOffsetY=i.height/2},this),this.bg.setOutSrc("bossBl_bg"),this.addChild(this.bg))},e.prototype.setData=function(t,i){this.initSkins(),this.maxIdx=5,this.curIdx=0,this.maxNums=t,this.blood=i,this.thumb=this.thumb2,this.updateBlood(t)},e.prototype.setBlood=function(t,i){var e=this.thumb;return this.thumb.scaleX=t/this.blood,this.updateBlood(i),this.thumb!=e},e.prototype.updateBlood=function(t){this.label.text="x"+t;var i=this.thumbGrp.getChildAt(0);if(1>=t)return void(i.scaleX=0);var e=(this.maxNums-t)%this.maxIdx+1;if(e!=this.curIdx){this.curIdx=e;var i=this.thumbGrp.getChildAt(0);i.setOutSrc("bossBl_"+this.curIdx);var s=this.curIdx+1;s>this.maxIdx&&(s=1),this.thumb.setOutSrc("bossBl_"+s),this.thumbGrp.addChildAt(this.thumb,0),this.thumb.scaleX=1,this.thumb=i}},e.prototype.dispose=function(){GObj.disposeObject(this.bg),this.bg=null,GObj.disposeObject(this.thumbGrp),this.thumbGrp=null,GObj.disposeObject(this.thumb1),this.thumb1=null,GObj.disposeObject(this.thumb2),this.thumb2=null,GObj.disposeObject(this.label),this.label=null,this.thumb=null},e}(eui.Component);t.IMiniGame19Blood=i,__reflect(i.prototype,"miniGame.IMiniGame19Blood")}(miniGame||(miniGame={}));var miniGame;!function(t){t.IMiniGame19Consts={skillUpGrade:"zhanliup_ui",bossMovie:"ui_bosslaixi",canUseSkillMovie:"ui_tishi1",skillDorpMovie:"ui_daoju_",skillDorpQue:[3,6],skillDorpColor:[16777215,655125,58623,14639615,16748553,16713993,16773394],hurtNum:"",critHurtNum:"",monsterGap:300,bossGap:400,hitBack:1,atkSpeed:120,hitFilter:10,playerChat:"",monsters:{},bigSkills:{},map:[2304,1536,9,6,1,1],angles:[0,360],distanceMin:null,distanceAdd:null,minigame_skill:"",minigame_bgm:"",minigame_win:"",minigame_die:"",minigame_boss:"",minigame_bigSkill:"",minigame_attack:""}}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){return i.call(this)||this}return __extends(e,i),e.prototype.setData=function(i){this.label||(this.label=GObj.create(eui.Label),this.label.width=100,this.label.height=20,this.label.anchorOffsetX=this.label.width/2,this.label.anchorOffsetY=this.label.height/2,this.label.background=!0,this.label.backgroundColor=5987163,this.label.border=!0,this.label.size=18,this.label.verticalAlign=egret.VerticalAlign.MIDDLE,this.label.textAlign=egret.HorizontalAlign.CENTER,this.addChild(this.label),this.goods=GObj.create(GoodsInfo)),this.goods.tid=i.tempId;var e=t.IMiniGame19Consts.skillDorpQue,s=this.goods.quality;this.label.text=IMiniGameMain.numberToStr(i.count)+this.goods.name,this.label.textColor=t.IMiniGame19Consts.skillDorpColor[s-1]||16777215,this.label.borderColor=this.label.textColor;var h=s>e[1]?e[1]:s<e[0]?e[0]:s;this.start(t.IMiniGame19Consts.skillDorpMovie+h)},e.prototype.moveto=function(t){var i=GMath.distance(this.x,this.y,t.x,t.y),e=5;if(3*e>i)return!1;var s=GMath.angle(this.x,this.y,t.x,t.y);return this.x+=e*GMath.cos(s),this.y+=e*GMath.sin(s),!0},e.prototype.dispose=function(){this.isDestory||(GObj.disposeObject(this.label),this.label=null,this.goods=null,i.prototype.dispose.call(this))},e}(t.IMovie);t.IMiniGame19Drop=i,__reflect(i.prototype,"miniGame.IMiniGame19Drop")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){return i.call(this)||this}return __extends(e,i),e.prototype.initSkins=function(){var i=this;this.bgMask||(this.width=StageManager.stageWidth,this.height=StageManager.stageHeight,this.bgMask=GObj.create(eui.Rect),this.bgMask.width=this.width,this.bgMask.height=this.height,this.bgMask.fillColor=0,this.bgMask.fillAlpha=.7,this.bgMask.touchChildren=!1,this.addChild(this.bgMask),this.bgGrp=GObj.create(eui.Group),this.bgGrp.width=this.width,this.bgGrp.height=this.height,this.bgGrp.anchorOffsetX=this.width/2,this.bgGrp.anchorOffsetY=this.height/2,this.bgGrp.horizontalCenter=0,this.bgGrp.verticalCenter=0,this.addChild(this.bgGrp),this.bgImg=GObj.create(t.ImageOutside),this.bgImg.horizontalCenter=0,this.bgImg.verticalCenter=0,this.bgGrp.addChild(this.bgImg),this.nameBg=GObj.create(t.ImageOutside),this.nameBg.horizontalCenter=0,this.nameBg.setOutSrc("sel_1"),this.bgGrp.addChild(this.nameBg),this.item=GObj.create(t.ImageOutside),this.item.loadCompleteCall(this.itemLoadComplete,this),this.item.horizontalCenter=0,this.item.verticalCenter=0,this.bgGrp.addChild(this.item),this.timeBg=GObj.create(t.ImageOutside),this.timeBg.setOutSrc("btn_2"),this.timeBg.horizontalCenter=120,this.bgGrp.addChild(this.timeBg),this.timeDown=GObj.create(eui.Label),this.timeDown.horizontalCenter=120,this.timeDown.size=30,this.timeDown.textColor=5580038,this.bgGrp.addChild(this.timeDown),this.btnSure=GObj.create(t.IBaseBtn),this.btnSure.horizontalCenter=0,this.btnSure.icon=IMiniGameMain.getIcon("btn_1"),this.btnSure.label=IMiniGameLanguage.c_20,this.btnSure.labelDisplay.textColor=5580038,this.btnSure.labelDisplay.size=30,this.btnSure.labelDisplay.verticalCenter=-6,this.btnSure.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelectClick,this),this.bgGrp.addChild(this.btnSure),this.visible=!1,this.bgImg.loadCompleteCall(function(){i.visible=!0,i.time=3,i.nameBg.verticalCenter=-i.bgImg.iconHeight/2,i.btnSure.verticalCenter=i.bgImg.iconHeight/2,i.timeBg.verticalCenter=i.bgImg.iconHeight/2,i.timeDown.verticalCenter=i.bgImg.iconHeight/2-5},this),this.bgImg.setOutSrc("sel_2"))},e.prototype.setData=function(t){this.initSkins(),this.visible=!1,this.item.setOutSrc(t.vdraw)},e.prototype.itemLoadComplete=function(){var t=this;this.bgGrp&&(this.visible=!0,this.bgMask.visible=!0,egret.Tween.removeTweens(this.bgGrp),this.bgGrp.scaleX=0,this.bgGrp.scaleY=0,egret.Tween.get(this.bgGrp).to({scaleX:1,scaleY:1},300).call(function(){t.setTimeDown()},this))},e.prototype.setTimeDown=function(){this.bgGrp&&(this.time=4,this.coundDown(),DispatcherManager.removeListener(HGEvent.HEARTBEAT,this.coundDown,this),DispatcherManager.addListener(HGEvent.HEARTBEAT,this.coundDown,this))},e.prototype.coundDown=function(){return--this.time<0?void this.onSelectClick():void(this.timeDown.text=this.time+"")},e.prototype.closeHide=function(){this.item&&(this.item.source=null),DispatcherManager.removeListener(HGEvent.HEARTBEAT,this.coundDown,this),egret.Tween.removeTweens(this.bgGrp),this.parent&&this.parent.removeChild(this)},e.prototype.onSelectClick=function(t){var i=this;this.bgMask.visible=!1,egret.Tween.get(this.bgGrp).to({scaleX:0,scaleY:0},200).call(function(){i.callBack&&i.callBack.call(i.thisObj),i.closeHide()},this)},e.prototype.setCallBack=function(t,i){this.callBack=t,this.thisObj=i},e.prototype.dispose=function(){this.bgMask&&(this.closeHide(),this.btnSure.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelectClick,this),GObj.disposeObject(this.bgMask),this.bgMask=null,GObj.disposeObject(this.bgGrp),this.bgGrp=null,GObj.disposeObject(this.bgImg),this.bgImg=null,GObj.disposeObject(this.nameBg),this.nameBg=null,GObj.disposeObject(this.item),this.item=null,GObj.disposeObject(this.btnSure),this.btnSure=null,GObj.disposeObject(this.timeDown),this.timeDown=null,this.callBack=null,this.thisObj=null)},e}(eui.Component);t.IMiniGame19GetSkill=i,__reflect(i.prototype,"miniGame.IMiniGame19GetSkill")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){return i.call(this)||this}return __extends(e,i),e.prototype.setHurt=function(i,e){this.setNumber(i||0),this.anchorOffsetX=this.width/2,e?(this.speed=1,this.moveNum=2,this.initMove2(),this.setPath(t.IMiniGame19Consts.critHurtNum||"num4")):(this.speed=1.2,this.moveNum=1,this.initMove1(),this.setPath(t.IMiniGame19Consts.hurtNum||"num4")),this.setGap(-2),this.isRun=!0},e.prototype.setAngle=function(t){this.angle!=t&&(this.angle=t,this.speedx=this.speed*GMath.cos(t),this.speedy=this.speed*GMath.sin(t))},e.prototype.run=function(){if(this.isRun)switch(this.moveNum){case 1:this.showMove1();break;case 2:this.showMove2()}},e.prototype.showMove1=function(){this.x+=this.speedx,this.y+=this.speedy,this.alpha-=.01,this.alpha<.3&&(this.isRun=!1)},e.prototype.initMove1=function(){this.alpha=1,this.scaleX=1,this.scaleY=1,this.setAngle(GMath.randomInt(300,320))},e.prototype.showMove2=function(){this.x+=this.speedx,this.y+=this.speedy,this.scaleX+=this.show2p1,this.scaleY+=this.show2p1,this.alpha+=this.show2p2,this.scaleX>=1.5&&(this.show2p1=-.02,this.show2p2=-.03,this.speed=this.show2p3,this.setAngle(270)),this.alpha<.3&&(this.isRun=!1)},e.prototype.initMove2=function(){this.show2p1=.1,this.show2p2=0,this.show2p3=this.speed,this.speed=5*this.show2p3,this.setAngle(GMath.randomInt(260,280)),this.scaleX=this.scaleY=.3,this.alpha=1},e}(t.IBitNumMap);t.IminiGame19Hurt=i,__reflect(i.prototype,"miniGame.IminiGame19Hurt")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.reSet(),t}return __extends(e,i),e.prototype.setData=function(t){this.reSet(),this.data=t,this.atkSpeed=0,this.anger=t.anger||1,this.maxHp=GMath.randomInt(t.hp[0],t.hp[1]),this.hpNum=t.hpNum||1,this.blood=Math.ceil(this.maxHp/this.hpNum),this.hp=this.blood,this.updatePart(t.model),this.setSpeed(t.speed),this.scaleX=this.scaleY=t.scaleXY,this.setAction(AvatarConsts.ACTION_STAND)},e.prototype.getHurt=function(){return this.data?this.data.hurt:null},e.prototype.run=function(){i.prototype.run.call(this),this.atk(),this.lockTarget(),this.hitBack()
},e.prototype.setTarget=function(t){this.target!=t&&(this.target=t,t&&!t.isDie()?(this._isMove=!0,this.lockTarget(),this.setAction(AvatarConsts.ACTION_WALK)):this._isMove=!1)},e.prototype.move=function(){this.isDie()||this._isMove&&(this.x+=this.speedx*this.scaleZ||0,this.y+=this.speedy*this.scaleZ||0)},e.prototype.atk=function(){if(!this.isDie()){var i=this.data.atkDis||0;0>=i&&(i=this.isBoss?t.IMiniGame19Consts.bossGap:t.IMiniGame19Consts.monsterGap),this._isMove=this.distance>i,--this.atkSpeed>0||this._isMove||(this.atkSpeed=this.data.atkSpeed||t.IMiniGame19Consts.atkSpeed,this.setAction(AvatarConsts.ACTION_ATTACK))}},e.prototype.actionOver=function(t){switch(i.prototype.actionOver.call(this,t),t){case AvatarConsts.ACTION_BRUISE:case AvatarConsts.ACTION_BRUISE_II:this._isMove=!0,this.updateBlood()?this.setAction(AvatarConsts.ACTION_WALK):(this.isDieShow=!0,this.setAction(AvatarConsts.ACTION_DIE),this.died());break;case AvatarConsts.ACTION_ATTACK:this.createAtk=!0,this.setAction(AvatarConsts.ACTION_STAND)}},e.prototype.lockTarget=function(){if(!this._isDie&&this.target&&!(--this.lockGap>0)){this.lockGap=Math.ceil(IMiniGameMain.sysFrame()/5);var t=GMath.angle(this.x,this.y,this.target.x,this.target.y),i=this.getDirection(t);this.setDirection(i),this.distance=GMath.distance(this.x,this.y,this.target.x,this.target.y),this.setAngle(t)}},e.prototype.getDirection=function(t){if(this.angle==t)return this._direction8;var i=AvatarConsts.R_R-Math.floor((t+22.5)/45);return 0>=i&&(i+=AvatarConsts.L_B),i},e.prototype.setHit=function(i){var i=Math.min(i,this.hp);this.hp-=i,this.updateBlood()||(this.isDieShow=!0,this.setAction(AvatarConsts.ACTION_DIE),this.died()),this.isBoss||(this.x-=this.speedx*this.scaleZ*t.IMiniGame19Consts.hitBack,this.y-=this.speedy*this.scaleZ*t.IMiniGame19Consts.hitBack)},e.prototype.hitBack=function(){this.isDieShow&&(this.alpha-=.02,this.alpha<=0&&(this.isDieShow=!1))},e.prototype.canRemove=function(){return!this.isDieShow&&this.isDie()},e.prototype.reSet=function(){this.isBoss=!1,this.isDieShow=!1,this._isDie=!1,this._isMove=!1,this.createAtk=!1,this.target=null,this.distance=99999,this.lockGap=1,this.hpNum=1,this.hp=0,this.maxHp=0,this.data=null,this.speed=0,this.alpha=1,this.anger=1},e.prototype.dispose=function(){this.reSet(),i.prototype.dispose.call(this)},e}(t.IMiniGame19Avatar);t.IMiniGame19Monster=i,__reflect(i.prototype,"miniGame.IMiniGame19Monster")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.isPlayer=!0,t.speed=1,t._direction8=1,t.dirTarget=t._direction8,t}return __extends(e,i),e.prototype.showUpGrade=function(){this.upGrade||(this.upGrade=GObj.create(t.IMovie),this.addChild(this.upGrade)),this.upGrade.start(t.IMiniGame19Consts.skillUpGrade,1),this.upGrade.autoRun(),IMiniGameMain.playEff(t.IMiniGame19Consts.minigame_skill)},e.prototype.setMoveArea=function(t,i,e,s){this.ax=t,this.ay=i,this.aw=e,this.ah=s},e.prototype.setMove=function(t){this._isMove=t,this.setAction(AvatarConsts.ACTION_ATTACK_III)},e.prototype.setData=function(t){this.hpNum=1,this.maxHp=t.hp[0],this.blood=Math.ceil(this.maxHp/this.hpNum),this.hp=this.blood,this.speed=t.speed,this.scaleX=this.scaleY=t.scaleXY,this.updatePart(t.model),this._isDie=!1},e.prototype.run=function(){i.prototype.run.call(this),this.updateDirection()},e.prototype.move=function(){if(this._isMove){var t=this.x+(this.speedx||0);t>this.ax&&t<this.aw-this.ax&&(this.x=t);var i=this.y+(this.speedy||0);i>this.ay&&i<this.ah-this.ay&&(this.y=i)}},e.prototype.setDirection=function(t){this.dirTarget=t,this._direction8!=t&&(this.partCont.scaleX=this.direction2mirror(this._direction8),this.part.setDirection(this.direction2res(this._direction8)))},e.prototype.getDirAngle=function(){return(360+11.25*(9-this._direction8)+5.625)%360},e.prototype.updateDirection=function(){var t=this.dirTarget-this._direction8;0!=t&&((t>16||-16>t)&&(t=-t),t=this._direction8+Math.ceil(t/Math.abs(t)),t=Math.floor(t%32),0>=t&&(t=32),this._direction8=t,this.partCont.scaleX=this.direction2mirror(this._direction8),this.part.setDirection(this.direction2res(this._direction8)))},e.prototype.direction2mirror=function(t){return t>=18?-1:1},e.prototype.direction2res=function(t){return 17>=t?t:32-t+2},e.prototype.showChat=function(i){var e=this;this.labGrp||(this.labGrp=GObj.create(eui.Group),this.labGrp.scaleX=1/(this.scaleX||1),this.labGrp.scaleY=1/(this.scaleY||1),this.addChild(this.labGrp),this.imgBg=GObj.create(t.ImageOutside),this.imgBg.horizontalCenter=0,this.lab=GObj.create(eui.Label),this.lab.textColor=0,this.lab.horizontalCenter=0,this.lab.verticalCenter=-10,this.lab.top=20,this.lab.lineSpacing=5,this.lab.size=18,this.lab.touchEnabled=!1,this.imgBg.loadCompleteCall(function(){e.labGrp.x=-e.imgBg.iconWidth/2*e.labGrp.scaleX,e.labGrp.y=(-e.imgBg.iconHeight-100*e.scaleY)*e.labGrp.scaleY,e.lab.maxWidth=e.imgBg.iconWidth-10,e.lab.maxHeight=e.imgBg.iconHeight-10},this),this.imgBg.setOutSrc("icon5"),this.labGrp.addChild(this.imgBg),this.labGrp.addChild(this.lab)),this.lab.text=i},e.prototype.hideChat=function(){this.labGrp&&(GObj.disposeObject(this.labGrp),this.labGrp=null,GObj.disposeObject(this.imgBg),this.imgBg=null,GObj.disposeObject(this.lab),this.lab=null)},e.prototype.dispose=function(){GObj.disposeObject(this.upGrade),this.upGrade=null,this.hideChat(),i.prototype.dispose.call(this)},e}(t.IMiniGame19Avatar);t.IMiniGame19Player=i,__reflect(i.prototype,"miniGame.IMiniGame19Player")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.initSkins(),t}return __extends(e,i),e.prototype.initSkins=function(){var i=this;this.touchEnabled=!1,this.touchChildren=!1,this.width=300,this.height=100,this.thumb=GObj.create(t.ImageOutside),this.thumb.x=76,this.thumb.y=50,this.thumb.setOutSrc("player_1"),this.addChild(this.thumb),this.bgImg=GObj.create(t.ImageOutside),this.addChild(this.bgImg),this.labName=GObj.create(eui.Label),this.labName.size=16,this.labName.x=90,this.labName.y=22,this.addChild(this.labName),this.labHp=GObj.create(eui.Label),this.labHp.size=16,this.labHp.horizontalCenter=22,this.labHp.y=50,this.addChild(this.labHp),this.countDownBg=GObj.create(t.ImageOutside),this.countDownBg.left=-8,this.countDownBg.setOutSrc("icon2"),this.addChild(this.countDownBg),this.countDownLab=GObj.create(eui.Label),this.countDownLab.left=this.countDownBg.left+30,this.countDownLab.size=22,this.countDownLab.textColor=16777215,this.addChild(this.countDownLab),this.bgImg.loadCompleteCall(function(){i.countDownBg.top=i.bgImg.iconHeight+10,i.countDownLab.top=i.countDownBg.top+1},this),this.bgImg.setOutSrc("player"),this.slideDuration=200},e.prototype.initInfo=function(t,i,e){this.labName.text=i||"nickName",this.countDown=e||120,this.allTime=e||120,this.setTime()},e.prototype.setData=function(t,i){0>t||t>i||(this.value=t/i*100,this.labHp.text=t+"")},e.prototype.setTime=function(){if(this.countDown>=0){var t=this.countDown,i=int(t/60),e=t%60;this.countDownLab.text=(10>i?"0":"")+i+":"+(10>e?"0":"")+e}this.countDown--},e.prototype.getCurTime=function(){return this.allTime-this.countDown},e.prototype.dispose=function(){GObj.disposeObject(this.bgImg),this.bgImg=null,GObj.disposeObject(this.thumb),this.thumb=null,GObj.disposeObject(this.labName),this.labName=null,GObj.disposeObject(this.countDownBg),this.countDownBg=null,GObj.disposeObject(this.countDownLab),this.countDownLab=null},e}(eui.ProgressBar);t.IMiniGame19PlayerHp=i,__reflect(i.prototype,"miniGame.IMiniGame19PlayerHp")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){return i.call(this)||this}return __extends(e,i),e.prototype.initSkins=function(){var e=this;if(!this.isInit){i.prototype.initSkins.call(this),this.shadowGrp=GObj.create(egret.DisplayObjectContainer),this.shadowGrp.touchEnabled=!1,this.shadowGrp.touchChildren=!1,this.mapGrp.addChild(this.shadowGrp),this.monsterGrp=GObj.create(egret.DisplayObjectContainer),this.monsterGrp.touchEnabled=!1,this.monsterGrp.touchChildren=!1,this.mapGrp.addChild(this.monsterGrp),this.effGrp=GObj.create(egret.DisplayObjectContainer),this.effGrp.touchEnabled=!1,this.effGrp.touchChildren=!1,this.mapGrp.addChild(this.effGrp),this.hurtGrp=GObj.create(egret.DisplayObjectContainer),this.hurtGrp.touchEnabled=!1,this.hurtGrp.touchChildren=!1,this.mapGrp.addChild(this.hurtGrp),this.player=GObj.create(t.IMiniGame19Player),this.cameraFollow=this.player,this.comSkill=GObj.create(t.IMiniGame19BigSkill),this.effGrp.addChild(this.comSkill),this.bigSkill=GObj.create(t.IMiniGame19BigSkill),this.effGrp.addChild(this.bigSkill),this.hitImg=GObj.create(t.ImageOutside);var s=egret.Rectangle.create();s.setTo(2,2,6,6),this.hitImg.scale9Grid=s,this.hitImg.setOutSrc("icon10"),this.hitImg.width=this.width,this.hitImg.height=this.height,this.addChild(this.hitImg),this.bossBlood=GObj.create(t.IMiniGame19Blood),this.bossBlood.x=this.width/2,this.bossBlood.y=180+IMiniGameMain.safeHeight,this.bossBlood.visible=!1,this.addChild(this.bossBlood),this.playerBlood=GObj.create(t.IMiniGame19PlayerHp),this.playerBlood.x=0,this.playerBlood.y=10+IMiniGameMain.safeHeight,this.addChild(this.playerBlood),this.skillView=GObj.create(t.IMiniGame19SkillView),this.skillView.x=this.width/2,this.skillView.y=this.height-5,this.skillView.setCallBack(this.useBigSkill,this),this.addChild(this.skillView),this.bossMovie=GObj.create(t.IMovie),this.bossMovie.isLast=!0,this.addChild(this.bossMovie),this.bigSkillName=GObj.create(t.IMovie),this.bigSkillName.x=0,this.addChild(this.bigSkillName),this.rocker=GObj.create(t.IMiniGameRocker),this.rocker.sceneArea=this.hitImg,this.rocker.setCallBack(this,function(){e.rocker.x=(e.width-e.rocker.width)/2,e.rocker.y=e.height-e.rocker.height-80,e.bigSkillName.y=e.rocker.y}),this.addChild(this.rocker),this.addChild(this.natureInfo)}},e.prototype.reSet=function(){i.prototype.reSet.call(this),this.itemFrame=0,this.curSkillIdx=0,this.comSkillVal=null,this.curTimesIdx=0,this.hitPlayerFrame=0,this.monsterFrame=0,this.monsterMax=0,this.monsterNum=0,this.showAll=!1,this.isStop=!1,this.frameNumRate=1,this.frameRate=IMiniGameMain.sysFrame(),this.boss=null,this.gameOver=!1,this.stop(),this.bossBlood&&(this.bossBlood.visible=!1)},e.prototype.stop=function(){i.prototype.stop.call(this),this.skillView&&this.skillView.closeHide(),this.getSkill&&this.getSkill.closeHide(),this.bossMovie&&(egret.Tween.removeTweens(this.bossMovie),this.bossMovie.visible=!1),this.backPoolAllObject()},e.prototype.start=function(){i.prototype.start.call(this),this.rocker.visible=!0,1==this.data.stageId&&this.player.showChat(t.IMiniGame19Consts.playerChat)},e.prototype.setData=function(t){this.initSkins(),this.curIdx=0,this.data=t,this.updateView()},e.prototype.updateView=function(){this.reSet(),this.hitImg.alpha=0,this.curData=this.data.passes[this.curIdx],this.monsterMax=this.curData.monsterMax[0]||1/0,this.loadMapImg(this.curData.mapId,this.curData.map||t.IMiniGame19Consts.map),this.initPlayerInfo(),!this.curIdx&&IMiniGameMain.reqSocket(1,this.data.stageId),this.curSkillIdx=-1,this.checkComSkill(),this.skillView.setData(this.getSkillById(this.curData.bigSkillId),this.curData.angerMax),this.showOpenView()},e.prototype.showOpenView=function(){this.showMovie||(this.showMovie=GObj.create(t.IMiniGame19Show),this.showMovie.setCallBack(this.start,this)),this.rocker.visible=!1,this.showMovie.setData(this.curData),IMiniGameMain.addToStage(this.showMovie)},e.prototype.initPlayerInfo=function(){var t=this.player,i=this.getAvatarById(this.curData.playerId);i&&(t.setData(i),this.monsterGrp.addChild(this.player),this.shadowGrp.addChild(t.getShadow()),this.playerBlood.initInfo(i.model,App.player.playerVo.name,this.curData.time),this.playerBlood.setData(t.hp,this.player.maxHp),t.x=this.mapGrp.width/2,t.y=this.mapGrp.height/2,this.setMoveArea(t),this.setCamera())},e.prototype.run=function(){return i.prototype.run.call(this),this.curData?(this.updatePlayer(),this.updateHitPlayer(),this.monsterRun(),this.comSkillRun(),this.bigSkillRun(),this.skillView.run(),this.hurtRun(),this.hitEffRun(),this.dorpItemRun(),!1):void 0},e.prototype.checkNature=function(){if(this.isStop)return!1;var e=this.sysFrame,s=this.frameRate,h=GApp.timer-this.lastTime,a=i.prototype.checkNature.call(this);if(!a)return a;this.playerBlood.setTime();var n=this.playerBlood.getCurTime(),o=this.curData.monsterMaxSec.indexOf(n);o>0&&this.curData.monsterMax[o]&&(this.monsterMax=this.curData.monsterMax[o]),this.checkComSkill(),this.player.isDie()&&this.setResult(IMiniGameResultType.type_0),this.gameOver&&(this.bossBlood.visible=!1,this.checkNextStage()),this.playerBlood.countDown<0&&this.setResult(IMiniGameResultType.type_0);var r=IMiniGameMain.sysFrame(),l=Math.min(r,e),p=Math.round(1e3*l/h),c=Math.max(p,.3*r)/r;return c=+c.toFixed(2),(s&&p-s>=10||s>p&&this.frameNumRate>c)&&(this.frameNumRate=c),this.natureInfo.visible&&(this.natureInfo.text="设备fps："+e+"\n设置fps："+r+"\n实际fps："+p+"\n运行比例："+this.frameNumRate+"\n小怪数："+this.getSceneInByClass(t.IMiniGame19Monster).length+"\n技能数："+this.getSceneInByClass(t.IMiniGame19BigSkill).length+"\n击中特效："+this.getSceneInByClass(t.IMovie).length+" | "+this.getSceneInByClass(t.IMovie,"dorpItems").length+"\n伤害数："+this.getSceneInByClass(t.IminiGame19Hurt).length),this.natureInfo.y=this.height-this.natureInfo.height-10,a},e.prototype.updatePlayer=function(){this.player&&(this.player.setMove(this.rocker.isMove),this.player.setAngle(this.rocker.angle),this.player.setDirection(this.rocker.dir),this.player.run(),this.rocker.isMove&&(this.setCamera(),this.player.hideChat()))},e.prototype.updateHitPlayer=function(){return--this.hitPlayerFrame<0?void(this.hitImg.alpha=.001):(this.hitImg.alpha<=.3&&(this.hitImg.alpha=1),void(this.hitImg.alpha-=.02))},e.prototype.getAvatarById=function(i){return t.IMiniGame19Consts.monsters[i]},e.prototype.checkCreateMonster=function(){if(!(this.isStop||0==this.bigSkill.isOver||this.monsterNum>0&&(this.monsterAddToScene(this.monsterNum),this.monsterNum>0)))if(this.monsterNum=this.curData.monsterNum[this.curTimesIdx]||0,this.monsterNum>0)this.curTimesIdx++,this.monsterAddToScene(this.monsterNum);else{if(this.monsterNum>0)return;var i=this.getSceneInByClass(t.IMiniGame19Monster);if(i.length>0)return;IMiniGameMain.reqSocket(2);var e=this.getAvatarById(this.curData.bossId);e?(this.checkBossMovie(),this.bossAddToScene(e)):(this.isStop=!0,this.showGetSkillView(this.curData.nextBigSkillId))}},e.prototype.bossAddToScene=function(i){var e;this.boss||(e=this.getPoolByClass(t.IMiniGame19Monster),e.setData(i),e.isBoss=!0,this.setMonsterPoint(e),e.setTarget(this.player),this.boss=e,this.pushSceneInByObject(e),this.bossBlood.setData(i.hpNum,e.blood),this.bossBlood.visible=!0)},e.prototype.monsterAddToScene=function(i){var e=this.getSceneInByClass(t.IMiniGame19Monster),s=this.monsterMax-e.length;if(!(0>=s)){this.monsterNum=i-s;for(var h,a,n,o=this.curData.monsterId,r=o[this.curTimesIdx-1]||o[o.length-1],l=0;s>l;l++)a=GMath.randomInt(1,r.length)-1,n=this.getAvatarById(r[a]),n&&(h=this.getPoolByClass(t.IMiniGame19Monster),h.setData(n),this.setMonsterPoint(h),h.setTarget(this.player),this.monsterGrp.addChild(h),this.shadowGrp.addChild(h.getShadow()),this.pushSceneInByObject(h))}},e.prototype.setMonsterPoint=function(i){var e=this.curData,s=e.angles||t.IMiniGame19Consts.angles,h=e.distanceMin||t.IMiniGame19Consts.distanceMin,a=e.distanceAdd||t.IMiniGame19Consts.distanceAdd,n=GMath.randomInt(s[0],s[1]),o=h||this.width/2,r=h||this.height/2,l=o+(a||o),p=r+(a||r),c=GMath.randomInt(o,l),u=GMath.randomInt(r,p);i.isBoss&&(n=270,c=this.width/2,u=this.height/3),i.x=this.player.x+c*GMath.cos(n),i.y=this.player.y+u*GMath.sin(n)},e.prototype.monsterRun=function(){var i=this.getSceneInByClass(t.IMiniGame19Monster);if(this.checkCreateMonster(),0!=i.length){for(var e,s,h,a=Math.ceil(this.frameNumRate*i.length),n=this.monsterFrame;a>0&&(n>=i.length&&(n=0),e=i[n]);)e.canRemove()||this.isStop?(this.isStop||(e.isBoss?(this.isStop=!0,this.bossBlood.visible=!1,this.showGetSkillView(this.curData.nextBigSkillId)):(this.skillView.updateAnger(e.anger),this.checkComSkill())),e.removeMe(),i.splice(n,1),this.backPoolByObject(e),n--):(e.isBoss&&this.monsterGrp.addChild(e),e.y<this.player.y&&(s=this.monsterGrp.getChildIndex(this.player),h=this.monsterGrp.getChildIndex(e),h>s&&this.monsterGrp.addChildAt(e,s)),e.run(),e.createAtk&&(this.createHit(this.player,e.getHurt()),this.hitPlayerFrame=IMiniGameMain.sysFrame()/2,e.createAtk=!1),this.showOrHide(e)),n++,a--;this.monsterFrame=n}},e.prototype.getTarget=function(i,e){var s,h,a,n,o,r,l,p=[],c=this.getSceneInByClass(t.IMiniGame19Monster),u=this.player;i>0&&360>i&&(s=u.getDirAngle(),h=u.x,a=u.y,n=s-i/2+180,o=s+i/2+180);for(var d,m,g=0,f=c.length-1;f>=g&&(d=c[g],m=u.isPlayer?d.distance:GMath.distance(u.x,u.y,d.x,d.y),!d.isDie()&&e>=m&&(l=!0,null!=s&&(r=GMath.angle(h,a,d.x,d.y)+180,n>r&&(r+=360),l=o>r&&r>=n),l&&p.push(d)),!(g>=f));g++,f--)d=c[f],m=u.isPlayer?d.distance:GMath.distance(u.x,u.y,d.x,d.y),!d.isDie()&&e>=m&&(l=!0,null!=s&&(r=GMath.angle(h,a,d.x,d.y)+180,n>r&&(r+=360),l=o>r&&r>=n),l&&p.push(d));return p},e.prototype.getSkillById=function(i){return t.IMiniGame19Consts.bigSkills[i]},e.prototype.skillRun=function(t){t&&(t.isOver||this.isStop||(t.run(),t.x=this.player.x,t.y=this.player.y,t.isKeyFrame&&(t.isKeyFrame=!1,this.setBigSkillHurt(t.data))))},e.prototype.setBigSkillHurt=function(i){var e;if(e=i.radius>0?this.getTarget(i.angle||360,i.radius):this.getSceneInByClass(t.IMiniGame19Monster))for(var s=i.hurt||[1,10],h=0,a=e;h<a.length;h++){var n=a[h];n.isDie()||this.createHit(n,s,i.hitmodel)}},e.prototype.checkComSkill=function(){var t=this.curData.comSkills[this.curSkillIdx+1];if(t){this.comSkillVal||(this.comSkillVal=t.split("_"));var i=this.comSkillVal,e=+i[0],s=+i[1],h=this.skillView.angerVal;if(h>=s){this.comSkillVal=null,s>0&&this.showGetSkillView(e),this.curSkillIdx++;var a=this.getSkillById(e);a&&this.comSkill.setData(a)}}},e.prototype.comSkillRun=function(){if(this.comSkill&&this.comSkill.data){var t=this.comSkill.data.follow;if(t){var i=this.player.getDirAngle();this.comSkill.rotation=i}else this.comSkill.rotation=0;this.skillRun(this.comSkill)}},e.prototype.bigSkillRun=function(){this.bigSkill&&this.skillRun(this.bigSkill)},e.prototype.useBigSkill=function(i){var e=t.IMiniGame19Consts.bigSkills[i||1];e&&(this.bigSkillName.start(e.nameModel,1),this.bigSkillName.autoRun(),this.bigSkill.setData(e),this.bigSkill.x=this.player.x,this.bigSkill.y=this.player.y)},e.prototype.createHit=function(t,i,e){var s=GMath.randomInt(i[0],i[1]),h=(i[1]-i[0])/10,a=s>i[0]+8*h,n=0,o=0;if(t.setHit(s),t.isPlayer||t.hit(),t.isBoss||t.isPlayer){var r=GMath.randomInt(180,360),l=GMath.randomInt(0,.2*t.width),p=GMath.randomInt(0,.7*t.height);n=t.scaleX*GMath.cos(r)*l,o=t.scaleY*GMath.sin(r)*p}this.hurtAddToScene(t,s,a,n,o),e&&this.hitEffAddToScene(t,e,n,o),this.setHpBlood(t)},e.prototype.hitEffAddToScene=function(i,e,s,h){var a=this.getPoolByClass(t.IMovie);a.x=i.x+(s||0),a.y=i.y+(h||0),a.start(e,1),this.pushSceneInByObject(a),this.effGrp.addChild(a)},e.prototype.hitEffRun=function(){var i=this.getSceneInByClass(t.IMovie);if(0!=i.length)for(var e,s=0;s<i.length;s++)e=i[s],e&&(e.run(),this.showOrHide(e),(e.isOver||this.isStop)&&(e.removeMe(),i.splice(s,1),this.backPoolByObject(e),s--))},e.prototype.hurtAddToScene=function(i,e,s,h,a){var n=this.getPoolByClass(t.IminiGame19Hurt);n.x=i.x+(h||0),n.y=i.y+(a||0),n.setHurt(e,s),this.pushSceneInByObject(n),this.hurtGrp.addChild(n)},e.prototype.hurtRun=function(){var i=this.getSceneInByClass(t.IminiGame19Hurt);if(0!=i.length)for(var e,s=0;s<i.length;s++)e=i[s],e&&(e.run(),this.showOrHide(e),(!e.isRun||this.isStop)&&(e.removeMe(),i.splice(s,1),this.backPoolByObject(e),s--))},e.prototype.setHpBlood=function(t){t.isBoss&&this.bossBlood.setBlood(this.boss.hp,this.boss.hpNum)&&this.skillView.updateAnger(this.boss.anger),t.isPlayer&&this.playerBlood.setData(this.player.hp,this.player.maxHp)},e.prototype.showGetSkillView=function(i){this.getSkill||(this.getSkill=GObj.create(t.IMiniGame19GetSkill),this.getSkill.setCallBack(this.closeGetSkillView,this));var e=this.getSkillById(i);e?(this.getSkill.setData(e),IMiniGameMain.addToStage(this.getSkill)):(this.isStop=!0,this.closeGetSkillView())},e.prototype.closeGetSkillView=function(){if(!this.isDestory&&(this.player.showUpGrade(),this.isStop)){this.comSkill.stop();var t=this.getSkillById(this.curData.nextBigSkillId);t&&this.skillView.updateBigSkill(t),this.passDropItem()}},e.prototype.passDropItem=function(){var i=IMiniGameMain.curMiniGame.gameData.funny;if(i){this.itemFrame=120;for(var e,s,h,a,n=i.bagList[0],o=this.player,r=0,l=n.rewardList;r<l.length;r++){var p=l[r];e=this.getPoolByClass(t.IMiniGame19Drop),e.setData(p),egret.Tween.removeTweens(e),e.x=o.x,e.y=o.y,s=GMath.randomInt(0,360),h=o.x+200*GMath.cos(s),a=o.y+200*GMath.sin(s),e.scaleX=.5,e.scaleY=.5,egret.Tween.get(e).to({x:h,y:a-30,scaleX:1.4,scaleY:1.4},500,egret.Ease.circOut).to({x:h,y:a,scaleX:1,scaleY:1},300,egret.Ease.circIn),this.effGrp.addChild(e),this.pushSceneInByObject(e)}}},e.prototype.dorpItemRun=function(){var i=this.getSceneInByClass(t.IMiniGame19Drop);if(0!=i.length){for(var e,s=--this.itemFrame>0?!1:!0,h=0;h<i.length;h++)e=i[h],e&&e.parent&&(e.run(),s&&!e.moveto(this.player)&&(e.removeMe(),i.splice(h,1),h--));0==i.length&&(this.gameOver=!0,this.checkNextStage())}},e.prototype.checkBossMovie=function(){this.bossMovie.visible=!1,this.bossMovie.setLoadCompleteBack(this.showBossMovie,this),this.bossMovie.start(t.IMiniGame19Consts.bossMovie,1),IMiniGameMain.playEff(t.IMiniGame19Consts.minigame_boss),this.bossMovie.autoRun()},e.prototype.showBossMovie=function(){var t=this;this.bossMovie.visible=!0,this.bossMovie.x=this.width+this.bossMovie.width,this.bossMovie.y=this.height/3;var i=(this.width-this.bossMovie.width)/2;egret.Tween.removeTweens(this.bossMovie),egret.Tween.get(this.bossMovie).to({x:i},500).wait(1500).to({x:-this.bossMovie.width},500).call(function(){t.bossMovie&&(t.bossMovie.visible=!1,t.bossMovie.stop())},this)},e.prototype.checkNextStage=function(){var t=this.data.passes[this.curIdx+1],i=IMiniGameResultType.type_1;t?(this.curIdx++,i=IMiniGameResultType.type_5):IMiniGameMain.reqSocket(3),this.setResult(i,t&&t.passId)},e.prototype.setResult=function(i,e){this.isStop=!0,i?IMiniGameMain.playEff(t.IMiniGame19Consts.minigame_win):IMiniGameMain.playEff(t.IMiniGame19Consts.minigame_die),t.IMiniGameResult.showResult(i,this.resultCallBack,this,3,e)},e.prototype.resultCallBack=function(t){switch(t){case IMiniGameResultType.type_0:this.reSet(),this.updateView();break;case IMiniGameResultType.type_1:var i=this.parent;i&&i.outCloseClick();break;case IMiniGameResultType.type_5:this.updateView()}},e.prototype.dispose=function(){this.isDestory||(this.removeEvent(),this.bossMovie&&egret.Tween.removeTweens(this.bossMovie),GObj.disposeObject(this.shadowGrp),this.shadowGrp=null,GObj.disposeObject(this.monsterGrp),this.monsterGrp=null,GObj.disposeObject(this.effGrp),this.effGrp=null,GObj.disposeObject(this.hurtGrp),this.hurtGrp=null,GObj.disposeObject(this.skillView),this.skillView=null,GObj.disposeObject(this.boss),this.boss=null,GObj.disposeObject(this.player),this.player=null,GObj.disposeObject(this.comSkill),this.comSkill=null,GObj.disposeObject(this.bigSkill),this.bigSkill=null,GObj.disposeObject(this.bossMovie),this.bossMovie=null,GObj.disposeObject(this.bigSkillName),this.bigSkillName=null,egret.Rectangle.release(this.hitImg.scale9Grid),GObj.disposeObject(this.hitImg),this.hitImg=null,GObj.disposeObject(this.bossBlood),this.bossBlood=null,GObj.disposeObject(this.playerBlood),this.playerBlood=null,GObj.disposeObject(this.rocker),this.rocker=null,GObj.disposeObject(this.getSkill),this.getSkill=null,GObj.disposeObject(this.showMovie),this.showMovie=null,this.sideIdx=null,this.data=null,this.curData=null,this.comSkillVal=null,i.prototype.dispose.call(this))},e}(t.IMiniGameSecne);t.IMiniGame19Scene=i,__reflect(i.prototype,"miniGame.IMiniGame19Scene")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){return i.call(this)||this}return __extends(e,i),e.prototype.initSkins=function(){var i=this;this.bgMask||(this.width=StageManager.stageWidth,this.height=StageManager.stageHeight,this.bgMask=GObj.create(eui.Rect),this.bgMask.width=this.width,this.bgMask.height=this.height,this.bgMask.fillColor=0,this.bgMask.fillAlpha=.5,this.bgMask.touchChildren=!1,this.addChild(this.bgMask),this.item=GObj.create(t.ImageOutside),this.addChild(this.item),this.infoBg=GObj.create(t.ImageOutside),this.infoBg.setOutSrc("showOpen_2"),this.infoBg.horizontalCenter=0,this.addChild(this.infoBg),this.info=GObj.create(eui.Label),this.info.horizontalCenter=0,this.info.textColor=16777215,this.info.stroke=2,this.info.strokeColor=7687684,this.info.size=30,this.addChild(this.info),this.item.loadCompleteCall(function(){i.item.anchorOffsetX=i.item.iconWidth/2,i.item.anchorOffsetY=i.item.iconHeight/2,i.info.y=i.height/2+i.item.iconHeight/2+20,i.infoBg.y=i.info.y-20,i.showMovie()},this))},e.prototype.setData=function(t){this.initSkins(),this.info.text=t.showInfo,this.info.visible=!1,this.infoBg.visible=!1,this.item.setOutSrc(t.showImg)},e.prototype.showMovie=function(){var t=this;this.item.x=this.width+this.item.anchorOffsetX,this.item.y=this.height/3,egret.Tween.removeTweens(this.item),egret.Tween.get(this.item).to({x:this.width/2,y:this.height/2},500).call(function(){t.info.visible=!0,t.infoBg.visible=!0},this).wait(1e3).to({x:-this.item.anchorOffsetX,y:2*this.height/3},500).call(this.showOver,this)},e.prototype.showOver=function(){this.item&&(this.item.source=null),this.info.visible=!1,this.infoBg.visible=!1,egret.Tween.removeTweens(this.item),this.parent&&this.parent.removeChild(this),this.callBack&&this.callBack.call(this.thisObj)},e.prototype.setCallBack=function(t,i){this.callBack=t,this.thisObj=i},e.prototype.dispose=function(){this.bgMask&&(egret.Tween.removeTweens(this.item),GObj.disposeObject(this.bgMask),this.bgMask=null,GObj.disposeObject(this.item),this.item=null,GObj.disposeObject(this.info),this.info=null,this.callBack=null,this.thisObj=null)},e}(eui.Component);t.IMiniGame19Show=i,__reflect(i.prototype,"miniGame.IMiniGame19Show")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function s(){var t=i.call(this)||this;return t.angerVal=0,t}return __extends(s,i),s.prototype.initSkins=function(){var i=this;if(!this.skill){this.height=0,this.skill=GObj.create(e),this.skill.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSkillClick,this),this.addChildAt(this.skill,0),this.proGrp=GObj.create(eui.Group),this.proGrp.horizontalCenter=0,this.proGrp.bottom=0,this.addChild(this.proGrp),this.angerBg=GObj.create(t.ImageOutside),this.angerBg.loadCompleteCall(function(){i.height=i.angerBg.iconHeight,i.width=i.angerBg.iconWidth,i.anchorOffsetX=i.width/2,i.proGrp.width=i.angerBg.iconWidth,i.proGrp.height=i.height,i.skill.bottom=i.height+10,i.skill.right=0,i.height=0},this),this.angerBg.setOutSrc("icon11"),this.proGrp.addChild(this.angerBg),this.anger=GObj.create(eui.ProgressBar),this.anger.x=145,this.anger.y=36;var s=GObj.create(t.ImageOutside);s.setOutSrc("icon12"),this.anger.thumb=s,this.anger.addChild(s),this.anger.slideDuration=200,this.proGrp.addChild(this.anger),this.numMap=GObj.create(t.IBitNumMap),this.numMap.setPath("num2"),this.numMap.setGap(-2),this.numMap.horizontalCenter=0,this.numMap.top=10,this.proGrp.addChild(this.numMap)}},s.prototype.onSkillClick=function(i){var e=i.target;return e.isComplete?(this.callBack&&this.callBack.call(this.thisObj,e.data.idx),e.start(),void IMiniGameMain.playEff(t.IMiniGame19Consts.minigame_bigSkill)):void App.msgtip.show(IMiniGameMain.getLanguage(1))},s.prototype.setData=function(t,i){this.initSkins(),this.updateBigSkill(t),this.anger.maximum=i,this.closeHide()},s.prototype.updateBigSkill=function(t){this.skill.setData(t)},s.prototype.updateAnger=function(t){this.angerVal+=t,this.anger.value=this.angerVal,this.numMap.setNumber(this.angerVal),this.skill.setAngerVal(t)},s.prototype.setCallBack=function(t,i){this.callBack=t,this.thisObj=i},s.prototype.closeHide=function(){this.skill&&(this.angerVal=0,this.anger.value=0,this.skill.start(),this.numMap.setNumber(0))},s.prototype.run=function(){this.skill&&this.skill.run()},s.prototype.dispose=function(){this.skill&&(this.skill.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSkillClick,this),GObj.disposeObject(this.skill),this.skill=null,GObj.disposeObject(this.proGrp),this.proGrp=null,GObj.disposeObject(this.angerBg),this.angerBg=null,GObj.disposeObject(this.anger.thumb),this.anger.thumb=null,GObj.disposeObject(this.anger),this.anger=null,GObj.disposeObject(this.numMap),this.numMap=null,this.skill=null,this.callBack=null,this.thisObj=null)},s}(eui.Component);t.IMiniGame19SkillView=i,__reflect(i.prototype,"miniGame.IMiniGame19SkillView");var e=function(i){function e(){return i.call(this)||this}return __extends(e,i),e.prototype.initSkins=function(){var i=this;this.img||(this.isComplete=!1,this.touchChildren=!1,this.grp=GObj.create(eui.Group),this.grp.horizontalCenter=0,this.grp.verticalCenter=0,this.addChild(this.grp),this.bg=GObj.create(t.ImageOutside),this.bg.horizontalCenter=0,this.bg.verticalCenter=0,this.grp.addChild(this.bg),this.shape=GObj.create(egret.Shape),this.grp.addChild(this.shape),this.img=GObj.create(t.ImageOutside),this.img.horizontalCenter=0,this.img.verticalCenter=0,this.grp.addChild(this.img),this.movie=GObj.create(t.IMovie),this.grp.addChild(this.movie),this.radius=0,this.bg.loadCompleteCall(function(){i.bg.width=i.bg.iconWidth+8,i.bg.height=i.bg.iconWidth+8,i.width=i.bg.width,i.height=i.bg.height,i.grp.width=i.width,i.grp.height=i.height,i.grp.anchorOffsetX=i.width/2,i.grp.anchorOffsetY=i.height/2,i.shape.x=i.width/2,i.shape.y=i.height/2,i.movie.x=i.width/2,i.movie.y=i.height/2,i.radius=i.bg.iconWidth/2-6},this),this.bg.setOutSrc("bigSkillBg"),this.skinName=this.getSkin())},e.prototype.getSkin=function(){var t=GObj.create(eui.Skin);return t.skinParts=["mcDisplay"],t.grp=this.grp,t.elementsContent=[this.grp],t.states=[new eui.State("up",[]),new eui.State("down",[new eui.SetProperty("grp","scaleX",.92),new eui.SetProperty("grp","scaleY",.92)]),new eui.State("disabled",[])],t},e.prototype.setData=function(t){this.initSkins(),this.data=t,this.maxVal=t.anger,this.img.setOutSrc(t.icon),this.isOpen=!0},e.prototype.setAngerVal=function(t){this.targetVal+=t||0,this.updateDraw()},e.prototype.start=function(){this.data&&(this.movie.stop(),this.shape.graphics.clear(),this.isComplete=!1,this.val=0,this.targetVal=0,this.run())},e.prototype.stop=function(){this.img&&(this.movie.start(t.IMiniGame19Consts.canUseSkillMovie),this.isComplete=!0)},e.prototype.run=function(){this.isOpen&&this.isComplete&&this.movie.run()},e.prototype.updateDraw=function(){this.isComplete||this.val>=this.targetVal||(this.val=this.targetVal,this.maxVal<=this.val&&this.stop(),this.draw())},e.prototype.draw=function(){var t=this.val;t>=this.maxVal&&(t=this.maxVal-.001);var i=3*Math.PI/2,e=i+2*Math.PI*t/this.maxVal,s=this.shape.graphics;s.clear(),s.beginFill(16752430,1),s.moveTo(0,0),s.lineTo(this.radius,0),s.drawArc(0,0,this.radius,e,i,!0),s.lineTo(0,0),s.endFill()},e.prototype.dispose=function(){this.img&&(GObj.disposeObject(this.grp),this.grp=null,GObj.disposeObject(this.bg),this.bg=null,GObj.disposeObject(this.img),this.img=null,this.shape.graphics.clear(),GObj.disposeObject(this.shape),this.shape=null,GObj.disposeObject(this.movie),this.movie=null,this.data=null)},e}(eui.Button);__reflect(e.prototype,"IMiniGame19SkillIcon")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){return i.call(this)||this}return __extends(e,i),e.prototype.initSkins=function(){this.isInit||(this.isInit=!0,this.horizontalCenter=0,this.verticalCenter=0,this.width=StageManager.stageWidth,this.height=StageManager.stageHeight,this.gameView=GObj.create(t.IMiniGame19Scene),this.addChild(this.gameView),this.exitBtn=GObj.create(t.IBaseBtn),this.exitBtn.icon=IMiniGameMain.getIcon("exit_btn",FileConst.png,"chapter"),this.exitBtn.right=20,this.exitBtn.top=100+IMiniGameMain.safeHeight,this.addChild(this.exitBtn),this.initEvent())
},e.prototype.initEvent=function(){this.exitBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCloseClick,this)},e.prototype.removeEvent=function(){this.exitBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onCloseClick,this)},e.prototype.onCloseClick=function(t){i.prototype.onCloseClick.call(this,t),this.gameView&&this.gameView.stop()},e.prototype.setData=function(i){this.initSkins(),this.gameView.setData(i),IMiniGameMain.playBgm(t.IMiniGame19Consts.minigame_bgm)},e.prototype.dispose=function(){this.removeEvent(),this.exitBtn&&egret.Tween.removeTweens(this.exitBtn),GObj.disposeObject(this.exitBtn),this.exitBtn=null,GObj.disposeObject(this.gameView),this.gameView=null,i.prototype.dispose.call(this)},e}(t.IBaseView);t.IMiniGame19View=i,__reflect(i.prototype,"miniGame.IMiniGame19View")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(t){return i.call(this,t)||this}return __extends(e,i),e.prototype.getGameView=function(){return this.gameView||(this.gameView=GObj.create(t.IMiniGame2View)),this.gameView.setData(this.getCurGameData()),this.gameView},e.prototype.loadConfigComplete=function(e){if(e)for(var s in e.config)t.IMiniGame2Consts[s]=e.config[s];i.prototype.loadConfigComplete.call(this,e)},e}(t.IMiniGameBaseCtr);t.IMiniGame2=i,__reflect(i.prototype,"miniGame.IMiniGame2")}(miniGame||(miniGame={}));var miniGame;!function(t){t.IMiniGame2Consts={newbie_huanzhuang2:"",PLAYER_MODEL:"",ZHANLINGUP_UI:"",UI_TA_XUANQU:"",UI_BENG_TA_left:"",UI_BENG_TA_right:"",SKILL_FUHUO:"",fightSuccess:"",towerLeft1:"",towerLeft2:"",towerRight1:"",towerRight2:"",towerTop:"",minigame_bgm:"",minigame_attack:"",minigame_die:"",minigame_gain:"",minigame_win:"",minigame_lose:"",minigame_show:"",townTop:1,acts:[1,2,3],towerEffMidGap:75,towerHeight:90,towerBtmGap:40,timeTower:300,jumpTime:0,timePlayer:1.5,playerMaxLevel:3,playerChat:""}}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.once(egret.Event.REMOVED_FROM_STAGE,t.dispose,t),t.initSkins(),t}return __extends(e,i),e.prototype.initSkins=function(){this.width=400,this.height=t.IMiniGame2Consts.towerHeight,this.isMonsterTower=!1,this.bgImg=GObj.create(t.ImageOutside),this.bgImg.horizontalCenter=0,this.addChild(this.bgImg),this.avatarGrp=GObj.create(eui.Group),this.avatarGrp.horizontalCenter=75,this.avatarGrp.bottom=0,this.addChild(this.avatarGrp),this.playerGrp=GObj.create(eui.Group),this.playerGrp.horizontalCenter=50,this.playerGrp.bottom=0,this.addChild(this.playerGrp),this.imgTop=GObj.create(t.ImageOutside),this.imgTop.horizontalCenter=0,this.imgTop.bottom=-5,this.addChild(this.imgTop),this.avatarGrp.touchChildren=!1,this.haveTarget=!1,this.createMovies(),this.loadSrc()},e.prototype.createMovies=function(){this.movie1||(this.movie1=GObj.create(t.IMovie),this.movie1.touchChildren=!1,this.movie1.touchEnabled=!1,this.movie1.x=this.width/2-t.IMiniGame2Consts.towerEffMidGap,this.movie1.y=this.height/2,this.movie1.scaleX=-1,this.addChild(this.movie1),this.movie2=GObj.create(t.IMovie),this.movie2.touchChildren=!1,this.movie2.touchEnabled=!1,this.movie2.x=this.width/2+t.IMiniGame2Consts.towerEffMidGap,this.movie2.y=this.height/2,this.addChild(this.movie2))},e.prototype.loadSrc=function(){this.bgImg&&this.bgImg.setOutSrc("minigame2_10"),this.imgTop&&this.imgTop.setOutSrc("minigame2_13"),this.movie1&&this.movie1.start(t.IMiniGame2Consts.towerLeft1),this.movie2&&this.movie2.start(t.IMiniGame2Consts.towerLeft1),this.LoadTopEff()},e.prototype.LoadTopEff=function(){0==this.itemIndex&&(this.movie1&&(this.movie1.start(t.IMiniGame2Consts.towerLeft2),this.movie1.x=this.width/2-.6*t.IMiniGame2Consts.towerEffMidGap,this.movie1.y=.8*this.height),this.movie2&&(this.movie2.start(t.IMiniGame2Consts.towerLeft2),this.movie2.x=this.width/2+.6*t.IMiniGame2Consts.towerEffMidGap,this.movie2.y=.8*this.height),this.movie3||(this.movie3=GObj.create(t.IMovie),this.movie3.touchChildren=!1,this.movie3.touchEnabled=!1,this.movie3.x=this.width/2,this.movie3.y=0,this.addChild(this.movie3)),this.movie3.visible=!0,this.movie3.start(t.IMiniGame2Consts.towerTop))},e.prototype.run=function(){this.visible&&(this.movie1&&this.movie1.run(),this.movie2&&this.movie2.run(),this.movie3&&this.movie3.run())},e.prototype.dataChanged=function(){i.prototype.dataChanged.call(this);var e=this.data;this.idx=e.index,e.model_Gain&&(this.imgAdd||(this.imgAdd=GObj.create(t.ImageOutside),this.imgAdd.horizontalCenter=-60,this.avatarGrp.addChild(this.imgAdd),this.imgAddHp=GObj.create(t.IBitNumMap),this.imgAddHp.left=55,this.imgAddHp.setGap(-5),this.avatarGrp.addChild(this.imgAddHp)),this.imgAddHp.setPath(e.hp>=0?"num3":"num4"),this.haveTarget=!0,this.imgAdd.setOutSrc("items/"+e.model_Gain),this.imgAddHp.setString((e.hp>=0?"+":"")+e.hp)),this.scaleY=1,this.visible=!0;var s=0==this.itemIndex;this.bgImg.visible=!s,this.imgTop.visible=s,this.LoadTopEff()},e.prototype.checkPos=function(t,i){var e=this.bgImg,s=e.localToGlobal();return t>s.x&&i>s.y&&t<s.x+e.width&&i<s.y+e.height},e.prototype.fightting=function(t){return this.isFight=!0,!1},e.prototype.stopFight=function(t,i){this.isDestory||(this.haveTarget=!1,this.isFight=!1,this.imgAdd&&(this.imgAdd.visible=!1),this.imgAddHp&&(this.imgAddHp.visible=!1))},e.prototype.addPlayerGrp=function(t){this.isDestory||this.playerGrp.addChild(t)},e.prototype.isNotOn=function(){return 0==this.itemIndex},e.prototype.dispose=function(){this.isDestory||(this.isDestory=!0,this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.dispose,this),GObj.disposeObject(this.bgImg),this.bgImg=null,GObj.disposeObject(this.playerGrp),this.playerGrp=null,GObj.disposeObject(this.avatarGrp),this.avatarGrp=null,GObj.disposeObject(this.imgTop),this.imgTop=null,GObj.disposeObject(this.imgAdd),this.imgAdd=null,GObj.disposeObject(this.imgAddHp),this.imgAddHp=null)},e}(eui.ItemRenderer);t.IMiniGame2Left=i,__reflect(i.prototype,"miniGame.IMiniGame2Left");var e=function(i){function e(){return null!==i&&i.apply(this,arguments)||this}return __extends(e,i),e.prototype.initSkins=function(){i.prototype.initSkins.call(this),this.isMonsterTower=!0,this.playerGrp.horizontalCenter=30,this.avatar=GObj.create(t.IMiniGame2Monster),this.avatarGrp.addChild(this.avatar)},e.prototype.loadSrc=function(){this.bgImg&&this.bgImg.setOutSrc("minigame2_15"),this.imgTop&&this.imgTop.setOutSrc("minigame2_14"),this.movie1&&this.movie1.start(t.IMiniGame2Consts.towerRight1),this.movie2&&this.movie2.start(t.IMiniGame2Consts.towerRight1),this.LoadRightTopEff()},e.prototype.LoadTopEff=function(){},e.prototype.LoadRightTopEff=function(){0==this.itemIndex&&(this.movie1&&(this.movie1.start(t.IMiniGame2Consts.towerRight2),this.movie1.x=this.width/2-.6*t.IMiniGame2Consts.towerEffMidGap,this.movie1.y=.9*this.height),this.movie2&&(this.movie2.start(t.IMiniGame2Consts.towerRight2),this.movie2.x=this.width/2+.6*t.IMiniGame2Consts.towerEffMidGap,this.movie2.y=.9*this.height),this.movie3&&(this.movie3.visible=!1))},e.prototype.loadLeftSrc=function(){i.prototype.loadSrc.call(this)},e.prototype.fightting=function(t){return this.isDestory?void 0:this.avatar&&!this.isFight?(this.isFight=!0,this.avatar.fightting(t),!0):!1},e.prototype.stopFight=function(t,i){this.isDestory||(this.isFight=!1,this.avatar.waitting(),t?(this.avatar.died(),this.haveTarget=!1):this.avatar.upGrade(i))},e.prototype.dataChanged=function(){i.prototype.dataChanged.call(this),this.LoadRightTopEff(),this.haveTarget=!1,this.avatar.reset();var t=this.data;t.model&&(this.avatar.setData(t),this.haveTarget=!0)},e.prototype.isNotOn=function(){return!(this.haveTarget||this.idx>=0)},e.prototype.dispose=function(){GObj.disposeObject(this.avatar),this.avatar=null,i.prototype.dispose.call(this)},e}(i);t.IMiniGame2Right=e,__reflect(e.prototype,"miniGame.IMiniGame2Right")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.init(),t}return __extends(e,i),e.prototype.init=function(){this.width=100,this.height=0,this.touchEnabled=!1,this.touchChildren=!1,this.avatar=GObj.create(t.IMovie),this.addChild(this.avatar),this.hpMap=GObj.create(t.IBitNumMap),this.hpMap.y=-80,this.hpMap.left=15,this.hpMap.setGap(-3),this.hpMap.setPath("num4"),this.addChild(this.hpMap)},e.prototype.setData=function(t){this.data=t,this.hp=t.hp,this.avatar.scaleX=t.scaleX||-.8,this.avatar.scaleY=t.scaleY||.8,this.showHp(t.hp),this.waitting()},e.prototype.fightting=function(t){this.hp&&!this.isFight&&(this.isFight=!0,this.avatar.start(this.data.model+"_attack"))},e.prototype.waitting=function(){this.isFight=!1,this.avatar.start(this.data.model+"_stand"),this.avatar.autoRun()},e.prototype.died=function(){this.hp=0,this.isFight=!1,this.emBackEff||(this.emBackEff=GObj.create(t.IMovie),this.addChild(this.emBackEff),this.emBackEff.y=-30,this.emBackEff.scaleY=.2,this.emBackEff.scaleX=.2),ClockManager.setTimeout(this.emBackHandler,this,120),IMiniGameMain.playEff(t.IMiniGame2Consts.minigame_die),this.emBackEff.start(t.IMiniGame2Consts.newbie_huanzhuang2,1)},e.prototype.emBackHandler=function(){this.avatar&&(this.avatar.visible=!1,this.hpMap.visible=!1)},e.prototype.showHp=function(t,i){this.hpMap.setNumber(t,i)},e.prototype.upGrade=function(t){this.hp=t,this.showHp(t,800)},e.prototype.reset=function(){this.avatar.visible=!0,this.hpMap.visible=!0},e.prototype.dispose=function(){GObj.disposeObject(this.avatar),this.avatar=null,GObj.disposeObject(this.emBackEff),this.avatar=null,GObj.disposeObject(this.hpMap),this.hpMap=null,this.data=null},e}(eui.Group);t.IMiniGame2Monster=i,__reflect(i.prototype,"miniGame.IMiniGame2Monster")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.initSkins(),t}return __extends(e,i),e.prototype.initSkins=function(){this.width=100,this.level=1,this.bgRect=GObj.create(eui.Rect),this.bgRect.width=this.width+50,this.bgRect.height=150,this.bgRect.x=-this.bgRect.width/2-20,this.bgRect.y=-this.bgRect.height,this.bgRect.alpha=.01,this.addChild(this.bgRect),this.avatar=GObj.create(t.IAvatarView),this.avatar.setDirection(0),this.avatar.setActOverCallBack(this.actionOver,this),this.addChild(this.avatar),this.hpMap=GObj.create(t.IBitNumMap),this.hpMap.y=-90,this.hpMap.right=130,this.hpMap.setGap(0),this.hpMap.setPath("num3"),this.addChild(this.hpMap)},e.prototype.showing=function(){this.isShow||(this.isShow=!0,this.waitting(),this.roleBackEff||(this.roleBackEff=GObj.create(t.IMovie),this.roleBackEff.setCompleteBack(this.showComplete,this),this.addChild(this.roleBackEff),this.roleBackEff.scaleX=this.roleBackEff.scaleY=.75,this.roleBackEff.x=-15),this.roleBackEff.visible=!0,this.roleBackEff.start(t.IMiniGame2Consts.SKILL_FUHUO,1),this.roleBackEff.autoRun(),IMiniGameMain.playEff(t.IMiniGame2Consts.minigame_show))},e.prototype.showComplete=function(){this.roleBackEff&&(this.isShowOver=!0,this.addToRoom(),this.roleBackEff.stop(),this.roleBackEff.visible=!1)},e.prototype.fightting=function(i,e,s){this.isFight||this.isMove||!i||(this.isFight=!0,this.callBack=e,this.thisObj=s,i.model_Gain?(IMiniGameMain.playEff(t.IMiniGame2Consts.minigame_gain),this.stopFight()):(this.acts=t.IMiniGame2Consts.acts.map(function(t){return t}),IMiniGameMain.playEff(t.IMiniGame2Consts.minigame_attack),this.showFightAction()))},e.prototype.showFightAction=function(){if(0==this.acts.length)return void this.stopFight();var t=GMath.randomInt(0,this.acts.length-1),i=this.acts.splice(t,1);this.avatar.setAction(AvatarConsts.ACTION_ATTACK+i)},e.prototype.actionOver=function(t){t.indexOf(AvatarConsts.ACTION_ATTACK)>-1&&this.showFightAction()},e.prototype.stopFight=function(){this.waitting(),this.callBack&&(this.callBack.call(this.thisObj),this.callBack=null,this.thisObj=null)},e.prototype.waitting=function(){this.isFight=!1,this.isMove=!1,egret.Tween.removeTweens(this),this.avatar.setAction(AvatarConsts.ACTION_STAND)},e.prototype.died=function(){this.hp=0,this.isMove=!1,this.isFight=!1,this.dieEff||(this.dieEff=GObj.create(t.IMovie),this.dieEff.setCompleteBack(this.emBackHandler,this),this.addChild(this.dieEff),this.dieEff.y=-30,this.dieEff.scaleY=.2,this.dieEff.scaleX=.2),this.dieEff.start(t.IMiniGame2Consts.newbie_huanzhuang2,1),this.dieEff.autoRun()},e.prototype.emBackHandler=function(){this.avatar.visible=!1,this.hpMap.visible=!1,this.dieImg||(this.dieImg=GObj.create(t.ImageOutside),this.dieImg.setOutSrc("minigame2_16"),this.dieImg.x=-64,this.dieImg.y=-82,this.addChild(this.dieImg)),this.dieImg.visible=!0},e.prototype.upgradeing=function(){this.upGradeEff||(this.upGradeEff=GObj.create(t.IMovie),this.upGradeEff.x=-20,this.addChild(this.upGradeEff)),this.upGradeEff.start(t.IMiniGame2Consts.ZHANLINGUP_UI,1),this.upGradeEff.autoRun()},e.prototype.moving=function(){this.isMove||(this.isShowOver&&this.hideChat(),this.isMove=!0,this.avatar.setAction(AvatarConsts.ACTION_JUMP))},e.prototype.moveTo=function(i,e,s){var h=this;if(!this.isMove&&i&&e&&i.playerGrp){egret.Tween.removeTweens(this),this.moving();var a=this.localToGlobal();e.globalToLocal(a.x,a.y,a),e.addChild(this),this.x=a.x,this.y=a.y;var n=i.playerGrp.localToGlobal();e.globalToLocal(n.x,n.y,n);var o=n.x-this.width/2,r=n.y,l=t.IMiniGame2Consts.jumpTime||Math.ceil(Math.sqrt(Math.pow(this.x-o,2)+Math.pow(this.y-r,2)))*t.IMiniGame2Consts.timePlayer;egret.Tween.removeTweens(this),egret.Tween.get(this).to({x:o,y:r},l).call(this.waitting,this).call(function(){h.playerRoom=i,h.isShow?h.addToRoom():h.showing(),s&&s.call(e,i)},this)}},e.prototype.addToRoom=function(){this.playerRoom&&(this.x=0,this.y=-2,this.playerRoom.addPlayerGrp(this))},e.prototype.showHp=function(t,i){this.hpMap.setNumber(t,i)},e.prototype.upGrade=function(i,e){this.hp=i,this.showHp(i,800),e&&(this.level=Math.min(t.IMiniGame2Consts.playerMaxLevel,++this.level),this.avatar.updatePart(t.IMiniGame2Consts.PLAYER_MODEL+this.level))},e.prototype.isDontMove=function(){return this.isFight||!this.isShowOver||this.isMove||!this.hp},e.prototype.reset=function(){this.isShowOver=!1,this.isShow=!1,this.avatar.visible=!0,this.hpMap.visible=!0,this.level=1,this.avatar.updatePart(t.IMiniGame2Consts.PLAYER_MODEL+this.level),this.avatar.autoRun(),this.dieImg&&(this.dieImg.visible=!1)},e.prototype.showChat=function(i){var e=this;this.labGrp||(this.labGrp=GObj.create(eui.Group),this.labGrp.scaleX=1/(this.scaleX||1),this.labGrp.scaleY=1/(this.scaleY||1),this.addChild(this.labGrp),this.imgBg=GObj.create(t.ImageOutside),this.imgBg.horizontalCenter=0,this.lab=GObj.create(eui.Label),this.lab.textColor=7353348,this.lab.horizontalCenter=0,this.lab.verticalCenter=-30,this.lab.top=20,this.lab.lineSpacing=2,this.lab.size=18,this.lab.touchEnabled=!1,this.imgBg.loadCompleteCall(function(){e.labGrp.x=-e.imgBg.iconWidth/2*e.labGrp.scaleX,e.labGrp.y=(-e.imgBg.iconHeight-90*e.scaleY)*e.labGrp.scaleY,e.lab.maxWidth=e.imgBg.iconWidth-10,e.lab.maxHeight=e.imgBg.iconHeight-10},this),this.imgBg.setOutSrc("icon5"),this.labGrp.addChild(this.imgBg),this.labGrp.addChild(this.lab)),this.lab.text=i},e.prototype.hideChat=function(){this.labGrp&&(GObj.disposeObject(this.labGrp),this.labGrp=null,GObj.disposeObject(this.imgBg),this.imgBg=null,GObj.disposeObject(this.lab),this.lab=null)},e.prototype.dispose=function(){this.avatar&&(this.hideChat(),egret.Tween.removeTweens(this),GObj.disposeObject(this.bgRect),this.bgRect=null,GObj.disposeObject(this.avatar),this.avatar=null,GObj.disposeObject(this.dieEff),this.dieEff=null,GObj.disposeObject(this.roleBackEff),this.roleBackEff=null,GObj.disposeObject(this.upGradeEff),this.upGradeEff=null,GObj.disposeObject(this.hpMap),this.hpMap=null,GObj.disposeObject(this.dieImg),this.dieImg=null,this.acts=null,this.callBack=null,this.thisObj=null,this.playerRoom=null)},e}(eui.Group);t.IMiniGame2Player=i,__reflect(i.prototype,"miniGame.IMiniGame2Player")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){return i.call(this)||this}return __extends(e,i),e.prototype.initSkins=function(){var i=this;if(!this.isInit){this.isInit=!0,this.horizontalCenter=0,this.verticalCenter=0,this.width=540,this.height=960,this.bgImg=GObj.create(t.ImageOutside),this.bgImg.setOutSrc("game2_bg_1",FileConst.jpg),this.bgImg.horizontalCenter=0,this.bgImg.bottom=0,this.addChild(this.bgImg),this.leftBtm=GObj.create(t.ImageOutside),this.leftBtm.left=0,this.leftBtm.bottom=0,this.addChild(this.leftBtm),this.rightBtm=GObj.create(t.ImageOutside),this.rightBtm.right=0,this.rightBtm.bottom=0,this.addChild(this.rightBtm),this.leftGrp=GObj.create(eui.Group),this.leftGrp.left=0,this.leftGrp.width=270,this.addChild(this.leftGrp),this.leftSrco=GObj.create(eui.Scroller),this.leftSrco.scrollPolicyH=eui.ScrollPolicy.OFF,this.leftSrco.scrollPolicyV=eui.ScrollPolicy.OFF,this.leftSrco.horizontalCenter=0,this.leftSrco.width=400,this.leftSrco.bottom=t.IMiniGame2Consts.towerBtmGap,this.leftGrp.addChild(this.leftSrco),this.leftImgBg=GObj.create(t.ImageOutside),this.leftImgBg.setOutSrc("minigame2_11"),this.leftImgBg.horizontalCenter=0,this.leftImgBg.bottom=0,this.leftImgBg.touchEnabled=!1,this.leftGrp.addChild(this.leftImgBg),this.leftList=GObj.create(eui.DataGroup),this.leftList.useVirtualLayout=!1;var e=GObj.create(eui.VerticalLayout);e.gap=0,e.paddingTop=200,e.horizontalAlign=egret.HorizontalAlign.CENTER,this.leftList.layout=e,this.leftData=GObj.create(eui.ArrayCollection),this.leftList.dataProvider=this.leftData,this.leftList.itemRenderer=t.IMiniGame2Left,this.leftSrco.viewport=this.leftList,this.rightGrp=GObj.create(eui.Group),this.rightGrp.right=0,this.rightGrp.bottom=20,this.rightGrp.width=270,this.addChild(this.rightGrp),this.rightSrco=GObj.create(eui.Scroller),this.rightSrco.scrollPolicyH=eui.ScrollPolicy.OFF,this.rightSrco.scrollPolicyV=eui.ScrollPolicy.OFF,this.rightSrco.horizontalCenter=0,this.rightSrco.width=400,this.rightSrco.bottom=t.IMiniGame2Consts.towerBtmGap,this.rightGrp.addChild(this.rightSrco),this.rightImgBg=GObj.create(t.ImageOutside),this.rightImgBg.horizontalCenter=0,this.rightImgBg.bottom=0,this.rightImgBg.touchEnabled=!1,this.rightGrp.addChild(this.rightImgBg),this.rightList=GObj.create(eui.DataGroup),this.rightList.useVirtualLayout=!1;var e=GObj.create(eui.VerticalLayout);e.gap=0,e.paddingTop=200,e.horizontalAlign=egret.HorizontalAlign.CENTER,this.rightList.layout=e,this.rightData=GObj.create(eui.ArrayCollection),this.rightList.dataProvider=this.rightData,this.rightList.itemRenderer=t.IMiniGame2Right,this.rightSrco.viewport=this.rightList,this.stageImgLab=GObj.create(t.ImageOutside),this.stageImgLab.setOutSrc("minigame2_17"),this.stageImgLab.horizontalCenter=0,this.addChild(this.stageImgLab),this.stageLab=GObj.create(t.IBitNumMap),this.stageLab.setGap(0),this.stageLab.setPath("num2"),this.stageLab.horizontalCenter=0,this.addChild(this.stageLab),this.exitBtn=GObj.create(t.IBaseBtn),this.exitBtn.icon=IMiniGameMain.getIcon("exit_btn",FileConst.png,"chapter"),this.exitBtn.x=20,this.exitBtn.y=40,this.addChild(this.exitBtn),this.leftBtm.loadCompleteCall(function(){var t=i.leftBtm.iconHeight;i.stageImgLab.y=i.height-t+5,i.stageLab.y=i.stageImgLab.y+5,i.leftGrp.bottom=t,i.rightGrp.bottom=t},this),this.leftBtm.setOutSrc("minigame2_19"),this.createPlayer(),this.initEvent()}},e.prototype.setRightSrc=function(t){this.rightImgBg.setOutSrc(t?"minigame2_18":"minigame2_11"),this.rightBtm.setOutSrc(t?"minigame2_20":"minigame2_19")},e.prototype.createPlayer=function(){this.player||(this.player=GObj.create(t.IMiniGame2Player)),this.addChild(this.player),this.player.x=0,this.player.y=this.height/2},e.prototype.initEvent=function(){this.exitBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCloseClick,this),this.player.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBeginClick,this),this.leftList.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onListClick,this),this.rightList.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onListClick,this),EnterFrameManager.instance.registeRender(this.run,this)},e.prototype.removeEvent=function(){this.exitBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onCloseClick,this),this.leftList.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onListClick,this),this.rightList.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onListClick,this),this.player.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBeginClick,this),this.player.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMoveClick,this),this.player.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onEndClick,this),this.player.removeEventListener(egret.TouchEvent.TOUCH_END,this.onEndClick,this),EnterFrameManager.instance.unRegisteRender(this.run,this)},e.prototype.run=function(){if(this.isRun){for(var t=this.leftList.$children,i=0,e=t;i<e.length;i++){var s=e[i];s&&s.run()}t=this.rightList.$children;for(var h=0,a=t;h<a.length;h++){var s=a[h];s&&s.run()}}},e.prototype.onListClick=function(i){if(!this.isMove&&!this.player.isDontMove()&&i.target){var e=i.target.parent;if(e instanceof t.IMiniGame2Left){if(e.isNotOn())return;this.player.moveTo(e,this,this.checkMoveTower)}}},e.prototype.onBeginClick=function(){if(!this.isMove&&!this.player.isDontMove()){this.player.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMoveClick,this),this.player.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onEndClick,this),this.player.addEventListener(egret.TouchEvent.TOUCH_END,this.onEndClick,this);var t=this.player.localToGlobal();this.globalToLocal(t.x,t.y,t),this.player.x=t.x,this.player.y=t.y,this.addChild(this.player),this.player.moving()}},e.prototype.onMoveClick=function(t){this.movePoint||(this.movePoint=egret.Point.create(0,0)),this.globalToLocal(t.stageX,t.stageY,this.movePoint),this.player.x=this.movePoint.x+10,this.player.y=this.movePoint.y+60},e.prototype.onEndClick=function(t){this.player.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMoveClick,this),this.player.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onEndClick,this),this.player.removeEventListener(egret.TouchEvent.TOUCH_END,this.onEndClick,this),this.player.waitting();for(var i,e,s=this.rightList.$children,h=0,a=s;h<a.length&&(e=a[h],!e.visible||e.isNotOn()||!(i=e.checkPos(t.stageX,t.stageY)));h++);if(!i){s=this.leftList.$children;for(var n=0,o=s;n<o.length&&(e=o[n],0==e.itemIndex||!e.visible||e.isNotOn()||!(i=e.checkPos(t.stageX,t.stageY)));n++);}i&&e?this.player.moveTo(e,this,this.checkMoveTower):this.player.moveTo(this.player.playerRoom,this)},e.prototype.checkMoveTower=function(i){var e=this;if(this.curRoom&&this.curRoom!=i&&this.curRoom.isMonsterTower){var s=t.IMiniGame2Consts.towerHeight,h=this.stageData.passes[this.curIndex],a=h.stages3[this.addLevel];if(a){this.addLevel++,this.leftData.addItem(a);var n=this.leftImgBg.localToGlobal();this.globalToLocal(n.x,n.y,n),this.dropping1(n.x+.5*this.leftImgBg.width,n.y+this.leftSrco.bottom),egret.Tween.get(this.leftSrco).to({height:this.leftSrco.height+s},t.IMiniGame2Consts.timeTower)}return n=this.curRoom.bgImg.localToGlobal(),this.globalToLocal(n.x,n.y,n),this.dropping2(n.x+.5*this.curRoom.bgImg.width,n.y+this.curRoom.height),egret.Tween.get(this.rightSrco).to({height:this.rightSrco.height-s},t.IMiniGame2Consts.timeTower),egret.Tween.get(this.curRoom).to({scaleY:0},t.IMiniGame2Consts.timeTower).call(function(){e.isMove=!1,e.curRoom.visible=!1,e.fightting(i)},this),void(this.isMove=!0)}this.fightting(i)},e.prototype.fightting=function(t){this.curRoom=t,t.haveTarget&&(IMiniGameMain.rmGuideView(),t.fightting(this.player.hp)&&this.showFightEff(),this.player.fightting(t.data,this.stopFight,this))},e.prototype.stopFight=function(){if(this.curRoom){var i=this.curRoom.data,e=this.player.hp+i.hp,s=i.model_Gain?!0:this.player.hp>i.hp;s?(!i.model_Gain&&IMiniGameMain.reqSocket(2),this.player.upGrade(e,!!i.model_Gain),this.player.upgradeing(),this.showPassEff()):(this.player.died(),IMiniGameMain.playEff(t.IMiniGame2Consts.minigame_lose),t.IMiniGameResult.showResult(IMiniGameResultType.type_0,this.resultCallBack,this)),this.curRoom&&this.curRoom.stopFight(s,e),this.fightEff&&this.fightEff.stop()}},e.prototype.showPassEff=function(){if(this.curRoom&&0==this.curRoom.idx){this.touchChildren=!1,this.setRightSrc(!1);for(var t=this.rightList.$children,i=0,e=t;i<e.length;i++){var s=e[i];s&&s.loadLeftSrc()}this.showFightSuccess()}},e.prototype.checkNextStage=function(){if(!this.isDestory){var i=this.stageData.passes[this.curIndex+1],e=IMiniGameResultType.type_1;i?(this.curIndex++,e=IMiniGameResultType.type_5):(IMiniGameMain.reqSocket(3),IMiniGameMain.playEff(t.IMiniGame2Consts.minigame_win)),t.IMiniGameResult.showResult(e,this.resultCallBack,this,3,i&&i.passId)}},e.prototype.resultCallBack=function(t){switch(t){case IMiniGameResultType.type_0:this.curIndex=0,this.updateView();break;case IMiniGameResultType.type_1:this.onCloseClick();break;case IMiniGameResultType.type_5:this.updateView()}},e.prototype.setData=function(i){IMiniGameMain.playBgm(t.IMiniGame2Consts.minigame_bgm),this.initSkins(),this.stageData=i,this.curIndex=0,this.updateView()},e.prototype.updateView=function(){var i=this;if(this.isInit&&this.stageData){this.setRightSrc(!0),this.createPlayer(),this.player.visible=!1,this.addLevel=0,this.isMove=!1,this.curRoom=null,this.touchChildren=!0;var e=this.stageData.passes[this.curIndex];this.stageLab.setString(IMiniGameMain.getString(IMiniGameLanguage.c_16,e.passId));for(var s=[],h=0,a=e.stages1;h<a.length;h++){var n=a[h];s.push(n)}this.leftData.removeAll(),this.leftData.replaceAll(s);for(var o=t.IMiniGame2Consts.townTop?[{index:-1}]:[],r=0,l=e.stages2;r<l.length;r++)n=l[r],o.push(n);this.rightData.removeAll(),this.rightData.replaceAll(o);var p=t.IMiniGame2Consts.towerHeight;this.leftSrco.height=p,this.rightSrco.height=p,this.exitBtn.y=-this.exitBtn.height||-100,ClockManager.setTimeout(function(){if(!i.isDestory){var t=i.leftImgBg.localToGlobal();i.globalToLocal(t.x,t.y,t),i.dropping1(t.x+.5*i.leftImgBg.iconWidth,t.y+i.leftSrco.bottom,s.length),t=i.rightImgBg.localToGlobal(),i.globalToLocal(t.x,t.y,t),i.dropping2(t.x+.5*i.rightImgBg.iconWidth,t.y+i.rightSrco.bottom,o.length),i.isRun=!0}},this,120);var c=this.leftList.layout,u=p*s.length+c.paddingTop,d=t.IMiniGame2Consts.timeTower*(s.length+1);egret.Tween.get(this.leftSrco).to({height:u},d).call(this.showMove,this),c=this.rightList.layout,u=p*o.length+c.paddingTop,d=t.IMiniGame2Consts.timeTower*(o.length+1),egret.Tween.get(this.rightSrco).to({height:u},d).call(this.showGuide,this),this.isMove=!0,!this.curIndex&&IMiniGameMain.reqSocket(1,this.stageData.stageId),1==this.stageData.stageId&&this.player.showChat(t.IMiniGame2Consts.playerChat)}},e.prototype.showMove=function(){if(!this.isDestory){if(0==this.leftList.numChildren)return void ClockManager.setTimeout(this.showMove,this,100);this.isMove=!1;var t=this.stageData.passes[this.curIndex],i=this.leftList.getChildAt(this.leftData.length-1);this.player.visible=!0,this.player.reset(),this.player.moveTo(i,this),this.player.hp=t.playerHp,this.player.showHp(t.playerHp),this.dropEff1.stopOne()}},e.prototype.showGuide=function(){if(this.dropEff2.stopOne(),0==this.curIndex&&1==this.stageData.stageId){var i=IMiniGameMain.getGuideView(),e=this.leftGrp,s=e.x+e.width/2,h=this.height-e.bottom-this.leftSrco.bottom-t.IMiniGame2Consts.towerHeight/2;i.playEffct(s,h,1),this.addChild(i);var a=this.rightGrp.x+this.rightGrp.width/2;egret.Tween.removeTweens(i),egret.Tween.get(i,{loop:!0}).to({x:a},1e3)}this.exitBtn&&egret.Tween.get(this.exitBtn).to({y:40},500)},e.prototype.showFightEff=function(){this.fightEff||(this.fightEff=GObj.create(t.IMovie),this.addChild(this.fightEff));var i=this.curRoom.localToGlobal();this.globalToLocal(i.x,i.y,i),this.fightEff.x=i.x+this.curRoom.width/2,this.fightEff.y=i.y+this.curRoom.height/2,this.fightEff.start(t.IMiniGame2Consts.UI_TA_XUANQU),this.fightEff.autoRun()},e.prototype.dropping1=function(i,e,s){void 0===s&&(s=1),this.dropEff1||(this.dropEff1=GObj.create(t.IMovie),this.addChild(this.dropEff1)),this.dropEff1.x=i,this.dropEff1.y=e,this.dropEff1.start(t.IMiniGame2Consts.UI_BENG_TA_left,s),this.dropEff1.autoRun()},e.prototype.dropping2=function(i,e,s){void 0===s&&(s=1),this.dropEff2||(this.dropEff2=GObj.create(t.IMovie),this.addChild(this.dropEff2)),this.dropEff2.x=i,this.dropEff2.y=e,this.dropEff2.start(t.IMiniGame2Consts.UI_BENG_TA_right,s),this.dropEff2.autoRun()},e.prototype.showFightSuccess=function(){this.fightSuccess||(this.fightSuccess=GObj.create(t.IMovie),this.fightSuccess.x=this.width/2,this.fightSuccess.y=this.height/2,this.fightSuccess.setCompleteBack(this.checkNextStage,this),this.addChild(this.fightSuccess)),this.fightSuccess.start(t.IMiniGame2Consts.fightSuccess,1),this.fightSuccess.autoRun()},e.prototype.dispose=function(){this.isDestory||(this.isDestory=!0,this.exitBtn&&egret.Tween.removeTweens(this.exitBtn),this.curRoom&&egret.Tween.removeTweens(this.curRoom),this.removeEvent(),GObj.disposeObject(this.exitBtn),this.exitBtn=null,GObj.disposeObject(this.bgImg),this.bgImg=null,GObj.disposeObject(this.leftBtm),this.leftBtm=null,GObj.disposeObject(this.leftGrp),this.leftGrp=null,GObj.disposeObject(this.leftImgBg),this.leftImgBg=null,GObj.disposeObject(this.rightBtm),this.rightBtm=null,GObj.disposeObject(this.rightGrp),this.rightGrp=null,GObj.disposeObject(this.rightImgBg),this.rightImgBg=null,this.leftSrco&&(egret.Tween.removeTweens(this.leftSrco),this.leftSrco.stopAnimation(),this.leftSrco.viewport=null,GObj.disposeObject(this.leftSrco),this.leftSrco=null),this.rightSrco&&(egret.Tween.removeTweens(this.rightSrco),this.rightSrco.stopAnimation(),this.rightSrco.viewport=null,GObj.disposeObject(this.rightSrco),this.rightSrco=null),this.leftList&&(this.leftList.dataProvider=null,egret.Tween.removeTweens(this.leftList),GObj.disposeObject(this.leftList),this.leftList=null),this.rightList&&(this.rightList.dataProvider=null,egret.Tween.removeTweens(this.rightList),GObj.disposeObject(this.rightList),this.rightList=null),GObj.disposeObject(this.stageImgLab),this.stageImgLab=null,GObj.disposeObject(this.stageLab),this.stageLab=null,GObj.disposeObject(this.dropEff1),this.dropEff1=null,GObj.disposeObject(this.dropEff2),this.dropEff2=null,GObj.disposeObject(this.fightEff),this.fightEff=null,GObj.disposeObject(this.fightSuccess),this.fightSuccess=null,GObj.disposeObject(this.player),this.player=null,this.stageData=null,this.leftData=null,this.rightData=null,this.stageData=null,egret.Point.release(this.movePoint),this.movePoint=null,this.curRoom=null,i.prototype.dispose.call(this))},e}(t.IBaseView);t.IMiniGame2View=i,__reflect(i.prototype,"miniGame.IMiniGame2View")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(t){return i.call(this,t)||this}return __extends(e,i),e.prototype.getGameView=function(){return this.gameView||(this.gameView=GObj.create(t.IMiniGame20View)),this.gameView.setData(this.getCurGameData()),this.gameView},e.prototype.loadConfigComplete=function(e){if(e)for(var s in e.config)t.IMiniGame20Consts[s]=e.config[s];var h=[];h=h.concat([1,0,0,0,100]),h=h.concat([0,0,0,0,0]),h=h.concat([0,0,0,0,0]),h=h.concat([0,0,0,1,0]),t.IMiniGame20Consts.redFilter=new egret.ColorMatrixFilter(h),h=[],h=h.concat([1,0,0,0,150]),h=h.concat([0,1,0,0,150]),h=h.concat([0,0,1,0,150]),h=h.concat([0,0,0,1,0]),t.IMiniGame20Consts.flashFilter=new egret.ColorMatrixFilter(h),h=[],h=h.concat([.3,.6,0,0,0]),h=h.concat([.3,.6,0,0,0]),h=h.concat([.3,.6,0,0,0]),h=h.concat([.3,.6,0,1,0]),t.IMiniGame20Consts.grayFilter=new egret.ColorMatrixFilter(h),i.prototype.loadConfigComplete.call(this,e)},e}(t.IMiniGameBaseCtr);t.IMiniGame20=i,__reflect(i.prototype,"miniGame.IMiniGame20")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.initSkin(),t.reset(),t}return __extends(e,i),e.prototype.initSkin=function(){this.broadcastImg=GObj.create(t.ImageOutside),this.addChild(this.broadcastImg)},e.prototype.setData=function(t){t&&(this.data=t,this.broadcastImg.setOutSrc(t.broadModel,FileConst.png),this.type=t.broadType,this.speed=t.broadSpeed||2)
},e.prototype.run=function(){if(this.data&&!this.isCanRun){this.isCanRun=!0,this.broadcastImg.y=0;var t;t=this.data.broadFloat?this.data.broadFloat:[1,4];var i=GMath.randomInt(t[0],t[1]);-1!=this.type.indexOf(broad20Type.TYPE_4)&&egret.Tween.get(this.broadcastImg,{loop:!0}).to({y:this.broadcastImg.y-i},100*i).to({y:this.broadcastImg.y+2*i},2*i*100).to({y:this.broadcastImg.y},100*i)}},e.prototype.reset=function(){this.data=null,this.type=[],this.isCanRun=!1,this.speed=0,this.broadcastImg&&egret.Tween.removeTweens(this.broadcastImg)},e.prototype.dispose=function(){},e}(eui.Component);t.IMiniGame20Broadcast=i,__reflect(i.prototype,"miniGame.IMiniGame20Broadcast")}(miniGame||(miniGame={}));var miniGame;!function(t){t.IMiniGame20Consts={boxOffsetY:-16,offsetX:5.5,offsetY:-15.5,ui_yanhua:"ui_yanhua",ui_wanmei:"ui_wanmei",boxScalxyArr:[.9,1],horizontalArr:[6,10],box_frame:5,frame_x:.5,max_x:10,overlapPixels:20,verticalDis:5,horizontalDis:2,mapMoveFrame:10,swingAngle:20,defaultHeight:200,crazyTime:10,shakingFloor:15,additionalP:5,perfectFactor:.1,redFilter:null,flashFilter:null,grayFilter:null,loopNumer:3}}(miniGame||(miniGame={}));var prop20Type;!function(t){t[t.TYPE_1=1]="TYPE_1",t[t.TYPE_2=2]="TYPE_2",t[t.TYPE_3=3]="TYPE_3",t[t.TYPE_4=4]="TYPE_4"}(prop20Type||(prop20Type={}));var broad20Type;!function(t){t[t.TYPE_1=1]="TYPE_1",t[t.TYPE_2=2]="TYPE_2",t[t.TYPE_3=3]="TYPE_3",t[t.TYPE_4=4]="TYPE_4",t[t.TYPE_5=5]="TYPE_5"}(broad20Type||(broad20Type={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.initSkin(),t.reset(),t}return __extends(e,i),e.prototype.setFun=function(t,i){this.fun=t,this.thisobj=i},e.prototype.setoutSrc=function(t,i,e){var s=this;this.fun=i,this.thisobj=e,this.imgBg.loadCompleteCall(function(){s.width=s.imgBg.width,s.height=s.imgBg.height,s.fun&&s.fun.call(s.thisobj)},this),this.imgBg.setOutSrc(t,FileConst.png)},e.prototype.initSkin=function(){this.imgBg=GObj.create(t.ImageOutside),this.typeBg=GObj.create(t.ImageOutside),this.typeBg.visible=!1,this.addChild(this.imgBg),this.addChild(this.typeBg)},e.prototype.setType=function(t){var i=this;if(t)switch(this.type=t.propType,this.typeBg.visible=!0,this.typeBg.horizontalCenter=0,this.typeBg.verticalCenter=20,this.imgBg.loadCompleteCall(function(){i.width=i.imgBg.width,i.height=i.imgBg.height,i.imgBg.x=i.imgBg.y=0,i.typeBg.horizontalCenter=0,i.typeBg.verticalCenter=20,i.fun&&i.fun.call(i.thisobj)},this),this.imgBg.setOutSrc(t.propModel,FileConst.png),this.typeBg.loadCompleteCall(function(){i.typeBg.anchorOffsetX=i.typeBg.width/2,i.typeBg.anchorOffsetY=i.typeBg.height/2,i.typeBg.horizontalCenter=0,i.typeBg.verticalCenter=20},this),this.type){case prop20Type.TYPE_1:this.typeBg.visible=!1;break;case prop20Type.TYPE_2:this.typeBg.setOutSrc("doubleS",FileConst.png);break;case prop20Type.TYPE_3:this.typeBg.setOutSrc("addhp",FileConst.png);break;case prop20Type.TYPE_4:this.typeBg.setOutSrc("super",FileConst.png)}},e.prototype.getType=function(){return this.type},e.prototype.reset=function(){this.type=void 0,this.isRun=!1,this.typeBg.visible=!1},e.prototype.dispose=function(){},e}(eui.Component);t.IMiniGame20Image=i,__reflect(i.prototype,"miniGame.IMiniGame20Image")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){return i.call(this)||this}return __extends(e,i),e.prototype.initSkins=function(){var i=this;if(!this.isInit){this.isInit=!0,this.width=540,this.height=960,this.initOnce();for(var e,s=0;3>s;s++)e=GObj.create(t.ImageOutside),this.bgArr.push(e),this.addChild(e);this.uiGroup2=GObj.create(egret.DisplayObjectContainer),this.uiRect2=GObj.create(eui.Rect),this.uiGroup2.width=this.uiRect2.width=this.width,this.uiGroup2.height=this.uiRect2.height=this.height,this.uiRect2.fillAlpha=.001,this.uiGroup2.x=this.uiGroup2.y=0,this.uiGroup2.addChild(this.uiRect2),this.addChild(this.uiGroup2),this.group=GObj.create(eui.Group),this.group.width=this.width,this.group.height=200,this.group.anchorOffsetX=this.group.x=this.width/2,this.group.y=-70,this.addChild(this.group),this.rope_1=GObj.create(t.ImageOutside),this.rope_1.loadCompleteCall(function(){i.rope_1.anchorOffsetX=i.rope_1.width/2,i.rope_1.anchorOffsetY=i.rope_1.height/2,i.rope_1.x=i.group.width/2-i.rope_1.width/2+t.IMiniGame20Consts.offsetX},this),this.rope_1.setOutSrc("rope_left",FileConst.png),this.rope_2=GObj.create(t.ImageOutside),this.rope_2.loadCompleteCall(function(){i.rope_2.anchorOffsetX=i.rope_2.width/2,i.rope_2.anchorOffsetY=i.rope_2.height/2,i.rope_2.x=i.group.width/2+i.rope_2.width/2+t.IMiniGame20Consts.offsetX},this),this.rope_2.setOutSrc("rope_right",FileConst.png),this.lineImg=GObj.create(t.ImageOutside),this.lineImg.loadCompleteCall(function(){i.lineImg.anchorOffsetX=i.lineImg.iconWidth/2,i.rope_1.y=i.lineImg.height+i.rope_1.anchorOffsetY+t.IMiniGame20Consts.offsetY,i.rope_2.y=i.lineImg.height+i.rope_2.anchorOffsetY+t.IMiniGame20Consts.offsetY},this),this.lineImg.x=this.group.width/2,this.lineImg.y=0,this.lineImg.setOutSrc("hook"),this.group.addChild(this.rope_1),this.group.addChild(this.lineImg),this.group.addChild(this.rope_2),this.uiGroup=GObj.create(egret.DisplayObjectContainer),this.uiRect=GObj.create(eui.Rect),this.uiGroup.width=this.uiRect.width=this.width,this.uiGroup.height=this.uiRect.height=this.height,this.uiRect.fillAlpha=.001,this.uiGroup.x=this.uiGroup.y=0,this.uiGroup.addChild(this.uiRect),this.addChild(this.uiGroup),this.textBg1=GObj.create(t.ImageOutside),this.textBg1.x=0,this.textBg1.y=250,this.textBg1.setOutSrc("textbg",FileConst.png),this.addChild(this.textBg1),this.textBg2=GObj.create(t.ImageOutside),this.textBg2.x=0,this.textBg2.y=290,this.textBg2.setOutSrc("textbg",FileConst.png),this.addChild(this.textBg2),this.targetLab=GObj.create(eui.Label),this.targetLab.size=18,this.targetLab.y=256,this.targetLab.x=5,this.targetLab.textColor=16777215,this.addChild(this.targetLab),this.scroeLabel=GObj.create(eui.Label),this.scroeLabel.size=18,this.scroeLabel.y=296,this.scroeLabel.x=5,this.scroeLabel.textColor=16777215,this.addChild(this.scroeLabel),this.boxImg=GObj.create(t.ImageOutside),this.boxImg.x=20,this.boxImg.y=330,this.boxImg.setOutSrc("boxitem"),this.addChild(this.boxImg),this.floorText=GObj.create(eui.Label),this.floorText.size=18,this.floorText.y=410,this.floorText.x=56,this.floorText.stroke=1,this.floorText.strokeColor=0,this.floorText.textColor=16777215,this.addChild(this.floorText),this.timeImg=GObj.create(t.ImageOutside),this.timeImg.x=430,this.timeImg.y=150,this.timeImg.setOutSrc("timeBg"),this.addChild(this.timeImg),this.timeLab=GObj.create(eui.Label),this.timeLab.size=25,this.timeLab.x=440,this.timeLab.y=150,this.timeLab.width=100,this.timeLab.textAlign=egret.HorizontalAlign.CENTER,this.addChild(this.timeLab),this.progressGroup=GObj.create(eui.Group),this.progressGroup.y=180,this.progressGroup.x=480,this.addChild(this.progressGroup),this.progressBg=GObj.create(t.ImageOutside),this.progress=GObj.create(t.ImageOutside),this.progressTextBg=GObj.create(t.ImageOutside),this.hitText=GObj.create(eui.Label),this.progressBg.horizontalCenter=0,this.progressBg.verticalCenter=0,this.progressBg.fillMode="repeat",this.progressBg.loadCompleteCall(function(){i.progressGroup.height=i.progressBg.height,i.progress.y=i.progressGroup.height,i.progressTextBg.y=i.progress.y-10},this),this.progressBg.setOutSrc("progressbg",FileConst.png),this.progressGroup.addChild(this.progressBg),this.progress.horizontalCenter=0,this.progress.rotation=180,this.progress.fillMode="repeat",this.progress.height=0,this.progress.setOutSrc("progress",FileConst.png),this.progressGroup.addChild(this.progress),this.progressTextBg.horizontalCenter=0,this.progressTextBg.loadCompleteCall(function(){i.progressGroup.width=i.progressTextBg.width},this),this.progressTextBg.setOutSrc("progressText",FileConst.png),this.progressGroup.addChild(this.progressTextBg),this.hitText.textColor=14483432,this.hitText.stroke=1,this.hitText.textColor=14483432,this.hitText.horizontalCenter=0,this.progressGroup.addChild(this.hitText),this.prefectWrok=GObj.create(t.IMovie),this.addChild(this.prefectWrok),this.fireWrok=GObj.create(t.IMovie),this.addChild(this.fireWrok),this.markLabel=GObj.create(eui.Label),this.markLabel.textColor=261897,this.markLabel.stroke=1,this.markLabel.strokeColor=10505,this.markLabel.size=30,this.addChild(this.markLabel),this.addEvent()}},e.prototype.initOnce=function(){this.bgArr=[],this.boxArr=[],this.boxPool=[],this.broadArr=[],this.broadPool=[],this.hpBrr=[]},e.prototype.update=function(){this.isRunning&&(this.boxFun(),this.mapMove(),this.broadRun(),this.progressUpdate(),this.boxWobbleRun())},e.prototype.initEvery=function(){if(this.allScore=this.perfectNumber=0,this.updateHit(this.perfectNumber),this.updateScore(0),this.isNeedPic=!1,this.isRunning=!0,this.isRight=!1,this.isCanClick=!0,this.isCanWobble=!1,this.floorsNum=1,this.markLabel.visible=!1,this.updatefloor(),this.updateTarget(),this.box_frame=t.IMiniGame20Consts.box_frame,this.loopNumber=t.IMiniGame20Consts.loopNumer,this.playerHp=this.data.playerHp||2,this.startime=this.data.gameTime||60,this.wobbleFloor=this.data.wobbleFloor||6,this.updateTime(this.startime),this.progressTime=0,this.updateWidth(0),this.boxScroeN=this.data.normalScore||100,this.group.rotation=t.IMiniGame20Consts.swingAngle,this.point1||(this.point1=GObj.create(egret.Point)),this.tempRefer&&(this.tempRefer.parent&&this.tempRefer.parent.removeChild(this.tempRefer),this.backBox(this.tempRefer),this.tempRefer=null),this.hpBrr&&0!=this.hpBrr.length)for(var i=0,e=this.hpBrr;i<e.length;i++){var s=e[i];GObj.disposeObject(s)}this.hpBrr=[];for(var h,a=0;a<this.playerHp;a++)h=GObj.create(t.ImageOutside),h.setOutSrc("hp",FileConst.png),h.x=5+15*a,h.y=200,this.addChild(h),this.hpBrr.push(h)},e.prototype.addEvent=function(){this.uiGroup.addEventListener(egret.TouchEvent.TOUCH_TAP,this.boxRun,this),EnterFrameManager.instance.registeRender(this.update,this),DispatcherManager.addListener(HGEvent.HEARTBEAT,this.timeFun,this)},e.prototype.removeEvent=function(){EnterFrameManager.instance.unRegisteRender(this.update,this),DispatcherManager.removeListener(HGEvent.HEARTBEAT,this.timeFun,this)},e.prototype.setData=function(t){t&&(this.data=t,this.initSkins(),this.mapO={},this.loadBgImage(0))},e.prototype.chassis=function(){var t=this,i=this.getBox();this.boxArr.push(i),i.setoutSrc("chassis",function(){i.anchorOffsetX=i.width/2,i.x=t.uiGroup.width/2,i.y=t.bgArr[0].y+790-i.height,t.isRunning=!1,t.updataView()},this),this.uiGroup.addChild(i)},e.prototype.loadBgImage=function(t){var i=this;if(t>=this.bgArr.length)return void this.chassis();var e=this.bgArr[t];if(0==t)e.loadCompleteCall(function(){e.y=StageManager.stageHeight-e.height,e.height==i.height&&i.juageBroad(e.y-e.height/2),e.y<0&&(e.y=0),i.loadBgImage(t+1)},this),this.addMap(t+1),e.setOutSrc("bg1",FileConst.jpg);else{var s=t+1;e.loadCompleteCall(function(){e.y=i.bgArr[t-1].y-e.height,e.height==i.height&&i.juageBroad(e.y-e.height/2),i.loadBgImage(t+1)},this),this.addMap(s),e.setOutSrc("bg"+s,FileConst.jpg)}},e.prototype.addMap=function(t){this.mapO.hasOwnProperty(t+"")||(this.mapO[t+""]=!0)},e.prototype.updataView=function(){this.initEvery(),this.swing(),this.addGroup()},e.prototype.swing=function(){var i=this,e=100*t.IMiniGame20Consts.swingAngle;egret.Tween.get(this.group,{loop:!0}).to({rotation:-t.IMiniGame20Consts.swingAngle},e,egret.Ease.cubicInOut).call(function(){i.isRight=!0},this).to({rotation:t.IMiniGame20Consts.swingAngle},e,egret.Ease.cubicInOut).call(function(){i.isRight=!1},this)},e.prototype.getBox=function(){var i=this.boxPool.pop();return i||(i=GObj.create(t.IMiniGame20Image)),i},e.prototype.backBox=function(t){t&&-1==this.boxPool.indexOf(t)&&(t.scaleX=t.scaleY=1,t.reset(),t.parent&&t.parent.removeChild(t),this.boxPool.push(t))},e.prototype.getBroad=function(){var i=this.broadArr.pop();return i||(i=GObj.create(t.IMiniGame20Broadcast)),i},e.prototype.backBroad=function(t){t&&-1==this.broadPool.indexOf(t)&&(t.reset(),t.parent&&t.parent.removeChild(t),this.broadPool.push(t))},e.prototype.updateTarget=function(){var t=this.data.levelsN||20;this.targetLab.text="目标:x"+t},e.prototype.updateScore=function(t){this.allScore=this.allScore+t,this.scroeLabel.text="分数:x"+this.allScore},e.prototype.showMarkLabel=function(t){var i=this;this.tempRefer&&(this.markLabel.text="+"+t,this.tempRefer.x>=StageManager.stageWidthHalf?this.markLabel.x=this.tempRefer.x-this.tempRefer.width/2-this.markLabel.width-15:this.markLabel.x=this.tempRefer.x+this.tempRefer.width/2+15,this.markLabel.y=this.tempRefer.y-this.markLabel.height/2+this.tempRefer.height/2,this.markLabel.alpha=1,this.markLabel.visible=!0,egret.Tween.removeTweens(this.markLabel),egret.Tween.get(this.markLabel).to({y:this.markLabel.y-20},1e3).to({alpha:0},300).call(function(){i.markLabel.visible=!1},this))},e.prototype.updatefloor=function(){this.floorText.text="x"+(this.floorsNum-1)},e.prototype.updateTime=function(t){this.timeLab.text=this.getTime()},e.prototype.updateHit=function(t){this.hitText.text="x"+t,this.hitText.y=this.progressTextBg.y+(this.progressTextBg.height-this.hitText.height)/2},e.prototype.getTime=function(){var t=Math.floor(this.startime/60);t=t>=10?t:"0"+t;var i=this.startime%60;return i=i>=10?i:"0"+i,t+":"+i||""},e.prototype.updateWidth=function(t){this.progress.height=t},e.prototype.addGroup=function(){var i=this;if(!this.tempRefer){this.tempRefer=this.getBox(),this.rope_1.visible=this.rope_2.visible=!0,this.tempRefer.setFun(function(){i.tempRefer.anchorOffsetX=i.tempRefer.width/2,i.tempRefer.x=i.group.width/2+5,i.tempRefer.parent||i.group.addChildAt(i.tempRefer,0)},this);var e;e=this.data.props[this.floorsNum],e?this.tempRefer.setType(e):(e={},e.propModel=this.data.boxModel,e.propType=prop20Type.TYPE_1,this.tempRefer.setType(e));var s;s=void 0!=e.boxOffsetY?e.boxOffsetY:t.IMiniGame20Consts.boxOffsetY,this.tempRefer.y=this.rope_1.y+this.rope_1.anchorOffsetY+s}},e.prototype.boxRun=function(){if(this.isCanClick&&this.tempRefer&&!this.isBoxRun){this.isCanClick=!1,this.rope_1.visible=this.rope_2.visible=!1,this.angle_Box=Math.abs(this.group.rotation);var i=(t.IMiniGame20Consts.swingAngle-this.angle_Box)/t.IMiniGame20Consts.swingAngle;this.horizontal_number=t.IMiniGame20Consts.horizontalDis*i,this.horizontal_number=this.isRight?-this.horizontal_number:this.horizontal_number;var e=this.tempRefer.width*this.tempRefer.height;this.vertical_number=t.IMiniGame20Consts.verticalDis*e/1e4,this.horizontal_number=Number(this.horizontal_number.toFixed(2)),this.vertical_number=Number(this.vertical_number.toFixed(2)),this.tempRefer.parent&&(this.tempRefer.parent.localToGlobal(this.tempRefer.x,this.tempRefer.y,this.point1),this.tempRefer.parent.removeChild(this.tempRefer),this.uiGroup.addChild(this.tempRefer),this.tempRefer.x=this.point1.x,this.tempRefer.y=this.point1.y,this.sceneNumber=Math.round((this.tempRefer.height-t.IMiniGame20Consts.overlapPixels)/t.IMiniGame20Consts.mapMoveFrame),this.isBoxRun=!0,this.isOverlap=!0,this.moveFrame=0)}},e.prototype.boxFun=function(){if(this.isBoxRun&&this.boxArr){var i;if(0==this.boxArr.length)i=this.tempRefer.y+this.vertical_number,this.tempRefer.x=this.tempRefer.x+this.horizontal_number,i>=900-this.tempRefer.height?(this.tempRefer.y=900-this.tempRefer.height,this.boxArr.push(this.tempRefer),this.runOver()):this.tempRefer.y=i;else{var e=this.boxArr.length,s=this.boxArr[e-1];if(i=this.tempRefer.y+this.vertical_number,this.tempRefer.x=this.tempRefer.x+this.horizontal_number,this.isOverlap&&i+this.tempRefer.height>=s.y+t.IMiniGame20Consts.overlapPixels){var h=this.tempRefer.x-s.x;if(h>0?this.isWobbleRight=!0:this.isWobbleRight=!1,h=Math.abs(h),h<s.width/2){this.isBoxRun=!1,this.floorsNum++,this.updatefloor(),this.updateLoopNumber(),this.juageWobble(h,s.width/2),this.tempRefer.y=s.y-this.tempRefer.height+t.IMiniGame20Consts.overlapPixels,this.boxArr.push(this.tempRefer);var a=void 0;if(h<s.width/2*t.IMiniGame20Consts.perfectFactor){this.progressTime=t.IMiniGame20Consts.crazyTime||10,this.updateWidth(this.progressBg.height),this.perfectNumber++,this.updateHit(this.perfectNumber);var n=this.data.perfectPro*this.perfectNumber;n>=this.data.maxPerfectPro&&(n=this.data.maxPerfectPro),a=this.boxScroeN+Math.ceil(this.boxScroeN*n/100),this.tempRefer.x=s.x,this.tempRefer.filters=[t.IMiniGame20Consts.flashFilter],this.playPrefect(),this.shake()}else a=this.boxScroeN,this.shake();this.tempRefer.getType()==prop20Type.TYPE_2&&(a=2*a),this.showMarkLabel(a),this.updateScore(a),this.tempRefer.getType()==prop20Type.TYPE_3&&(this.playerHp++,this.updateHpImg(1))}else{this.playerHp--,this.updateHpImg(-1),this.isOverlap=!1;var o=t.IMiniGame20Consts.horizontalArr||[3,5],r=GMath.randomInt(o[0],o[1]);egret.Tween.get(this).to({x:this.x-r,y:this.y-r},20).to({x:this.x+r,y:this.y+r},40).to({x:this.x,y:this.y},20)}}else this.tempRefer.y=i,!this.isOverlap&&this.tempRefer.y>StageManager.stageHeight&&(this.playerHp<1?this.setResult(!1):this.runOver())}}},e.prototype.updateHpImg=function(i){if(0>i)this.hpBrr[this.playerHp].filters=[t.IMiniGame20Consts.grayFilter];else if(this.playerHp>this.hpBrr.length){var e=GObj.create(t.ImageOutside);e.setOutSrc("hp",FileConst.png),e.y=this.hpBrr[0].y,e.x=this.hpBrr[this.hpBrr.length-1].x+15,this.addChild(e),this.hpBrr.push(e)}else this.hpBrr[this.playerHp-1].filters=null},e.prototype.updateLoopNumber=function(){if(this.data.floorId&&this.data.pictureId&&!this.isNeedPic){for(var t,i=this.data.floorId,e=this.data.pictureId,s=0;s<i.length;s++)if(this.floorsNum<i[s]){t=0>s-1?e[0]:e[s-1];break}void 0!=t&&t!=this.loopNumber&&(this.isNeedPic=!0,this.loopNumber=t)}},e.prototype.shake=function(){var i=this;if(this.tempRefer){this.tempRefer.scaleX=this.tempRefer.scaleY=1;var e=t.IMiniGame20Consts.boxScalxyArr;egret.Tween.get(this.tempRefer).to({scaleX:e[0],scaleY:e[1]},100).to({scaleX:1,scaleY:1},100).call(function(){i.isMapMove=!0,i.tempRefer.filters=null},this)}},e.prototype.overlopSuccess=function(){this.runOver(),this.boxArr[this.boxArr.length-1].isRun=!0,this.floorsNum>=this.wobbleFloor&&(this.box_frame=t.IMiniGame20Consts.box_frame,this.isCanWobble=!0,this.setX(!0)),this.isMapMove=!1;var i=this.data.levelsN||20;this.floorsNum-1>=i&&(this.playFire(),this.setResult(!0))},e.prototype.progressUpdate=function(){if(this.progress.height>0){var i=this.progressBg.height/t.IMiniGame20Consts.crazyTime/IMiniGameMain.sysFrame();this.updateWidth(this.progress.height-i)}},e.prototype.juageBroad=function(t){if(this.data.broadcast){this.mapNumeber++;var i=this.data.broadcast[this.mapNumeber];if(i){var e=this.getBroad();e.y=t,e.setData(i),this.uiGroup2.addChild(e),this.broadArr.push(e)}}},e.prototype.broadRun=function(){if(this.broadArr||0==this.broadArr.length)for(var t,i=0;i<this.broadArr.length;i++)t=this.broadArr[i],t.isCanRun&&(-1!=t.type.indexOf(broad20Type.TYPE_2)?t.x=t.x+t.speed:-1!=t.type.indexOf(broad20Type.TYPE_3)?t.x=t.x-t.speed:-1!=t.type.indexOf(broad20Type.TYPE_5)&&(t.y=t.y-t.speed))},e.prototype.mapMove=function(){if(this.tempRefer&&this.isMapMove){for(var i,e,s,h=0;h<this.bgArr.length;h++)if(i=this.bgArr[h],i.y>StageManager.stageHeight){i.y=3*-this.height;var a=void 0;this.isNeedPic?(a=this.loopNumber-1,this.isNeedPic=!1):a=this.loopNumber,this.mapO.hasOwnProperty(a+"")?(i.loadCompleteCall(this.changeBgY,this,i),i.setOutSrc("bg"+a,FileConst.jpg),this.changeBgY(i,!0)):(i.loadCompleteCall(this.changeBgY,this,i),i.setOutSrc("bg"+a,FileConst.jpg))}else i.y=i.y+this.sceneNumber;for(var n=0;n<this.boxArr.length;n++)e=this.boxArr[n],e.y=e.y+this.sceneNumber,e.y>StageManager.stageHeight&&(this.backBox(e),this.boxArr.splice(n,1),n--);for(var o=StageManager.stageHeight<=this.uiGroup2.height?0:-(StageManager.stageHeight-this.uiGroup2.height),r=0;r<this.broadArr.length;r++)s=this.broadArr[r],s.y=s.y+this.sceneNumber,s.y>StageManager.stageHeight||s.x<-s.width||s.x>StageManager.stageWidth?(this.backBroad(s),this.broadArr.splice(r,1),r--):s.y+s.height>o&&s.run();++this.moveFrame>=t.IMiniGame20Consts.mapMoveFrame&&this.overlopSuccess()}},e.prototype.changeBgY=function(t,i){if(t){var e=this.bgArr.indexOf(t)-1;0>e&&(e=this.bgArr.length-1),t.y=this.bgArr[e].y-t.height,i&&e==this.bgArr.length-1&&(t.y=t.y+this.sceneNumber),t.height==this.height&&this.juageBroad(t.y-t.height/2)}},e.prototype.setResult=function(i){if(this.isRunning=!1,i){t.IMiniGame12Consts.extraNum=this.allScore,IMiniGameMain.reqSocket(3);var e=this.parent;e&&t.IMiniGameResult.showResult(IMiniGameResultType.type_1,e.outCloseClick,e)}else t.IMiniGameResult.showResult(IMiniGameResultType.type_0,this.updateView,this)},e.prototype.timeFun=function(){this.isRunning&&(--this.startime<0&&this.setResult(!1),this.updateTime(this.startime),this.progressTime>0&&(this.progressTime--,this.progressTime<1&&(this.perfectNumber=0,this.updateHit(this.perfectNumber))))},e.prototype.updateView=function(){this.removeStageFun(),this.mapO={},this.mapNumeber=0,this.loadBgImage(0)},e.prototype.runOver=function(){this.isBoxRun=!1,this.tempRefer=null,this.isCanClick=!0,this.addGroup()},e.prototype.removeStageFun=function(){this.clearTween(),this.resetValue(),this.cleanArr()},e.prototype.resetValue=function(){this.isRunning=!1,this.isMapMove=!1,this.isBoxRun=!1,this.isCanWobble=!1,this.isCanClick=!0,this.backBox(this.tempRefer),this.tempRefer=null,this.isNeedPic=!1},e.prototype.juageWobble=function(i,e){if(this.floorsNum<this.wobbleFloor)return void(this.isCanWobble=!1);var s=.05*(this.floorsNum-this.wobbleFloor)*t.IMiniGame20Consts.max_x*.5;s>.5*t.IMiniGame20Consts.max_x&&(s=.5*t.IMiniGame20Consts.max_x);var h=t.IMiniGame20Consts.max_x*i/e*.5;h>.5*t.IMiniGame20Consts.max_x&&(h=.5*t.IMiniGame20Consts.max_x),this.sum_x=Math.round(s+h)},e.prototype.setX=function(t){var i,e,s=this.boxArr.length;e=this.isWobbleRight?this.sum_x:-this.sum_x;for(var h=0;s>h;h++)i=this.boxArr[h],t?i.targetX=i.x+e:i.targetX=i.x+2*e},e.prototype.boxWobbleRun=function(){if(this.isCanWobble&&this.boxArr&&!(this.box_frame-->0)){this.box_frame=t.IMiniGame20Consts.box_frame;var i,e,s=this.boxArr.length,h=!1;e=this.isWobbleRight?t.IMiniGame20Consts.frame_x:-t.IMiniGame20Consts.frame_x;for(var a=0;s>a;a++)i=this.boxArr[a],i.isRun&&(i.x=i.x+e,e>0?i.x>=i.targetX&&(i.x=i.targetX,h=!0):i.x<=i.targetX&&(i.x=i.targetX,h=!0));h&&(this.isWobbleRight=!this.isWobbleRight,this.setX(!1))}},e.prototype.playPrefect=function(){this.tempRefer&&(this.prefectWrok.x=this.tempRefer.x,this.prefectWrok.y=this.tempRefer.y-70,this.prefectWrok.autoRun(),this.prefectWrok.start(t.IMiniGame20Consts.ui_wanmei,1))},e.prototype.playFire=function(){this.fireWrok.x=StageManager.stageWidthHalf,this.fireWrok.y=300,this.fireWrok.autoRun(),this.fireWrok.start(t.IMiniGame20Consts.ui_yanhua,1)},e.prototype.clearTween=function(){this.group&&egret.Tween.removeTweens(this.group),this.tempRefer&&egret.Tween.removeTweens(this.tempRefer)},e.prototype.cleanArr=function(){for(var t=0,i=this.boxArr;t<i.length;t++){var e=i[t];this.backBox(e)}this.boxArr=[]},e.prototype.dispose=function(){this.removeEvent();for(var t=0,i=this.bgArr;t<i.length;t++){var e=i[t];GObj.disposeObject(e)}this.bgArr=null,GObj.disposeObject(this.lineImg),this.lineImg=null},e}(egret.DisplayObjectContainer);t.IMiniGame20Scene=i,__reflect(i.prototype,"miniGame.IMiniGame20Scene")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){return i.call(this)||this}return __extends(e,i),e.prototype.addEvent=function(){this.exitBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCloseClick,this)},e.prototype.removeEvent=function(){this.exitBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onCloseClick,this)},e.prototype.initSkins=function(){this.isInit||(this.isInit=!0,this.horizontalCenter=0,this.verticalCenter=0,this.width=540,this.height=960,this.gameScene=GObj.create(t.IMiniGame20Scene),this.addChild(this.gameScene),this.exitBtn=GObj.create(t.IBaseBtn),this.exitBtn.icon=IMiniGameMain.getIcon("exit_btn",FileConst.png,"chapter"),this.exitBtn.right=20,this.exitBtn.top=20,this.addChild(this.exitBtn),this.addEvent())},e.prototype.setData=function(i){this.initSkins(),this.gameScene.setData(i),IMiniGameMain.playBgm(t.IMiniGame18Consts.minigame_bgm)},e.prototype.hideExitBtn=function(){this.exitBtn.visible=!1},e.prototype.showExitBtn=function(){this.exitBtn.visible=!0},e.prototype.onCloseClick=function(){this.gameScene.removeStageFun(),i.prototype.onCloseClick.call(this)},e.prototype.dispose=function(){this.removeEvent(),GObj.disposeObject(this.gameScene),this.gameScene=null,GObj.disposeObject(this.exitBtn),this.exitBtn=null,i.prototype.dispose.call(this)},e}(t.IBaseView);t.IMiniGame20View=i,__reflect(i.prototype,"miniGame.IMiniGame20View")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(t){return i.call(this,t)||this}return __extends(e,i),e.prototype.getGameView=function(){return this.gameView||(this.gameView=GObj.create(t.IMiniGame21View)),this.gameView.setData(this.gameData.funny,this.gameData),this.gameView},e.prototype.loadConfigComplete=function(e){if(e)for(var s in e.config)t.IMiniGame21Consts[s]=e.config[s];i.prototype.loadConfigComplete.call(this,e)},e.prototype.getMiniGameView=function(){if(!this.configData)return null;if(this.gameData&&this.gameData.funny){var t=this.gameData.funny.bagList[0];if(t&&2==t.status)return App.msgtip.show(IMiniGameLanguage.c_8),null}return this.gameView||this.getGameView(),this.gameView},e}(t.IMiniGameBaseCtr);t.IMiniGame21=i,__reflect(i.prototype,"miniGame.IMiniGame21")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function s(){var t=i.call(this)||this;return t.imgFinish=!1,t.effFinish=!1,t}return __extends(s,i),s.prototype.initSkins=function(){this.isInit||(this.index=1,this.chapterIndex=1,this.nextTime=3,this.width=540,this.height=960,this.scro=GObj.create(eui.Scroller),this.addChild(this.scro),this.group=GObj.create(eui.Group),this.scro.viewport=this.group,this.effGroup=GObj.create(eui.Group),this.effGroup.width=this.width,this.effGroup.height=this.height,this.addChild(this.effGroup),this.bgRect=GObj.create(eui.Rect),this.bgRect.alpha=.01,this.bgRect.width=this.width,this.bgRect.height=this.height,this.addChild(this.bgRect),this.descLab=GObj.create(eui.Label),this.descLab.horizontalCenter=0,this.descLab.bottom=10,this.descLab.text=IMiniGameMain.getString(t.IMiniGame21Consts.lang[3]),this.descLab.size=18,this.descLab.textColor=16777215,this.addChild(this.descLab),this.setLayout(),this.cartoon=t.IMiniGame21Consts.cartoon,this.addEvent(),this.isInit=!0)},s.prototype.setLayout=function(){this.scro.horizontalCenter=0,this.scro.y=0,this.scro.width=this.width,this.scro.height=this.height},s.prototype.addEvent=function(){this.bgRect.addEventListener(egret.TouchEvent.TOUCH_TAP,this.__nextClick,this),DispatcherManager.addListener(HGEvent.HEARTBEAT,this.nextBtnTime,this)},s.prototype.removeEvent=function(){this.bgRect&&this.bgRect.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.__nextClick,this),DispatcherManager.removeListener(HGEvent.HEARTBEAT,this.nextBtnTime,this)},s.prototype.initView=function(){this.initSkins(),this.effArr=[],this.cartoonVo=this.cartoon[this.chapterIndex];var i=this.cartoonVo[this.index];if(i.isEff&&i.isFirst){for(var e=0;e<i.eff.length;e++){var s=t.IMiniGameMgr.ins.getPoolByClass(t.IMovieMore);s.start(i.eff[e][0],1e4),s.autoRun(),s.x=i.eff[e][1],s.y=i.eff[e][2],this.effGroup.addChild(s),t.IMiniGameMgr.ins.pushSceneInByObject(s),this.effArr.push(s),e==i.eff.length-1&&(s.setCompleteBack(this.firstStart,this),this.canTouch=!1)}this.effFinish=this.imgFinish=!0}else this.start()},s.prototype.firstStart=function(){this.start(),this.effArr[this.effArr.length-1].setCompleteBack(null,this)},s.prototype.start=function(){this.canTouch=!0,this.cartoonVo=this.cartoon[this.chapterIndex];for(var i in this.cartoonVo){var e=t.IMiniGameMgr.ins.getPoolByClass(t.ImageOutside),s=this.cartoonVo[i];switch(s.direction){case DirectionType.LTR:if(e.x=-541,e.y=s.y,e.setOutSrc("cartoon/"+s.img,FileConst.jpg),this.group.addChild(e),t.IMiniGameMgr.ins.pushSceneInByObject(e),1==parseInt(i)&&(1==this.chapterIndex||!s.isFirst)){egret.Tween.get(e).to({x:0},800,egret.Ease.bounceOut);break}break;case DirectionType.RTL:if(e.x=541,e.y=s.y,e.setOutSrc("cartoon/"+s.img,FileConst.jpg),this.group.addChild(e),t.IMiniGameMgr.ins.pushSceneInByObject(e),1==parseInt(i)&&(1==this.chapterIndex||!s.isFirst)){egret.Tween.get(e).to({x:0},800,egret.Ease.bounceOut);break}break;case DirectionType.ALPHA:if(e.x=0,e.y=s.y,e.alpha=0,e.setOutSrc("cartoon/"+s.img,FileConst.jpg),this.group.addChild(e),t.IMiniGameMgr.ins.pushSceneInByObject(e),1==parseInt(i)&&(1==this.chapterIndex||!s.isFirst)){egret.Tween.get(e).to({alpha:1},500);break}}}},s.prototype.nextBtnTime=function(){this.nextTime--<=1&&this.__nextClick()},s.prototype.__nextClick=function(){if(this.canTouch&&this.cartoonVo[this.index]){this.nextTime=3;var i=this.cartoonVo[this.index];if(!i.isEff||this.effFinish&&this.imgFinish){if(!this.imgFinish)return void this.next();if(this.index++,this.effFinish=this.imgFinish=!1,this.index>Object.keys(this.cartoonVo).length){if(this.chapterIndex++,this.chapterIndex>Object.keys(this.cartoon).length-1){if(t.IMiniGame21Consts.onlyCartoon){var s=function(){IMiniGameMain.reqSocket(3),DispatcherManager.dispatch(IMiniGameEvent.IMiniGameExit),DispatcherManager.dispatch(IMiniGameEvent.IMiniGameChapterExit),DispatcherManager.dispatch(IMiniGameEvent.IMiniCloseTools)},h={callfun:s,caller:this},a=GObj.create(e,h);IMiniGameMain.addToStage(a)}else{var a=this.parent;a.cutTo(2),this.group.removeChildren(),this.effGroup.removeChildren(),this.effArr=[],DispatcherManager.removeListener(HGEvent.HEARTBEAT,this.nextBtnTime,this)}return}if(this.chapterIndex>Object.keys(this.cartoon).length)return;this.index=1,this.group.removeChildren(),this.effGroup.removeChildren(),this.start(),this.effArr=[]}this.__nextClick()}else if(i.isFirst&&!this.effFinish){for(var n=0;n<i.eff.length;n++){var o=t.IMiniGameMgr.ins.getPoolByClass(t.IMovieMore);o.start(i.eff[n][0],1e4),o.autoRun(),o.x=i.eff[n][1],o.y=i.eff[n][2],this.effGroup.addChild(o),t.IMiniGameMgr.ins.pushSceneInByObject(o),this.effArr.push(o)}this.effFinish=!0}else if(i.isFirst&&!this.imgFinish)this.next();else if(i.isFirst||this.imgFinish){if(!i.isFirst&&!this.effFinish){for(var n=0;n<i.eff.length;n++){var o=t.IMiniGameMgr.ins.getPoolByClass(t.IMovieMore);o.start(i.eff[n][0],1e4),o.autoRun(),o.x=i.eff[n][1],o.y=i.eff[n][2],this.effGroup.addChild(o),t.IMiniGameMgr.ins.pushSceneInByObject(o),this.effArr.push(o)}this.effFinish=!0}}else this.next()}},s.prototype.next=function(){var t=this.cartoonVo[this.index],i=this.group.$children[this.index-1];switch(t.direction){case DirectionType.LTR:egret.Tween.get(i).to({x:0},800,egret.Ease.bounceOut);break;case DirectionType.RTL:egret.Tween.get(i).to({x:0},800,egret.Ease.bounceOut);break;case DirectionType.ALPHA:egret.Tween.get(i).to({alpha:1},500)}this.imgFinish=!0},s.prototype.dispose=function(){this.removeEvent(),this.isInit=!1,GObj.disposeObject(this.scro),this.scro=null,GObj.disposeObject(this.group),this.group=null,GObj.disposeObject(this.effGroup),this.effGroup=null,GObj.disposeObject(this.bgRect),this.bgRect=null,GObj.disposeObject(this.descLab),this.descLab=null},s}(eui.Component);t.IMiniGame21Cartoon=i,__reflect(i.prototype,"miniGame.IMiniGame21Cartoon");var e=function(i){function e(t){var e=i.call(this)||this;return e.exact=!0,e.initSkin(t),e}return __extends(e,i),e.prototype.initSkin=function(i){var e=this;this.horizontalCenter=this.verticalCenter=0,this.width=StageManager.stageWidth,this.height=StageManager.stageHeight,this.bgRect=GObj.create(eui.Rect),this.bgRect.width=this.width,this.bgRect.height=this.height,this.bgRect.alpha=0,this.addChild(this.bgRect),this.cartoon=GObj.create(t.ImageOutside);var s=Object.keys(t.IMiniGame21Consts.cartoon).length,h=t.IMiniGame21Consts.cartoon[s][1].img;this.cartoon.setOutSrc("cartoon/"+h,FileConst.png),this.cartoon.horizontalCenter=0,this.cartoon.verticalCenter=0,this.cartoon.alpha=0,this.addChild(this.cartoon),egret.Tween.get(this.bgRect).to({alpha:1},1e3).call(function(){i&&i.callfun&&i.caller&&i.callfun.call(i.caller),egret.Tween.get(e.cartoon).to({alpha:1},1e3).wait(500).call(function(){egret.Tween.get(e.bgRect).to({alpha:0},2e3).call(function(){e.parent&&e.parent.removeChild(e),GObj.disposeObject(e)
}),egret.Tween.get(e.cartoon).to({alpha:0},1e3)})})},e.prototype.dispose=function(){egret.Tween.removeTweens(this),GObj.disposeObject(this.bgRect),this.bgRect=null,GObj.disposeObject(this.cartoon),this.cartoon=null},e}(eui.Component);t.IMiniGame21End=e,__reflect(e.prototype,"miniGame.IMiniGame21End")}(miniGame||(miniGame={}));var miniGame;!function(t){t.IMiniGame21Consts={cartoon:{},dialogue:{},fight:{},lang:{},bullet:{},skill:{},frame:6,bulletTime:300,waitTime:3e3,closeTime:1e3,onlyCartoon:!0,num22:"num22",num23:"num23",UI_SHENGLI:"ui_shengli",UI_SHIBAI:"ui_shibai",DAYUN2:"dayun2",plotIndex:0,chapter:1,minigame_bgm1:"game21_minigame_bgm1",minigame_bgm2:"game21_minigame_bgm2",minigame_win:"game21_minigame_win",minigame_lose:"game21_minigame_lose"}}(miniGame||(miniGame={}));var DirectionType;!function(t){t[t.LTR=1]="LTR",t[t.RTL=2]="RTL",t[t.ALPHA=3]="ALPHA"}(DirectionType||(DirectionType={}));var PosType;!function(t){t[t.LEFT=1]="LEFT",t[t.RIGHT=2]="RIGHT"}(PosType||(PosType={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.frame=6,t.wordIndex=0,t}return __extends(e,i),e.prototype.initSkins=function(){this.isInit||(this.width=540,this.height=960,this.bg=GObj.create(t.ImageOutside),this.addChild(this.bg),this.dialogueGroup=GObj.create(eui.Group),this.dialogueGroup.width=540,this.dialogueGroup.height=960,this.addChild(this.dialogueGroup),this.img=GObj.create(t.ImageOutside),this.img.y=350,this.dialogueGroup.addChild(this.img),this.chatBg=GObj.create(t.ImageOutside),this.chatBg.y=548,this.chatBg.horizontalCenter=0,this.chatBg.setOutSrc("chatBg"),this.chatBg.scale9Grid=new egret.Rectangle(15,15,30,30),this.chatBg.width=490,this.chatBg.height=126,this.dialogueGroup.addChild(this.chatBg),this.nameBg=GObj.create(t.ImageOutside),this.nameBg.y=526,this.dialogueGroup.addChild(this.nameBg),this.nameLab=GObj.create(eui.Label),this.nameLab.size=20,this.nameLab.y=535,this.nameLab.textColor=16775405,this.dialogueGroup.addChild(this.nameLab),this.dialogueLab=GObj.create(eui.Label),this.dialogueLab.x=65,this.dialogueLab.y=580,this.dialogueLab.width=430,this.dialogueLab.size=18,this.dialogueLab.lineSpacing=4,this.dialogueLab.textColor=1453901,this.dialogueGroup.addChild(this.dialogueLab),this.bgRect=GObj.create(eui.Rect),this.bgRect.alpha=.01,this.bgRect.width=this.width,this.bgRect.height=this.height,this.addChild(this.bgRect),this.chapterGroup=GObj.create(eui.Group),this.chapterGroup.horizontalCenter=0,this.chapterGroup.verticalCenter=0,this.chapterGroup.width=0,this.addChild(this.chapterGroup),this.chapterBg=GObj.create(t.ImageOutside),this.chapterBg.right=0,this.chapterBg.left=0,this.chapterBg.setOutSrc("scrollBg"),this.chapterGroup.addChild(this.chapterBg),this.leftScroll=GObj.create(t.ImageOutside),this.leftScroll.setOutSrc("scroll"),this.leftScroll.left=0,this.leftScroll.y=-28,this.chapterGroup.addChild(this.leftScroll),this.rightScroll=GObj.create(t.ImageOutside),this.rightScroll.setOutSrc("scroll"),this.rightScroll.right=0,this.rightScroll.y=-28,this.chapterGroup.addChild(this.rightScroll),this.chapterTitle=GObj.create(eui.Label),this.chapterTitle.y=24,this.chapterTitle.horizontalCenter=0,this.chapterTitle.size=22,this.chapterTitle.textColor=1776411,this.chapterTitle.alpha=0,this.chapterGroup.addChild(this.chapterTitle),this.chapterLab=GObj.create(eui.Label),this.chapterLab.width=300,this.chapterLab.horizontalCenter=0,this.chapterLab.verticalCenter=-20,this.chapterLab.lineSpacing=5,this.chapterLab.size=18,this.chapterLab.textColor=1776411,this.chapterLab.textAlign=egret.HorizontalAlign.CENTER,this.chapterLab.alpha=0,this.chapterGroup.addChild(this.chapterLab),this.startBtn=GObj.create(t.IMiniGame21Btn),this.startBtn.horizontalCenter=0,this.startBtn.y=167,this.startBtn.icon=IMiniGameMain.getIcon("btn_1",FileConst.png),this.startBtn.labelDisplay.textColor=9655570,this.startBtn.alpha=0,this.chapterGroup.addChild(this.startBtn),this.nextBtn=GObj.create(t.IMiniGame21Btn),this.nextBtn.x=384,this.nextBtn.y=690,this.nextBtn.icon=IMiniGameMain.getIcon("btn_1",FileConst.png),this.nextBtn.labelDisplay.textColor=9655570,this.nextBtn.visible=!1,this.addChild(this.nextBtn),this.isInit=!0,this.addEvent())},e.prototype.addEvent=function(){this.bgRect.addEventListener(egret.TouchEvent.TOUCH_TAP,this.overPlay,this),this.startBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.__startClick,this),this.nextBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.changeDialogue,this)},e.prototype.removeEvent=function(){this.bgRect&&this.bgRect.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.overPlay,this),this.startBtn&&this.startBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.__startClick,this),this.nextBtn&&this.nextBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.changeDialogue,this),DispatcherManager.removeListener(HGEvent.HEARTBEAT,this.nextBtnTime,this),DispatcherManager.removeListener(HGEvent.HEARTBEAT,this.startBtnTime,this),EnterFrameManager.instance.unRegisteRender(this.wordPlay,this)},e.prototype.initView=function(i){this.initSkins(),this.isFight=!1,this.chapterIndex=i,this.startTime=3,this.dialogueData=t.IMiniGame21Consts.dialogue[i][t.IMiniGame21Consts.plotIndex],this.bg.setOutSrc("bg/"+this.dialogueData.bg,FileConst.jpg),this.chapterGroup.visible=!0,this.dialogueGroup.alpha=0,this.dialogueGroup.visible=!0,this.bgRect.visible=!1,this.index=0,this.chapterTitle.text=this.dialogueData.chapter[0],this.chapterLab.text=this.dialogueData.chapter[1],ClockManager.setTimeout(this.delayPlay,this,500)},e.prototype.delayPlay=function(){var i=this;egret.Tween.get(this.chapterGroup).to({width:457},800).call(function(){egret.Tween.get(i.chapterTitle).to({alpha:1},800),egret.Tween.get(i.chapterLab).to({alpha:1},800).call(function(){egret.Tween.get(i.startBtn).to({alpha:1},800),DispatcherManager.addListener(HGEvent.HEARTBEAT,i.startBtnTime,i)}),i.startBtn.label=IMiniGameMain.getString(t.IMiniGame21Consts.lang[1],i.startTime)})},e.prototype.startBtnTime=function(){this.startBtn.label=IMiniGameMain.getString(t.IMiniGame21Consts.lang[1],this.startTime),this.startTime--<1&&this.__startClick()},e.prototype.nextBtnTime=function(){this.nextBtn.label=IMiniGameMain.getString(t.IMiniGame21Consts.lang[2],this.nextTime),this.nextTime--<1&&(this.changeDialogue(),this.nextTime=3,this.nextBtn.visible=!1,DispatcherManager.removeListener(HGEvent.HEARTBEAT,this.nextBtnTime,this))},e.prototype.__startClick=function(){DispatcherManager.removeListener(HGEvent.HEARTBEAT,this.startBtnTime,this),this.chapterGroup.visible=!1,this.bgRect.visible=!0,this.changeDialogue()},e.prototype.changeDialogue=function(){var i=this;DispatcherManager.removeListener(HGEvent.HEARTBEAT,this.nextBtnTime,this),this.nextBtn.visible=!1,this.nextTime=3,this.isFight||egret.Tween.get(this.dialogueGroup).to({alpha:0},500).call(function(){if(!i.isFight){if(i.index++,i.dialogueVo=i.dialogueData.dialogue[i.index],!i.dialogueVo){var e=t.IMiniGame21Consts.dialogue[t.IMiniGame21Consts.chapter+1],s=t.IMiniGame21Consts.dialogue[t.IMiniGame21Consts.chapter][t.IMiniGame21Consts.plotIndex+1];if(!e&&!s){var h=function(){IMiniGameMain.reqSocket(3),DispatcherManager.dispatch(IMiniGameEvent.IMiniGameExit),DispatcherManager.dispatch(IMiniGameEvent.IMiniGameChapterExit),DispatcherManager.dispatch(IMiniGameEvent.IMiniCloseTools)},a={callfun:h,caller:i},n=GObj.create(t.IMiniGame21End,a);return void IMiniGameMain.addToStage(n)}if(i.dialogueGroup.visible=!1,!t.IMiniGame21Consts.dialogue[i.chapterIndex][t.IMiniGame21Consts.plotIndex+1]){var o=i.parent;return void o.nextChapter()}var r=i.parent;return r.cutTo(3),void(i.isFight=!0)}i.dialogueVo.lf==PosType.LEFT?(i.img.left=0,i.img.right=void 0,i.nameLab.horizontalCenter=-120,i.nameBg.x=45,i.nameBg.setOutSrc("nameBg1")):(i.img.right=0,i.img.left=void 0,i.nameLab.horizontalCenter=140,i.nameBg.x=300,i.nameBg.setOutSrc("nameBg2")),i.img.setOutSrc("dialogue/"+i.dialogueVo.img),i.nameLab.text=i.dialogueVo.name,i.dialogueLab.text="",i.wordIndex=0,i.wordArr=i.dialogueVo.desc.split(""),egret.Tween.get(i.dialogueGroup).to({alpha:1},500).call(i.play,i)}})},e.prototype.play=function(){this.isPlay=!0,EnterFrameManager.instance.registeRender(this.wordPlay,this),this.nextBtn.label=IMiniGameMain.getString(t.IMiniGame21Consts.lang[2],this.nextTime)},e.prototype.overPlay=function(){this.isPlay&&(EnterFrameManager.instance.unRegisteRender(this.wordPlay,this),this.isPlay=!1,this.dialogueLab.text=this.dialogueVo.desc,this.nextBtn.visible=!0,DispatcherManager.addListener(HGEvent.HEARTBEAT,this.nextBtnTime,this))},e.prototype.wordPlay=function(){--this.frame>0||(this.frame=t.IMiniGame21Consts.frame,this.dialogueLab.text=this.dialogueLab.text.concat(this.wordArr[this.wordIndex]),this.wordIndex++,this.wordIndex>this.wordArr.length-1&&(EnterFrameManager.instance.unRegisteRender(this.wordPlay,this),this.isPlay=!1,this.nextBtn.visible=!0,DispatcherManager.addListener(HGEvent.HEARTBEAT,this.nextBtnTime,this)))},e.prototype.goOn=function(){if(this.dialogueGroup.visible=!0,t.IMiniGame21Consts.plotIndex++,!t.IMiniGame21Consts.dialogue[this.chapterIndex][t.IMiniGame21Consts.plotIndex]){var i=this.parent;return void i.nextChapter()}this.isFight=!1,this.index=0,this.dialogueData=t.IMiniGame21Consts.dialogue[this.chapterIndex][t.IMiniGame21Consts.plotIndex],this.changeDialogue()},e.prototype.dispose=function(){this.removeEvent(),this.isInit=!1,GObj.disposeObject(this.bg),this.bg=null,GObj.disposeObject(this.chapterGroup),this.chapterGroup=null,GObj.disposeObject(this.chapterBg),this.chapterBg=null,GObj.disposeObject(this.chapterLab),this.chapterLab=null,GObj.disposeObject(this.chapterTitle),this.chapterTitle=null,GObj.disposeObject(this.leftScroll),this.leftScroll=null,GObj.disposeObject(this.rightScroll),this.rightScroll=null,GObj.disposeObject(this.startBtn),this.startBtn=null,GObj.disposeObject(this.dialogueGroup),this.dialogueGroup=null,GObj.disposeObject(this.img),this.img=null,GObj.disposeObject(this.nameLab),this.nameLab=null,GObj.disposeObject(this.dialogueLab),this.dialogueLab=null,GObj.disposeObject(this.bgRect),this.bgRect=null,GObj.disposeObject(this.nextBtn),this.nextBtn=null,GObj.disposeObject(this.nameBg),this.nameBg=null,GObj.disposeObject(this.chatBg),this.chatBg=null,GObj.disposeObject(this.bgRect),this.bgRect=null},e}(eui.Component);t.IMiniGame21Dialogue=i,__reflect(i.prototype,"miniGame.IMiniGame21Dialogue")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.isOver=!1,t}return __extends(e,i),e.prototype.initSkins=function(){this.isInit||(this.width=540,this.height=960,this.bg=GObj.create(t.ImageOutside),this.addChild(this.bg),this.bgRect=GObj.create(eui.Rect),this.bgRect.alpha=.5,this.bgRect.width=this.width,this.bgRect.height=this.height,this.addChild(this.bgRect),this.chooseGroup=GObj.create(eui.Group),this.chooseGroup.horizontalCenter=0,this.chooseGroup.verticalCenter=0,this.chooseGroup.width=490,this.chooseGroup.height=142,this.addChild(this.chooseGroup),this.chooseBg=GObj.create(t.ImageOutside),this.chooseBg.scale9Grid=new egret.Rectangle(15,15,30,30),this.chooseBg.setOutSrc("chatBg"),this.chooseBg.width=490,this.chooseBg.height=142,this.chooseGroup.addChild(this.chooseBg),this.descBg=GObj.create(t.ImageOutside),this.descBg.horizontalCenter=0,this.descBg.y=18,this.descBg.scale9Grid=new egret.Rectangle(12,12,20,20),this.descBg.setOutSrc("frame"),this.descBg.width=447,this.descBg.height=104,this.chooseGroup.addChild(this.descBg),this.chooseDesc=GObj.create(eui.Label),this.chooseDesc.verticalCenter=0,this.chooseDesc.horizontalCenter=0,this.chooseDesc.size=18,this.chooseDesc.lineSpacing=4,this.chooseDesc.textColor=1453901,this.chooseGroup.addChild(this.chooseDesc),this.leftBtn=GObj.create(t.IMiniGame21Btn),this.leftBtn.horizontalCenter=0,this.leftBtn.y=180,this.leftBtn.icon=IMiniGameMain.getIcon("btn_3"),this.leftBtn.labelDisplay.textColor=9655570,this.chooseGroup.addChild(this.leftBtn),this.rightBtn=GObj.create(t.IMiniGame21Btn),this.rightBtn.horizontalCenter=0,this.rightBtn.y=250,this.rightBtn.icon=IMiniGameMain.getIcon("btn_3"),this.rightBtn.labelDisplay.textColor=9655570,this.chooseGroup.addChild(this.rightBtn),this.fightGroup=GObj.create(eui.Group),this.fightGroup.width=540,this.fightGroup.height=960,this.addChild(this.fightGroup),this.myNameBg=GObj.create(t.ImageOutside),this.myNameBg.x=240,this.myNameBg.y=745,this.myNameBg.setOutSrc("nameBg"),this.fightGroup.addChild(this.myNameBg),this.myName=GObj.create(eui.Label),this.myName.x=280,this.myName.y=750,this.myName.size=20,this.myName.textColor=16775405,this.fightGroup.addChild(this.myName),this.myHpBar=GObj.create(t.IMiniGame21Hp),this.myHpBar.x=40,this.myHpBar.y=770,this.myHpBar.scaleX=this.myHpBar.scaleY=.9,this.myHpBar.setUI(!0),this.fightGroup.addChild(this.myHpBar),this.myHead=GObj.create(t.ImageOutside),this.fightGroup.addChild(this.myHead),this.enemyNameBg=GObj.create(t.ImageOutside),this.enemyNameBg.x=320,this.enemyNameBg.y=244,this.enemyNameBg.scaleX=-1,this.enemyNameBg.setOutSrc("nameBg"),this.fightGroup.addChild(this.enemyNameBg),this.enemyName=GObj.create(eui.Label),this.enemyName.right=260,this.enemyName.y=248,this.enemyName.size=20,this.enemyName.textColor=16775405,this.fightGroup.addChild(this.enemyName),this.enemyHpBar=GObj.create(t.IMiniGame21Hp),this.enemyHpBar.x=120,this.enemyHpBar.y=268,this.enemyHpBar.scaleX=this.enemyHpBar.scaleY=.9,this.enemyHpBar.setUI(!1),this.fightGroup.addChild(this.enemyHpBar),this.enemyHead=GObj.create(t.ImageOutside),this.fightGroup.addChild(this.enemyHead),this.bulletGroup=GObj.create(eui.Group),this.bulletGroup.width=540,this.bulletGroup.height=960,this.bulletGroup.touchEnabled=!1,this.bulletGroup.touchChildren=!1,this.addChild(this.bulletGroup),this.skill=GObj.create(t.IMovieMore),this.addChild(this.skill),this.skillNameGroup=GObj.create(eui.Group),this.addChild(this.skillNameGroup),this.skillNameBg=GObj.create(t.ImageOutside),this.skillNameBg.setOutSrc("skillBg"),this.skillNameGroup.scaleX=this.skillNameGroup.scaleY=0,this.skillNameGroup.addChild(this.skillNameBg),this.skillNameLab=GObj.create(eui.Label),this.skillNameLab.horizontalCenter=0,this.skillNameLab.verticalCenter=0,this.skillNameLab.size=20,this.skillNameLab.textColor=0,this.skillNameGroup.addChild(this.skillNameLab),this.hurtGroup=GObj.create(eui.Group),this.hurtGroup.width=540,this.hurtGroup.height=960,this.hurtGroup.touchEnabled=!1,this.hurtGroup.touchChildren=!1,this.addChild(this.hurtGroup),this.resultEff=GObj.create(t.IMovie),this.addChild(this.resultEff),this.isInit=!0,this.addEvent())},e.prototype.addEvent=function(){this.leftBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.startClick,this),this.rightBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.startClick,this)},e.prototype.removeEvent=function(){this.leftBtn&&this.leftBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.startClick,this),this.rightBtn&&this.rightBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.startClick,this),EnterFrameManager.instance.unRegisteRender(this.run,this)},e.prototype.initView=function(i){if(this.initSkins(),this.chapterIndex=i,this.isOver=!1,t.IMiniGame21Consts.plotIndex++,this.fightData=t.IMiniGame21Consts.dialogue[i][t.IMiniGame21Consts.plotIndex],!this.fightData){var e=this.parent;return void e.nextChapter()}this.bg.setOutSrc("bg/"+this.fightData.bg,FileConst.jpg),this.myHead.setOutSrc("dialogue/"+this.fightData.head[0]),this.myHpBar.setData(this.fightData.hp[0],this.fightData.hp[0]),this.myHp=this.fightData.hp[0],this.myName.text=this.fightData.name[0],this.enemyHead.setOutSrc("dialogue/"+this.fightData.head[1]),this.enemyHpBar.setData(this.fightData.hp[1],this.fightData.hp[1]),this.enemyHp=this.fightData.hp[1],this.enemyName.text=this.fightData.name[1],this.myHpBar.skewX=this.myName.skewX=this.myNameBg.skewX=90,this.enemyHpBar.skewX=this.enemyName.skewX=this.enemyNameBg.skewX=-90,this.myHead.x=600,this.myHead.y=700,this.enemyHead.x=-200,this.enemyHead.y=0,this.chooseDesc.text=this.fightData.desc[0],this.leftBtn.label=this.fightData.desc[1],this.rightBtn.label=this.fightData.desc[2],this.chooseGroup.visible=!0,this.fightGroup.visible=!1,this.chooseTween()},e.prototype.chooseTween=function(){var t=this;this.chooseBg.alpha=this.chooseDesc.alpha=this.leftBtn.alpha=this.rightBtn.alpha=0,egret.Tween.get(this.chooseBg).to({alpha:1},1e3).call(function(){egret.Tween.get(t.leftBtn).to({alpha:1},1e3),egret.Tween.get(t.rightBtn).to({alpha:1},1e3)}),egret.Tween.get(this.chooseDesc).to({alpha:1},1e3)},e.prototype.startClick=function(){var t=this.parent;t.cloudPlay(),this.chooseGroup.visible=!1,this.fightGroup.visible=!0,ClockManager.setTimeout(this.startTween,this,1e3)},e.prototype.startTween=function(){var t=this;egret.Tween.get(this.myHead).to({x:200,y:360},400).call(function(){t.createBone(),egret.Tween.get(t.myHead).to({x:310,y:593},500),egret.Tween.get(t.enemyHead).to({x:10,y:91},500).call(function(){egret.Tween.get(t.myHpBar).to({skewX:0},1500,egret.Ease.bounceOut),egret.Tween.get(t.enemyHpBar).to({skewX:0},1500,egret.Ease.bounceOut),egret.Tween.get(t.myName).to({skewX:0},1500,egret.Ease.bounceOut),egret.Tween.get(t.enemyName).to({skewX:0},1500,egret.Ease.bounceOut),egret.Tween.get(t.myNameBg).to({skewX:0},1500,egret.Ease.bounceOut),egret.Tween.get(t.enemyNameBg).to({skewX:0},1500,egret.Ease.bounceOut)})}),egret.Tween.get(this.enemyHead).to({x:150,y:300},400)},e.prototype.createBone=function(){this.bone=GObj.create(BonesDisplay),this.bone.touchEnabled=!1,this.bone.source=IMiniGameMain.getBone("bones_tex"),this.bone.play(null,1),this.bone.x=this.width/2,this.bone.y=this.height/2,this.addChild(this.bone),ClockManager.setTimeout(this.startFight,this,2e3)},e.prototype.startFight=function(){this.bone&&(GObj.disposeObject(this.bone),this.bone=null),this.fightIndex=0,this.fight()},e.prototype.fight=function(){if(this.fightVo&&(this.removeBullet(),this.removeHurt()),!this.isOver){this.fightIndex++;var i=this.fightData.fight;if(this.fightVo=i[this.fightIndex],!this.fightVo)return void this.startFight();this.isPlayer=this.fightVo.isPlayer,this.fightVo.isSkill?(this.skillVo=t.IMiniGame21Consts.skill[this.fightVo.index],this.playSkill()):(this.bulletVo=t.IMiniGame21Consts.bullet[this.fightVo.index],this.addBullet())}},e.prototype.run=function(){this.skill.run(),(this.skillVo.keyFrame<0||0==--this.keyFrame)&&this.skillVo.keyFrame>0&&(this.keyFrame=this.skillVo.keyFrame,this.hurt())},e.prototype.addBullet=function(){for(var i=1;i<=this.bulletVo.count;i++)ClockManager.setTimeout(this.createBullet,this,t.IMiniGame21Consts.bulletTime*i,i)},e.prototype.createBullet=function(i){var e=this.myHead.x+this.myHead.width/2,s=this.myHead.y+this.myHead.height/2,h=this.enemyHead.x+this.enemyHead.width/2,a=this.enemyHead.y+this.enemyHead.height/2,n=GObj.create(t.ImageOutside);if(n.loadCompleteCall(function(){n.anchorOffsetX=n.iconWidth/2,n.anchorOffsetY=n.iconHeight/2},this),n.setOutSrc("bullet/"+this.bulletVo.img),this.bulletGroup.addChild(n),this.isPlayer){n.x=e,n.y=s;var o=GMath.distance(n.x,n.y,this.enemyHead.x,this.enemyHead.y);if(i>=this.bulletVo.count?egret.Tween.get(n).to({x:h,y:a},o/this.bulletVo.speed*1e3).call(this.fight,this):egret.Tween.get(n).to({x:h,y:a},o/this.bulletVo.speed*1e3).call(this.removeBullet,this),this.bulletVo.rotation)egret.Tween.get(n,{loop:!0}).to({rotation:360},360/this.bulletVo.rotation*1e3);else{var r=GMath.angle(e,s,h,a);r=Math.floor((r+360)%360),n.rotation=r+90}}else{n.x=h,n.y=a;var o=GMath.distance(n.x,n.y,this.myHead.x,this.myHead.y);if(i>=this.bulletVo.count?egret.Tween.get(n).to({x:e,y:s},o/this.bulletVo.speed*1e3).call(this.fight,this):egret.Tween.get(n).to({x:e,y:s},o/this.bulletVo.speed*1e3).call(this.removeBullet,this),this.bulletVo.rotation)egret.Tween.get(n,{loop:!0}).to({rotation:360},360/this.bulletVo.rotation*1e3);else{var r=GMath.angle(h,a,e,s);r=Math.floor((r+360)%360),n.rotation=r+90}}},e.prototype.removeBullet=function(){this.bulletGroup.$children[0]&&!this.isOver&&(egret.Tween.removeTweens(this.bulletGroup.$children[0]),GObj.disposeObject(this.bulletGroup.$children[0]),this.hurt())},e.prototype.playSkill=function(){this.skill.x=this.skillVo.x,this.skill.y=this.skillVo.y,this.keyFrame=this.skillVo.keyFrame,this.addChild(this.skill),egret.Tween.removeTweens(this.skillNameGroup),this.isPlayer?(this.skillNameGroup.x=236,this.skillNameGroup.y=646):(this.skillNameGroup.x=150,this.skillNameGroup.y=150),this.skillNameLab.text=this.skillVo.broadcast,egret.Tween.get(this.skillNameGroup).to({scaleX:1,scaleY:1},300).wait(800).to({scaleX:0,scaleY:0},300),this.skill.start(this.skillVo.skill,1),this.skill.rotation=this.isPlayer?0:180,EnterFrameManager.instance.registeRender(this.run,this),this.skill.setCompleteBack(this.stop,this)},e.prototype.stop=function(){EnterFrameManager.instance.unRegisteRender(this.run,this),this.keyFrame=0,this.fight()},e.prototype.hurt=function(){if(this.enemyHead){var i=GObj.create(t.IBitNumMap),e=this.fightVo.hurt,s=GMath.randomInt(e[0],e[1]);if(s>.8*(e[1]-e[0])?i.setPath(t.IMiniGame21Consts.num22):i.setPath(t.IMiniGame21Consts.num23),i.setString(s.toString()),this.hurtGroup.addChild(i),this.isPlayer){i.x=this.enemyHead.x+this.enemyHead.width/2,i.y=this.enemyHead.y+this.enemyHead.height/2;var h=Math.random();.5>h?egret.Tween.get(i).to({x:i.x-50,y:i.y-100,alpha:0},800).call(this.removeHurt,this):egret.Tween.get(i).to({x:i.x+50,y:i.y-100,alpha:0},800).call(this.removeHurt,this),this.setHp(s)}else{i.x=this.myHead.x+this.myHead.width/2,i.y=this.myHead.y+this.myHead.height/2;var h=Math.random();.5>h?egret.Tween.get(i).to({x:i.x-50,y:i.y-100,alpha:0},800).call(this.removeHurt,this):egret.Tween.get(i).to({x:i.x+50,y:i.y-100,alpha:0},800).call(this.removeHurt,this),this.setHp(s)}}},e.prototype.removeHurt=function(){GObj.disposeObject(this.hurtGroup.$children[0])},e.prototype.setHp=function(i){var e,s=this;this.isPlayer?(this.enemyHp-=i,this.enemyHp<=0&&!this.isOver&&(this.enemyHp=0,this.isOver=!0,this.resultEff.x=270,this.resultEff.y=480,this.removeBullet(),this.resultEff.start(t.IMiniGame21Consts.UI_SHENGLI,1,0),e=t.IMiniGame21Consts.minigame_win),this.enemyHpBar.setData(this.enemyHp,this.fightData.hp[1]),this.enemyHead.filters=[IMiniGameMain.getRedFilter()],egret.Tween.get(this).wait(200).call(function(){s.enemyHead.filters=null})):(this.myHp-=i,this.myHp<=0&&!this.isOver&&(this.myHp=0,this.isOver=!0,this.resultEff.x=270,this.resultEff.y=480,this.removeBullet(),this.resultEff.start(t.IMiniGame21Consts.UI_SHIBAI,1,0),e=t.IMiniGame21Consts.minigame_lose),this.myHpBar.setData(this.myHp,this.fightData.hp[0]),this.myHead.filters=[IMiniGameMain.getRedFilter()],egret.Tween.get(this).wait(200).call(function(){s.myHead.filters=null})),this.resultEff.autoRun(),this.resultEff.setCompleteBack(this.nextDialogue,this),IMiniGameMain.playEff(e)},e.prototype.nextDialogue=function(){for(;this.bulletGroup.$children.length>0;)GObj.disposeObject(this.bulletGroup.$children[0]);var i=t.IMiniGame21Consts.dialogue[t.IMiniGame21Consts.chapter+1],e=t.IMiniGame21Consts.dialogue[t.IMiniGame21Consts.chapter][t.IMiniGame21Consts.plotIndex+1];if(!i&&!e){var s=function(){IMiniGameMain.reqSocket(3),DispatcherManager.dispatch(IMiniGameEvent.IMiniGameExit),DispatcherManager.dispatch(IMiniGameEvent.IMiniGameChapterExit),DispatcherManager.dispatch(IMiniGameEvent.IMiniCloseTools)},h={callfun:s,caller:this},a=GObj.create(t.IMiniGame21End,h);return void IMiniGameMain.addToStage(a)}if(!t.IMiniGame21Consts.dialogue[this.chapterIndex][t.IMiniGame21Consts.plotIndex+1]){var n=this.parent;return void n.nextChapter()}var o=this.parent;o.cutTo(5)},e.prototype.dispose=function(){if(this.removeEvent(),this.isInit=!1,GObj.disposeObject(this.bg),this.bg=null,GObj.disposeObject(this.bgRect),this.bgRect=null,GObj.disposeObject(this.fightGroup),this.fightGroup=null,GObj.disposeObject(this.myHead),this.myHead=null,GObj.disposeObject(this.myNameBg),this.myNameBg=null,GObj.disposeObject(this.myName),this.myName=null,GObj.disposeObject(this.myHpBar),this.myHpBar=null,GObj.disposeObject(this.enemyHead),this.enemyHead=null,GObj.disposeObject(this.enemyName),this.enemyName=null,GObj.disposeObject(this.enemyNameBg),this.enemyNameBg=null,GObj.disposeObject(this.enemyHpBar),this.enemyHpBar=null,GObj.disposeObject(this.skill),this.skill=null,GObj.disposeObject(this.chooseGroup),this.chooseGroup=null,GObj.disposeObject(this.chooseBg),this.chooseBg=null,GObj.disposeObject(this.chooseDesc),this.chooseDesc=null,GObj.disposeObject(this.leftBtn),this.leftBtn=null,GObj.disposeObject(this.rightBtn),this.rightBtn=null,this.bulletGroup){for(;this.bulletGroup.$children.length>0;)egret.Tween.removeTweens(this.bulletGroup.$children[0]),GObj.disposeObject(this.bulletGroup.$children[0]);GObj.disposeObject(this.bulletGroup),this.bulletGroup=null}},e}(eui.Component);t.IMiniGame21Fight=i,__reflect(i.prototype,"miniGame.IMiniGame21Fight")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.initSkins(),t}return __extends(e,i),e.prototype.initSkins=function(){var i=this;this.touchEnabled=!1,this.touchChildren=!1,this.labHp=GObj.create(eui.Label),this.thumbImg=GObj.create(t.ImageOutside),this.thumbImg.loadCompleteCall(function(){i.labHp.width=i.thumbImg.width},this),this.thumbImg.setOutSrc("hp2"),this.addChild(this.thumbImg),this.thumb=GObj.create(t.ImageOutside),this.thumb.loadCompleteCall(function(){i.thumb.x=19,i.thumb.y=4},this),this.addChild(this.thumb),this.labHp.y=4,this.labHp.size=18,this.labHp.textAlign=egret.HorizontalAlign.CENTER,this.addChild(this.labHp),this.slideDuration=2e3/egret.ticker.$frameRate},e.prototype.setUI=function(t){t?this.thumb.setOutSrc("hp1"):this.thumb.setOutSrc("hp3")},e.prototype.setData=function(t,i){t>i||(0>t&&(t=0),this.value=t/i*100,this.labHp.text=t+"")},e.prototype.showHpNum=function(t){this.labHp.visible=t},e.prototype.dispose=function(){GObj.disposeObject(this.thumbImg),this.thumbImg=null,GObj.disposeObject(this.thumb),this.thumb=null,GObj.disposeObject(this.labHp),this.labHp=null},e}(eui.ProgressBar);t.IMiniGame21Hp=i,__reflect(i.prototype,"miniGame.IMiniGame21Hp")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){return i.call(this)||this}return __extends(e,i),e.prototype.addEvent=function(){this.exitBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCloseClick,this)},e.prototype.removeEvent=function(){this.exitBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onCloseClick,this)},e.prototype.initSkins=function(){this.isInit||(this.isInit=!0,this.horizontalCenter=0,this.verticalCenter=0,this.width=540,this.height=960,this.cartoonView=GObj.create(t.IMiniGame21Cartoon),this.addChild(this.cartoonView),this.dialogueView=GObj.create(t.IMiniGame21Dialogue),this.addChild(this.dialogueView),this.fightView=GObj.create(t.IMiniGame21Fight),this.addChild(this.fightView),this.exitBtn=GObj.create(t.IBaseBtn),this.exitBtn.icon=IMiniGameMain.getIcon("exit_btn",FileConst.png,"chapter"),this.exitBtn.x=10,this.exitBtn.y=10,this.addChild(this.exitBtn),this.cloudEff=GObj.create(t.IMovieMore),this.cloudEff.x=this.width/2,this.cloudEff.y=this.height/2,this.addChild(this.cloudEff),this.addEvent())},e.prototype.setData=function(i,e){this.initSkins(),t.IMiniGame21Consts.chapter=1,this.showCartoon(),t.IMiniGame21Consts.plotIndex=1,this.updateOut(e.isMust)},e.prototype.updateOut=function(t){var i=this;this.exitBtn&&t&&(IMiniGameConfig.countDownExit>0?(this.exitBtn.visible=!1,ClockManager.setTimeout(function(){i.exitBtn&&(i.exitBtn.visible=!0)},this,IMiniGameConfig.countDownExit)):IMiniGameConfig.countDownExit<0&&(this.exitBtn.visible=!1))},e.prototype.showCartoon=function(){this.cartoonView.visible=!0,this.dialogueView.visible=!1,this.fightView.visible=!1,this.cartoonView.initView(),IMiniGameMain.playBgm(t.IMiniGame21Consts.minigame_bgm1)},e.prototype.showEnd=function(){this.cartoonView.visible=!0,this.dialogueView.visible=!1,this.fightView.visible=!1,this.cartoonView.start()},e.prototype.showDialogue=function(){this.cartoonView.visible=!1,this.dialogueView.visible=!0,this.fightView.visible=!1,this.dialogueView.initView(t.IMiniGame21Consts.chapter),IMiniGameMain.playBgm(t.IMiniGame21Consts.minigame_bgm1)},e.prototype.showFight=function(){this.cartoonView.visible=!1,this.dialogueView.visible=!1,this.fightView.visible=!0,this.fightView.initView(t.IMiniGame21Consts.chapter),IMiniGameMain.playBgm(t.IMiniGame21Consts.minigame_bgm2)},e.prototype.nextChapter=function(){if(t.IMiniGame21Consts.chapter++,t.IMiniGame21Consts.chapter>Object.keys(t.IMiniGame21Consts.dialogue).length){var i=function(){IMiniGameMain.reqSocket(3),DispatcherManager.dispatch(IMiniGameEvent.IMiniGameExit),DispatcherManager.dispatch(IMiniGameEvent.IMiniGameChapterExit),DispatcherManager.dispatch(IMiniGameEvent.IMiniCloseTools)},e={callfun:i,caller:this},s=GObj.create(t.IMiniGame21End,e);return void IMiniGameMain.addToStage(s)}t.IMiniGame21Consts.plotIndex=1,this.cutTo(2)},e.prototype.cutTo=function(i){switch(this.cloudEff.start(t.IMiniGame21Consts.DAYUN2,1),this.cloudEff.autoRun(),i){case 1:this.showCartoon();break;case 2:this.showDialogue();break;case 3:this.showFight();break;case 4:this.showEnd();break;case 5:this.goOn()}},e.prototype.cloudPlay=function(){this.cloudEff.start(t.IMiniGame21Consts.DAYUN2,1),this.cloudEff.autoRun()},e.prototype.goOn=function(){this.cartoonView.visible=!1,this.dialogueView.visible=!0,this.fightView.visible=!1,this.dialogueView.goOn(),IMiniGameMain.playBgm(t.IMiniGame21Consts.minigame_bgm1)},e.prototype.dispose=function(){this.removeEvent(),GObj.disposeObject(this.cartoonView),this.cartoonView=null,GObj.disposeObject(this.dialogueView),this.dialogueView=null,GObj.disposeObject(this.fightView),this.fightView=null,GObj.disposeObject(this.cloudEff),this.cloudEff=null,GObj.disposeObject(this.exitBtn),this.exitBtn=null,i.prototype.dispose.call(this)},e}(t.IBaseView);t.IMiniGame21View=i,__reflect(i.prototype,"miniGame.IMiniGame21View")}(miniGame||(miniGame={})),function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.skinName=t.getSkin(),t}return __extends(e,i),e.prototype.getSkin=function(){var i=this,e=GObj.create(eui.Skin);e.skinParts=["mcDisplay"];var s=GObj.create(t.ImageOutside);s.touchEnabled=!1,s.loadCompleteCall(function(){i.width=i.iconDisplay.iconWidth,i.height=i.iconDisplay.iconHeight},this),s.horizontalCenter=0,s.verticalCenter=0,this.iconDisplay=s;var h=GObj.create(eui.Label);return h.touchEnabled=!1,h.horizontalCenter=0,h.verticalCenter=0,h.size=18,h.textColor=9655570,h.text="",this.labelDisplay=h,e.icon=s,e.label=h,e.elementsContent=[s],e.states=[new eui.State("up",[]),new eui.State("down",[new eui.SetProperty("label","scaleX",.92),new eui.SetProperty("label","scaleY",.92),new eui.SetProperty("icon","scaleX",.92),new eui.SetProperty("icon","scaleY",.92)]),new eui.State("disabled",[])],e},Object.defineProperty(e.prototype,"label",{set:function(t){this.labelDisplay&&(this.labelDisplay.parent||this.addChild(this.labelDisplay),this.labelDisplay.text=t)},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){i.prototype.dispose.call(this)},e}(t.IBaseBtn);t.IMiniGame21Btn=i,__reflect(i.prototype,"miniGame.IMiniGame21Btn")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(t){return i.call(this,t)||this}return __extends(e,i),e.prototype.getGameView=function(){return this.gameView||(this.gameView=GObj.create(t.IMiniGame23View)),this.gameView.setData(this.getCurGameData()),this.gameView},e.prototype.loadConfigComplete=function(e){if(e)for(var s in e.config)t.IMiniGame23Consts[s]=e.config[s];var h=[];h=[],h=h.concat([1,0,0,0,150]),h=h.concat([0,1,0,0,150]),h=h.concat([0,0,1,0,150]),h=h.concat([0,0,0,1,0]),t.IMiniGame23Consts.flashFilter=new egret.ColorMatrixFilter(h),i.prototype.loadConfigComplete.call(this,e)},e.setDefSpecVo=function(i,e){for(var s,h,a=0;a<i.length;a++)if(s=t.IMiniGame23Consts.specs[i[a].index]){h=i[a];for(var n in s)void 0==h[n]&&(h[n]=s[n]);
void 0!=e&&(i[a].specTime=e)}},e.setDefCoinVo=function(i){for(var e,s,h=0;h<i.length;h++)if(e=t.IMiniGame23Consts.coins[i[h].index]){s=i[h];for(var a in e)void 0==s[a]&&(s[a]=e[a])}},e.setDefObstVo=function(i){for(var e,s,h=0;h<i.length;h++)if(e=t.IMiniGame23Consts.obsts[i[h].index]){s=i[h];for(var a in e)void 0==s[a]&&(s[a]=e[a])}},e.prototype.dispose=function(){i.prototype.dispose.call(this)},e}(t.IMiniGameBaseCtr);t.IMiniGame23=i,__reflect(i.prototype,"miniGame.IMiniGame23")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.reset(),t.initSkins(),t}return __extends(e,i),e.prototype.initSkins=function(){this.touchEnabled=!1,this.coinImg=GObj.create(t.ImageOutside),this.coinImg.loadCompleteCall(this.loadEd,this),this.addChild(this.coinImg)},e.prototype.loadEd=function(){this.width=this.coinImg.width,this.height=this.coinImg.height,this.anchorOffsetX=this.width/2},e.prototype.setTarget=function(t){this.targetObject=t},e.prototype.setAddNum=function(t,i){this.addNum=(this.totalScalx-this.scaleX)/(t-i)},e.prototype.setData=function(t){t&&(this.data=t,this.coinProp=t.coinProp||1,this.alpha=1,this.speed=t.speed||10,this.scaleX=this.scaleY=t.initScalXY||.01,this.totalScalx=t.totalScalXY||1,this.coinImg.setOutSrc(t.model))},e.prototype.setSpeed=function(t){this.speedx=this.speed*GMath.cos(t),this.speedy=this.speed*GMath.sin(t)},e.prototype.run=function(){if(!this.isCanBack&&this.isRunning&&this.targetObject&&this.addNum)if(this.isAttract){var i=GMath.angle(this.x,this.y,this.targetObject.x,this.targetObject.y);this.setSpeed(i);var e=this.y+this.speedy,s=Number((this.scaleX+(e-this.y)*this.addNum).toFixed(4));this.x=this.x+this.speedx,this.scaleX=this.scaleY=s,this.y=e}else{var e=Math.ceil(this.targetObject.y+this.scaleY*((this.posIndex-1)*this.data.coinDis)),s=void 0;s=e>this.y?Number((this.scaleX+(e-this.y)*this.addNum).toFixed(4)):Number((this.scaleX-(this.y-e)*this.addNum).toFixed(4)),this.scaleX=this.scaleY=s,this.visible=this.scaleX>t.IMiniGame23Consts.showScaleXY,this.y=e,this.x=this.posArr[1]+this.scaleX*(this.posArr[this.posX]-this.posArr[1]),this.parent&&this.y>this.parent.height&&(this.isCanBack=!0)}},e.prototype.tweenIng=function(){this.isTween||(this.isTween=!0,egret.Tween.get(this).to({x:this.x-100,y:this.y-120,alpha:0},1e3).call(this.tweenCall,this))},e.prototype.tweenCall=function(){this.isTween=!1,this.isCanBack=!0},e.prototype.reset=function(){this.scaleX=this.scaleY=0,this.isAttract=!1,this.isRunning=!1,this.isTween=!1,this.isCanBack=!1,this.targetObject=null,this.data=null,egret.Tween.removeTweens(this)},e.prototype.dispose=function(){this.reset(),this.posArr=null,GObj.disposeObject(this.coinImg),this.coinImg=null},e}(eui.Group);t.IMiniGame23Coin=i,__reflect(i.prototype,"miniGame.IMiniGame23Coin")}(miniGame||(miniGame={}));var miniGame;!function(t){t.IMiniGame23Consts={tipsTime:2e3,tipsNumber:1e3,tipsArr:["完美","厉害","漂亮"],clickTime:200,guide3Time:3e3,woodNumber:150,showScaleXY:.01,shakeNum:10,shakeArr:[2,5,50],frameNumber:5,playersCheck:.05,specArr:[120,270,430],obstArr:[120,270,430],coinArr:[120,270,430],meterNumber:1,skillBottom:0,skill1Model:"ui_ski1",skill2Model:"ui_ski2",skill3Model:"ui_ski3",ui_kuang:"ui_kuang",isSlideNum:30,mapImageNum:8,imageOffset:85,upperWidth:220,downWidth:408,petsDis:10,petsDisY:50,petsNumber:4,flashFilter:null,extraNum:0,extra:"",roleY:850,mapSpeed:1,addEff:"ui_shengji",reduceEff:"ui_jiangdi",dieEff:"ui_siwang",minigame23_bgm:"minigame23_bgm",minigame23_win:"minigame23_win",minigame23_die:"minigame23_lose",minigame23_coin:"minigame23_coin",minigame23_add:"minigame23_add",minigame23_reduce:"minigame23_reduce",minigame23_skill:"minigame23_skill",specTextY:0,icon_y:2,titles:{},coins:{},specs:{},players:{},skills:{},obsts:{},mounts:{},pets:{}}}(miniGame||(miniGame={}));var Spec23Type;!function(t){t[t.TYPE_1=1]="TYPE_1",t[t.TYPE_2=2]="TYPE_2",t[t.TYPE_3=3]="TYPE_3",t[t.TYPE_4=4]="TYPE_4"}(Spec23Type||(Spec23Type={}));var Skill23Type;!function(t){t[t.TYPE_1=1]="TYPE_1",t[t.TYPE_2=2]="TYPE_2",t[t.TYPE_3=3]="TYPE_3"}(Skill23Type||(Skill23Type={}));var Title23Type;!function(t){t[t.TYPE_1=1]="TYPE_1",t[t.TYPE_2=2]="TYPE_2",t[t.TYPE_3=3]="TYPE_3"}(Title23Type||(Title23Type={}));var miniGame;!function(t){var i=function(t){function i(){return t.call(this)||this}return __extends(i,t),i.prototype.getEffectData=function(){return this._effect&&this._effect.ttfs?this._effect.ttfs[0].ttr||null:null},i.prototype.dispose=function(){t.prototype.dispose.call(this)},i}(t.IMovie);t.IMiniGame23IMovie=i,__reflect(i.prototype,"miniGame.IMiniGame23IMovie")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.reset(),t.initSkins(),t}return __extends(e,i),e.prototype.initSkins=function(){this.touchEnabled=!1,this.ObstImg=GObj.create(t.IMiniGame23IMovie),this.ObstImg.setLoadCompleteBack(this.loadEd,this),this.addChild(this.ObstImg)},e.prototype.loadEd=function(){var t=this.ObstImg.getEffectData();t&&(this.width=t.textureWidth,this.height=t.textureHeight)},e.prototype.setTarget=function(t){this.targetObject=t},e.prototype.setAddNum=function(t,i){this.addNum=(this.totalScalx-this.scaleX)/(t-i),this.addNum<0},e.prototype.setData=function(t){t&&(this.data=t,this.alpha=1,this.isJump=t.isJump,this.scaleX=this.scaleY=t.initScalXY||.01,this.totalScalx=t.totalScalXY||1,this.ObstImg.start(t.model),this.ObstImg.autoRun())},e.prototype.run=function(){if(!this.isCanBack&&this.targetObject&&this.addNum){var i,e=Math.ceil(this.targetObject.y);i=e>this.y?Number((this.scaleX+(e-this.y)*this.addNum).toFixed(4)):Number((this.scaleX-(this.y-e)*this.addNum).toFixed(4)),this.scaleX=this.scaleY=i,this.visible=this.scaleX>t.IMiniGame23Consts.showScaleXY,this.y=e,this.x=this.posArr[1]+this.scaleX*(this.posArr[this.posX]-this.posArr[1]),this.parent&&this.y>this.parent.height&&(this.isCanBack=!0)}},e.prototype.reset=function(){this.scaleX=this.scaleY=0,this.isRunning=!1,this.isCanBack=!1,this.targetObject=null,this.data=null,egret.Tween.removeTweens(this)},e.prototype.dispose=function(){this.reset(),this.posArr=null,GObj.disposeObject(this.ObstImg),this.ObstImg=null},e}(eui.Group);t.IMiniGame23Obst=i,__reflect(i.prototype,"miniGame.IMiniGame23Obst")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){return i.call(this)||this}return __extends(e,i),e.prototype.setFun=function(t,i){this.fun=t,this.thisobj=i},e.prototype.getPlayerArr=function(){return this.playerxArr},e.prototype.actionOver=function(t){i.prototype.actionOver.call(this,t),t==AvatarConsts.ACTION_JUMP&&this.setAction(AvatarConsts.ACTION_WALK),t==AvatarConsts.ACTION_DIE&&this.fun&&this.fun.call(this.thisobj,!1)},e.prototype.setData=function(t){t&&(this._isMove=!1,this._isDie=!1,this.data=t,this.scaleX=this.scaleY=this.data.role_scaleXY||1,this.playerxArr=t.role_posArr||[170,270,270],this.updatePart(this.data.role_model),this.setDirection(AvatarConsts.B_B),this.setAction(AvatarConsts.ACTION_WALK))},e.prototype.partComplete=function(t){i.prototype.partComplete.call(this,t),t&&t.jsonObj&&(this.width=this.fixWidth=t.jsonObj.frames[0].w,this.height=this.fixHeight=t.jsonObj.frames[0].h)},e.prototype.getFixW=function(){return this.fixWidth||this.width},e.prototype.getFixH=function(){return this.fixHeight||this.height},e.prototype.addPets=function(i){i&&(this.petObj||(this.petObj=GObj.create(t.IMovie)),this.petObj.visible=!1,this.petObj.setCompleteBack(this.setPetXY,this),this.petObj.scaleX=this.petObj.scaleY=i.scaleXY||1,this.petObj.start(i.model,0),this.petObj.autoRun(),this.petObj.parent||this.addChild(this.petObj))},e.prototype.setPetXY=function(){this.petObj&&(this.petObj.visible=!0,this.petObj.x=this.fixWidth*this.scaleX/2+this.petObj.width/2*this.petObj.scaleX+t.IMiniGame23Consts.petsDis,this.petObj.y=-this.fixHeight*this.scaleX+t.IMiniGame23Consts.petsDisY)},e.prototype.hidePet=function(){this.petObj&&this.petObj.stop()},e.prototype.setMountXY=function(){this.mountObj&&(this.mountObj.visible=!0,this.mountObj.x=0,this.mountObj.y=this.mountObj.height*this.mountObj.scaleY/3*2)},e.prototype.hideMount=function(){this.mountObj&&this.mountObj.stop()},e.prototype.addMount=function(i){i&&(this.mountObj||(this.mountObj=GObj.create(t.IMovie)),this.mountObj.visible=!1,this.mountObj.setCompleteBack(this.setMountXY,this),this.mountObj.scaleX=this.mountObj.scaleY=i.scaleXY||1,this.mountObj.start(i.model,0),this.mountObj.autoRun(),this.mountObj.parent||this.addChildAt(this.mountObj,0))},e.prototype.addSkill1=function(){this.skill1Moive||(this.skill1Moive=GObj.create(t.IMovie)),this.skill1Moive.start(t.IMiniGame23Consts.skill1Model),this.skill1Moive.y=-this.fixHeight*this.scaleY/2,this.skill1Moive.autoRun(),this.skill1Moive.parent||this.addChild(this.skill1Moive)},e.prototype.hideSkill1=function(){this.skill1Moive&&this.skill1Moive.stop()},e.prototype.addSkill2=function(){this.skill2Moive||(this.skill2Moive=GObj.create(t.IMovie)),this.skill2Moive.start(t.IMiniGame23Consts.skill2Model),this.skill2Moive.y=-this.fixHeight*this.scaleY/2,this.skill2Moive.autoRun(),this.skill2Moive.parent||this.addChild(this.skill2Moive)},e.prototype.hideSkill2=function(){this.skill2Moive&&this.skill2Moive.stop()},e.prototype.addSkill3=function(){this.skill3Moive||(this.skill3Moive=GObj.create(t.IMovie)),this.skill3Moive.start(t.IMiniGame23Consts.skill3Model),this.skill3Moive.y=-this.fixHeight*this.scaleY/2,this.skill3Moive.autoRun(),this.skill3Moive.parent||this.addChild(this.skill3Moive)},e.prototype.hideSkill3=function(){this.skill3Moive&&this.skill3Moive.stop()},e.prototype.setTitle=function(i){this.title||(this.title=GObj.create(t.ImageOutside)),this.title.loadCompleteCall(this.setTitleX,this),this.title.setOutSrc(i),this.title.parent||this.addChild(this.title)},e.prototype.setTitleX=function(){this.title.visible=!0,this.title.anchorOffsetX=this.title.width/2,this.title.y=-this.title.height-this.fixHeight*this.scaleY-20},e.prototype.hideTitle=function(){this.title&&(this.title.visible=!1)},e.prototype.dispose=function(){this.fun=null,this.playerxArr=null,this.thisobj=null,this.data=null,GObj.disposeObject(this.title),this.title=null,GObj.disposeObject(this.mountObj),this.mountObj=null,GObj.disposeObject(this.petObj),this.petObj=null,GObj.disposeObject(this.skill1Moive),this.skill1Moive=null,GObj.disposeObject(this.skill2Moive),this.skill2Moive=null,GObj.disposeObject(this.skill3Moive),this.skill3Moive=null,i.prototype.dispose.call(this)},e}(t.IAvatarViewCtr);t.IMiniGame23Player=i,__reflect(i.prototype,"miniGame.IMiniGame23Player")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.isUpdate=!1,t.initSkins(),t}return __extends(e,i),e.prototype.getIsPick=function(){return this._isPick},e.prototype.setPick=function(i){var e=this;void 0===i&&(i=!0),this._isPick=!0,i&&(egret.Tween.removeTweens(this),this.filters=[t.IMiniGame23Consts.flashFilter],egret.Tween.get(this).wait(200).call(function(){e.filters=null}))},e.prototype.setAddNum=function(t,i){this.addNum=(this.totalScalx-this.scaleX)/(t-i)},e.prototype.setTarget=function(t){this.targetObject=t},e.prototype.initSkins=function(){var i=this;this.touchEnabled=!1,this.bgImg=GObj.create(t.IMiniGame23IMovie),this.bgImg.setLoadCompleteBack(function(){i.isLoad=!0,i.updateView()},this),this.addChild(this.bgImg),this.nameLab=GObj.create(eui.Label),this.nameLab.size=24,this.nameLab.textColor=16774479,this.nameLab.stroke=1,this.nameLab.strokeColor=0,this.addChild(this.nameLab),this.icon=GObj.create(t.ImageOutside),this.addChild(this.icon)},e.prototype.updateView=function(){var i=this;if(this.isLoad&&this.data&&!this.isUpdate){this.isUpdate=!0;var e=this.bgImg.getEffectData();e&&(this.width=e.textureWidth,this.height=e.textureHeight,this.anchorOffsetX=this.width/2),this.nameLab.text=this.data.specName,this.nameLab.horizontalCenter=0,this.nameLab.y=t.IMiniGame23Consts.specTextY,this.icon.loadCompleteCall(function(){i.icon.horizontalCenter=0,i.icon.y=i.nameLab.y+i.nameLab.height+t.IMiniGame23Consts.icon_y,egret.Tween.removeTweens(i.icon),egret.Tween.get(i.icon,{loop:!0}).to({y:i.icon.y-2},400).to({y:i.icon.y+2},800).to({y:i.icon.y},400)},this),this.icon.setOutSrc(this.data.specIconName||"")}},e.prototype.setData=function(t){this.data=t,this.alpha=1,this.scaleX=this.scaleY=t.initScalXY||.05,this.totalScalx=t.totalScalXY||1,this.bgImg.visible=!0,this.bgImg.start(this.data.specEff?"addImg":"reduceImg"),this.bgImg.autoRun(),this.nameLab.visible=!0,this.icon.visible=!0,this.updateView()},e.prototype.run=function(){if(!this.isDie&&this.targetObject){var i,e=Math.ceil(this.targetObject.y);i=e>this.y?Number((this.scaleX+(e-this.y)*this.addNum).toFixed(4)):Number((this.scaleX-(this.y-e)*this.addNum).toFixed(4)),this.scaleX=this.scaleY=i,this.visible=this.scaleX>t.IMiniGame23Consts.showScaleXY,this.y=e,this.x=this.posArr[1]+this.scaleX*(this.posArr[this.posX]-this.posArr[1]),this.y>960+this.height&&(this.isDie=!0)}},e.prototype.setFun=function(t,i){this.thisObj=t,this.fun=i},e.prototype.isCanRemove=function(){return this.isDie},e.prototype.reset=function(){this.scaleX=this.scaleY=0,this.targetObject=null,this.isDie=!1,this._isPick=!1,this.data=null,this.isLoad=!1,this.isUpdate=!1,this.thisObj=null,this.fun=null,egret.Tween.removeTweens(this),this.icon&&egret.Tween.removeTweens(this.icon)},e.prototype.dispose=function(){this.reset(),this.posArr=null,GObj.disposeObject(this.bgImg),this.bgImg=null,GObj.disposeObject(this.icon),this.icon=null,GObj.disposeObject(this.nameLab),this.nameLab=null},e}(eui.Component);t.IMiniGame23Spec=i,__reflect(i.prototype,"miniGame.IMiniGame23Spec")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.exact=!0,t.initOnce(),t}return __extends(e,i),e.prototype.initOnce=function(){this.mapArr=[],this.coinArr=[],this.obstacleArr=[],this.specArr=[],this.specPool=[]},e.prototype.setData=function(i){i&&(this.stageData=i,IMiniGameMain.reqSocket(1,this.stageData.stageId),this.imageOffset=this.stageData.imageOffset||t.IMiniGame23Consts.imageOffset,this.upperWidth=this.stageData.upperWidth||t.IMiniGame23Consts.upperWidth,this.downWidth=this.stageData.downWidth||t.IMiniGame23Consts.downWidth,App.sound.playBgm(t.IMiniGame23Consts.minigame23_bgm),this.initSkins(),this.initGame())},e.prototype.initGame=function(){this.tempTime=0,1==this.stageData.stageId?this.isPause=!0:this.isPause=!1,this.isRunning=!1,this.bgImage.setOutSrc("bg"+this.stageData.mapId,FileConst.jpg),this.guide1.visible=this.guide2.visible=this.guide3.visible=this.guide4.visible=this.guideBg.visible=!1,this.initValue(),this.loadMapImage()},e.prototype.initValue=function(){if(this.mapArr)for(var i=0,e=this.mapArr;i<e.length;i++){var s=e[i];s.parent&&s.parent.removeChild(s),GObj.disposeObject(s)}if(this.mapArr=[],this.coinArr)for(var h=0,a=this.coinArr;h<a.length;h++){var n=a[h];n.reset(),n.parent&&n.parent.removeChild(n),t.IMiniGameMgr.ins.backPoolByObject(n)}if(this.coinArr=[],this.obstacleArr)for(var o=0,r=this.obstacleArr;o<r.length;o++){var l=r[o];l.reset(),l.parent&&l.parent.removeChild(l),t.IMiniGameMgr.ins.backPoolByObject(l)}if(this.obstacleArr=[],this.specArr)for(var p=0,c=this.specArr;p<c.length;p++){var s=c[p];s.parent&&s.parent.removeChild(s),this.backSpecObj(s)}this.specArr=[],this.mapNumber=0,this.mapSpeed=t.IMiniGame23Consts.mapSpeed,this.allBonus=100,this.allScore=0,this.start()},e.prototype.loadMapImage=function(){if(this.mapArr){if(this.mapNumber++,this.mapNumber>t.IMiniGame23Consts.mapImageNum)return void this.updateView();var i=GObj.create(t.ImageOutside);this.mapArr.push(i),this.mapGrp.addChildAt(i,0),i.loadCompleteCall(this.loaded,this),i.setOutSrc("map"+this.stageData.mapId,FileConst.png)}},e.prototype.loaded=function(){var t=this.mapArr[this.mapNumber-1];if(t.anchorOffsetX=t.width/2,t.x=this.mapGrp.width/2,1==this.mapNumber)t.scaleX=t.scaleY=1,t.y=this.mapGrp.height-t.height;else{var i=this.mapArr[this.mapNumber-2];t.scaleX=t.scaleY=Number((i.scaleX*this.upperWidth/this.downWidth).toFixed(4)),t.y=Math.ceil(i.y-t.height*t.scaleY+i.scaleY*this.imageOffset)}this.loadMapImage()},e.prototype.updateView=function(){this.step=1,this.tipsNum=0,this.isTwo=!1,this.changeBouse(0),this.inFrame=0,this.addPlayer(),this.initSkill(),this.initSkills=this.stageData.initSkills||[],this.initSkills.length>0?(this.skillGroup.visible=!0,this.skillIcon.setOutSrc("skill"+this.initSkills[0])):this.skillGroup.visible=!1,this.traveledSum=0,this.totalSum=this.stageData.totalSum||1e3,this.moveLabel.text=this.totalSum+"米",this.time=0,this.totalNum=this.stageData.skillScore||500,this.isRunning=!0,this.addSocre(0),this.frameNumber=0,this.updateProgess(this.traveledSum),egret.Tween.removeTweens(this),egret.Tween.get(this).wait(300).call(this.showGuide,this)},e.prototype.addPlayer=function(){if(this.player){this.player.setFun(this.setResult,this);var i=t.IMiniGame23Consts.players;if(this.player.setData(i),this.posArr=i.role_posArr||[170,270,370],this.player.x=this.player.getPlayerArr()[1],this.player.y=t.IMiniGame23Consts.roleY,void 0!=this.stageData.petIndex){var e=t.IMiniGame23Consts.pets[this.stageData.petIndex];this.player.addPets(e),this.changeBouse(e.bonusValue||100)}else this.player.hidePet();this.player.hideTitle()}},e.prototype.initRockerGrp=function(){this.rockerGrp=GObj.create(egret.DisplayObjectContainer),this.uiRect=GObj.create(eui.Rect),this.rockerGrp.width=this.uiRect.width=this.width,this.rockerGrp.height=this.uiRect.height=this.height,this.addChild(this.rockerGrp),this.uiRect.fillAlpha=.001,this.rockerGrp.addChild(this.uiRect)},e.prototype.initUiGrp=function(){var i=this;this.progressGrp=GObj.create(eui.Group),this.uiGrp.addChild(this.progressGrp),this.progressBg=GObj.create(t.ImageOutside),this.endIcon=GObj.create(t.ImageOutside),this.lightImg=GObj.create(t.ImageOutside),this.move1Grp=GObj.create(eui.Group),this.progressBg.verticalCenter=this.progressBg.horizontalCenter=0,this.progressBg.loadCompleteCall(function(){i.progressGrp.width=i.progressBg.width,i.progressGrp.height=i.progressBg.height,i.progressGrp.anchorOffsetX=i.progressGrp.width/2,i.progressGrp.x=i.uiGrp.width/2,i.progressGrp.y=75+IMiniGameMain.safeHeight,i.endIcon.x=i.progressGrp.width,i.endIcon.y=i.progressGrp.height/2,i.lightImg.y=i.progressGrp.height/2,i.move1Grp.x=i.progressGrp.width-10,i.move1Grp.y=i.progressGrp.height+20},this),this.progressBg.setOutSrc("perbar_0"),this.progressGrp.addChild(this.progressBg),this.progress=GObj.create(t.ImageOutside),this.progress.verticalCenter=0,this.progress.loadCompleteCall(function(){i.proGressWidth=i.progress.width},this),this.progress.setOutSrc("perbar_1"),this.progressGrp.addChild(this.progress),this.lightImg.loadCompleteCall(function(){i.lightImg.anchorOffsetX=i.lightImg.width/2,i.lightImg.anchorOffsetY=i.lightImg.height/2},this),this.lightImg.setOutSrc("light"),this.progressGrp.addChild(this.lightImg),this.endIcon.loadCompleteCall(function(){i.endIcon.anchorOffsetX=i.endIcon.width/2,i.endIcon.anchorOffsetY=i.endIcon.height/2},this),this.endIcon.setOutSrc("endIcon"),this.progressGrp.addChild(this.move1Grp),this.moveBg=GObj.create(t.ImageOutside),this.moveBg.loadCompleteCall(function(){i.move1Grp.height=i.moveBg.height,i.move1Grp.width=i.moveBg.width,i.move1Grp.anchorOffsetX=i.move1Grp.width/2},this),this.moveBg.setOutSrc("moveBg"),this.move1Grp.addChild(this.moveBg),this.moveLabel=GObj.create(eui.Label),this.moveLabel.size=22,this.moveLabel.textColor=15068671,this.moveLabel.horizontalCenter=this.moveLabel.verticalCenter=0,this.move1Grp.addChild(this.moveLabel),this.progressGrp.addChild(this.endIcon),this.mileageGrp=GObj.create(eui.Group),this.mileageGrp.y=100,this.uiGrp.addChild(this.mileageGrp),this.minute=GObj.create(t.ImageOutside),this.minute.loadCompleteCall(function(){i.mileageGrp.height=i.minute.height},this),this.minute.verticalCenter=0,this.minute.setOutSrc("minute"),this.mileageGrp.addChild(this.minute),this.numB=GObj.create(t.IBitNumMap),this.numB.setGap(-12),this.numB.setPath("num26"),this.numB.verticalCenter=0,this.numB.x=0,this.mileageGrp.addChild(this.numB),this.bonusText=GObj.create(eui.Label),this.socreGroup=GObj.create(eui.Group),this.uiGrp.addChild(this.socreGroup),this.socreImg=GObj.create(t.ImageOutside),this.socreGroup.x=0,this.socreGroup.y=150,this.socreImg.horizontalCenter=this.socreImg.verticalCenter=0,this.socreImg.loadCompleteCall(function(){i.socreGroup.width=i.socreImg.width,i.socreGroup.height=i.socreImg.height,i.bonusText.y=i.socreGroup.y+i.socreGroup.height+10},this),this.socreImg.setOutSrc("coinbg"),this.socreGroup.addChild(this.socreImg),this.socreLab=GObj.create(eui.Label),this.socreLab.size=28,this.socreLab.textColor=15068671,this.socreLab.verticalCenter=0,this.socreGroup.addChild(this.socreLab),this.coinIcon=GObj.create(t.ImageOutside),this.coinIcon.verticalCenter=0,this.coinIcon.x=15,this.coinIcon.loadCompleteCall(function(){i.socreLab.x=i.coinIcon.x+i.coinIcon.width+25},this),this.coinIcon.setOutSrc("coinicon"),this.socreGroup.addChild(this.coinIcon),this.bonusText.x=5,this.bonusText.size=22,this.bonusText.textColor=2546986,this.bonusText.stroke=1,this.bonusText.strokeColor=347665,this.uiGrp.addChild(this.bonusText)},e.prototype.initSkins=function(){var i=this;this.isInit||(this.isInit=!0,this.horizontalCenter=this.verticalCenter=0,this.width=540,this.height=960,this.touchMask=GObj.create(eui.Rect),this.touchMask.height=StageManager.stageHeight+600,this.touchMask.width=StageManager.stageWidth,this.touchMask.fillColor=0,this.touchMask.horizontalCenter=0,this.touchMask.verticalCenter=0,this.touchMask.alpha=.1,this.addChild(this.touchMask),this.sceneGrp=GObj.create(egret.DisplayObjectContainer),this.addChild(this.sceneGrp),this.bgImage=GObj.create(t.ImageOutside),this.sceneGrp.addChild(this.bgImage),this.mapGrp=GObj.create(egret.DisplayObjectContainer),this.mapGrp.height=960,this.mapGrp.width=540,this.sceneGrp.addChild(this.mapGrp),this.uiGrp=GObj.create(egret.DisplayObjectContainer),this.uiGrp.width=this.width,this.uiGrp.height=this.height,this.uiGrp.touchEnabled=!1,this.uiGrp.touchChildren=!1,this.addChild(this.uiGrp),this.initUiGrp(),this.avatarGrp=GObj.create(egret.DisplayObjectContainer),this.avatarGrp.width=this.width,this.avatarGrp.height=this.height,this.avatarGrp.touchEnabled=!1,this.avatarGrp.touchChildren=!1,this.addChild(this.avatarGrp),this.player=GObj.create(t.IMiniGame23Player),this.avatarGrp.addChild(this.player),this.specLabel=GObj.create(eui.Label),this.specLabel.size=36,this.specLabel.textColor=6225917,this.specLabel.stroke=1,this.specLabel.strokeColor=152209,this.addChild(this.specLabel),this.initRockerGrp(),this.guideBg=GObj.create(t.ImageOutside),this.guideBg.loadCompleteCall(function(){i.guideBg.anchorOffsetX=i.guideBg.width/2,i.guideBg.anchorOffsetY=i.guideBg.height/2},this),this.guideBg.setOutSrc("guideBg"),this.rockerGrp.addChild(this.guideBg),this.guide1=GObj.create(t.ImageOutside),this.guide1.loadCompleteCall(function(){i.guide1.anchorOffsetX=i.guide1.width/2,i.guide1.anchorOffsetY=i.guide1.height/2},this),this.guide1.setOutSrc("guide1"),this.rockerGrp.addChild(this.guide1),this.guide2=GObj.create(t.ImageOutside),this.guide2.loadCompleteCall(function(){i.guide2.anchorOffsetX=i.guide2.width/2,i.guide2.anchorOffsetY=i.guide2.height/2},this),this.guide2.setOutSrc("guide2"),this.rockerGrp.addChild(this.guide2),this.guide3=GObj.create(t.ImageOutside),this.guide3.loadCompleteCall(function(){i.guide3.anchorOffsetX=i.guide3.width/2,i.guide3.anchorOffsetY=i.guide3.height/2},this),this.guide3.setOutSrc("guide3"),this.rockerGrp.addChild(this.guide3),this.guide4=GObj.create(t.ImageOutside),this.guide4.loadCompleteCall(function(){i.guide4.anchorOffsetX=i.guide4.width/2,i.guide4.anchorOffsetY=i.guide4.height/2},this),this.guide4.setOutSrc("guide4"),this.rockerGrp.addChild(this.guide4),this.radius=0,this.skillGroup=GObj.create(eui.Group),this.skillbg=GObj.create(t.ImageOutside),this.shape=GObj.create(egret.Shape),this.skillMoive=GObj.create(t.IMovie),this.skillbg.loadCompleteCall(function(){i.skillGroup.height=i.skillbg.height,i.skillGroup.width=i.skillbg.width,i.skillGroup.anchorOffsetY=i.skillGroup.height/2,i.skillGroup.anchorOffsetX=i.skillGroup.width/2,i.skillMoive.x=i.shape.x=i.skillGroup.width/2,i.skillMoive.y=i.shape.y=i.skillGroup.height/2,i.radius=i.skillbg.iconWidth/2-2},this),this.skillbg.horizontalCenter=0,this.skillbg.verticalCenter=0,this.skillbg.setOutSrc("skillbg"),this.skillGroup.addChild(this.skillbg),this.skillGroup.addChild(this.shape),this.skillIcon=GObj.create(t.ImageOutside),this.skillIcon.exact=!0,this.skillIcon.verticalCenter=-1,this.skillIcon.horizontalCenter=0,this.skillGroup.addChild(this.skillIcon),this.skillGroup.horizontalCenter=0,this.skillGroup.bottom=t.IMiniGame23Consts.skillBottom,this.skillGroup.addChild(this.skillMoive),this.addChild(this.skillGroup),this.tipLabel=GObj.create(eui.Label),this.tipLabel.size=36,this.tipLabel.textColor=6225917,this.tipLabel.stroke=1,this.tipLabel.strokeColor=152209,this.addChild(this.tipLabel),this.exitBtn=GObj.create(t.IBaseBtn),this.exitBtn.icon=IMiniGameMain.getIcon("exit_btn",FileConst.png,"chapter"),this.exitBtn.right=20,this.exitBtn.y=150+IMiniGameMain.safeHeight,this.addChild(this.exitBtn),this.addEvent())},e.prototype.addEvent=function(){this.rockerGrp.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBeginClick,this),this.exitBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCloseClick,this),DispatcherManager.addListener(HGEvent.HEARTBEAT,this.timeFun,this),EnterFrameManager.instance.registeRender(this.update,this),this.skillGroup.addEventListener(egret.TouchEvent.TOUCH_TAP,this.openSkill,this)},e.prototype.removeEvent=function(){this.skillGroup.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.openSkill,this),this.rockerGrp.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBeginClick,this),this.rockerGrp.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMoveClick,this),this.rockerGrp.removeEventListener(egret.TouchEvent.TOUCH_END,this.onEndClick,this),this.exitBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onCloseClick,this),DispatcherManager.removeListener(HGEvent.HEARTBEAT,this.timeFun,this),EnterFrameManager.instance.unRegisteRender(this.update,this)},e.prototype.onBeginClick=function(i){this.isSlided=!1,$GApp.timer-this.tempTime<=t.IMiniGame23Consts.clickTime&&this.openSkill(),this.tempTime=$GApp.timer,this.tempoint||(this.tempoint=GObj.create(egret.Point)),this.avatarGrp.globalToLocal(i.stageX,i.stageY,this.tempoint),this.startX=this.tempoint.x,this.startY=this.tempoint.y,this.rockerGrp.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMoveClick,this),this.rockerGrp.addEventListener(egret.TouchEvent.TOUCH_END,this.onEndClick,this)},e.prototype.onMoveClick=function(i){if(this.player&&!this.isSlided){if(this.avatarGrp.globalToLocal(i.stageX,i.stageY,this.tempoint),this.endX=this.tempoint.x,this.endY=this.tempoint.y,!this.skill2Ing&&!this.skill3Ing&&this.startY-this.endY>=t.IMiniGame23Consts.isSlideNum){if(1==this.stageData.stageId&&3==this.step){this.isPause=!1,this.guide2.visible=this.guideBg.visible=!1,this.step=4,this.guide3.visible=!0,this.alpha=1,this.guide3.x=this.rockerGrp.width/2,this.guide3.y=this.rockerGrp.height/2-300,egret.Tween.get(this.guide3).to({alpha:0},t.IMiniGame23Consts.guide3Time);var e=IMiniGameMain.getGuideView();egret.Tween.removeTweens(e),e.parent&&e.parent.removeChild(e)}return this.isSlided=!0,this.inFrame=this.player.data.role_Frame||5,void this.player.setAction(AvatarConsts.ACTION_JUMP)}var s=this.endX-this.startX;if(Math.abs(s)>=t.IMiniGame23Consts.isSlideNum){if(1==this.stageData.stageId&&1==this.step){this.isPause=!1,this.guide1.visible=this.guideBg.visible=!1;var e=IMiniGameMain.getGuideView();egret.Tween.removeTweens(e),e.parent&&e.parent.removeChild(e),this.step=2}var h=this.player.getPlayerArr();this.isSlided=!0;var a=h.indexOf(this.player.x);s>0?(a+=1,a<h.length&&(this.player.x=h[a])):(a-=1,a>=0&&(this.player.x=h[a]))}}},e.prototype.onEndClick=function(){this.rockerGrp.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMoveClick,this),this.rockerGrp.removeEventListener(egret.TouchEvent.TOUCH_END,this.onEndClick,this)},e.prototype.onCloseClick=function(t){i.prototype.onCloseClick.call(this,t),this.initValue(),this.isRunning=!1},e.prototype.openSkill=function(){if(egret.Tween.get(this.skillGroup).to({scaleX:.8,scaleY:.8},20).to({scaleX:1,scaleY:1},20),this.isComplete){if(5==this.step&&1==this.stageData.stageId){this.step=6,this.isPause=!1,this.guideBg.visible=this.guide4.visible=!1;var i=IMiniGameMain.getGuideView();egret.Tween.removeTweens(i),i.parent&&i.parent.removeChild(i)}App.sound.playEff(t.IMiniGame23Consts.minigame23_skill),this.start();var e;if(this.juageSkill(Skill23Type.TYPE_1)&&(e=t.IMiniGame23Consts.skills[Skill23Type.TYPE_1],this.skill1Ing=!0,this.time1Ing=e.duration||5,this.player.addSkill1()),this.juageSkill(Skill23Type.TYPE_2)&&(e=t.IMiniGame23Consts.skills[Skill23Type.TYPE_2],this.skill2Ing=!0,this.time2Ing=e.duration||5,this.player.addSkill2()),this.juageSkill(Skill23Type.TYPE_3)){e=t.IMiniGame23Consts.skills[Skill23Type.TYPE_3],this.skill3Ing=!0,this.time3Ing=e.duration||5,this.player.addSkill3();var s=t.IMiniGame23Consts.mounts[e.comValue];this.player.addMount(s),this.player.setAction(AvatarConsts.ACTION_STAND),this.mapSpeed=this.mapSpeed+e.comValue||4}}},e.prototype.updateProgess=function(i){var e=Math.ceil(i/t.IMiniGame23Consts.meterNumber),s=e/this.totalSum;if(0>s?s=0:s>1&&(s=1),this.progress.width=s*this.proGressWidth,this.lightImg.x=s*this.proGressWidth,!this.isTwo&&e>=this.totalSum/2&&(this.isTwo=!0,IMiniGameMain.reqSocket(2)),e>=this.totalSum&&(e=this.totalSum,this.setResult(!0)),this.tipsNum>=t.IMiniGame23Consts.tipsNumber){this.tipsNum=0;var h=t.IMiniGame23Consts.tipsArr,a=GMath.randomInt(0,h.length-1);this.tipLabel.text=h[a],this.tipLabel.alpha=1,this.tipLabel.anchorOffsetX=this.tipLabel.width/2,this.tipLabel.x=this.width/2,this.tipLabel.y=this.height/2-300,egret.Tween.get(this.tipLabel).to({y:this.tipLabel.y-28,alpha:0},t.IMiniGame23Consts.tipsTime)}--this.frameNumber<=0&&(this.frameNumber=t.IMiniGame23Consts.frameNumber,this.numB.setNumber(e),this.mileageGrp.x=(this.uiGrp.width-this.mileageGrp.width)/2,this.minute.x=this.numB.width-10)},e.prototype.addSocre=function(t,i){var e=t;i&&(e=Math.ceil(t*this.allBonus/100)),this.allScore=this.allScore+e,this.socreLab.text=this.allScore+"",this.setAngerVal(e)},e.prototype.changeBouse=function(t){this.allBonus=this.allBonus+t,this.allBonus<0&&(this.allBonus=0),this.bonusText.text="元宝总加成："+(this.allBonus-100)+"%"},e.prototype.juageSkill=function(t){return-1!=this.initSkills.indexOf(t)},e.prototype.setResult=function(i){this.isRunning=!1,i?(t.IMiniGame23Consts.extraNum=this.allScore,App.sound.playEff(t.IMiniGame23Consts.minigame23_win),IMiniGameMain.reqSocket(3)):App.sound.playEff(t.IMiniGame23Consts.minigame23_die),i?t.IMiniGameResult.showResult(IMiniGameResultType.type_1,this.onCloseClick,this,3,0/0,t.IMiniGame23Consts.extra,t.IMiniGame23Consts.extraNum):t.IMiniGameResult.showResult(IMiniGameResultType.type_0,this.initGame,this)},e.prototype.update=function(){this.isRunning&&(this.playerRun(),this.isPause||(this.mapRun(),this.specRun(),this.coinsRun(),this.obstRun(),this.updateDraw()))},e.prototype.mapRun=function(){if(this.mapArr&&!(this.mapArr.length<=2)){for(var i,e,s,h,a=this.mapArr.length,n=this.downWidth/this.upperWidth,o=0;a>o;o++)i=this.mapArr[o],0==o?(e=this.mapGrp.height-i.y-this.imageOffset*i.scaleY,s=e/(i.height-this.imageOffset)*(n-1),i.scaleX=i.scaleY=n-s,i.y+=this.mapSpeed*i.scaleY):(h=this.mapArr[o-1],i.scaleX=i.scaleY=h.scaleX/n,i.y=h.y+h.scaleY*(this.imageOffset-this.mapSpeed)-i.height*i.scaleY);i=this.mapArr[0],i.y>=this.mapGrp.height&&(this.mapArr.splice(0,1),i.removeMe(),this.mapArr.push(i),this.mapGrp.addChildAt(i,0),this.shakeBgImg()),this.tipsNum=this.tipsNum+this.mapSpeed/t.IMiniGame23Consts.meterNumber,this.traveledSum+=this.mapSpeed,this.updateProgess(this.traveledSum)
}},e.prototype.shakeBgImg=function(){if(!this.isDestory){if(GMath.random(0,100)>t.IMiniGame23Consts.shakeNum)return;egret.Tween.removeTweens(this.sceneGrp);var i=t.IMiniGame23Consts.shakeArr,e=GMath.randomInt(i[0],i[1]),s=i[2];egret.Tween.get(this.sceneGrp).to({x:-e},s).to({y:e},s).to({x:e},s).to({y:-e},s).to({x:0,y:0},s)}},e.prototype.showGuide=function(){if(1==this.stageData.stageId&&1==this.step){var t=IMiniGameMain.getGuideView(),i=this.width/2,e=this.height/2;this.guideBg.x=this.guide1.x=i,this.guideBg.y=this.guide1.y=e-100,this.guideBg.visible=this.guide1.visible=!0,t.playEffct(i-50,e),this.addChild(t),egret.Tween.removeTweens(t),egret.Tween.get(t,{loop:!0}).to({x:i+50},500).to({x:i-50},500)}},e.prototype.playerRun=function(){this.player&&this.player.run()},e.prototype.coinsRun=function(){for(var i,e,s,h,a,n=this.player.width*this.player.scaleX/2*t.IMiniGame23Consts.playersCheck,o=this.player.height*this.player.scaleX/2*t.IMiniGame23Consts.playersCheck,r=0;r<this.coinArr.length;r++)if(i=this.coinArr[r],!i.isTween){if(i.run(),this.skill1Ing&&!i.isAttract){if(h=GMath.distance(i.x,i.y,this.player.x,this.player.y),a=t.IMiniGame23Consts.skills[Skill23Type.TYPE_1],!a)continue;h<a.comValue&&(i.isAttract=!0,i.setTarget(this.player))}i.isCanBack?(this.coinArr.splice(r,1),i.reset(),t.IMiniGameMgr.ins.backPoolByObject(i),i.parent&&i.parent.removeChild(i),r--):(e=i.width*i.scaleX/2,s=i.height*i.scaleX,i.y+s>=this.player.y-o&&i.y<=this.player.y+o&&i.x+e>=this.player.x-n&&i.x-e<=this.player.x+n&&(i.isAttract?i.isCanBack=!0:i.tweenIng(),App.sound.playEff(t.IMiniGame23Consts.minigame23_coin),this.addSocre(i.coinProp,!0)))}},e.prototype.obstRun=function(){this.inFrame--,this.inFrame<0&&(this.inFrame=0);for(var i,e,s,h=this.player.width*this.player.scaleX/2*t.IMiniGame23Consts.playersCheck,a=this.player.height*this.player.scaleX/2*t.IMiniGame23Consts.playersCheck,n=0;n<this.obstacleArr.length;n++)i=this.obstacleArr[n],0!=i.numChildren&&(i.run(),i.isCanBack?(this.obstacleArr.splice(n,1),i.reset(),t.IMiniGameMgr.ins.backPoolByObject(i),i.parent&&i.parent.removeChild(i),n--):this.skill2Ing||this.skill3Ing||(e=i.width*i.scaleX/2,s=i.height*i.scaleX,this.inFrame>0&&i.isJump||i.y+s>=this.player.y-a&&i.y<=this.player.y+a&&i.x+e>=this.player.x-h&&i.x-e<=this.player.x+h&&this.player.setAction(AvatarConsts.ACTION_DIE)));if(2==this.step&&1==this.stageData.stageId&&0!=this.obstacleArr.length&&this.player.y-this.obstacleArr[0].y<=t.IMiniGame23Consts.woodNumber){this.isPause=!0,this.step=3;var o=IMiniGameMain.getGuideView(),r=this.width/2,l=this.height/2;this.guideBg.x=this.guide2.x=r,this.guideBg.y=this.guide2.y=l-100,this.guideBg.visible=this.guide2.visible=!0,o.playEffct(r,l),this.addChild(o),egret.Tween.removeTweens(o),egret.Tween.get(o,{loop:!0}).to({y:r-100},600).to({y:l},50)}},e.prototype.getMinMap=function(){for(var t,i=this.mapArr[0],e=this.mapArr.length,s=0;e>s;s++)t=this.mapArr[s],t.y<i.y&&(i=t);return i},e.prototype.createSpec=function(i){for(var e=i.length,s=this.getMinMap(),h=0;e>h;h++){var a=void 0;a=this.getSpecObj(),a.setData(i[h]),a.posArr=t.IMiniGame23Consts.specArr,a.posX=i[h].specLR,a.setAddNum(this.player.y,s.y),a.x=a.posArr[1]+s.scaleX*(a.posArr[a.posX]-a.posArr[1]),a.y=Math.ceil(s.y),a.setTarget(s),this.specArr.push(a)}},e.prototype.specRun=function(){var i=this.specArr.length;if(0!=i)for(var e,s,h,a=this.player.width*this.player.scaleX/2*t.IMiniGame23Consts.playersCheck,n=this.player.height*this.player.scaleX/2*t.IMiniGame23Consts.playersCheck,o=0;i>o;o++)e=this.specArr[o],e&&(e.isCanRemove()?(this.specArr.splice(o,1),o--,this.backSpecObj(e)):(e.run(),e.getIsPick()||(s=e.width*e.scaleX/2,h=e.height*e.scaleX,e.y+h>=this.player.y-n&&e.y<=this.player.y+n&&e.x+s>=this.player.x-a&&e.x-s<=this.player.x+a&&(e.setPick(),e.data.specEff?App.sound.playEff(t.IMiniGame23Consts.minigame23_add):App.sound.playEff(t.IMiniGame23Consts.minigame23_reduce),this.setSpecTimeOfPick(e.data.specTime),this.addBySpec(e.data,[e.x,e.y])))))},e.prototype.addBySpec=function(i,e){if(i&&e){switch(this.specLabel.x=this.width/2,this.specLabel.y=this.height/2-300,i.index){case Spec23Type.TYPE_1:this.mapSpeed=this.mapSpeed+i.specValue,this.mapSpeed<1&&(this.mapSpeed=1),this.specLabel.text=IMiniGameMain.getString(i.specText,i.specValue);break;case Spec23Type.TYPE_2:this.changeBouse(i.specValue),this.specLabel.text=IMiniGameMain.getString(i.specText,i.specValue);break;case Spec23Type.TYPE_3:this.addSocre(i.specValue),this.specLabel.text=IMiniGameMain.getString(i.specText,i.specValue);break;case Spec23Type.TYPE_4:this.addTitle(i.specValue)}this.specLabel.alpha=1,this.specLabel.anchorOffsetX=this.specLabel.width/2,egret.Tween.get(this.specLabel).to({y:this.specLabel.y-28,alpha:0},t.IMiniGame23Consts.tipsTime)}},e.prototype.addTitle=function(i){var e=t.IMiniGame23Consts.titles[i];if(e){var s=e.titleValue;switch(i){case Title23Type.TYPE_1:this.addSocre(s);break;case Title23Type.TYPE_2:this.mapSpeed=this.mapSpeed+s,this.mapSpeed<1&&(this.mapSpeed=1);break;case Title23Type.TYPE_3:this.changeBouse(s)}this.player.setTitle(e.model),this.specLabel.text=IMiniGameMain.getString(e.titleText,e.titleValue),this.specLabel.anchorOffsetX=this.specLabel.width/2}},e.prototype.setSpecTimeOfPick=function(t){var i=this.specArr.length;if(0!=i)for(var e,s=0;i>s;s++)e=this.specArr[s],e&&e.data.specTime==t&&e.setPick(!1)},e.prototype.initSkill=function(){this.skill1Ing=!1,this.player.hideSkill1(),this.skill3Ing=!1,this.player.hideSkill3(),this.skill2Ing=!1,this.player.hideSkill2(),this.player.hideMount()},e.prototype.skillTime=function(){if(this.skill1Ing&&--this.time1Ing<=0&&(this.time1Ing=0,this.skill1Ing=!1,this.player.hideSkill1()),this.skill2Ing&&--this.time2Ing<=0&&(this.time2Ing=0,this.skill2Ing=!1,this.player.hideSkill2()),this.skill3Ing&&--this.time3Ing<=0){this.time3Ing=0,this.skill3Ing=!1,this.player.hideSkill3(),this.player.hideMount(),this.player.setAction(AvatarConsts.ACTION_WALK);var i=t.IMiniGame23Consts.skills[Skill23Type.TYPE_3]||{};this.mapSpeed=this.mapSpeed-i.comValue||4}},e.prototype.timeFun=function(){if(this.isRunning&&!this.isPause){this.skillTime(),this.time++;var i=this.stageData.specs[this.time];i&&(t.IMiniGame23.setDefSpecVo(i,this.time),this.createSpec(i));var e=this.stageData.coins[this.time];e&&(t.IMiniGame23.setDefCoinVo(e),this.createCoin(e));var s=this.stageData.obsts[this.time];s&&(t.IMiniGame23.setDefObstVo(s),this.createObst(s))}},e.prototype.createObst=function(i){for(var e=i.length,s=this.getMinMap(),h=0;e>h;h++){var a=void 0;a=t.IMiniGameMgr.ins.getPoolByClass(t.IMiniGame23Obst),a.setData(i[h]),a.posArr=t.IMiniGame23Consts.obstArr,a.posX=i[h].obstLR,a.setAddNum(this.player.y,s.y),a.x=a.posArr[1]+s.scaleX*(a.posArr[a.posX]-a.posArr[1]),a.y=Math.ceil(s.y),a.setTarget(s),this.obstacleArr.push(a),this.uiGrp.addChildAt(a,0)}},e.prototype.createCoin=function(i){var e,s,h,a,n=i.length,o=this.getMinMap();if(o)for(var r=0;n>r;r++){a=i[r],s=a.coinNum,h=a.coinDis||80;for(var l=0;s>l;l++)e=t.IMiniGameMgr.ins.getPoolByClass(t.IMiniGame23Coin),e.setData(a),e.posIndex=l+1,e.posArr=t.IMiniGame23Consts.coinArr,e.posX=a.coinLR,e.setAddNum(this.player.y,o.y),e.x=e.posArr[1]+o.scaleX*(e.posArr[a.coinLR]-e.posArr[1]),e.y=Math.ceil(o.y+e.scaleY*a.coinDis),e.isRunning=!0,e.setTarget(o),this.coinArr.push(e),this.uiGrp.addChildAt(e,0)}},e.prototype.start=function(){this.shape.graphics.clear(),this.isComplete=!1,this.skillMoive.stop(),this.val=0,this.targetVal=0},e.prototype.setAngerVal=function(t){this.targetVal+=t||0,this.updateDraw()},e.prototype.stop=function(){if(this.isComplete=!0,this.skillMoive.start(t.IMiniGame23Consts.ui_kuang),this.skillMoive.autoRun(),4==this.step&&1==this.stageData.stageId){this.isPause=!0,this.step=5;var i=IMiniGameMain.getGuideView(),e=this.skillGroup.x,s=this.skillGroup.y;this.guideBg.x=this.guide4.x=this.width/2,this.guideBg.y=this.guide4.y=this.height/2-100,this.guideBg.visible=this.guide4.visible=!0,i.playEffct(e,s),this.addChild(i)}},e.prototype.getSpecObj=function(){var i=this.specPool.pop();return i||(i=GObj.create(t.IMiniGame23Spec)),this.uiGrp.addChildAt(i,0),i},e.prototype.backSpecObj=function(t){t&&-1==this.specPool.indexOf(t)&&(t.reset(),t.parent&&t.parent.removeChild(t),this.specPool.push(t))},e.prototype.updateDraw=function(){this.isComplete||this.val>=this.targetVal||(this.val=this.targetVal,this.totalNum<=this.val&&this.stop(),this.draw())},e.prototype.draw=function(){var t=this.val;t>=this.totalNum&&(t=this.totalNum-.001);var i=3*Math.PI/2,e=i+2*Math.PI*t/this.totalNum,s=this.shape.graphics;s.clear(),s.beginFill(16765970,1),s.moveTo(0,0),s.lineTo(this.radius,0),s.drawArc(0,0,this.radius,e,i,!0),s.lineTo(0,0),s.endFill()},e.prototype.clearOneArr=function(t){if(t)for(var i=0,e=t;i<e.length;i++){var s=e[i];GObj.disposeObject(s)}t=null},e.prototype.clearArr=function(){this.clearOneArr(this.coinArr),this.clearOneArr(this.mapArr),this.clearOneArr(this.specArr),this.clearOneArr(this.specPool),this.clearOneArr(this.obstacleArr)},e.prototype.dispose=function(){this.removeEvent(),this.clearArr(),this.stageData=null,this.posArr=null,GObj.disposeObject(this.sceneGrp),this.sceneGrp=null,GObj.disposeObject(this.progressGrp),this.progressGrp=null,GObj.disposeObject(this.move1Grp),this.move1Grp=null,GObj.disposeObject(this.socreGroup),this.socreGroup=null,GObj.disposeObject(this.socreLab),this.socreLab=null,GObj.disposeObject(this.bonusText),this.bonusText=null,GObj.disposeObject(this.shape),this.shape=null,GObj.disposeObject(this.moveLabel),this.moveLabel=null,GObj.disposeObject(this.mapGrp),this.mapGrp=null,GObj.disposeObject(this.touchMask),this.touchMask=null,GObj.disposeObject(this.avatarGrp),this.avatarGrp=null,GObj.disposeObject(this.uiGrp),this.uiGrp=null,GObj.disposeObject(this.uiRect),this.uiRect=null,GObj.disposeObject(this.tempoint),this.tempoint=null,GObj.disposeObject(this.skillGroup),this.skillGroup=null,GObj.disposeObject(this.rockerGrp),this.rockerGrp=null,GObj.disposeObject(this.bgImage),this.bgImage=null,GObj.disposeObject(this.player),this.player=null,GObj.disposeObject(this.skillbg),this.skillbg=null,GObj.disposeObject(this.progressBg),this.progressBg=null,GObj.disposeObject(this.progress),this.progress=null,GObj.disposeObject(this.endIcon),this.endIcon=null,GObj.disposeObject(this.lightImg),this.lightImg=null,GObj.disposeObject(this.moveBg),this.moveBg=null,GObj.disposeObject(this.socreImg),this.socreImg=null,GObj.disposeObject(this.coinIcon),this.coinIcon=null,GObj.disposeObject(this.shape),this.shape=null,GObj.disposeObject(this.numB),this.numB=null,GObj.disposeObject(this.minute),this.minute=null,GObj.disposeObject(this.skillIcon),this.skillIcon=null,GObj.disposeObject(this.skillMoive),this.skillMoive=null,GObj.disposeObject(this.mileageGrp),this.mileageGrp=null,GObj.disposeObject(this.specLabel),this.specLabel=null,GObj.disposeObject(this.guideBg),this.guideBg=null,GObj.disposeObject(this.guide1),this.guide1=null,GObj.disposeObject(this.guide2),this.guide2=null,GObj.disposeObject(this.guide3),this.guide3=null,GObj.disposeObject(this.guide4),this.guide4=null,GObj.disposeObject(this.tipLabel),this.tipLabel=null,i.prototype.dispose.call(this)},e}(t.IBaseView);t.IMiniGame23View=i,__reflect(i.prototype,"miniGame.IMiniGame23View")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(t){return i.call(this,t)||this}return __extends(e,i),e.prototype.getGameView=function(){return this.gameView||(this.gameView=GObj.create(t.IMiniGame28View)),this.gameView.setData(this.getCurGameData()),this.gameView},e.prototype.loadConfigComplete=function(e){if(e)for(var s in e.config)t.IMiniGame28Consts[s]=e.config[s];var h=[];h=h.concat([1,0,0,0,100]),h=h.concat([0,0,0,0,0]),h=h.concat([0,0,0,0,0]),h=h.concat([0,0,0,1,0]),t.IMiniGame28Consts.redFilter=new egret.ColorMatrixFilter(h),h=[],h=h.concat([1,0,0,0,150]),h=h.concat([0,1,0,0,150]),h=h.concat([0,0,1,0,150]),h=h.concat([0,0,0,1,0]),t.IMiniGame28Consts.flashFilter=new egret.ColorMatrixFilter(h),i.prototype.loadConfigComplete.call(this,e)},e.setPlayerVo=function(i,e){var s=t.IMiniGame28Consts.players[e];for(var h in s)i[h]=s[h]},e.setDefMonsterVo=function(i){for(var e,s,h,a=0;a<i.length;a++){s=i[a],e=s.index,h=t.IMiniGame28Consts.monsters[e];for(var n in h)void 0==s[n]&&"monProp"!=n&&(s[n]=h[n])}},e.setDefSpecVo=function(i,e){for(var s=0;s<i.length;s++){var h=i[s].index,a=t.IMiniGame28Consts.specs[h];for(var n in a)void 0==i[s][n]&&(i[s][n]=a[n]);void 0!=e&&(i[s].specTime=e)}},e.prototype.dispose=function(){i.prototype.dispose.call(this)},e}(t.IMiniGameBaseCtr);t.IMiniGame28=i,__reflect(i.prototype,"miniGame.IMiniGame28")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(){function t(){this.fixHeight=0}return t.prototype.setAngle=function(t){this._isMove&&t!=this.angle&&(this.angle=t,this.speedx=this.speed*GMath.cos(t),this.speedy=this.speed*GMath.sin(t))},t.prototype.setRocker=function(t){this.isRocker=t,this.isSlideX=!1,this.isSlideY=!1},t.prototype.setMove=function(t){this._isMove=t},t.prototype.setFixHeight=function(t){this.fixHeight=t,this.minY=t},t.prototype.setX=function(t,i){this.minX=t,this.maxX=i},t.prototype.setY=function(t,i){this.point_y<=t&&(this.point_y=t),this.point_y>=i&&(this.point_y=i),this.minY=t,this.maxY=i},t.prototype.getMinY=function(){return this.minY},t.prototype.getMaxY=function(){return this.maxY},t.prototype.setMoveArea=function(t,i,e,s){this.minX=t,this.maxX=i,this.minY=e,this.maxY=s},t.prototype.run=function(){if(this._isMove)if(this.isRocker)this.tempX=this.point_x+(this.speedx||0),this.tempX>this.minX&&this.tempX<this.maxX&&(this.point_x=this.tempX),this.tempY=this.point_y+(this.speedy||0),this.tempY>this.minY&&this.tempY<this.maxY&&(this.point_y=this.tempY);else{if(void 0==this.endX)return;this.tempX=this.point_x+(this.speedx||0),this.tempY=this.point_y+(this.speedy||0),this.speedx>0?this.tempX<this.maxX&&(this.endX>=this.maxX&&(this.endX=this.maxX),this.tempX<this.endX&&(this.point_x=this.tempX),this.isSlideX&&this.point_x<this.targetEndX&&(this.point_x=this.tempX)):this.tempX>this.minX&&(this.endX<=this.minX&&(this.endX=this.minX),this.endX<this.tempX&&(this.point_x=this.tempX),this.isSlideX&&this.point_x>this.targetEndX&&(this.point_x=this.tempX)),this.speedy>0?this.tempY<this.maxY&&(this.endY>=this.maxY&&(this.endY=this.maxY),this.tempY<this.endY&&(this.point_y=this.tempY),this.isSlideY&&this.point_y<this.targetEndY&&(this.point_y=this.tempY)):this.tempY>this.minY&&(this.endY<=this.minY&&(this.endY=this.minY),this.endY<this.tempY&&(this.point_y=this.tempY),this.isSlideY&&this.point_y>this.targetEndY&&(this.point_y=this.tempY))}},t.prototype.dispose=function(){},t}();t.IMiniGame28CenterPoint=i,__reflect(i.prototype,"miniGame.IMiniGame28CenterPoint")}(miniGame||(miniGame={}));var miniGame;!function(t){t.IMiniGame28Consts={soundFrame:15,isAtkSwitch:!0,firstRingNum:8,hero_MaxNum:3,player_sclaXY:.5,monster_sclaXY:.5,boss_bottom:"ui_boss",speedValue:10,bossText:"{}人打倒",manText:"人数：{}",moveText:"{}米","continue":"点击继续",isRocker:1,lineNum:3,frameTotal:5,playx_value:-20,playy_value:-20,monPos:[108,216,324,432],specPos:[108,216,324,432],heroDisplay:!0,allow_bottom:100,rocker_bottom:10,petsNumber:4,redFilter:null,flashFilter:null,seleRoleDir:!0,roleY:850,mapSpeed:1,arrowTime:200,role_select_eff:"ui_xuankuang",addEff:"ui_shengji",reduceEff:"ui_jiangdi",dieEff:"ui_siwang",minigame28_bgm:"bgm_login",minigame28_win:"win",minigame28_die:"minigame28_die",minigame28_boss:"minigame28_boss",minigame28_add:"minigame28_add",minigame28_reduce:"minigame28_reduce",minigame28_monD:"minigame28_monD",bossMovie:"ui_bosslaixi",specTextY:0,icon_y:2,monsters:{},specs:{},players:{},pets:{},mounts:{},wings:{},weapons:{}}}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(){function i(){this.monArr=[],this.hpGrp=GObj.create(t.IMiniGame28HpGrp)}return i.prototype.run=function(){this.hpGrp&&this.hpGrp.run()},i.prototype.backMon=function(i){i&&i.parent&&(i.reset(),i.parent.removeChild(i),t.IMiniGameMgr.ins.backPoolByObject(i))},i.prototype.pushMon=function(t){t&&this.monArr&&-1==this.monArr.indexOf(t)&&this.monArr.push(t)},i.prototype.unshiftMon=function(t){t&&this.monArr&&-1==this.monArr.indexOf(t)&&this.monArr.unshift(t)},i.prototype.reset=function(){if(this.isBoss=!1,this.monArr)for(var i=0,e=this.monArr;i<e.length;i++){var s=e[i];t.IMiniGameMgr.ins.backPoolByObject(s),s=null}this.hpGrp&&(this.hpGrp.visible=!1),this.monArr=[]},i.prototype.resetGrp=function(){this.hpGrp&&(this.hpGrp.setTextColor(16723211),this.hpGrp.setIcon("enemyIcon"),this.hpGrp.visible=!0,this.monArr&&this.monArr.length>0&&(this.hpGrp.x=this.monArr[0].x,this.hpGrp.y=this.monArr[0].y),this.resetHp())},i.prototype.getHpSum=function(){var t=0;if(!this.monArr)return t;for(var i,e=this.monArr.length,s=0;e>s;s++)i=this.monArr[s],t+=i._hp;return t},i.prototype.resetHp=function(){this.hpGrp&&this.hpGrp.setLabelNum(this.getHpSum())},i.prototype.doCitcle=function(){if(this.monArr&&0!=this.monArr.length){for(var i,e,s,h=this.monArr[0],a=this.monArr.length,n=1;a>n;n++)i=this.monArr[n],s=this.getRingIndex(n),e=360/(s[0]*t.IMiniGame28Consts.firstRingNum)*s[1],i.x=h.x+GMath.cos(e)*s[0]*t.IMiniGame28Consts.playx_value,i.y=h.y+GMath.sin(e)*s[0]*t.IMiniGame28Consts.playy_value;this.updateZindex()}},i.prototype.updateZindex=function(){for(var t,i,e,s,h=this.monArr.length,a=0;h>a;a++)if(t=this.monArr[a],t.parent)for(var n=0;h>n;n++)i=this.monArr[n],t!=i&&(e=t.parent.getChildIndex(t),s=t.parent.getChildIndex(i),t.y>i.y?s>e&&(t.parent.addChildAt(t,s),t.parent.addChildAt(i,e)):t.y<i.y&&e>s&&(t.parent.addChildAt(t,s),t.parent.addChildAt(i,e)))},i.prototype.getRingIndex=function(i){for(var e,s,h=1;i>h*(h-1)*t.IMiniGame28Consts.firstRingNum/2;)h++;return e=h-1,s=i-e*(e-1)*t.IMiniGame28Consts.firstRingNum/2-1,[e,s]},i.prototype.dispose=function(){if(this.monArr)for(var t=0,i=this.monArr;t<i.length;t++){var e=i[t];GObj.disposeObject(e),e=null}this.monArr=null,GObj.disposeObject(this.hpGrp),this.hpGrp=null},i}();t.IMiniGame28Dump=i,__reflect(i.prototype,"miniGame.IMiniGame28Dump")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.initSkins(),t}return __extends(e,i),e.prototype.initSkins=function(){var i=this;this.bgImg=GObj.create(t.ImageOutside),this.bgImg.loadCompleteCall(function(){i.width=i.bgImg.width,i.height=i.bgImg.height,i.anchorOffsetX=i.width/2,i.anchorOffsetY=i.height/2},this),this.bgImg.setOutSrc("hpBg"),this.addChild(this.bgImg),this.iconImg=GObj.create(t.ImageOutside),this.iconImg.x=8,this.iconImg.verticalCenter=0,this.addChild(this.iconImg),this.hpText=GObj.create(eui.Label),this.hpText.x=28,this.hpText.size=18,this.hpText.verticalCenter=0,this.addChild(this.hpText)},e.prototype.setLabelNum=function(t){this.hpText&&(this.hpText.text=t+"")},e.prototype.setTextColor=function(t){this.hpText&&(this.hpText.textColor=t)},e.prototype.setIcon=function(t){this.iconImg&&this.iconImg.setOutSrc(t)},e.prototype.run=function(){this.y+=t.IMiniGame28Consts.mapSpeed},e.prototype.dispose=function(){GObj.disposeObject(this.iconImg),this.iconImg=null,GObj.disposeObject(this.bgImg),this.bgImg=null,GObj.disposeObject(this.hpText),this.hpText=null},e}(egret.DisplayObjectContainer);t.IMiniGame28HpGrp=i,__reflect(i.prototype,"miniGame.IMiniGame28HpGrp")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(t){function i(){return t.call(this)||this}return __extends(i,t),i.prototype.getEffectData=function(){return this._effect&&this._effect.ttfs?this._effect.ttfs[0].ttr||null:null},i.prototype.dispose=function(){t.prototype.dispose.call(this)},i}(t.IMovie);t.IMiniGame28IMovie=i,__reflect(i.prototype,"miniGame.IMiniGame28IMovie")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){return i.call(this)||this}return __extends(e,i),e.prototype.setData=function(i){i&&(this.reset(),this.alpha=1,this.data=i,this.scaleX=this.scaleY=this.data.scaleXY||1,this.data.isBoss&&(this.isBoss=this.data.isBoss,this.showBoss()),this.updatePart(this.data.model),this.setDirection(0),this.speed=t.IMiniGame28Consts.mapSpeed,this.setAngle(90),this.monRadius=i.monRadius||200,this.data.isNotAtt?(this.isNotAtt=this.data.isNotAtt,this.setAction(AvatarConsts.ACTION_WALK)):this.setAction(AvatarConsts.ACTION_STAND),i.hp?this._hp=GMath.randomInt(i.hp[0],i.hp[1]):this._hp=1)},e.prototype.partComplete=function(t){i.prototype.partComplete.call(this,t),t&&t.jsonObj&&(this.fixWidth=t.jsonObj.frames[0].w,this.fixHeight=t.jsonObj.frames[0].h)},e.prototype.actionOver=function(t){switch(i.prototype.actionOver.call(this,t),t){case AvatarConsts.ACTION_DIE:this.isDieBack=!1}},e.prototype.setTarget=function(t){this.isNotAtt||(this.isTarget=!0,this.playerTarget=t)},e.prototype.isChoice=function(){return this.isBoss||!this.isTarget},e.prototype.showBoss=function(){this.ui_boss||(this.ui_boss=GObj.create(t.IMovie),this.addChildAt(this.ui_boss,0)),this.ui_boss.start(t.IMiniGame28Consts.boss_bottom),this.ui_boss.autoRun()},e.prototype.hideBoss=function(){this.ui_boss&&(this.ui_boss.parent&&this.ui_boss.parent.removeChild(this.ui_boss),GObj.disposeObject(this.ui_boss),this.ui_boss=null)},e.prototype.reset=function(){this.hideBoss(),this.data=null,this.filters=null,this.isNotAtt=!1,this._isMove=!0,this.resetTarget(),this._hp=0,this._isDie=!1,this.isDieBack=!1,this.isBoss=!1,this.isDrop=!1},e.prototype.resetTarget=function(){this.isTarget=!1,this.playerTarget=null},e.prototype.run=function(){i.prototype.run.call(this),this.playerTarget&&!this._isDie?(this.setAction(AvatarConsts.ACTION_WALK),this.lockTarget(),this.playerTarget.y<this.y&&(this.speed=t.IMiniGame28Consts.mapSpeed,this.setAngle(90),this.data&&this.data.isNotAtt||this.setAction(AvatarConsts.ACTION_STAND),this.playerTarget&&this.playerTarget.setAtkTarget(null),this.isNotAtt=!0,this.resetTarget())):this.y>StageManager.stageHeight+this.fixHeight&&(this._isDie=!0)},e.prototype.isDie=function(){return this._isDie},e.prototype.setDie=function(){this._isDie=!0},e.prototype.lockTarget=function(){var t=this.playerTarget.y-this.playerTarget.fixHeight*this.playerTarget.scaleY/2,i=GMath.angle(this.x,this.y,this.playerTarget.x,t);this.speed=this.data.monSpeed||5,this.setAngle(i)},e.prototype.move=function(){this._isDie||(this.x=this.x+this.speedx||0,this.y=this.y+this.speedy||0)},e.prototype.setHit=function(i){var e=this;this._hp-=i,egret.Tween.removeTweens(this),this.filters=[t.IMiniGame28Consts.redFilter],egret.Tween.get(this).wait(100).call(function(){e.filters=null}),this._hp<=0&&(this._hp=0,this._isDie=!0,this.isDieBack=!0,this.alpha=1,this.isBoss?this.setAction(AvatarConsts.ACTION_DIE):egret.Tween.get(this).to({alpha:0},100).call(function(){e.isDieBack=!1}))},e.prototype.isCanRemove=function(){return this._isDie&&!this.isDieBack},e.prototype.dispose=function(){egret.Tween.removeTweens(this),this.reset(),i.prototype.dispose.call(this)},e}(t.IAvatarViewCtr);t.IMiniGame28Monster=i,__reflect(i.prototype,"miniGame.IMiniGame28Monster")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){return i.call(this)||this}return __extends(e,i),e.prototype.getSoundName=function(){return this.soundName},e.prototype.setSoundName=function(t){this.soundName=t},e.prototype.getStartTime=function(){return this.part.startTime},e.prototype.setStartTime=function(t){this.part.startTime=t},e.prototype.updateAngle=function(t){this.angle=t,this.speedx=this.speed*GMath.cos(t),this.speedy=this.speed*GMath.sin(t)},e.prototype.setSoundFun=function(t,i){this.soundFun=t,this.soundObj=i},e.prototype.setData=function(t){t&&(this._isDie=!1,this.data=t,this.speed=this.data.role_speed||1,this.scaleX=this.scaleY=this.data.role_scaleXY||1,this.keyFrames=t.aktFrame||[[2,2]],this.key2Frames=t.akt1Frame||[[2,2]],this.atkSpeed=t.atkSpeed||1,this.diffusion=t.diffusionA,this.atkGap=t.atkGap||50,this.realAtk=t.aktNum||1,this.soundName=t.atkSound||"",this._isMove=this.isAtking=!1,this.radius=t.radius||100,void 0===this.diffusion&&(this.diffusion=180),this.updatePart(this.data.role_model),this.setDirection(0),this.changeAction(this.isAtking,this._isMove),this.reset())},e.prototype.setFun=function(t,i){this.fun1=t,this.thisobj1=i},e.prototype.setOneFun=function(t,i){this.oneFun=t,this.oneObj=i},e.prototype.setFun2=function(t,i){this.fun2||(this.fun2=t,this.thisobj2=i)},e.prototype.setIsMove=function(t){this._isMove=t},e.prototype.getIsMove=function(){return this._isMove},e.prototype.partComplete=function(t){i.prototype.partComplete.call(this,t),t&&t.jsonObj&&!this.fixWidth&&(this.fixWidth=t.jsonObj.frames[0].w,this.fixHeight=t.jsonObj.frames[0].h,this.oneFun&&this.oneFun.call(this.oneObj,this.fixHeight*this.scaleY),this.oneFun=this.oneObj=null)},e.prototype.initData=function(){if(this.petsArr)for(var t=0,i=this.petsArr;t<i.length;t++){var e=i[t];e.parent&&e.parent.removeChild(e),GObj.disposeObject(e),e=null}this.petsArr=[],this.petIds=[]},e.prototype.changeAction=function(t,i){this.isAtkA||(this.mountObj?t?(this.isAtkA=!0,this.walkAtk=!1,this.setAction(AvatarConsts.ACTION_ATTACK),this.weaponObj&&this.weaponObj.setAction(AvatarConsts.ACTION_ATTACK)):(this.setAction(AvatarConsts.ACTION_STAND),this.weaponObj&&this.weaponObj.setAction(AvatarConsts.ACTION_STAND)):t?(this.isAtkA=!0,i?(this.walkAtk=!0,this.setAction(AvatarConsts.ACTION_ATTACK_I),this.weaponObj&&this.weaponObj.setAction(AvatarConsts.ACTION_ATTACK_I)):(this.walkAtk=!1,this.setAction(AvatarConsts.ACTION_ATTACK),this.weaponObj&&this.weaponObj.setAction(AvatarConsts.ACTION_ATTACK))):i?(this.setAction(AvatarConsts.ACTION_WALK),this.weaponObj&&this.weaponObj.setAction(AvatarConsts.ACTION_WALK)):(this.setAction(AvatarConsts.ACTION_STAND),this.weaponObj&&this.weaponObj.setAction(AvatarConsts.ACTION_STAND)))},e.prototype.run=function(){if(i.prototype.run.call(this),this.weaponObj&&this.weaponObj.run(),this.targetObject&&!this.isAtking){var e=this.targetObject.point_x+this.centobj_x,s=this.targetObject.point_y+this.centobj_y,h=GMath.angle(this.x,this.y,e,s);if(this.speedx=t.IMiniGame28Consts.speedValue*GMath.cos(h),this.speedy=t.IMiniGame28Consts.speedValue*GMath.sin(h),Math.abs(this.x-e)<t.IMiniGame28Consts.speedValue&&Math.abs(this.y-s)<t.IMiniGame28Consts.speedValue)return this.x=e,this.y=s,this.setIsMove(!1),void(this.targetObject=null);this.setIsMove(!0),this.x=this.x+this.speedx,this.y=this.y+this.speedy}else if(this.atkTarget&&!this.isAtking){var a=this.lockTarget();a&&this.changeAction(this.isAtking,!0)}this.atkTarget&&this.atkTarget.y>this.y&&(this.atkTarget.resetTarget(),this.atkTarget=null),this.checkAtk()},e.prototype.lockTarget=function(){var t=this.atkTarget.y-this.atkTarget.fixHeight*this.atkTarget.scaleY/2,i=GMath.distance(this.x,this.y,this.atkTarget.x,t);if(this.atkMove=!0,i>this.radius)return!1;this.atkMove=!1;var e=GMath.angle(this.x,this.y,this.atkTarget.x,t);return this.speedx=this.atkSpeed*GMath.cos(e),this.speedy=this.atkSpeed*GMath.sin(e),this.x=this.x+this.speedx,this.y=this.y+this.speedy,this.setIsMove(!0),this.checkAtkMonster(this.atkTarget)?(this.playerAtk(),!1):!0},e.prototype.actionOver=function(t){switch(i.prototype.actionOver.call(this,t),t){case AvatarConsts.ACTION_ATTACK:case AvatarConsts.ACTION_ATTACK_I:this.isAtking=!1,this.isAtkA=!1,this.isUnifyAtk=!1,this.walkAtk=!1,this.changeAction(this.isAtking,this._isMove),this.fun1&&this.fun1.call(this.thisobj1)}},e.prototype.checkAtk=function(){if(!this._isDie&&this.isAtking)if(t.IMiniGame28Consts.isAtkSwitch&&!this.isUnifyAtk){if(!this.atkTarget||this.atkTarget.isDie())return;-1!=this.atkArr.indexOf(this.part.frame)&&(this.atkTarget.setHit(1),IMiniGameMain.playEff(t.IMiniGame28Consts.minigame28_monD))}else{if(!this.isLead)return;var i=void 0;if(i=this.walkAtk?this.key2Frames:this.keyFrames)for(var e=i.length,s=0;e>s;s++)if(this.checkAtkArr(i[s]))return void(this.fun2&&this.fun2.call(this.thisobj2))}},e.prototype.checkAtkArr=function(t){return t&&2==t.length&&this.part.frame<=t[1]&&this.part.frame>=t[0]?!0:!1},e.prototype.setUnifyAtk=function(t){this.isUnifyAtk=t},e.prototype.playerAtk=function(){if(this.isCanPlay&&this.soundName&&IMiniGameMain.playEff(this.soundName),t.IMiniGame28Consts.isAtkSwitch&&!this.isUnifyAtk){this.atkArr=[];var i=[],e=void 0;if(this.key2Frames)for(var s=this.key2Frames.length,h=void 0,a=0;s>a;a++)if(h=this.key2Frames[a],2==h.length){e=h[1]-h[0]+1;for(var n=0;e>n;n++)i.push(n+h[0])}for(var o=void 0,a=0;a<this.realAtk;a++)o=GMath.randomInt(0,i.length-1),this.atkArr.push(i[o]),i.splice(o,1)}this.isAtking=!0,this.changeAction(this.isAtking,this._isMove)},e.prototype.checkAtkMonster=function(t){var i=this.y-this.fixHeight*this.scaleY/2,e=GMath.distance(this.x,i,t.x,t.y);if(this.atkGap<e)return!1;var s=t.fixWidth/2*t.scaleX,h=GMath.angle(this.x,i,t.x,t.y),a=GMath.angle(this.x,i,t.x+s,t.y),n=GMath.angle(this.x,i,t.x-s,t.y),o=270-this.diffusion/2,r=270+this.diffusion/2,l=h>=o&&r>=h||a>=o&&r>=a||n>=o&&r>=n;return l?!0:!1},e.prototype.setLeadData=function(){this.posAngle=this.ringIndex=this.ringPosIndex=this.posIndex=0,this.isLead=!0,this.centobj_x=this.centobj_y=0},e.prototype.setMove=function(t){this._isMove=t,this.changeAction(this.isAtking,this._isMove)},e.prototype.move=function(){},e.prototype.setTarget=function(t){this.targetObject=t},e.prototype.setAtkTarget=function(i){t.IMiniGame28Consts.isAtkSwitch&&!this.isLead&&(this.atkTarget=i)},e.prototype.setCallFun=function(t,i){this.callFun=t,this.thisObj=i},e.prototype.manMove=function(){egret.Tween.get(this.partCont).to({x:this.partCont.x-20},15).to({x:this.partCont.x+40},30).to({x:this.partCont.x},15).to({x:this.partCont.x-20},15).to({x:this.partCont.x+40},30).to({x:this.partCont.x},15).to({x:this.partCont.x-20},15).to({x:this.partCont.x+40},30).to({x:this.partCont.x},15).to({x:this.partCont.x-20},15).to({x:this.partCont.x+40},30).to({x:this.partCont.x},15).call(this.callBack,this)},e.prototype.callBack=function(){this.callFun&&this.callFun.call(this.thisObj)},e.prototype.addBySpec=function(i){if(i){var e;switch(i.index){case 2:e=t.IMiniGame28Consts.mounts[i.specValue],this.mountId=i.specValue,this.addMount(e);break;case 3:e=t.IMiniGame28Consts.wings[i.specValue],this.wingId=i.specValue,this.addWing(e);break;case 4:var s=t.IMiniGame28Consts.players[i.specValue];this.figureId=i.specValue,this.changeRole(s);break;case 5:this.addRoleSpeed(i.specValue);break;case 6:if(void 0===i.petId)this.petIds.push(i.specValue),this.addPets(t.IMiniGame28Consts.pets[i.specValue]);else if(e=t.IMiniGame28Consts.pets[i.petId],this.petsArr&&0==this.petsArr.length)this.petIds.push(i.petId),this.addPets(e);else{for(var h=this.petIds.length,a=0;h>a;a++)this.petIds[a]=i.petId;this.changePets(e.model)}break;case 7:this.weaId=i.specValue,e=t.IMiniGame28Consts.weapons[i.specValue],this.addWea(e)}}},e.prototype.addBySpecIndex=function(i){if(i){var e=i.split(",");if(e&&!(i.length<2)){var s,h=Number(e[1]);switch(Number(e[0])){case 2:s=t.IMiniGame28Consts.mounts[h],this.mountId=h,this.addMount(s);break;case 3:s=t.IMiniGame28Consts.wings[h],this.wingId=h,this.addWing(s);break;case 4:var a=t.IMiniGame28Consts.players[h];this.figureId=h,this.changeRole(a);break;case 5:this.addRoleSpeed(h);break;case 6:if(s=t.IMiniGame28Consts.pets[h],this.petsArr&&0==this.petsArr.length)this.petIds.push(h),this.addPets(s);else{for(var n=this.petIds.length,o=0;n>o;o++)this.petIds[o]=h;this.changePets(s.model)}break;case 7:this.weaId=h,s=t.IMiniGame28Consts.weapons[h],this.addWea(s)}}}},e.prototype.addRoleSpeed=function(t){void 0!==t&&(this.speed+=t,this.speed<=0&&(this.speed=1))},e.prototype.getSpeed=function(){return this.speed||1},e.prototype.getMountId=function(){return this.mountObj?this.mountId:void 0},e.prototype.getWingId=function(){return this.wingObj?this.wingId:void 0},e.prototype.getFigureId=function(){return this.figureId},e.prototype.getWeaId=function(){return this.weaponObj?this.weaId:void 0},e.prototype.getWeaponObj=function(){return this.weaponObj},e.prototype.getPetId=function(){return this.petIds},e.prototype.isIdle=function(){return!this.isAtking&&!this.targetObject&&!this.atkTarget
},e.prototype.isCanMove=function(){return(!this.atkTarget||this.atkMove)&&!this.targetObject&&!this.isIndeAtt()},e.prototype.isIndeAtt=function(){return this.isAtking&&!this.isUnifyAtk},e.prototype.setFirstData=function(i,e,s,h,a,n){this.figureId=i,this.mountId=e,this.wingId=s,this.weaId=h,this.petIds=a,void 0!=this.figureId&&this.changeRole(t.IMiniGame28Consts.players[this.figureId]),void 0!=this.mountId&&this.addMount(t.IMiniGame28Consts.mounts[this.mountId]),void 0!=this.wingId&&this.addWing(t.IMiniGame28Consts.wings[this.wingId]),void 0!=this.weaId&&this.addWea(t.IMiniGame28Consts.weapons[this.weaId]);for(var o=0;o<this.petIds.length;o++)this.addPets(t.IMiniGame28Consts.pets[this.petIds[o]]);this.speed=n,this.changeAction(this.isAtking,this._isMove)},e.prototype.reset=function(){this.initData(),this.clearMount(),this.atkArr=[],this.isGoRun=!1,this.atkMove=!1,this.isUnifyAtk=!1,this.figureId=void 0,this.mountId=void 0,this.wingId=void 0,this.isLead=!1,this.weaId=void 0,this.walkAtk=!1,this.soundFun=null,this.soundObj=null,this.isCanPlay=!0,this.atkTarget=null,this.isAtkA=!1,this.targetObject=null,this.callFun=this.thisObj=null},e.prototype.addPets=function(i){var e=this.petsArr.length;if(i&&!(e>=t.IMiniGame28Consts.petsNumber)){var s=GObj.create(t.IAvatarView);this.petsArr.push(s),s.x=i.pet_X||0,s.y=i.pet_Y||0,s.updatePart(i.model),s.autoRun(),s.setDirection(0),s.scaleX=s.scaleY=i.scaleXY||1,s.setAction(AvatarConsts.ACTION_WALK),s.parent||this.addChild(s)}},e.prototype.changePets=function(t){if(t)for(var i,e=this.petsArr.length,s=0;e>s;s++)i=this.petsArr[s],i.updatePart(t)},e.prototype.addMount=function(i){i&&(this.mountObj||(this.mountObj=GObj.create(t.IAvatarView),this.changeAction(this.isAtking,this._isMove)),this.mountObj.parent||this.addChildAt(this.mountObj,0),this.mountObj.x=i.pet_X||0,this.mountObj.y=i.pet_Y||0,this.mountObj.updatePart(i.model),this.mountObj.autoRun(),this.mountObj.setDirection(0),this.mountObj.scaleX=this.mountObj.scaleY=i.scaleXY||1,this.mountObj.setAction(AvatarConsts.ACTION_STAND))},e.prototype.addWing=function(i){i&&(this.wingObj||(this.wingObj=GObj.create(t.IAvatarView)),this.wingObj.x=i.pet_X||0,void 0==i.pet_Y?this.wingObj.y=this.fixHeight*this.scaleY/2:this.wingObj.y=i.pet_Y,this.wingObj.updatePart(i.model),this.wingObj.autoRun(),this.wingObj.setDirection(0),this.wingObj.scaleX=this.wingObj.scaleY=i.scaleXY||1,this.wingObj.setAction(AvatarConsts.ACTION_STAND),this.wingObj.parent||this.addChild(this.wingObj))},e.prototype.changeRole=function(t){t&&(this.soundName=t.atkSound||"",this.updatePart(t.role_model),this.scaleX=this.scaleY=t.role_scaleXY||1,this.keyFrames=t.aktFrame||[[2,2]],this.key2Frames=t.akt1Frame||[[2,2]],this.diffusion=t.diffusionA,this.atkGap=t.atkGap||50)},e.prototype.addWea=function(i){i&&(this.weaponObj||(this.weaponObj=GObj.create(t.IAvatarView)),this.weaponObj.x=i.pet_X||0,this.weaponObj.y=i.pet_Y||0,this.weaponObj.updatePart(i.model),this.weaponObj.setDirection(0),this.weaponObj.scaleX=this.weaponObj.scaleY=i.scaleXY||1,this.weaponObj.setAction(AvatarConsts.ACTION_STAND),this.weaponObj.parent||this.addChild(this.weaponObj))},e.prototype.clearMount=function(){this.mountObj&&(GObj.disposeObject(this.mountObj),this.mountObj=null),this.wingObj&&(GObj.disposeObject(this.wingObj),this.wingObj=null),this.weaponObj&&(GObj.disposeObject(this.weaponObj),this.weaponObj=null)},e.prototype.dispose=function(){this.reset(),this.data=null,this.petsArr=null,this.petIds=null,this.oneFun=this.oneObj=null,this.atkArr=null,this.keyFrames=null,this.key2Frames=null,i.prototype.dispose.call(this)},e}(t.IAvatarViewCtr);t.IMiniGame28Player=i,__reflect(i.prototype,"miniGame.IMiniGame28Player")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.addEventListener(egret.Event.ADDED_TO_STAGE,t.addToStage,t),t}return __extends(e,i),e.prototype.initSkin=function(){var i=this;this.bg||(this.dir=AvatarConsts.B_B,this.angle=90,this.rateVal=10,this.bg=GObj.create(t.ImageOutside),this.bg.touchEnabled=!1,this.bg.loadCompleteCall(function(){i.width=i.bg.iconWidth,i.height=i.bg.iconHeight,i.startX=i.width/2,i.startY=i.height/2,i.setArrowPoint()},this),this.bg.setOutSrc("rocker"),this.addChild(this.bg),this.rockerRect=GObj.create(eui.Rect),this.rockerRect.fillAlpha=.001,this.rocker=GObj.create(t.ImageOutside),this.rocker.touchEnabled=!1,this.rocker.loadCompleteCall(function(){i.rockerRect.width=4*i.rocker.iconWidth,i.rockerRect.height=4*i.rocker.iconHeight,i.rockerRect.anchorOffsetX=i.rockerRect.width/2,i.rockerRect.anchorOffsetY=i.rockerRect.height/2,i.rocker.anchorOffsetX=i.rocker.iconWidth/2,i.rocker.anchorOffsetY=i.rocker.iconHeight/2},this),this.rocker.setOutSrc("rockerPoint"),this.addChild(this.rocker),this.addChild(this.rockerRect),this.arrow=GObj.create(t.ImageOutside),this.arrow.touchEnabled=!1,this.arrow.loadCompleteCall(this.setArrowPoint,this),this.arrow.setOutSrc("rocketArrow"),this.addChild(this.arrow),this.addEvent())},e.prototype.setArrowPoint=function(){this.arrow&&this.bg&&this.arrow.iconWidth&&this.bg.iconWidth&&(this.arrow.anchorOffsetX=this.arrow.iconWidth/2,this.arrow.anchorOffsetY=this.bg.iconHeight/2+this.arrow.iconHeight/2+10,this.arrow.x=this.startX,this.arrow.y=this.startY,this.arrow.rotation=180,this.onEndClick(),this.callBack&&this.callBack.call(this.parentObj),this.oldx=this.x,this.oldy=this.y)},e.prototype.addEvent=function(){this.rockerRect.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBeginClick,this)},e.prototype.removeEvent=function(){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.addToStage,this),this.rockerRect.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBeginClick,this),this.rockerRect.removeEventListener(egret.TouchEvent.TOUCH_END,this.onEndClick,this),this.parentObj&&(this.parentObj.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onMoveClick,this),this.parentObj.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMoveClick,this))},e.prototype.addToStage=function(){this.initSkin(),this.parentObj=this.parent,this.alpha=.5},e.prototype.onBeginClick=function(t){this.isMove||(this.isMove=!0,this.rockerRect.addEventListener(egret.TouchEvent.TOUCH_END,this.onEndClick,this),this.parentObj&&(this.parentObj.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onEndClick,this),this.parentObj.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMoveClick,this)),this.fun2&&this.fun2.call(this.thisobj2),this.alpha=1,this.setPose(t))},e.prototype.onMoveClick=function(t){this.setPose(t)},e.prototype.setPose=function(t){this.tempPoint||(this.tempPoint=GObj.create(egret.Point)),this.globalToLocal(t.stageX,t.stageY,this.tempPoint);var i=GMath.distance(this.tempPoint.x,this.tempPoint.y,this.startX,this.startY);if(!(i<this.rateVal)){this.rockerRect.x=this.tempPoint.x,this.rockerRect.y=this.tempPoint.y;var e=this.width/2;if(i=GMath.distance(this.tempPoint.x,this.tempPoint.y,e,this.height/2),i>e){var s=GMath.towardSource(this.width/2,this.height/2,this.tempPoint.x,this.tempPoint.y,e);this.tempPoint.x=s.x,this.tempPoint.y=s.y,this.startX=this.width/2,this.startY=this.height/2}this.rocker.x=this.tempPoint.x,this.rocker.y=this.tempPoint.y,this.dir=this.getRocker(),this.startX=this.rocker.x,this.startY=this.rocker.y}},e.prototype.getRocker=function(){var t=this.startX,i=this.startY,e=this.rocker.x,s=this.rocker.y,h=GMath.angle(t,i,e,s);this.arrow.rotation=h+90,this.angle=h;var a=9-Math.floor((h+5.625)/11.25);return 0>=a&&(a+=32),a},e.prototype.onEndClick=function(){this.parentObj&&(this.rockerRect.removeEventListener(egret.TouchEvent.TOUCH_END,this.onEndClick,this),this.parentObj.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onEndClick,this),this.parentObj.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMoveClick,this)),this.isMove=!1,this.startX=this.width/2,this.startY=this.height/2,this.rockerRect.x=this.startX,this.rockerRect.y=this.startY,this.rocker.x=this.startX,this.rocker.y=this.startY,this.x=this.oldx||this.x,this.y=this.oldy||this.y,this.alpha=.5},e.prototype.setCallBack=function(t,i){this.callBack=i,this.parentObj=t},e.prototype.setFun2=function(t,i){this.fun2=t,this.thisobj2=i},e.prototype.dispose=function(){this.bg&&(this.removeEvent(),GObj.disposeObject(this.bg),this.bg=null,GObj.disposeObject(this.rocker),this.rocker=null,GObj.disposeObject(this.rockerRect),this.rockerRect=null,GObj.disposeObject(this.arrow),this.arrow=null,this.parentObj=null,this.callBack=null,this.fun2=null,this.thisobj2=null,this.tempPoint=null)},e}(eui.Group);t.IMiniGame28Rocker=i,__reflect(i.prototype,"miniGame.IMiniGame28Rocker")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function s(){var t=i.call(this)||this;return t.initSkins(),t}return __extends(s,i),s.prototype.initSkins=function(){var i=this;this.width=540,this.height=960,this.bgImg=GObj.create(t.ImageOutside),this.bgImg.horizontalCenter=0,this.bgImg.verticalCenter=0,this.bgImg.height=StageManager.stageHeight+600,this.bgImg.width=StageManager.stageWidth,this.bgImg.setOutSrc("img3"),this.addChild(this.bgImg),this.itemGrp=GObj.create(eui.Group),this.itemGrp.width=540,this.itemGrp.height=960,this.addChild(this.itemGrp),this.okBtn=GObj.create(t.IBaseBtn),this.okBtn.horizontalCenter=0,this.okBtn.bottom=280,this.okBtn.icon=IMiniGameMain.getIcon("btn_1"),this.okBtn.scaleX=0,this.addChild(this.okBtn),this.titleImg=GObj.create(t.ImageOutside),this.titleImg.horizontalCenter=0,t.IMiniGame28Consts.seleRoleDir?this.titleImg.top=50:this.titleImg.top=0,this.titleImg.scaleX=0,this.titleImg.loadCompleteCall(function(){egret.Tween.get(i.titleImg).to({scaleX:1},500),egret.Tween.get(i.okBtn).to({scaleX:1},500)},this),this.titleImg.setOutSrc("img1"),this.addChild(this.titleImg),this.addEvent()},s.prototype.addEvent=function(){this.okBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.okBtnClick,this)},s.prototype.removeEvent=function(){this.okBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.okBtnClick,this)},s.prototype.show=function(i,s){this.closeBack=i,this.thisObj=s,this.itemArr=[],this.nowSelIndex=0;for(var h=Object.keys(t.IMiniGame28Consts.players),a=h.length>t.IMiniGame28Consts.hero_MaxNum?t.IMiniGame28Consts.hero_MaxNum:h.length,n=1;a>=n;n++){var o=GObj.create(e);t.IMiniGame28Consts.seleRoleDir?(o.x=280+150*n,1==n&&(this.midX=o.x),o.y=-300,o.alpha=0,egret.Tween.get(o).wait(200*n).to({y:480,alpha:1},500,egret.Ease.circInOut)):(o.y=270+200*n,1==n&&(this.midY=o.y),o.x=-300,o.alpha=0,egret.Tween.get(o).wait(200*n).to({x:270,alpha:1},500,egret.Ease.circInOut)),o.addEventListener(egret.TouchEvent.TOUCH_TAP,this.itemTap,this),o.setData({img:t.IMiniGame28Consts.players[n].role_model,idx:n,sel:this.nowSelIndex}),this.itemGrp.addChild(o),this.itemArr.push(o)}},s.prototype.itemTap=function(t){var i=t.target.index;if(this.nowSelIndex!=i){this.nowSelIndex=i;for(var e=0;e<this.itemArr.length;e++){var s=this.itemArr[e];s.setData({sel:this.nowSelIndex})}}},s.prototype.okBtnClick=function(){for(var i,e=this,s=0;s<this.itemArr.length;s++){var h=this.itemArr[s];h.visible=h.index==this.nowSelIndex,h.visible&&(i=h)}i&&(t.IMiniGame28Consts.seleRoleDir?i.x==this.midX?egret.Tween.get(i).to({y:-300},300).call(function(){e.closeClick()}):egret.Tween.get(i).to({x:this.midX},300).to({y:-300},300).call(function(){e.closeClick()}):i.y==this.midY?egret.Tween.get(i).to({x:-300},300).call(function(){e.closeClick()}):egret.Tween.get(i).to({y:this.midY},300).to({x:-300},300).call(function(){e.closeClick()}))},s.prototype.closeClick=function(){this.closeBack&&this.closeBack.call(this.thisObj,this.nowSelIndex),GObj.disposeObject(this)},s.prototype.dispose=function(){this.removeEvent(),this.thisObj=null,this.closeBack=null,egret.Tween.removeTweens(this.titleImg),egret.Tween.removeTweens(this.okBtn),GObj.disposeObject(this.bgImg),this.bgImg=null,GObj.disposeObject(this.titleImg),this.titleImg=null,GObj.disposeObject(this.okBtn),this.okBtn=null,GObj.disposeObject(this.itemGrp),this.itemGrp=null;for(var t=0,i=this.itemArr;t<i.length;t++){var e=i[t];e.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.itemTap,this),GObj.disposeObject(e),e=null}this.itemArr=null},s}(eui.Component);t.IMiniGame28SelectPop=i,__reflect(i.prototype,"miniGame.IMiniGame28SelectPop");var e=function(i){function e(){var t=i.call(this)||this;return t.initskins(),t}return __extends(e,i),e.prototype.initskins=function(){var i=this;this.itemBg=GObj.create(t.ImageOutside),this.itemBg.touchEnabled=!1,this.selEff=GObj.create(t.IMovie),this.selEff.touchEnabled=!1,this.itemBg.loadCompleteCall(function(){i.width=i.itemBg.width,i.height=i.itemBg.height,i.anchorOffsetX=i.width/2,i.anchorOffsetY=i.height/2,t.IMiniGame28Consts.seleRoleDir?(i.selEff.x=i.anchorOffsetX,i.selEff.y=i.anchorOffsetY+10):(i.selEff.x=248,i.selEff.y=87),i.selEff.start(t.IMiniGame28Consts.role_select_eff),i.selEff.autoRun()},this),this.addChild(this.itemBg),this.addChild(this.selEff)},e.prototype.setData=function(t){t.img&&this.itemBg.setOutSrc(t.img),isNaN(t.idx)||(this.index=t.idx),isNaN(t.sel)||(this.selEff.visible=this.index==t.sel)},e.prototype.dispose=function(){egret.Tween.removeTweens(this),GObj.disposeObject(this.itemBg),this.itemBg=null,GObj.disposeObject(this.selEff),this.selEff=null},e}(eui.Component);t.IMiniGame28SelectItem=e,__reflect(e.prototype,"miniGame.IMiniGame28SelectItem")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.isUpdate=!1,t.initSkins(),t}return __extends(e,i),e.prototype.getIsPick=function(){return this._isPick},e.prototype.setPick=function(i){var e=this;void 0===i&&(i=!0),this._isPick=this.isDie=!0,i&&(egret.Tween.removeTweens(this),this.filters=[t.IMiniGame28Consts.flashFilter],egret.Tween.get(this).wait(200).call(function(){e.filters=null,e.visible=!1}))},e.prototype.initSkins=function(){var i=this;this.touchEnabled=!1,this.bgImg=GObj.create(t.IMiniGame28IMovie),this.bgImg.setLoadCompleteBack(function(){i.isLoad=!0,i.updateView()},this),this.addChild(this.bgImg),this.nameLab=GObj.create(eui.Label),this.nameLab.size=24,this.nameLab.textColor=16774479,this.nameLab.width=100,this.nameLab.textAlign=egret.HorizontalAlign.CENTER,this.nameLab.stroke=1,this.nameLab.strokeColor=0,this.addChild(this.nameLab),this.icon=GObj.create(t.ImageOutside),this.addChild(this.icon)},e.prototype.updateView=function(){var i=this;if(this.isLoad&&this.data&&!this.isUpdate){this.isUpdate=!0;var e=this.bgImg.getEffectData();e&&(this.width=e.textureWidth,this.height=e.textureHeight,this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height),this.nameLab.text=this.data.specName,this.nameLab.horizontalCenter=0,this.nameLab.y=t.IMiniGame28Consts.specTextY,this.icon.loadCompleteCall(function(){i.icon.horizontalCenter=0,i.icon.y=i.nameLab.y+i.nameLab.height+t.IMiniGame28Consts.icon_y;var e=i.icon.y;egret.Tween.removeTweens(i.icon),egret.Tween.get(i.icon,{loop:!0}).to({y:e-2},400).to({y:e+2},800).to({y:e},400)},this),this.icon.setOutSrc(this.data.specIconName||"")}},e.prototype.setData=function(t){t&&(this.data=t,this.alpha=1,this.scaleX=this.scaleY=1,this.bgImg.start(this.data.specEff?"addImg":"reduceImg"),this.bgImg.autoRun(),this.updateView())},e.prototype.run=function(){this.isDie||(this.y+=t.IMiniGame28Consts.mapSpeed,this.y>StageManager.stageHeight+this.height&&(this.isDie=!0))},e.prototype.isCanRemove=function(){return this.isDie},e.prototype.reset=function(){this.visible=!0,this.filters=null,this.isDie=!1,this._isPick=!1,this.data=null,this.isLoad=!1,this.isUpdate=!1,egret.Tween.removeTweens(this),this.icon&&egret.Tween.removeTweens(this.icon)},e.prototype.dispose=function(){this.reset(),GObj.disposeObject(this.bgImg),this.bgImg=null,GObj.disposeObject(this.icon),this.icon=null,GObj.disposeObject(this.nameLab),this.nameLab=null},e}(eui.Component);t.IMiniGame28Spec=i,__reflect(i.prototype,"miniGame.IMiniGame28Spec")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.isSkip=!1,t.isPlayComplete=!0,t.monsterArr=[],t.monsterPool=[],t.specArr=[],t.specPool=[],t.hitEffPool=[],t.hitEffIn=[],t.playerArr=[],t.playerPool=[],t}return __extends(e,i),e.prototype.setData=function(i){i&&(this.stageData=i,this.isRocker=1==t.IMiniGame28Consts.isRocker,this.initSkins(),this.proGressWidth&&this.updateView(),this.startHeartbeat(),IMiniGameApp.sound.playBgm(t.IMiniGame28Consts.minigame28_bgm))},e.prototype.initSkins=function(){var i=this;if(!this.isInit){this.isInit=!0,this.horizontalCenter=this.verticalCenter=0,this.width=540,this.height=StageManager.stageHeight,this.hegihtScalY=this.height/960,this.hegihtScalY<=1&&(this.hegihtScalY=1),this.oneBgH=960,this.bgArr=[],this.touchMask=GObj.create(eui.Rect),this.touchMask.height=this.height+600,this.touchMask.width=this.width,this.touchMask.fillColor=0,this.touchMask.horizontalCenter=0,this.touchMask.verticalCenter=0,this.touchMask.alpha=.1,this.addChild(this.touchMask);for(var e=-1;1>=e;e++){var s=GObj.create(t.ImageOutside);s.y=-this.oneBgH*e,s.setOutSrc("bg"+this.stageData.mapId,FileConst.jpg),this.bgArr.push(s),this.addChild(s)}this.avatarGrp=GObj.create(egret.DisplayObjectContainer),this.avatarGrp.width=this.width,this.avatarGrp.height=this.height,this.avatarGrp.touchEnabled=!1,this.avatarGrp.touchChildren=!1,this.addChild(this.avatarGrp),this.monsterGrp=GObj.create(egret.DisplayObjectContainer),this.monsterGrp.width=this.width,this.monsterGrp.height=this.height,this.monsterGrp.touchEnabled=!1,this.monsterGrp.touchChildren=!1,this.addChild(this.monsterGrp),this.playerGrp=GObj.create(egret.DisplayObjectContainer),this.playerGrp.width=310,this.playerGrp.height=this.height,this.playerGrp.touchEnabled=!1,this.playerGrp.touchChildren=!1,this.addChild(this.playerGrp),this.hitEffGrp=GObj.create(egret.DisplayObjectContainer),this.hitEffGrp.touchEnabled=!1,this.hitEffGrp.touchChildren=!1,this.addChild(this.hitEffGrp),this.initUiGrp(),this.uiGrp=GObj.create(eui.Group),this.uiGrp.width=this.width,this.uiGrp.height=this.height,this.addChild(this.uiGrp),this.isRocker&&this.initRocker(),this.arrowImg=GObj.create(t.ImageOutside),this.arrowImg.horizontalCenter=0,this.arrowImg.bottom=t.IMiniGame28Consts.allow_bottom,this.arrowImg.setOutSrc("arrowImg"),this.arrowImg.touchEnabled=!1,this.addChild(this.arrowImg),this.bossMovie=GObj.create(t.IMovie),this.bossMovie.isLast=!0,this.addChild(this.bossMovie),this.exitBtn=GObj.create(t.IBaseBtn),this.exitBtn.icon=IMiniGameMain.getIcon("exit_btn",FileConst.png,"chapter"),this.exitBtn.right=10,this.exitBtn.y=160*this.hegihtScalY,this.addChild(this.exitBtn),this.initTalkGrp(),this.progressBgUp.loadCompleteCall(function(){i.proGressWidth=i.progressBgUp.width,i.progressBgUp.anchorOffsetX=i.proGressWidth,i.progressBgUp.rotation=180,i.updateView()},this),this.progressBgUp.setOutSrc("perbar_0"),this.addEvent()}},e.prototype.initTalkGrp=function(){this.talkGrp=GObj.create(eui.Group),this.talkGrp.width=this.width,this.talkGrp.height=this.height,this.talkGrp.visible=!1,this.addChild(this.talkGrp),this.talkRect=GObj.create(eui.Rect),this.talkRect.height=this.height+600,this.talkRect.width=this.width,this.talkRect.fillColor=0,this.talkRect.horizontalCenter=0,this.talkRect.verticalCenter=0,this.talkRect.alpha=.5,this.talkGrp.addChild(this.talkRect),this.talkShowGrp=GObj.create(eui.Group),this.talkShowGrp.width=this.width,this.talkShowGrp.height=this.height,this.talkShowGrp.anchorOffsetX=this.talkShowGrp.x=int(.5*this.talkShowGrp.width),this.talkShowGrp.anchorOffsetY=this.talkShowGrp.y=int(.5*this.talkShowGrp.height),this.talkGrp.addChild(this.talkShowGrp),this.roleImg=GObj.create(t.ImageOutside),this.talkShowGrp.addChild(this.roleImg),this.talkImg=GObj.create(t.ImageOutside),this.talkImg.horizontalCenter=0,this.talkImg.setOutSrc("po_chatbg"),this.talkImg.scale9Grid=GObj.create(egret.Rectangle,125,39,152,56),this.talkShowGrp.addChild(this.talkImg),this.talkImg.y=400,this.roleNameBg=GObj.create(t.ImageOutside),this.roleNameBg.setOutSrc("name_back"),this.talkShowGrp.addChild(this.roleNameBg),this.roleNameBg.horizontalCenter=0,this.roleNameBg.y=440,this.roleName=GObj.create(eui.Label),this.roleName.size=22,this.roleName.text="--",this.roleName.width=200,this.roleName.textAlign=egret.HorizontalAlign.CENTER,this.roleName.textColor=15925171,this.roleName.stroke=1,this.roleName.strokeColor=0,this.talkShowGrp.addChild(this.roleName),this.roleName.horizontalCenter=0,this.roleName.y=415,this.talkText=GObj.create(eui.Label),this.talkText.y=465,this.talkText.horizontalCenter=0,this.talkText.width=300,this.talkText.size=18,this.talkText.textColor=15925171,this.talkText.stroke=1,this.talkText.strokeColor=0,this.talkText.lineSpacing=5,this.talkShowGrp.addChild(this.talkText),this.talkContinue=GObj.create(eui.Label),this.talkContinue.size=18,this.talkContinue.x=100,this.talkContinue.text=IMiniGameMain.getString(t.IMiniGame28Consts["continue"]),this.talkShowGrp.addChild(this.talkContinue),this.talkUnderLine=GObj.create(t.ImageOutside),this.talkUnderLine.setOutSrc("core_line"),this.talkUnderLine.x=100,this.talkShowGrp.addChild(this.talkUnderLine),this.talkUnderLine.width=this.talkContinue.textWidth,this.talkContinue.visible=this.talkUnderLine.visible=!1,this.talkTouchMask=GObj.create(eui.Rect),this.talkTouchMask.height=this.height+600,this.talkTouchMask.width=this.width+300,this.talkTouchMask.fillColor=0,this.talkTouchMask.horizontalCenter=0,this.talkTouchMask.verticalCenter=0,this.talkTouchMask.alpha=0,this.talkGrp.addChild(this.talkTouchMask)},e.prototype.initRocker=function(){this.rocker=GObj.create(t.IMiniGame28Rocker),this.rocker.horizontalCenter=0,this.rocker.setFun2(this.guide,this),this.rocker.bottom=t.IMiniGame28Consts.rocker_bottom,this.uiGrp.addChild(this.rocker)},e.prototype.initUiGrp=function(){var i=this;this.uiGrp2=GObj.create(eui.Group),this.uiGrp2.width=this.width,this.uiGrp2.height=this.height,this.addChild(this.uiGrp2),this.playerHp=GObj.create(t.IMiniGame28HpGrp),this.playerHp.setTextColor(9437020),this.playerHp.setIcon("playerIcon"),this.uiGrp2.addChild(this.playerHp),this.progressGrp=GObj.create(eui.Group),this.uiGrp2.addChild(this.progressGrp),this.progressBg=GObj.create(t.ImageOutside),this.progressBgUp=GObj.create(t.ImageOutside),this.endIcon=GObj.create(t.ImageOutside),this.lightImg=GObj.create(t.ImageOutside),this.move1Grp=GObj.create(eui.Group),this.progressBg.verticalCenter=0,this.progressBg.loadCompleteCall(function(){i.progressGrp.width=i.progressBg.width+i.endIcon.width/2,i.progressGrp.height=i.progressBg.height,i.endIcon.x=i.progressBg.width,i.endIcon.y=i.progressGrp.height/2,i.lightImg.y=i.endIcon.y,i.move1Grp.x=i.progressBg.width-3,i.move1Grp.y=i.progressGrp.height+20},this),this.progressBg.setOutSrc("perbar_0"),this.progressGrp.addChild(this.progressBg),this.progress=GObj.create(t.ImageOutside),this.progress.verticalCenter=0,this.progress.setOutSrc("perbar_1"),this.progressGrp.addChild(this.progress),this.progressBgUp.verticalCenter=0,this.progressGrp.addChild(this.progressBgUp),this.lightImg.loadCompleteCall(function(){i.lightImg.anchorOffsetX=i.lightImg.width/2,i.lightImg.anchorOffsetY=i.lightImg.height/2},this),this.lightImg.setOutSrc("light"),this.progressGrp.addChild(this.lightImg),this.endIcon.loadCompleteCall(function(){i.endIcon.anchorOffsetX=i.endIcon.width/2,i.endIcon.anchorOffsetY=i.endIcon.height/2,i.progressGrp.width=i.progressBg.width+i.endIcon.width/2},this),this.endIcon.setOutSrc("endIcon"),this.progressGrp.addChild(this.endIcon),this.progressGrp.addChild(this.move1Grp),this.moveBg=GObj.create(t.ImageOutside),this.moveBg.loadCompleteCall(function(){i.move1Grp.height=i.moveBg.height,i.move1Grp.width=i.moveBg.width,i.move1Grp.anchorOffsetX=i.move1Grp.width/2},this),this.moveBg.setOutSrc("moveBg"),this.move1Grp.addChild(this.moveBg),this.moveLabel=GObj.create(eui.Label),this.moveLabel.size=22,this.moveLabel.textColor=15068671,this.moveLabel.horizontalCenter=this.moveLabel.verticalCenter=0,this.move1Grp.addChild(this.moveLabel),this.progressGrp.y=85*this.hegihtScalY,this.progressGrp.left=25,this.numB=GObj.create(t.IBitNumMap),this.numB.setGap(-8),this.numB.setPath("num33"),this.numB.y=125*this.hegihtScalY,this.numB.horizontalCenter=0,this.uiGrp2.addChild(this.numB),this.timeGrp=GObj.create(eui.Group),this.timeGrp.y=110*this.hegihtScalY,this.uiGrp2.addChild(this.timeGrp),this.timeImg=GObj.create(t.ImageOutside),this.timeImg.loadCompleteCall(function(){i.timeGrp.width=i.timeImg.width,i.timeGrp.height=i.timeImg.height},this),this.timeImg.setOutSrc("timeBg"),this.timeGrp.addChild(this.timeImg),this.timeLab=GObj.create(eui.Label),this.timeLab.size=22,this.timeLab.textColor=10263708,this.timeGrp.addChild(this.timeLab),this.timeIcon=GObj.create(t.ImageOutside),this.timeIcon.x=8,this.timeIcon.y=27,this.timeIcon.loadCompleteCall(function(){i.timeLab.x=i.timeIcon.x+i.timeIcon.width+6,i.timeLab.y=i.timeIcon.y},this),this.timeIcon.setOutSrc("timeIcon"),this.timeGrp.addChild(this.timeIcon),this.manLab=GObj.create(eui.Label),this.manLab.size=22,this.manLab.textColor=6946586,this.timeGrp.addChild(this.manLab),this.manIcon=GObj.create(t.ImageOutside),this.manIcon.x=8,this.manIcon.y=5,this.manIcon.loadCompleteCall(function(){i.manLab.x=i.manIcon.x+i.manIcon.width+6,i.manLab.y=i.manIcon.y},this),this.manIcon.setOutSrc("manIcon"),this.timeGrp.addChild(this.manIcon),this.bossGrp=GObj.create(eui.Group),this.bossGrp.y=190*this.hegihtScalY,this.addChild(this.bossGrp),this.bossBg=GObj.create(t.ImageOutside),this.bossGrp.addChild(this.bossBg),this.bossLabel=GObj.create(eui.Label),this.bossImg=GObj.create(t.ImageOutside),this.bossImg.horizontalCenter=-5,this.bossImg.loadCompleteCall(function(){i.bossImg.anchorOffsetY=i.bossImg.height/2,i.bossImg.anchorOffsetX=i.bossImg.width/2},this),this.bossImg.setOutSrc("bossimg"),this.bossGrp.addChild(this.bossImg),this.bossLabelIcon=GObj.create(t.ImageOutside),this.bossLabelIcon.x=10,this.bossLabelIcon.loadCompleteCall(function(){i.bossLabel.x=i.bossLabelIcon.x+i.bossLabelIcon.width+5},this),this.bossLabelIcon.setOutSrc("enemyIcon"),this.bossGrp.addChild(this.bossLabelIcon),this.bossLabel.size=20,this.bossLabel.fontFamily="SimHei",this.bossLabel.textColor=16777215,this.bossGrp.addChild(this.bossLabel),this.bossBg.loadCompleteCall(function(){i.bossGrp.width=i.bossBg.width,i.bossGrp.height=i.bossBg.height,i.bossLabel.verticalCenter=i.bossBg.height/4+2,i.bossLabelIcon.verticalCenter=i.bossBg.height/4+2,i.bossImg.verticalCenter=-i.bossBg.height/4+2},this),this.bossBg.setOutSrc("bossBg")},e.prototype.updateView=function(){this.initValue(),t.IMiniGame28Consts.heroDisplay?this.selectRole():this.choiceHero(1)},e.prototype.isFirstFight=function(){return t.IMiniGame28Consts.isAtkSwitch},e.prototype.initValue=function(){this.clearObject(),this.initProgress(),this.isStartGame=!1,this.isAtkIng=!1,this.addOnceNum=0,this.isSuccess=!1,1==this.stageData.stageId?(this.arrowImg.alpha=1,this.arrowImg.visible=!0,this.isPause=!0):(this.arrowImg.visible=!1,this.isPause=!1),this.lineNum=t.IMiniGame28Consts.lineNum||3,this.time=0,this.allTime=this.stageData.gameTime||90,this.updateTime(),this.mapSpeed=t.IMiniGame28Consts.mapSpeed,this.avatarGrp.removeChildren(),this.monsterGrp.removeChildren(),this.hitEffGrp.removeChildren(),this.playerGrp.removeChildren()},e.prototype.addEvent=function(){this.isRocker||this.uiGrp.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBeginClick,this),this.exitBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCloseClick,this),EnterFrameManager.instance.registeRender(this.checkRun,this),this.talkTouchMask&&this.talkTouchMask.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickTalk,this)},e.prototype.removeEvent=function(){this.isRocker||(this.uiGrp.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBeginClick,this),this.uiGrp.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMoveClick,this),this.uiGrp.removeEventListener(egret.TouchEvent.TOUCH_END,this.onEndClick,this)),this.exitBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onCloseClick,this),EnterFrameManager.instance.unRegisteRender(this.checkRun,this),this.talkTouchMask&&this.talkTouchMask.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickTalk,this)},e.prototype.onClickTalk=function(t){if(!this.isPlayComplete)return void(this.isSkip=!0);if(0==this.talkArr.length)return this.talkGrp.visible=!1,this.isRunning=!0,void(this.talkCallBack&&this.talkCallBack());var i=this.talkArr.shift();this.talkShowGrp.visible=!0,i.popType&&this.openEffect(2==i.popType),this.roleImg.setOutSrc(i.roleSrc),e=i.roleSrcXY,this.roleImg.x=e[0],this.roleImg.y=e[1],this.roleName.text=i.roleName,this.curShowText=i.text,this.talkText.text="",this.isPlayComplete=this.isSkip=!1,this.talkContinue.visible=this.talkUnderLine.visible=!1,this.showTalkContent(1);var e},e.prototype.openEffect=function(t){if(this.talkShowGrp.alpha=0,this.talkShowGrp.scaleX=this.talkShowGrp.scaleY=.7,egret.Tween.get(this.talkShowGrp).to({alpha:1,scaleX:1,scaleY:1},200),t){var i=this.talkShowGrp.x,e=this.talkShowGrp.y;egret.Tween.get(this.talkShowGrp).to({rotation:2,x:i-2,y:e+2},30).to({rotation:-7,x:i+2,y:e-2},30).to({rotation:7,x:i+3,y:e-2},30).to({rotation:-2,x:i+3,y:e+2},30).to({rotation:0,x:i-2,y:e},30).to({rotation:-2,x:i,y:e-2},30).to({rotation:7,x:i+2,y:e-3},30).to({rotation:-2,x:i-2,y:e+3},30).to({rotation:2,x:i+2,y:e+2},30).to({rotation:0,x:i,y:e},30)}},e.prototype.showTalkContent=function(t){return this.talkText.text.length>=this.curShowText.length||this.isSkip?void this.textPlayOver():void egret.Tween.get(this.talkText).to({alpha:1},70).call(this.tweenCallAddText,this,[t])},e.prototype.tweenCallAddText=function(t){var i=this.curShowText;this.talkText.text=i.substring(0,t);var e=80+this.talkText.height>140?90+this.talkText.height:140;this.talkImg.$setHeight(e),egret.Tween.get(this.talkText).to({alpha:1},70).call(this.showTalkContent,this,[t+1])},e.prototype.textPlayOver=function(){egret.Tween.removeTweens(this.talkText),egret.Tween.removeTweens(this.talkShowGrp),egret.Tween.removeTweens(this),this.talkText.text=this.curShowText,this.isPlayComplete=!0;var t=80+this.talkText.height>140?90+this.talkText.height:140;this.talkImg.$setHeight(t),this.talkContinue.visible=this.talkUnderLine.visible=!0,this.talkContinue.y=this.talkImg.y+this.talkImg.height+10,this.talkUnderLine.y=this.talkContinue.y+this.talkContinue.height+2},e.prototype.guide=function(){var i=this;if(1==this.stageData.stageId){if(this.isPause=!1,this.isStartGame)return;this.isStartGame=!0,this.lastTime=GApp.timer,this.arrowImg.alpha=1,egret.Tween.get(this.arrowImg).to({alpha:0},t.IMiniGame28Consts.arrowTime).call(function(){i.arrowImg.visible=!1})}},e.prototype.onBeginClick=function(t){this.guide(),this.startX=t.stageX,this.startY=t.stageY,this.uiGrp.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMoveClick,this),this.uiGrp.addEventListener(egret.TouchEvent.TOUCH_END,this.onEndClick,this)},e.prototype.onCloseClick=function(t){this.clearTween(),this.isRunning=!1,i.prototype.onCloseClick.call(this,t)},e.prototype.onMoveClick=function(t){this.centerObj&&(this.endX=t.stageX,this.endY=t.stageY,this.isMoved=!0,this.moveNum_x=this.endX-this.startX,this.moveNum_y=this.endY-this.startY,this.setTargetX(),this.setTargetY(),this.angle=GMath.angle(this.startX,this.startY,this.endX,this.endY),this.startX=this.endX,this.startY=this.endY)},e.prototype.setTargetX=function(){this.centerObj.endX=this.endX,this.moveNum_x>0?this.centerObj.endX<this.centerObj.point_x&&(this.centerObj.isSlideX=!0,this.centerObj.targetEndX=this.centerObj.point_x+this.moveNum_x):this.centerObj.point_x<this.centerObj.endX&&(this.centerObj.isSlideX=!0,this.centerObj.targetEndX=this.centerObj.point_x+this.moveNum_x)},e.prototype.setTargetY=function(){this.centerObj.endY=this.endY,this.moveNum_y>0?this.centerObj.endY<this.centerObj.point_x&&(this.centerObj.isSlideY=!0,this.centerObj.targetEndY=this.centerObj.point_y+this.moveNum_y):this.centerObj.point_y<this.centerObj.endY&&(this.centerObj.isSlideY=!0,this.centerObj.targetEndY=this.centerObj.point_y+this.moveNum_y)
},e.prototype.onEndClick=function(){this.centerObj&&(this.centerObj.isSlideX=this.centerObj.isSlideY=!1),this.isMoved=!1,this.uiGrp.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMoveClick,this),this.uiGrp.removeEventListener(egret.TouchEvent.TOUCH_END,this.onEndClick,this)},e.prototype.selectRole=function(){this.isRunning=!1,IMiniGameMain.reqSocket(1,this.stageData.stageId);var i=GObj.create(t.IMiniGame28SelectPop);i.show(this.choiceHero,this),this.addChild(i)},e.prototype.choiceHero=function(i){if(t.IMiniGame28Consts.heroDisplay||IMiniGameMain.reqSocket(1,this.stageData.stageId),this.frameNum=t.IMiniGame28Consts.soundFrame,this.playerData={},t.IMiniGame28.setPlayerVo(this.playerData,i),this.centerObj||(this.centerObj=GObj.create(t.IMiniGame28CenterPoint)),0==this.playerArr.length){var e=this.getPlayer();this.playerGrp.addChild(e),this.centerObj.setY(this.centerObj.fixHeight,this.playerGrp.height),this.centerObj.fixHeight||e.setOneFun(this.centerObj.setFixHeight,this.centerObj),this.centerObj.setX(115,this.playerGrp.width+115),e.setData(this.playerData),this.centerObj.speed=e.getSpeed(),this.centerObj.point_y=e.y=t.IMiniGame28Consts.roleY,this.leading_Role=e,this.up_Role=e,this.down_Role=e,this.playerArr.push(e);for(var s=this.playerData.initSkill,h=0;h<s.length;h++)e.addBySpecIndex(s[h]);this.playerHp.visible=!0,this.centerObj.point_x=e.x=this.playerGrp.width/2+115,this.centerObj.setRocker(this.isRocker),e.setFun(this.changeAtk,this),e.setFun2(this.changeSuccess,this),e.setSoundFun(this.soundCall,this),this.udpatePlayerHp(this.playerArr.length),e.setLeadData()}this.upDateMan(1),this.addPlayer(9),this.checkHaveTalk("start")},e.prototype.checkHaveTalk=function(t){this.stageData&&this.stageData.talk&&this.stageData.talk[t]?(this.isRunning=!1,this.showTalk(this.stageData.talk[t])):this.isRunning=!0},e.prototype.showTalk=function(t){if(t&&t.length){this.talkArr=[];for(var i=0,e=t;i<e.length;i++){var s=e[i];this.talkArr.push(s)}this.talkGrp.visible=!0,this.talkShowGrp.visible=!1,this.onClickTalk(null)}},e.prototype.udpatePlayerHp=function(t){this.playerHp.setLabelNum(t)},e.prototype.upDateMan=function(i){this.manLab.text=IMiniGameMain.getString(t.IMiniGame28Consts.manText,i)},e.prototype.updateTime=function(){var t=this.allTime-this.time;0>t&&(t=0),this.timeLab.text=IMiniGameMain.getTimeFormat(t)},e.prototype.updateBoss=function(i){this.bossLabel.text=IMiniGameMain.getString(t.IMiniGame28Consts.bossText,i)},e.prototype.checkBoss=function(){this.time==this.bossTime&&(this.bossMovie.visible=!1,IMiniGameMain.reqSocket(2),this.bossMovie.setLoadCompleteBack(this.showBossMovie,this),this.bossMovie.start(t.IMiniGame28Consts.bossMovie,1),this.bossMovie.autoRun())},e.prototype.bossTween=function(){if(this.bossGrp.width){this.bossGrp.visible=!0,this.bossGrp.x=-this.width,egret.Tween.removeTweens(this.bossGrp);var t=0;egret.Tween.get(this.bossGrp).to({x:t},100).to({x:t-5},50).to({x:t},50)}},e.prototype.bossExit=function(){var t=this;egret.Tween.removeTweens(this.bossGrp),egret.Tween.get(this.bossGrp).to({x:0},100).call(function(){t.bossGrp.visible=!1})},e.prototype.showBossMovie=function(){var i=this;this.bossMovie.visible=!0,this.bossExit(),this.bossMovie.x=this.width+this.bossMovie.width,this.bossMovie.y=this.height/3,IMiniGameApp.sound.playEff(t.IMiniGame28Consts.minigame28_boss);var e=(this.width-this.bossMovie.width)/2;egret.Tween.get(this.bossMovie).to({x:e},500).wait(500).to({x:-this.bossMovie.width},500).call(function(){i.bossMovie&&i.bossMovie.stop()},this)},e.prototype.initProgress=function(){this.frameNumber=t.IMiniGame28Consts.frameTotal,this.sumMeter=this.stageData.totalNum||1e3,this.moveLabel.text=IMiniGameMain.getString(t.IMiniGame28Consts.moveText,this.sumMeter),this.sysFrame=0,this.frameRate=IMiniGameMain.sysFrame(),this.lastTime=GApp.timer,this.bossTime=this.stageData.bossTime||50,this.initBossText(),this.bossGrp.visible=!1,this.wireFrameN=this.proGressWidth/this.frameRate/this.bossTime,this.setNum(0),this.lightImg.x=0,this.progressBgUp.width=this.proGressWidth},e.prototype.initBossText=function(){if(this.stageData){var i=this.stageData.monsters[this.bossTime];if(i){t.IMiniGame28.setDefMonsterVo(i);for(var e=i.length,s=void 0,h=void 0,a=0,n=0;e>n;n++)s=i[n],h=s.hp&&s.hp.length>0?s.hp:[1],a+=h[0]*s.monNum;this.updateBoss(a)}}},e.prototype.setNum=function(t){t>=this.sumMeter&&(t=this.sumMeter);var i=t+"M";this.numB&&this.numB.setString(i)},e.prototype.checkRun=function(){this.isRunning&&(this.centObjRun(),this.isPause||(this.sysFrame++,this.mapMove(),this.checkNature(),this.changeProgress(),this.monsterRun(),this.specRun(),this.hitEffRun(),this.chiocePlayer(),this.checkSoundRun()))},e.prototype.soundCall=function(){this.frameNum=0;for(var t,i=this.playerArr.length,e=0;i>e;e++)t=this.playerArr[e],t.isCanPlay=!1},e.prototype.checkSoundRun=function(){if(this.frameNum!=t.IMiniGame28Consts.soundFrame&&++this.frameNum==t.IMiniGame28Consts.soundFrame)for(var i=this.playerArr.length,e=void 0,s=0;i>s;s++)e=this.playerArr[s],e.isCanPlay=!0},e.prototype.changeProgress=function(){this.progressBgUp.width-this.wireFrameN<=0?this.progressBgUp.width=0:this.progressBgUp.width-=this.wireFrameN;var i=(this.proGressWidth-this.progressBgUp.width)/this.proGressWidth;i>=1&&(i=1),this.lightImg.x=i*this.proGressWidth,--this.frameNumber<=0&&(this.frameNumber=t.IMiniGame28Consts.frameTotal,this.setNum(Math.round(this.sumMeter*i)))},e.prototype.checkNature=function(){if(GApp.timer<this.lastTime+1e3)return!1;var i=this.sysFrame,e=GApp.timer-this.lastTime;if(this.lastTime=GApp.timer,this.frameRate=Math.round(1e3*i/e),this.sysFrame=0,this.time++,this.wireFrameN=this.proGressWidth/this.frameRate/this.bossTime,this.updateTime(),this.stageData.gameTime&&this.time>=this.stageData.gameTime)return void this.setResult(!1);this.time==(this.stageData.bossGrpTime||5)&&this.bossTween(),this.checkBoss();var s=this.stageData.monsters[this.time];s&&(t.IMiniGame28.setDefMonsterVo(s),this.createMonster(s));var h=this.stageData.specs[this.time];h&&(t.IMiniGame28.setDefSpecVo(h,this.time),this.createSpec(h))},e.prototype.mapMove=function(){for(var t=0;t<this.bgArr.length;t++){var i=this.bgArr[t];i.y=i.y+this.mapSpeed,i.y>=StageManager.stageHeight&&(i.y-=3*this.oneBgH)}},e.prototype.updateZindex=function(){for(var t,i,e,s,h=this.playerArr.length,a=0;h>a;a++){t=this.playerArr[a];for(var n=0;h>n;n++)i=this.playerArr[n],t!=i&&(e=this.playerGrp.getChildIndex(t),s=this.playerGrp.getChildIndex(i),t.y>i.y?s>e&&(this.playerGrp.addChildAt(t,s),this.playerGrp.addChildAt(i,e)):t.y<i.y&&e>s&&(this.playerGrp.addChildAt(t,s),this.playerGrp.addChildAt(i,e)))}},e.prototype.centObjRun=function(){this.centerObj&&(this.isRocker&&(this.isMoved=this.rocker.isMove,this.angle=this.rocker.angle),this.centerObj.setMove(this.isMoved),this.centerObj.setAngle(this.angle),this.centerObj.run(),this.playerRun())},e.prototype.playerRun=function(){if(this.playerArr){for(var t,i=this.playerArr.length,e=0;i>e;e++)t=this.playerArr[e],t.isCanMove()&&(t.x=this.centerObj.point_x+t.centobj_x,t.y=this.centerObj.point_y+t.centobj_y,t.setMove(this.isMoved)),t.atkTarget&&t.atkTarget.isDie()&&(t.setAtkTarget(null),t.setTarget(this.centerObj)),t.run();this.updateHpPos(),this.updateZindex(),this.isFirstFight()?this.juageLeadCanAtk():this.juageCanAtk(),this.checkPlayerA()}},e.prototype.changeAtk=function(){this.isAtkIng&&(this.isAtkIng=!1)},e.prototype.changeSuccess=function(){this.isSuccess=!0},e.prototype.updateHpPos=function(){this.centerObj&&(this.playerHp.x=this.centerObj.point_x,this.playerHp.y=this.centerObj.point_y-this.centerObj.fixHeight/2)},e.prototype.playerDie=function(){this.updateMoveArea(!0),0==this.playerArr.length&&this.setResult(!1)},e.prototype.createMonster=function(i){var e,s=i.length,h=this.getMonsterObj();this.monsterArr.push(h);for(var a,n=0;s>n;n++){a=i[n].monNum||2;for(var o=0;a>o;o++)e=t.IMiniGameMgr.ins.getPoolByClass(t.IMiniGame28Monster),void 0!=i[n].monsterY?e.y=i[n].monsterY:e.y=-50,void 0!=i[n].monsterX?e.x=i[n].monsterX:e.x=i[n].monLR<t.IMiniGame28Consts.monPos.length?t.IMiniGame28Consts.monPos[i[n].monLR]:this.monsterGrp.width/2,e.setData(i[n]),i[n].isBoss?(h.unshiftMon(e),h.isBoss=!0):h.pushMon(e),i[n].monProp&&0==o&&(e.isDrop=!0),this.monsterGrp.addChild(e)}this.uiGrp2.addChild(h.hpGrp),h.resetGrp(),h.doCitcle()},e.prototype.monsterRun=function(){if(0!=this.playerArr.length&&0!=this.monsterArr.length)for(var i,e,s,h,a,n,o,r,l,p=this.playerArr[0],c=p.fixWidth*p.scaleX/2*t.IMiniGame28Consts.player_sclaXY,u=p.fixHeight*p.scaleX,d=u*(1-t.IMiniGame28Consts.player_sclaXY)/2,m=0;m<this.monsterArr.length;m++)if(o=this.monsterArr[m],o.monArr&&0!=o.monArr.length){o.run();for(var g=0;g<o.monArr.length;g++)if(i=o.monArr[g])if(i.isCanRemove()){if(o.monArr.splice(g,1),p&&(!r&&p.getWeaponObj()&&(l=t.IMiniGame28Consts.weapons[p.getWeaId()],l&&(r=l.hit_model,r&&this.hitEffAddToScene({atkx:i.x,atky:i.y,eff:r},!0))),i.data.monProp&&i.isDrop)){for(var f=0,b=i.data.monProp;f<b.length;f++){var y=b[f];this.playArrSpec(y)}this.hitEffAll(t.IMiniGame28Consts.addEff)}o.backMon(i),g--}else if(i.run(),!i.isDie()&&(!i.isBoss||this.juageBoss(o.monArr))){s=i.width*i.scaleX/2*t.IMiniGame28Consts.monster_sclaXY,h=i.height*i.scaleX,a=h*(1-t.IMiniGame28Consts.monster_sclaXY)/2;for(var G=0;G<this.playerArr.length;G++)if(p=this.playerArr[0],e=this.playerArr[G],e&&!e.isDie()&&(e!=this.leading_Role||i.isBoss||this.juageLead())&&(i.isChoice()&&e.isIdle()&&(n=GMath.distance(i.x,i.y,e.x,e.y-u/2),n<i.monRadius&&i.y<e.y&&(i.isBoss?this.leading_Role&&!i.isTarget&&i.setTarget(this.leading_Role):i.setTarget(e),e.setAtkTarget(i))),i.y-a>=e.y-u+d&&i.y-h+a<=e.y-d&&i.x+s>=e.x-c&&i.x-s<=e.x+c)){this.hitEffAddToScene({atkx:e.x,atky:e.y,eff:t.IMiniGame28Consts.dieEff}),i.setHit(1),e.died(),this.cancelAllTarget(e),this.backPlayerObj(e),this.playerArr.splice(G,1),this.playerDie(),G--;break}}o.resetHp()}else{if(o.isBoss&&this.setResult(!0),this.backMonsterObj(o),this.monsterArr.splice(m,1),!this.isRunning)return;m--}},e.prototype.cancelAllTarget=function(t){for(var i,e,s,h=this.monsterArr.length,a=0;h>a;a++)if(i=this.monsterArr[a],i&&i.monArr){s=i.monArr.length;for(var n=0;s>n;n++)e=i.monArr[n],e.playerTarget&&e.playerTarget==t&&e.resetTarget()}},e.prototype.chiocePlayer=function(){if(!this.leading_Role&&this.centerObj)for(var t,i=this.playerArr.length,e=0;i>e;e++)if(t=this.playerArr[e],t.isIdle()){this.leading_Role=t,t.setLeadData(),t.setTarget(this.centerObj),t.setFun2(this.changeSuccess,this);break}},e.prototype.juageBoss=function(t){if(!t)return!1;for(var i,e=!0,s=t.length,h=0;s>h;h++)if(i=t[h],!i.isBoss&&!i.isTarget)return e=!1;return e},e.prototype.juageLead=function(){for(var t,i=!0,e=this.playerArr.length,s=0;e>s;s++)if(t=this.playerArr[s],t!=this.leading_Role&&t.isIdle())return i=!1;return i},e.prototype.getMonsterObj=function(){var i=this.monsterPool.pop();return i||(i=GObj.create(t.IMiniGame28Dump)),i},e.prototype.backMonsterObj=function(t){t&&-1==this.monsterPool.indexOf(t)&&(t.reset(),this.monsterPool.push(t))},e.prototype.createSpec=function(i){for(var e=i.length,s=0;e>s;s++){var h=void 0;h=this.getSpecObj(),h.y=-50,h.x=i[s].specLR<t.IMiniGame28Consts.specPos.length?t.IMiniGame28Consts.specPos[i[s].specLR]:250,h.setData(i[s]),i[s].specX&&(h.x=i[s].specX),this.specArr.push(h)}},e.prototype.specRun=function(){if(0!=this.specArr.length&&this.centerObj)for(var i,e,s,h=0;h<this.specArr.length;h++)i=this.specArr[h],i&&(i.isCanRemove()?(this.specArr.splice(h,1),this.backSpecObj(i),h--):(i.run(),e=i.width*i.scaleX/2,s=i.height*i.scaleY,i.y>this.centerObj.point_y&&i.y-s<this.centerObj.point_y&&i.x+e>this.centerObj.point_x&&i.x-e<this.centerObj.point_x&&(i.setPick(),this.setSpecTimeOfPick(i.data.specTime),1==i.data.index?(this.tempData=i.data,this.playerShake()):this.playArrSpec(i.data),i.data.specEff?(this.hitEffAll(t.IMiniGame28Consts.addEff),IMiniGameMain.playEff(t.IMiniGame28Consts.minigame28_add)):(IMiniGameMain.playEff(t.IMiniGame28Consts.minigame28_reduce),this.hitEffAll(t.IMiniGame28Consts.reduceEff)),this.checkHaveTalk(""+i.data.specTime))))},e.prototype.setSpecTimeOfPick=function(t){var i=this.specArr.length;if(0!=i)for(var e,s=0;i>s;s++)e=this.specArr[s],e&&e.data.specTime==t&&e.setPick(!1)},e.prototype.getSpecObj=function(){var i=this.specPool.pop();return i||(i=GObj.create(t.IMiniGame28Spec)),this.avatarGrp.addChildAt(i,0),i},e.prototype.backSpecObj=function(t){t&&-1==this.specPool.indexOf(t)&&(t.reset(),t.parent&&t.parent.removeChild(t),this.specPool.push(t))},e.prototype.hitEffAll=function(t){for(var i=0;i<this.playerArr.length;i++)this.hitEffAddToScene({atkx:this.playerArr[i].x,atky:this.playerArr[i].y,eff:t})},e.prototype.hitEffAddToScene=function(t,i){var e=this.gethitEffObj();e.x=t.atkx,e.y=t.atky,e.start(t.eff,1),i&&(e.rotation=GMath.randomInt(0,360)),this.hitEffIn.push(e),this.hitEffGrp.addChild(e)},e.prototype.gethitEffObj=function(){var i=this.hitEffPool.pop();return i||(i=GObj.create(t.IMovie)),i},e.prototype.backHitEffObj=function(t){t&&-1==this.hitEffPool.indexOf(t)&&(t.parent&&t.parent.removeChild(t),this.hitEffPool.push(t))},e.prototype.hitEffRun=function(){var t=this.hitEffIn.length;if(0!=t)for(var i=0;t>i;i++){var e=this.hitEffIn[i];e&&(e.run(),e.isOver&&(this.hitEffIn.splice(i,1),i--,this.backHitEffObj(e)))}},e.prototype.playArrSpec=function(t){if(t&&this.playerArr){for(var i=this.playerArr.length,e=0;i>e;e++)this.playerArr[e].addBySpec(t);this.centerObj&&this.playerArr.length>0&&(this.centerObj.speed=this.playerArr[0].getSpeed());var s=t.specStrA;if(s)for(var h=s.length,a=void 0,n=0;h>n;n++){a=s[n];for(var o=0;i>o;o++)this.playerArr[o].addBySpecIndex(a)}}},e.prototype.getIsExit=function(t){for(var i,e=!1,s=this.playerArr.length,h=0;s>h;h++)if(i=this.playerArr[h],i.posIndex==t){e=!0;break}return e},e.prototype.getMaxIndex=function(){for(var t=-1,i=this.playerArr.length,e=0;i>e;e++)this.playerArr[e].posIndex>t&&(t=this.playerArr[e].posIndex);return t},e.prototype.reducePlayer=function(t){var i,e,s,h=t;s=h>=this.playerArr.length?0:GMath.randomInt(0,this.playerArr.length-h-1);for(var a=0;h>a&&!(this.playerArr.length<2);a++)i=this.getMaxPlayer(),i!=this.leading_Role&&(e=this.playerArr.indexOf(i),-1!=e&&(this.cancelAllTarget(i),this.playerArr.splice(e,1),egret.Tween.get(i).to({x:this.playerArr[s].x,y:this.playerArr[s].y},200).call(this.backPlayerObj,this,[i])));this.updateMoveArea(!0)},e.prototype.addPlayer=function(i){if(!this.getObjectB()||0!=this.playerArr.length){for(var e=[],s=this.getMaxIndex(),h=0;s>h;h++)this.getIsExit(h)||e.push(h);for(var a,n,o,r,l,p,c,u,d=this.playerArr[0],m=e.length,g=[],f=0;i>f;f++)a=this.getPlayer(),a.fixWidth=d.fixWidth,a.fixHeight=d.fixHeight,this.playerGrp.addChildAt(a,0),f<e.length?a.posIndex=e[f]:a.posIndex=s+f-m+1,u=this.getRingIndex(a.posIndex),a.ringIndex=u[0],a.ringPosIndex=u[1],a.setData(this.playerData),a.setIsMove(d.getIsMove()),a.setFun(this.changeAtk,this),a.isCanPlay=d.isCanPlay,a.setSoundName(d.getSoundName()),a.setSoundFun(this.soundCall,this),a.setFirstData(d.getFigureId(),d.getMountId(),d.getWingId(),d.getWeaId(),d.getPetId(),d.getSpeed()),n=0==d.ringIndex?0:360/d.ringIndex/t.IMiniGame28Consts.firstRingNum*d.ringPosIndex,o=d.x-d.ringIndex*t.IMiniGame28Consts.playx_value*GMath.cos(n),r=d.y-d.ringIndex*t.IMiniGame28Consts.playy_value*GMath.sin(n),n=0==a.ringIndex?0:360/a.ringIndex/t.IMiniGame28Consts.firstRingNum*a.ringPosIndex,a.posAngle=n,l=o+a.ringIndex*t.IMiniGame28Consts.playx_value*GMath.cos(n),p=r+a.ringIndex*t.IMiniGame28Consts.playy_value*GMath.sin(n),p>this.down_Role.y&&(this.down_Role=a),p<this.up_Role.y&&(this.up_Role=a),a.x=l,a.y=p,a.centobj_x=l-this.centerObj.point_x,a.centobj_y=p-this.centerObj.point_y,c||(p>this.playerGrp.height&&(c=1),p<a.fixHeight*a.scaleY&&(c=2)),g.push(a);this.centerObj.setY(this.centerObj.point_y-this.up_Role.y+this.centerObj.fixHeight,this.playerGrp.height-this.down_Role.y+this.centerObj.point_y),m=g.length;for(var h=0;m>h;h++)a=g[h],a.x=this.centerObj.point_x,a.y=this.centerObj.point_y,this.playerArr.push(a),g[h]=null;g=null,this.updateMoveArea(!1,c)}},e.prototype.updateRole=function(){for(var t,i=this.playerArr.length,e=0;i>e;e++)t=this.playerArr[e],0==e?this.down_Role=this.up_Role=t:(t.y>this.down_Role.y&&(this.down_Role=t),t.y<this.up_Role.y&&(this.up_Role=t))},e.prototype.updateMoveArea=function(t,i){if(t&&this.updateRole(),!this.getObjectB()){var e,s=this.playerArr.length;this.upDateMan(s),this.udpatePlayerHp(s);var h=s-this.addOnceNum;if(i){1==i&&(this.centerObj.point_y=Math.floor(this.centerObj.getMaxY())),2==i&&(this.centerObj.point_y=Math.ceil(this.centerObj.getMinY()));for(var a=0;s>a;a++)e=this.playerArr[a],h>a&&(e.y=this.centerObj.point_y+e.centobj_y)}for(var a=h;s>a;a++)e=this.playerArr[a],e.setTarget(this.centerObj);this.addOnceNum=0,t&&this.centerObj.setY(this.centerObj.point_y-this.up_Role.y+this.centerObj.fixHeight,this.playerGrp.height-this.down_Role.y+this.centerObj.point_y)}},e.prototype.juageCanAtk=function(){if(!this.isAtkIng){var t=this.playerArr.length,i=this.monsterArr.length;if(0!=i&&0!=t)for(var e,s,h,a,n=0;i>n;n++)if(h=this.monsterArr[n],h.monArr){a=h.monArr.length;for(var o=0;a>o;o++)if(e=h.monArr[o],!e.isDie())for(var r=0;t>r;r++)if(s=this.playerArr[r],s.checkAtkMonster(e))return this.playerAtk(),void(this.isAtkIng=!0)}}},e.prototype.juageLeadCanAtk=function(){if(!this.isAtkIng){var t=this.monsterArr.length;if(0!=t&&this.leading_Role)for(var i,e,s,h=this.leading_Role,a=0;t>a;a++)if(e=this.monsterArr[a],e.monArr){s=e.monArr.length;for(var n=0;s>n;n++)if(i=e.monArr[n],!i.isDie()&&h.checkAtkMonster(i))return this.otherPlayerAtk(),void(this.isAtkIng=!0)}}},e.prototype.playerAtk=function(){if(!this.isAtkIng)for(var t,i=this.playerArr.length,e=0;i>e;e++)t=this.playerArr[e],t.setUnifyAtk(!0),t.playerAtk()},e.prototype.otherPlayerAtk=function(){if(!this.isAtkIng)for(var t,i=this.playerArr.length,e=0;i>e;e++)t=this.playerArr[e],t.isIdle()&&(t.setUnifyAtk(!0),t.playerAtk())},e.prototype.checkPlayerA=function(){if(this.isSuccess){this.isSuccess=!1;var i=this.playerArr.length,e=this.monsterArr.length;if(i&&e)for(var s,h,a,n,o=0;e>o;o++)if(n=this.monsterArr[o],n.monArr){a=n.monArr.length;for(var r=0;a>r;r++)if(s=n.monArr[r],!s.isDie())for(var l=0;l<this.playerArr.length&&(h=this.playerArr[l],!(h&&h.isUnifyAtk&&h.checkAtkMonster(s)&&(s.setHit(1),IMiniGameMain.playEff(t.IMiniGame28Consts.minigame28_monD),s.isDie())));l++);}}},e.prototype.getRingIndex=function(i){for(var e,s,h=1;i>h*(h-1)*t.IMiniGame28Consts.firstRingNum/2;)h++;return e=h-1,s=i-e*(e-1)*t.IMiniGame28Consts.firstRingNum/2-1,[e,s]},e.prototype.getMaxPlayer=function(){for(var t=this.playerArr[0],i=0;i<this.playerArr.length;i++)this.playerArr[i].posIndex>t.posIndex&&(t=this.playerArr[i]);return t},e.prototype.playerShake=function(){this.playerArr[0].setCallFun(this.timeFunT,this);for(var t=0;t<this.playerArr.length;t++)this.playerArr[t].manMove()},e.prototype.timeFunT=function(){egret.Tween.get(this).wait(300).call(this.shakeCall,this)},e.prototype.shakeCall=function(){if(!(this.playerArr.length<1)&&this.tempData&&(this.playerArr[0].setCallFun(null,null),1==this.tempData.index))switch(this.tempData.specMan){case 0:this.addOnceNum=this.tempData.specValue||0,this.addPlayer(this.addOnceNum);break;case 1:this.reducePlayer(this.tempData.specValue);break;case 2:this.addOnceNum=this.playerArr.length*(this.tempData.specValue-1)||0,this.addPlayer(this.addOnceNum);break;case 3:this.reducePlayer(Math.floor(this.playerArr.length/this.tempData.specValue*(this.tempData.specValue-1)))}},e.prototype.getObjectB=function(){return!this.up_Role||!this.down_Role},e.prototype.clearObject=function(){for(var t,i,e=0;e<this.monsterArr.length;e++){if(i=this.monsterArr[e],i.monArr)for(var s=0;s<i.monArr.length;s++)t=i.monArr[s],i.backMon(t),i.monArr.splice(s,1),s--;this.backMonsterObj(i),this.monsterArr.splice(e,1),e--}this.monsterArr=[];for(var h,e=0;e<this.specArr.length;e++)h=this.specArr[e],this.backSpecObj(h),this.specArr.splice(e,1),e--;this.specArr=[];for(var a,e=0;e<this.hitEffIn.length;e++)a=this.hitEffIn[e],this.backHitEffObj(a),this.hitEffIn.splice(e,1),e--;this.hitEffIn=[];for(var n,e=0;e<this.playerArr.length;e++)n=this.playerArr[e],this.backPlayerObj(n),this.playerArr.splice(e,1),e--;this.hitEffIn=[]},e.prototype.backPlayerObj=function(t){t&&-1==this.playerPool.indexOf(t)&&(t.parent&&t.parent.removeChild(t),t.reset(),this.playerPool.push(t))},e.prototype.getPlayer=function(){var i=this.playerPool.pop();return i||(i=GObj.create(t.IMiniGame28Player)),i},e.prototype.setResult=function(i){this.talkCallBack=function(i){void 0===i&&(i=!0),this.isRunning=!1,i?(IMiniGameApp.sound.playEff(t.IMiniGame28Consts.minigame28_win),IMiniGameMain.reqSocket(3)):(this.playerHp.visible=!1,IMiniGameApp.sound.playEff(t.IMiniGame28Consts.minigame28_die)),i?t.IMiniGameResult.showResult(IMiniGameResultType.type_1,this.onCloseClick,this,3):t.IMiniGameResult.showResult(IMiniGameResultType.type_0,this.updateView,this)}.bind(this),i?this.checkHaveTalk("end"):(this.talkCallBack(i),this.talkCallBack=null)},e.prototype.clearTween=function(){egret.Tween.removeTweens(this),this.arrowImg&&egret.Tween.removeTweens(this.arrowImg),this.bossGrp&&egret.Tween.removeTweens(this.bossGrp),this.bossMovie&&(this.bossMovie.stop(),egret.Tween.removeTweens(this.bossMovie))},e.prototype.clearArr=function(t){if(t)for(var i in t)GObj.disposeObject(t[i])},e.prototype.dispose=function(){this.clearTween(),this.removeEvent(),this.playerData=null,GObj.disposeObject(this.touchMask),this.touchMask=null,this.clearArr(this.bgArr),this.bgArr=null,this.clearArr(this.playerArr),this.playerArr=null,this.clearArr(this.playerPool),this.playerPool=null,GObj.disposeObject(this.avatarGrp),this.avatarGrp=null,GObj.disposeObject(this.monsterGrp),this.avatarGrp=null,GObj.disposeObject(this.playerGrp),this.playerGrp=null,this.rocker&&GObj.disposeObject(this.rocker),this.rocker=null,GObj.disposeObject(this.arrowImg),this.arrowImg=null,this.clearArr(this.monsterArr),this.monsterArr=null,this.clearArr(this.monsterPool),this.monsterPool=null,this.clearArr(this.specArr),this.specArr=null,this.clearArr(this.specPool),this.specPool=null,GObj.disposeObject(this.hitEffGrp),this.hitEffGrp=null,this.stageData=null,GObj.disposeObject(this.uiGrp2),this.uiGrp2=null,GObj.disposeObject(this.uiGrp),this.uiGrp=null,this.bossMovie&&(GObj.disposeObject(this.bossMovie),this.bossMovie=null),GObj.disposeObject(this.progressGrp),this.progressGrp=null,GObj.disposeObject(this.progressBg),this.progressBg=null,GObj.disposeObject(this.progress),this.progress=null,GObj.disposeObject(this.progressBgUp),this.progressBgUp=null,GObj.disposeObject(this.endIcon),this.endIcon=null,GObj.disposeObject(this.lightImg),this.lightImg=null,GObj.disposeObject(this.numB),this.numB=null,GObj.disposeObject(this.move1Grp),this.move1Grp=null,GObj.disposeObject(this.moveBg),this.moveBg=null,GObj.disposeObject(this.moveLabel),this.moveLabel=null,GObj.disposeObject(this.timeGrp),this.timeGrp=null,GObj.disposeObject(this.timeImg),this.timeImg=null,GObj.disposeObject(this.timeIcon),this.timeIcon=null,GObj.disposeObject(this.timeLab),this.timeLab=null,GObj.disposeObject(this.timeIcon),this.timeIcon=null,GObj.disposeObject(this.manIcon),this.manIcon=null,GObj.disposeObject(this.manLab),this.manLab=null,GObj.disposeObject(this.bossGrp),this.bossGrp=null,GObj.disposeObject(this.exitBtn),this.exitBtn=null,GObj.disposeObject(this.bossBg),this.bossBg=null,GObj.disposeObject(this.bossImg),this.bossImg=null,GObj.disposeObject(this.bossLabel),this.bossLabel=null,this.tempData=null,this.stageData=null,this.leading_Role=null,this.up_Role=null,this.down_Role=null,GObj.disposeObject(this.playerHp),this.playerHp=null,GObj.disposeObject(this.centerObj),this.centerObj=null,GObj.disposeObject(this.bossLabelIcon),this.bossLabelIcon=null,i.prototype.dispose.call(this)},e}(t.IBaseView);t.IMiniGame28View=i,__reflect(i.prototype,"miniGame.IMiniGame28View")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(t){return i.call(this,t)||this}return __extends(e,i),e.prototype.getGameView=function(){return this.gameView||(this.gameView=GObj.create(t.IMiniGame3View)),this.gameView.setData(this.getCurGameData()),this.gameView},e.prototype.loadConfigComplete=function(e){if(e)for(var s in e.config)t.IMiniGame3Consts[s]=e.config[s];i.prototype.loadConfigComplete.call(this,e)},e}(t.IMiniGameBaseCtr);t.IMiniGame3=i,__reflect(i.prototype,"miniGame.IMiniGame3")}(miniGame||(miniGame={}));var miniGame;!function(t){t.IMiniGame3Consts={scene:"ui_haididongxiao",PLAYER_MODEL:"yu",ZHANLINGUP_UI:"ui_shengji",SKILL_ZHANDOU:"ui_yao",UI_SHENLI_CLIMB:"ui_shenli",GOODS_EFF:"ui_shanguang",minigame_bgm:"game3_minigame_bgm",minigame_attack:"game3_minigame_attack",minigame_defend:"game3_minigame_defend",minigame_gain:"game3_minigame_gain",minigame_win:"game3_minigame_win",minigame_lose:"game3_minigame_lose",timeTower:500,timePlayer:1,upBody:.15,playerSize:.3,playerMaxSize:1,atcTime:500,emmeyTime1:200,emmeyTime2:100}}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.initSkins(),t}return __extends(e,i),e.prototype.initSkins=function(){this.touchChildren=!1,this.imgAdd=GObj.create(t.ImageOutside),this.imgAdd.horizontalCenter=0,this.imgAdd.verticalCenter=0,this.imgAdd.loadCompleteCall(this.loadComplete,this),this.addChild(this.imgAdd),this.imgAddHp=GObj.create(t.IBitNumMap),this.imgAddHp.horizontalCenter=0,this.imgAddHp.setGap(-5),this.addChild(this.imgAddHp)},e.prototype.setData=function(t,i){this.scaleX=this.scaleY=1,this.anchorOffsetY=0,this.anchorOffsetX=0,this.imgAddHp.setPath(i>=0?"num3":"num4"),this.imgAdd.setOutSrc("items/"+t),this.imgAddHp.setString((i>=0?"+":"")+i)},e.prototype.loadComplete=function(){this.height=this.imgAdd.iconHeight||80,this.width=this.imgAdd.width,this.anchorOffsetY=this.explicitHeight/2,this.anchorOffsetX=this.explicitWidth/2,this.x+=this.imgAdd.width,this.imgAddHp.y=-30,ClockManager.setTimeout(this.moveTween,this,t.IMiniGame3Consts.timeTower)},e.prototype.removeMe=function(){this.imgAdd.anchorOffsetY=0,this.imgAdd.setOutSrc(""),this.lightEff&&this.lightEff.stop(),this.parent&&this.parent.removeChild(this)},e.prototype.moveTween=function(){egret.Tween.removeTweens(this.imgAdd),egret.Tween.removeTweens(this),this.showOutEff(),egret.Tween.get(this.imgAdd,{loop:!0}).to({verticalCenter:-5},1e3).to({verticalCenter:0},1e3).to({verticalCenter:5},1e3).to({verticalCenter:0},1e3)},e.prototype.moveToPlayer=function(i){egret.Tween.removeTweens(this.imgAdd),egret.Tween.removeTweens(this),egret.Tween.get(this).to({x:this.x-i,verticalCenter:-80,scaleX:1.35,scaleY:1.35},.8*t.IMiniGame3Consts.atcTime,egret.Ease.circOut).to({verticalCenter:0,scaleX:.3,scaleY:.3},.6*t.IMiniGame3Consts.atcTime,egret.Ease.circIn).call(this.removeMe,this)},e.prototype.showOutEff=function(){this.lightEff||(this.lightEff=GObj.create(t.IMovie),this.addChild(this.lightEff)),this.lightEff.x=this.width/2,this.lightEff.y=this.height/2,this.lightEff.start(t.IMiniGame3Consts.GOODS_EFF,1),this.lightEff.autoRun()},e.prototype.dispose=function(){this.lightEff&&this.lightEff.stop(),egret.Tween.removeTweens(this.imgAdd),egret.Tween.removeTweens(this),GObj.disposeObject(this.imgAdd),this.imgAdd=null,GObj.disposeObject(this.imgAddHp),this.imgAddHp=null,GObj.disposeObject(this.lightEff),this.lightEff=null},e}(eui.Component);t.IMiniGame3Goods=i,__reflect(i.prototype,"miniGame.IMiniGame3Goods")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.once(egret.Event.REMOVED_FROM_STAGE,t.dispose,t),t.initSkins(),t}return __extends(e,i),e.prototype.initSkins=function(){this.width=270,this.height=108,this.isMonsterTower=!1,this.bgImg=GObj.create(eui.Rect),this.bgImg.width=this.width,this.bgImg.top=10,this.bgImg.bottom=10,this.bgImg.alpha=.01,this.addChild(this.bgImg),this.avatarGrp=GObj.create(eui.Group),this.avatarGrp.horizontalCenter=50,this.avatarGrp.bottom=0,this.addChild(this.avatarGrp),this.playerGrp=GObj.create(eui.Group),this.playerGrp.horizontalCenter=-10,this.playerGrp.verticalCenter=0,this.addChild(this.playerGrp),this.avatarGrp.touchChildren=!1,this.haveTarget=!1},e.prototype.dataChanged=function(){i.prototype.dataChanged.call(this);var e=this.data;e.model_Gain&&(this.goods||(this.goods=GObj.create(t.IMiniGame3Goods)),this.goods.x=this.playerGrp.x+25,this.goods.verticalCenter=0,this.addChild(this.goods),this.goods.setData(e.model_Gain,e.hp),this.haveTarget=!0),this.scaleY=1,this.visible=!0},e.prototype.checkPos=function(t,i){var e=this,s=e.localToGlobal();return t>s.x&&i>s.y&&t<s.x+e.width&&i<s.y+e.height},e.prototype.fightting=function(t){if(!this.isDestory&&(this.isFight=!0,this.haveTarget&&t)){var i=t.getPlayerObj();this.goods&&this.goods.moveToPlayer(i.width*i.scaleX/2)}},e.prototype.stopFight=function(t,i){this.isDestory||(this.haveTarget=!1,this.isFight=!1,this.goods&&this.goods.removeMe())},e.prototype.addPlayerGrp=function(t){this.isDestory||this.playerGrp.addChild(t)},e.prototype.isNotOn=function(){return 0==this.itemIndex&&!this.isMonsterTower},e.prototype.dispose=function(){this.isDestory||(this.isDestory=!0,this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.dispose,this),GObj.disposeObject(this.bgImg),this.bgImg=null,GObj.disposeObject(this.avatarGrp),this.avatarGrp=null,GObj.disposeObject(this.playerGrp),this.playerGrp=null,GObj.disposeObject(this.goods),this.goods=null)},e}(eui.ItemRenderer);t.IMiniGame3Left=i,__reflect(i.prototype,"miniGame.IMiniGame3Left");var e=function(i){function e(){return null!==i&&i.apply(this,arguments)||this}return __extends(e,i),e.prototype.initSkins=function(){i.prototype.initSkins.call(this),this.isMonsterTower=!0,this.minHeight=108,this.height=void 0,this.avatarGrp.bottom=void 0,this.avatarGrp.horizontalCenter=50,this.avatarGrp.verticalCenter=0,this.playerGrp.horizontalCenter=0,this.avatar=GObj.create(t.IMiniGame3Monster),this.avatarGrp.addChild(this.avatar)},e.prototype.fightting=function(t){return this.isDestory?void 0:this.avatar&&!this.isFight?(this.isFight=!0,this.avatar.fightting(t.hp),!0):!1},e.prototype.stopFight=function(t,i){this.isDestory||(this.isFight=!1,this.avatar.waitting(),t?(this.avatar.died(),this.haveTarget=!1):this.avatar.upGrade(i))},e.prototype.dataChanged=function(){i.prototype.dataChanged.call(this);var t=this.data;this.avatar.reset(),this.avatar.setData(t),this.haveTarget=!0},e.prototype.dispose=function(){GObj.disposeObject(this.avatar),this.avatar=null,i.prototype.dispose.call(this)},e}(i);t.IMiniGame3Right=e,__reflect(e.prototype,"miniGame.IMiniGame3Right")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.init(),t}return __extends(e,i),e.prototype.init=function(){this.width=100,this.height=0,this.touchEnabled=!1,this.touchChildren=!1,this.monster=GObj.create(t.IMovie),this.monster.setLoadCompleteBack(this.callBack,this),this.addChild(this.monster),this.monster.autoRun(),this.hpMap=GObj.create(t.IBitNumMap),this.hpMap.y=-70,this.hpMap.left=10,this.hpMap.setGap(-3),this.hpMap.setPath("num4"),this.addChild(this.hpMap)},e.prototype.setData=function(t){this.data=t,this.hp=t.hp,this.showHp(t.hp),this.waitting()},e.prototype.fightting=function(i){this.hp&&!this.isFight&&(this.isFight=!0,this.monster.start(this.data.model_attack),i>this.hp?ClockManager.setTimeout(this.emBackHandler,this,.8*t.IMiniGame3Consts.atcTime):this.attackMove())},e.prototype.emBackHandler=function(){this.showHp(0),this.monster.visible=!1,this.hpMap.visible=!1},e.prototype.waitting=function(){this.isFight=!1,this.monster.start(this.data.model_stand),this.callBack()},e.prototype.died=function(){this.hp=0,this.isFight=!1},e.prototype.showHp=function(t,i){this.hpMap.setNumber(t,i)},e.prototype.upGrade=function(t){this.hp=t,this.showHp(t,800)},e.prototype.callBack=function(){var t=this;ClockManager.setTimeout(function(){t.monster&&(t.height=t.monster.height,t.monster.y=t.monster.height/2+5,t.hpMap.y=-Math.max(.25*t.monster.height,25))
},this,240)},e.prototype.attackMove=function(){IMiniGameMain.playEff(t.IMiniGame3Consts.minigame_defend),egret.Tween.removeTweens(this.monster),egret.Tween.get(this.monster).to({x:50},t.IMiniGame3Consts.emmeyTime1).wait(t.IMiniGame3Consts.emmeyTime2).to({x:-50},t.IMiniGame3Consts.emmeyTime2).to({x:0},t.IMiniGame3Consts.emmeyTime2)},e.prototype.reset=function(){this.monster.visible=!0,this.hpMap.visible=!0},e.prototype.dispose=function(){GObj.disposeObject(this.monster),this.monster=null,GObj.disposeObject(this.hpMap),this.hpMap=null,this.data=null},e}(eui.Group);t.IMiniGame3Monster=i,__reflect(i.prototype,"miniGame.IMiniGame3Monster")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.initSkins(),t}return __extends(e,i),e.prototype.initSkins=function(){this.width=10,this.bgRect=GObj.create(eui.Rect),this.bgRect.width=100,this.bgRect.height=80,this.bgRect.x=-this.bgRect.width/2,this.bgRect.y=-this.bgRect.height+18,this.bgRect.alpha=.01,this.addChild(this.bgRect),this.avatar=GObj.create(t.IAvatarView),this.avatar.y=10,this.avatar.setDirection(0),this.addChild(this.avatar),this.avatar.scaleY=this.avatar.scaleX=t.IMiniGame3Consts.playerSize,this.avatar.updatePart(t.IMiniGame3Consts.PLAYER_MODEL),this.avatar.setAction(AvatarConsts.ACTION_STAND),this.avatar.autoRun(),this.hpMap=GObj.create(t.IBitNumMap),this.hpMap.y=-80,this.hpMap.right=7,this.hpMap.setGap(-3),this.hpMap.setPath("num3"),this.addChild(this.hpMap)},e.prototype.showing=function(){this.isShow||(this.isShow=!0,this.waitting(),this.addToRoom())},e.prototype.fightting=function(i,e,s){this.isFight||this.isMove||!i||(this.isFight=!0,this.callBack=e,this.thisObj=s,i.model_Gain?(IMiniGameMain.playEff(t.IMiniGame3Consts.minigame_gain),ClockManager.setTimeout(this.stopFight,this,1.4*t.IMiniGame3Consts.atcTime)):this.hp>i.hp?(IMiniGameMain.playEff(t.IMiniGame3Consts.minigame_attack),this.avatar.setAction(AvatarConsts.ACTION_ATTACK),ClockManager.setTimeout(this.stopFight,this,t.IMiniGame3Consts.atcTime)):(egret.Tween.removeTweens(this.avatar),egret.Tween.get(this.avatar).wait(t.IMiniGame3Consts.emmeyTime1+2*t.IMiniGame3Consts.emmeyTime2).to({x:-50},100).call(this.stopFight,this)))},e.prototype.stopFight=function(){if(this.waitting(),this.callBack){var t=this.callBack,i=this.thisObj;this.callBack=null,this.thisObj=null,t.call(i)}},e.prototype.waitting=function(){this.isFight=!1,this.isMove=!1,egret.Tween.removeTweens(this),this.avatar.setAction(AvatarConsts.ACTION_STAND)},e.prototype.died=function(){this.hp=0,this.isMove=!1,this.isFight=!1,this.showBoomEff(),this.emBackHandler()},e.prototype.emBackHandler=function(){this.avatar.visible=!1,this.hpMap.visible=!1},e.prototype.getPlayerObj=function(){return this.avatar},e.prototype.upgradeing=function(i,e,s){this.isUpGrade||(this.callBack=e,this.thisObj=s,this.isUpGrade=!0,this.upGradeEff||(this.upGradeEff=GObj.create(t.IMovie),this.upGradeEff.setCompleteBack(this.upGradeComplete,this),this.upGradeEff.scaleX=this.upGradeEff.scaleY=t.IMiniGame3Consts.playerSize,this.addChild(this.upGradeEff)),i?ClockManager.setTimeout(this.upSize,this,500):this.upSize())},e.prototype.upSize=function(){var i=t.IMiniGame3Consts.upBody,e=t.IMiniGame3Consts.playerMaxSize;this.upGradeEff.scaleY+=i,this.upGradeEff.scaleX+=i,this.avatar.scaleY+=t.IMiniGame3Consts.upBody,this.avatar.scaleX+=t.IMiniGame3Consts.upBody,this.avatar.scaleX>e&&(this.avatar.scaleY=e,this.avatar.scaleX=e,this.upGradeEff.scaleY=e,this.upGradeEff.scaleX=e),this.upGradeEff.start(t.IMiniGame3Consts.ZHANLINGUP_UI,1),this.upGradeEff.x=-this.avatar.width*this.avatar.scaleX/2,this.upGradeEff.y=this.avatar.y-this.avatar.height*this.avatar.scaleY/3,this.upGradeEff.autoRun(),this.hpMap.y=-Math.max(this.avatar.height*this.avatar.scaleY,40),this.hpMap.right=this.avatar.height*this.avatar.scaleY/3},e.prototype.upGradeComplete=function(){if(this.isUpGrade=!1,this.callBack){var t=this.callBack,i=this.thisObj;this.callBack=null,this.thisObj=null,t.call(i)}},e.prototype.showBoomEff=function(){this.boomEff||(this.boomEff=GObj.create(t.IMovie),this.addChild(this.boomEff)),this.boomEff.scaleX=this.boomEff.scaleY=this.avatar.scaleX,this.boomEff.x=-50,this.boomEff.y=this.avatar.y,this.boomEff.start(t.IMiniGame3Consts.SKILL_ZHANDOU,1),this.boomEff.autoRun()},e.prototype.moving=function(){this.isMove||(this.isMove=!0,this.avatar.setAction(AvatarConsts.ACTION_STAND))},e.prototype.moveTo=function(i,e,s){var h=this;if(!this.isMove||!i){egret.Tween.removeTweens(this),this.moving();var a=this.localToGlobal();e.globalToLocal(a.x,a.y,a),e.addChild(this),this.x=a.x,this.y=a.y;var n=i.playerGrp.localToGlobal();e.globalToLocal(n.x,n.y,n);var o=n.x-this.width/2,r=n.y,l=Math.ceil(Math.sqrt(Math.pow(this.x-o,2)+Math.pow(this.y-r,2)))*t.IMiniGame3Consts.timePlayer;egret.Tween.get(this).to({x:o,y:r},l).call(this.waitting,this).call(function(){h.playerRoom=i,h.isShow?h.addToRoom():h.showing(),s&&s.call(e,i)},this)}},e.prototype.addToRoom=function(){this.playerRoom&&(this.x=0,this.y=0,this.playerRoom.addPlayerGrp(this))},e.prototype.showHp=function(t,i){this.hpMap.setNumber(t,i)},e.prototype.upGrade=function(t){this.hp=t,this.showHp(t,800)},e.prototype.dontMove=function(){return this.isMove||this.isFight||this.isUpGrade||!this.isShow||!this.hp},e.prototype.reset=function(){this.hpMap.right=7,this.avatar.x=0,this.isShow=!1,this.avatar.visible=!0,this.hpMap.visible=!0;var i=t.IMiniGame3Consts.playerSize;this.avatar.scaleY=this.avatar.scaleX=i,this.upGradeEff&&(this.upGradeEff.scaleY=this.upGradeEff.scaleX=i),this.hpMap.y=-Math.max(this.avatar.height*this.avatar.scaleY,40)},e.prototype.dispose=function(){egret.Tween.removeTweens(this),GObj.disposeObject(this.bgRect),this.bgRect=null,GObj.disposeObject(this.avatar),this.avatar=null,GObj.disposeObject(this.upGradeEff),this.upGradeEff=null,GObj.disposeObject(this.hpMap),this.hpMap=null,GObj.disposeObject(this.boomEff),this.boomEff=null,this.callBack=null,this.thisObj=null,this.playerRoom=null},e}(eui.Group);t.IMiniGame3Player=i,__reflect(i.prototype,"miniGame.IMiniGame3Player")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){return i.call(this)||this}return __extends(e,i),e.prototype.initSkins=function(){this.isInit||(this.isInit=!0,this.horizontalCenter=0,this.verticalCenter=0,this.width=540,this.height=960,this.bgImg=GObj.create(t.ImageOutside),this.bgImg.setOutSrc("game2_bg_1",FileConst.jpg),this.bgImg.horizontalCenter=0,this.bgImg.bottom=0,this.addChild(this.bgImg),this.sceneEff=GObj.create(t.IMovieMore),this.sceneEff.x=this.width/2,this.sceneEff.y=this.height/2,this.sceneEff.start(t.IMiniGame3Consts.scene),this.sceneEff.autoRun(),this.addChild(this.sceneEff),this.leftList=GObj.create(eui.DataGroup),this.leftList.bottom=50,this.leftList.left=0,this.leftList.width=270,this.leftList.useVirtualLayout=!1,this.leftData=GObj.create(eui.ArrayCollection),this.leftList.dataProvider=this.leftData,this.leftList.itemRenderer=t.IMiniGame3Left,this.addChild(this.leftList),this.rightList=GObj.create(eui.DataGroup),this.rightList.useVirtualLayout=!1,this.rightList.bottom=50,this.rightList.right=0,this.rightList.width=270,this.rightData=GObj.create(eui.ArrayCollection),this.rightList.dataProvider=this.rightData,this.rightList.itemRenderer=t.IMiniGame3Right,this.addChild(this.rightList),this.exitBtn=GObj.create(t.IBaseBtn),this.exitBtn.icon=IMiniGameMain.getIcon("exit_btn",FileConst.png,"chapter"),this.exitBtn.x=20,this.exitBtn.y=40,this.addChild(this.exitBtn),this.stageImg=GObj.create(t.ImageOutside),this.stageImg.setOutSrc("minigame2_17"),this.stageImg.horizontalCenter=0,this.stageImg.bottom=40,this.addChild(this.stageImg),this.stageNum=GObj.create(t.IBitNumMap),this.stageNum.setGap(5),this.stageNum.setPath("num2"),this.stageNum.horizontalCenter=0,this.stageNum.bottom=41,this.addChild(this.stageNum),this.createPlayer(),this.initEvent())},e.prototype.createPlayer=function(){this.player||(this.player=GObj.create(t.IMiniGame3Player)),this.addChild(this.player),this.player.x=0,this.player.y=this.height-this.leftList.bottom},e.prototype.initEvent=function(){this.exitBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCloseClick,this),this.player.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBeginClick,this),this.leftList.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onListClick,this),this.rightList.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onListClick,this)},e.prototype.removeEvent=function(){this.exitBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onCloseClick,this),this.leftList.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onListClick,this),this.rightList.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onListClick,this),this.player.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBeginClick,this),this.player.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMoveClick,this),this.player.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onEndClick,this),this.player.removeEventListener(egret.TouchEvent.TOUCH_END,this.onEndClick,this)},e.prototype.onListClick=function(i){if(!this.isMove&&!this.player.dontMove()&&i.target){var e=i.target.parent;if(e instanceof t.IMiniGame3Left){if(e.isNotOn())return;this.player.moveTo(e,this,this.checkMoveTower)}}},e.prototype.onBeginClick=function(){if(!this.isMove&&!this.player.dontMove()){this.player.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMoveClick,this),this.player.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onEndClick,this),this.player.addEventListener(egret.TouchEvent.TOUCH_END,this.onEndClick,this);var t=this.player.localToGlobal();this.globalToLocal(t.x,t.y,t),this.player.x=t.x,this.player.y=t.y,this.addChild(this.player),this.player.moving()}},e.prototype.onMoveClick=function(t){this.movePoint||(this.movePoint=GObj.create(egret.Point)),this.globalToLocal(t.stageX,t.stageY,this.movePoint),this.player.x=this.movePoint.x+10,this.player.y=this.movePoint.y+0},e.prototype.onEndClick=function(t){this.player.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMoveClick,this),this.player.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onEndClick,this),this.player.removeEventListener(egret.TouchEvent.TOUCH_END,this.onEndClick,this),this.player.waitting();for(var i,e,s=this.rightList.$children,h=0,a=s;h<a.length&&(e=a[h],!e.visible||!(i=e.checkPos(t.stageX,t.stageY)));h++);if(!i){s=this.leftList.$children;for(var n=0,o=s;n<o.length&&(e=o[n],0==e.itemIndex||!e.visible||!(i=e.checkPos(t.stageX,t.stageY)));n++);}i&&e?this.player.moveTo(e,this,this.checkMoveTower):this.player.moveTo(this.player.playerRoom,this)},e.prototype.checkMoveTower=function(i){if(this.curRoom&&this.curRoom!=i&&this.curRoom.isMonsterTower){var e=this.stageData.passes[this.curIndex],s=e.stages3[this.addLevel];return s&&(this.addLevel++,this.leftData.addItem(s),egret.Tween.get(this.leftList).to({height:this.leftList.height+108},t.IMiniGame3Consts.timeTower)),egret.Tween.get(this.rightList).to({height:this.rightList.height-this.curRoom.height},t.IMiniGame3Consts.timeTower),egret.Tween.get(this.curRoom).to({scaleY:0},t.IMiniGame3Consts.timeTower),this.curRoom.visible=!1,void this.fightting(i)}this.fightting(i)},e.prototype.fightting=function(i){var e=this;if(this.curRoom=i,i.haveTarget){IMiniGameMain.rmGuideView();var s=this.curRoom.data;if(!s.model_Gain){var h=s.model_Gain?!0:this.player.hp>s.hp,a=h?300:t.IMiniGame3Consts.emmeyTime1+t.IMiniGame3Consts.emmeyTime2;h&&ClockManager.setTimeout(function(){e.showBoomEff()},this,a)}i.fightting(this.player),this.player.fightting(i.data,this.stopFight,this)}},e.prototype.stopFight=function(){if(this.curRoom){var i=this.curRoom.data,e=this.player.hp+i.hp,s=i.model_Gain?!0:this.player.hp>i.hp;s?(!i.model_Gain&&IMiniGameMain.reqSocket(2),this.player.upGrade(e),this.player.upgradeing(!i.model_Gain,this.checkNextStage,this)):(this.player.died(),IMiniGameMain.playEff(t.IMiniGame3Consts.minigame_lose),t.IMiniGameResult.showResult(IMiniGameResultType.type_0,this.resultCallBack,this)),this.curRoom&&this.curRoom.stopFight(s,e)}},e.prototype.checkNextStage=function(){if(this.curRoom&&0==this.curRoom.itemIndex){var i=this.stageData.passes[this.curIndex+1],e=IMiniGameResultType.type_1;i?(this.curIndex++,e=IMiniGameResultType.type_5):(IMiniGameMain.reqSocket(3),IMiniGameMain.playEff(t.IMiniGame3Consts.minigame_win)),t.IMiniGameResult.showResult(e,this.resultCallBack,this,3,i&&i.passId)}},e.prototype.resultCallBack=function(t){switch(t){case IMiniGameResultType.type_0:this.curIndex=0,this.updateView();break;case IMiniGameResultType.type_1:this.onCloseClick();break;case IMiniGameResultType.type_5:this.updateView()}},e.prototype.setData=function(i){IMiniGameMain.playBgm(t.IMiniGame3Consts.minigame_bgm),this.initSkins(),this.stageData=i,this.curIndex=0,this.updateView()},e.prototype.updateView=function(){if(this.isInit&&this.stageData){this.createPlayer(),this.addLevel=0,this.isMove=!1,this.curRoom=null;var i=this.stageData.passes[this.curIndex];this.stageNum.setString(IMiniGameMain.getString(IMiniGameLanguage.c_16,i.passId));for(var e=[],s=0,h=i.stages1;s<h.length;s++){var a=h[s];e.push(a)}this.leftData.removeAll(),this.leftData.replaceAll(e);for(var n=[],o=0,r=i.stages2;o<r.length;o++)a=r[o],n.push(a);this.rightData.removeAll(),this.rightData.replaceAll(n),this.player.visible=!1,this.exitBtn.y=-this.exitBtn.height||-100,this.leftList.height=108*e.length,this.leftList.left=-150,egret.Tween.get(this.leftList).to({left:0},t.IMiniGame3Consts.timeTower).call(this.showMove,this),this.rightList.right=-150,this.rightList.height=void 0,egret.Tween.get(this.rightList).to({right:0},t.IMiniGame3Consts.timeTower).call(this.showGuide,this),this.isMove=!0,!this.curIndex&&IMiniGameMain.reqSocket(1,this.stageData.stageId)}},e.prototype.showMove=function(){if(0==this.leftList.numChildren)return void ClockManager.setTimeout(this.showMove,this,100);this.isMove=!1;var t=this.stageData.passes[this.curIndex];if(this.leftList.numChildren>1){var i=this.leftList.getChildAt(this.leftData.length-1);this.player.visible=!0,this.player.reset(),this.player.moveTo(i,this),this.player.hp=t.playerHp,this.player.showHp(t.playerHp)}},e.prototype.showGuide=function(){if(this.rightList.height=void 0,0==this.curIndex&&1==this.stageData.stageId){var t=IMiniGameMain.getGuideView(),i=this.rightList;t.playEffct(i.x+i.width/2+10,this.height-i.bottom-54),this.addChild(t)}this.exitBtn&&egret.Tween.get(this.exitBtn).to({y:40},500)},e.prototype.showBoomEff=function(){this.boomEff||(this.boomEff=GObj.create(t.IMovie),this.boomEff.scaleY=this.boomEff.scaleX=t.IMiniGame3Consts.playerSize);var i=this.player.getPlayerObj(),e=this.curRoom.avatarGrp;this.boomEff.x=e.width/4,this.boomEff.y=e.height/2,this.boomEff.scaleX=this.boomEff.scaleY=i&&i.scaleX,e.addChild(this.boomEff),this.boomEff.start(t.IMiniGame3Consts.SKILL_ZHANDOU,1),this.boomEff.autoRun()},e.prototype.dispose=function(){this.removeEvent(),this.curRoom&&egret.Tween.removeTweens(this.curRoom),this.leftList&&(this.leftList.dataProvider=null,egret.Tween.removeTweens(this.leftList),GObj.disposeObject(this.leftList),this.leftList=null),this.rightList&&(this.rightList.dataProvider=null,egret.Tween.removeTweens(this.rightList),GObj.disposeObject(this.rightList),this.rightList=null),GObj.disposeObject(this.exitBtn),this.exitBtn=null,GObj.disposeObject(this.bgImg),this.bgImg=null,GObj.disposeObject(this.stageImg),this.stageImg=null,GObj.disposeObject(this.stageNum),this.stageNum=null,GObj.disposeObject(this.sceneEff),this.sceneEff=null,GObj.disposeObject(this.boomEff),this.boomEff=null,GObj.disposeObject(this.player),this.player=null,this.stageData=null,this.leftData=null,this.rightData=null,egret.Point.release(this.movePoint),this.movePoint=null,this.curRoom=null,i.prototype.dispose.call(this)},e}(t.IBaseView);t.IMiniGame3View=i,__reflect(i.prototype,"miniGame.IMiniGame3View")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(t){return i.call(this,t)||this}return __extends(e,i),e.prototype.getGameView=function(){return this.gameView||(this.gameView=GObj.create(t.IMiniGame4View)),this.gameView.setData(this.getCurGameData()),this.gameView},e.prototype.loadConfigComplete=function(e){if(e)for(var s in e.config)t.IMiniGame4Consts[s]=e.config[s];i.prototype.loadConfigComplete.call(this,e)},e.setDefaultData=function(t){t.skillSel||(t.skillSel=[]),t.skills||(t.skills=[]);for(var i in t.skills)e.setDefaultSkill(t.skills[i]);t.bigSkills||(t.bigSkills=[]);for(i in t.bigSkills)e.setDefaultBigSkill(t.bigSkills[i]);t.passiveSkills||(t.passiveSkills=[]);for(i in t.passiveSkills)e.setDefaultPassiveSkill(t.passiveSkills[i]);for(var s in t.monsters)e.setDefaultMonster(t.monsters[s])},e.setDefaultSkill=function(i){var e=t.IMiniGame4Consts.skills[i.idx]||{};e.type=1;for(var s in e)void 0==i[s]&&(i[s]=e[s])},e.setDefaultBigSkill=function(i){var e=t.IMiniGame4Consts.bigSkills[i.idx]||{};e.type=2;for(var s in e)void 0==i[s]&&(i[s]=e[s])},e.setDefaultPassiveSkill=function(i){var e=t.IMiniGame4Consts.passiveSkill[i.idx]||{};e.type=3;for(var s in e)void 0==i[s]&&(i[s]=e[s])},e.setDefaultMonster=function(i){var e=t.IMiniGame4Consts.monsters[i.idx]||{};for(var s in e)void 0==i[s]&&(i[s]=e[s])},e}(t.IMiniGameBaseCtr);t.IMiniGame4=i,__reflect(i.prototype,"miniGame.IMiniGame4")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(t){function i(){var i=t.call(this)||this;return i.keyFrame=0,i}return __extends(i,t),i.prototype.setData=function(t){this.data=t,this.times=t.times,this.keyFrame=t.keyFrame,this.isKeyFrame=!1,this.start(t.model,t.times)},i.prototype.run=function(){t.prototype.run.call(this),(this.data.keyFrame<0||0==--this.keyFrame)&&(this.data.keyFrame>0&&(this.keyFrame=this.data.keyFrame),this.isKeyFrame=!0)},i.prototype.dispose=function(){this.data=null,t.prototype.dispose.call(this)},i}(t.IMovieMore);t.IMiniGame4BigSkill=i,__reflect(i.prototype,"miniGame.IMiniGame4BigSkill")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.initSkins(),t}return __extends(e,i),e.prototype.initSkins=function(){var i=this;this.touchEnabled=!1,this.touchChildren=!1,this.bg=GObj.create(t.ImageOutside),this.bg.horizontalCenter=0,this.bg.loadCompleteCall(function(){i.width=i.bg.iconWidth,i.height=i.bg.iconHeight,i.anchorOffsetX=i.width/2,i.anchorOffsetY=i.height/2},this),this.bg.setOutSrc("icon4"),this.addChild(this.bg),this.thumb=GObj.create(t.ImageOutside),this.thumb.horizontalCenter=0,this.thumb.verticalCenter=0,this.thumb.setOutSrc("icon3"),this.addChild(this.thumb),this.point=GObj.create(t.ImageOutside),this.point.loadCompleteCall(function(){i.point.anchorOffsetX=i.point.iconWidth/2,i.point.anchorOffsetY=i.point.iconHeight/2},this),this.point.setOutSrc("icon1"),this.point.verticalCenter=0,this.addChild(this.point),this.label=GObj.create(eui.Label),this.label.size=22,this.label.horizontalCenter=0,this.label.verticalCenter=0,this.addChild(this.label),this.slideDuration=200},e.prototype.setData=function(t,i){if(!(0>t||t>i)){var e=this.thumb.width||this.width;this.value=t/i*100,this.point.x=e*t/i+this.thumb.x,this.label.text=t+"/"+i}},e.prototype.dispose=function(){GObj.disposeObject(this.bg),this.bg=null,GObj.disposeObject(this.thumb),this.thumb=null,GObj.disposeObject(this.point),this.point=null,GObj.disposeObject(this.label),this.label=null},e}(eui.ProgressBar);t.IMiniGame4Blood=i,__reflect(i.prototype,"miniGame.IMiniGame4Blood")}(miniGame||(miniGame={}));var miniGame;!function(t){t.IMiniGame4Consts={skillUpGrade:"zhanliup_ui",skinChange:"",partnerShow:"",bossMovie:"ui_bosslaixi",selectSkillMovie:"ui_tishi2",canUseSkillMovie:"ui_tishi1",skillDorpMovie:"ui_pao",hurtNum:"num15",critHurtNum:"num14",monsterGap:300,bossGap:400,hitBack:20,atkSpeed:120,hitFilter:10,showTrailing:!0,playerChat:"滑动摇杆操控人物",skills:{},monsters:{},bigSkills:{},passiveSkill:{},partner:{},map:[2304,1536,9,6,1,1],angles:[0,360],distanceMin:null,distanceAdd:null,minigame4_item:"",minigame4_skill:"baowu",minigame4_attack:"att",minigame4_bgm:"bgm_login",minigame4_win:"win",minigame4_die:"minigame_lose",minigame4_boss:"minigame_lose",minigame4_pSkill1:"",minigame4_pSkill2:"",minigame4_bigSkill:""}}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){return i.call(this)||this}return __extends(e,i),e.prototype.setHurt=function(i,e){this.setNumber(i||0),this.anchorOffsetX=this.width/2,e?(this.speed=1,this.moveNum=2,this.initMove2(),this.setPath(t.IMiniGame4Consts.critHurtNum||"num4")):(this.speed=1.2,this.moveNum=1,this.initMove1(),this.setPath(t.IMiniGame4Consts.hurtNum||"num4")),this.setGap(-2),this.isRun=!0},e.prototype.setAngle=function(t){this.angle!=t&&(this.angle=t,this.speedx=this.speed*GMath.cos(t),this.speedy=this.speed*GMath.sin(t))},e.prototype.run=function(){if(this.isRun)switch(this.moveNum){case 1:this.showMove1();break;case 2:this.showMove2()}},e.prototype.showMove1=function(){this.x+=this.speedx,this.y+=this.speedy,this.alpha-=.02,this.alpha<.3&&(this.isRun=!1)},e.prototype.initMove1=function(){this.alpha=1,this.scaleX=1,this.scaleY=1,this.setAngle(GMath.randomInt(300,320))},e.prototype.showMove2=function(){this.x+=this.speedx,this.y+=this.speedy,this.scaleX+=this.show2p1,this.scaleY+=this.show2p1,this.alpha+=this.show2p2,this.scaleX>=1.5&&(this.show2p1=-.02,this.show2p2=-.03,this.speed=this.show2p3,this.setAngle(270)),this.alpha<.3&&(this.isRun=!1)},e.prototype.initMove2=function(){this.show2p1=.1,this.show2p2=0,this.show2p3=this.speed,this.speed=5*this.show2p3,this.setAngle(GMath.randomInt(260,280)),this.scaleX=this.scaleY=.3,this.alpha=1},e}(t.IBitNumMap);t.IminiGame4Hurt=i,__reflect(i.prototype,"miniGame.IminiGame4Hurt")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.reSet(),t}return __extends(e,i),e.prototype.setData=function(t){this.reSet(),this.data=t,this.actPosY=t.actPosY||0,this.atkSpeed=0,this.hp=GMath.randomInt(t.hp[0],t.hp[1]),this.maxHp=this.hp,this.maxHitTimes=t.hitTimes||1,this.updatePart(t.model),this.setSpeed(t.speed),this.scaleX=this.scaleY=t.scaleXY,this.setAction(AvatarConsts.ACTION_STAND)},e.prototype.getHurt=function(){return this.data?this.data.hurt:null},e.prototype.getSkill=function(){return this.data&&this.data.skillIdx||-1},e.prototype.run=function(){i.prototype.run.call(this),this.atk(),this.lockTarget(),this.hitBack()},e.prototype.setTarget=function(t){this.target!=t&&(this.target=t,t&&!t.isDie()?(this._isMove=!0,this.lockTarget(),this.setAction(AvatarConsts.ACTION_WALK)):this._isMove=!1)},e.prototype.move=function(){this.isDie()||this._isMove&&(this.x+=this.speedx*this.scaleZ||0,this.y+=this.speedy*this.scaleZ||0)},e.prototype.atk=function(){if(!this.isDie()){var i=this.data.atkDis||0;0>=i&&(i=this.isBoss?t.IMiniGame4Consts.bossGap:t.IMiniGame4Consts.monsterGap),this._isMove=this.distance>i,--this.atkSpeed>0||this._isMove||(this.atkSpeed=this.data.atkSpeed||t.IMiniGame4Consts.atkSpeed,this.setAction(AvatarConsts.ACTION_ATTACK))}},e.prototype.actionOver=function(t){switch(i.prototype.actionOver.call(this,t),t){case AvatarConsts.ACTION_BRUISE:case AvatarConsts.ACTION_BRUISE_II:this.setAction(AvatarConsts.ACTION_WALK);break;case AvatarConsts.ACTION_ATTACK:this.createAtk=!0,this.setAction(AvatarConsts.ACTION_STAND)}},e.prototype.lockTarget=function(){if(!this._isDie&&this.target&&!(--this.lockGap>0)){this.lockGap=Math.ceil(IMiniGameMain.sysFrame()/5);var t=GMath.angle(this.x,this.y,this.target.x,this.target.y),i=this.getDirection(t);this.setDirection(i),this.distance=GMath.distance(this.x,this.y,this.target.x,this.target.y),this.setAngle(t)}},e.prototype.getDirection=function(t){if(this.angle==t)return this._direction8;var i=AvatarConsts.R_R-Math.floor((t+22.5)/45);return 0>=i&&(i+=AvatarConsts.L_B),i},e.prototype.hit=function(){i.prototype.hit.call(this),this.hitTimes>0&&this.hitTimes--},e.prototype.setHit=function(i){var i=Math.min(i,this.hp);this.hp-=i,this.hp<=0&&(this.hp=0,this.isDieShow=!0,this.setAction(AvatarConsts.ACTION_DIE),this.died()),this.isBoss||(this.x-=this.speedx*this.scaleZ*t.IMiniGame4Consts.hitBack,this.y-=this.speedy*this.scaleZ*t.IMiniGame4Consts.hitBack,this.hp>0&&this.setAction(AvatarConsts.ACTION_BRUISE))},e.prototype.hitBack=function(){this.isDieShow&&(this.alpha-=.02,this.alpha<=0&&(this.isDieShow=!1))},e.prototype.setSelected=function(){!this._isDie&&this.hitTimes<this.maxHitTimes&&this.hitTimes++},e.prototype.checkSelected=function(){return!this._isDie&&this.hitTimes<this.maxHitTimes&&this._action!=AvatarConsts.ACTION_BRUISE},e.prototype.canRemove=function(){return!this.isDieShow&&this.isDie()},e.prototype.reSet=function(){this.isBoss=!1,this.isDieShow=!1,this._isDie=!1,this._isMove=!1,this.target=null,this.distance=99999,this.hitTimes=0,this.hp=0,this.maxHp=0,this.data=null,this.maxHitTimes=1,this.speed=0,this.alpha=1},e.prototype.dispose=function(){this.reSet(),i.prototype.dispose.call(this)},e}(t.IMiniGame4Avatar);t.IMiniGame4Monster=i,__reflect(i.prototype,"miniGame.IMiniGame4Monster")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.isPlayer=!0,t.speed=1,t._direction8=1,t.dirTarget=t._direction8,t}return __extends(e,i),e.prototype.showUpGrade=function(i){this.upGrade||(this.upGrade=GObj.create(t.IMovie),this.addChild(this.upGrade)),this.upGrade.start(i||t.IMiniGame4Consts.skillUpGrade,1),this.upGrade.autoRun(),IMiniGameMain.playEff(t.IMiniGame4Consts.minigame4_skill)},e.prototype.setMoveArea=function(t,i,e,s){this.ax=t,this.ay=i,this.aw=e,this.ah=s},e.prototype.setMove=function(t){this._isMove=t,this.setAction(AvatarConsts.ACTION_ATTACK_III)},e.prototype.setData=function(t){this.actPosY=t.actPosY||0,this.hp=t.hp&&t.hp[0],this.setCd(t.atkSpeed),this.skillIdx=t.skillIdx||0,this.maxHp=this.hp,this.speed=t.speed,this.scaleX=this.scaleY=t.scaleXY,this.updatePart(t.model),this._isDie=!1},e.prototype.setCd=function(t){this.cd=t||this.cd,this.curCd=this.cd},e.prototype.run=function(){i.prototype.run.call(this),this.updateDirection()},e.prototype.move=function(){if(this._isMove){var t=this.x+(this.speedx||0);t>this.ax&&t<this.aw-this.ax&&(this.x=t);var i=this.y+(this.speedy||0);i>this.ay&&i<this.ah-this.ay&&(this.y=i)}},e.prototype.setDirection=function(t){this.dirTarget=t,this._direction8!=t&&(this.partCont.scaleX=this.direction2mirror(this._direction8),this.part.setDirection(this.direction2res(this._direction8)))},e.prototype.updateDirection=function(){var t=this.dirTarget-this._direction8;0!=t&&((t>16||-16>t)&&(t=-t),t=this._direction8+Math.ceil(t/Math.abs(t)),t=Math.floor(t%32),0>=t&&(t=32),this._direction8=t,this.partCont.scaleX=this.direction2mirror(this._direction8),this.part.setDirection(this.direction2res(this._direction8)))},e.prototype.direction2mirror=function(t){return t>=18?-1:1},e.prototype.direction2res=function(t){return 17>=t?t:32-t+2},e.prototype.showChat=function(i){var e=this;this.labGrp||(this.labGrp=GObj.create(eui.Group),this.labGrp.scaleX=1/(this.scaleX||1),this.labGrp.scaleY=1/(this.scaleY||1),this.addChild(this.labGrp),this.imgBg=GObj.create(t.ImageOutside),this.imgBg.horizontalCenter=0,this.lab=GObj.create(eui.Label),this.lab.textColor=0,this.lab.horizontalCenter=0,this.lab.verticalCenter=-10,this.lab.top=20,this.lab.lineSpacing=5,this.lab.size=18,this.lab.touchEnabled=!1,this.imgBg.loadCompleteCall(function(){e.labGrp.x=-e.imgBg.iconWidth/2*e.labGrp.scaleX,e.labGrp.y=(-e.imgBg.iconHeight-100*e.scaleY)*e.labGrp.scaleY,e.lab.maxWidth=e.imgBg.iconWidth-10,e.lab.maxHeight=e.imgBg.iconHeight-10},this),this.imgBg.setOutSrc("icon5"),this.labGrp.addChild(this.imgBg),this.labGrp.addChild(this.lab)),this.lab.text=i},e.prototype.hideChat=function(){this.labGrp&&(GObj.disposeObject(this.labGrp),this.labGrp=null,GObj.disposeObject(this.imgBg),this.imgBg=null,GObj.disposeObject(this.lab),this.lab=null)},e.prototype.dispose=function(){GObj.disposeObject(this.upGrade),this.upGrade=null,this.hideChat(),i.prototype.dispose.call(this)},e}(t.IMiniGame4Avatar);t.IMiniGame4Player=i,__reflect(i.prototype,"miniGame.IMiniGame4Player")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.initSkins(),t}return __extends(e,i),e.prototype.initSkins=function(){var i=this;this.touchEnabled=!1,this.touchChildren=!1,this.width=299,this.height=99,this.bgImg=GObj.create(t.ImageOutside),this.bgImg.x=0,this.bgImg.y=18,this.addChild(this.bgImg),this.thumbImg=GObj.create(t.ImageOutside),this.thumbImg.x=90,this.thumbImg.y=53,this.thumbImg.setOutSrc("icon7"),this.addChild(this.thumbImg),this.thumb=GObj.create(t.ImageOutside),this.thumb.x=91,this.thumb.y=55,this.thumb.setOutSrc("icon6"),this.addChild(this.thumb),this.headImg=GObj.create(t.ImageOutside),this.headImg.x=0,this.headImg.y=0,this.addChild(this.headImg),this.labName=GObj.create(eui.Label),this.labName.size=16,this.labName.x=97,this.labName.y=27,this.addChild(this.labName),this.labHp=GObj.create(eui.Label),this.labHp.size=16,this.labHp.horizontalCenter=22,this.labHp.y=52,this.addChild(this.labHp),this.countDownBg=GObj.create(t.ImageOutside),this.countDownBg.left=-8,this.countDownBg.setOutSrc("icon2"),this.addChild(this.countDownBg),this.countDownLab=GObj.create(eui.Label),this.countDownLab.left=this.countDownBg.left+30,this.countDownLab.size=22,this.countDownLab.textColor=16777215,this.addChild(this.countDownLab),this.bgImg.loadCompleteCall(function(){i.countDownBg.top=i.bgImg.iconHeight+20,i.countDownLab.top=i.countDownBg.top+1},this),this.bgImg.setOutSrc("icon9"),this.slideDuration=2e3/IMiniGameMain.sysFrame()},e.prototype.initInfo=function(t,i,e){this.updateHead(t),this.labName.text=i||"nickName",this.countDown=e||120,this.allTime=e||120,this.countDownLab.text="00:00"},e.prototype.updateHead=function(t){this.headImg.setOutSrc(t||"minigame4_role2")},e.prototype.setData=function(t,i){0>t||t>i||(this.value=t/i*100,this.labHp.text=t+"")},e.prototype.setTime=function(){if(this.countDown>=0){var t=this.countDown,i=int(t/60),e=t%60;this.countDownLab.text=(10>i?"0":"")+i+":"+(10>e?"0":"")+e}this.countDown--},e.prototype.getCurTime=function(){return this.allTime-this.countDown},e.prototype.dispose=function(){GObj.disposeObject(this.bgImg),this.bgImg=null,GObj.disposeObject(this.thumbImg),this.thumbImg=null,GObj.disposeObject(this.thumb),this.thumb=null,GObj.disposeObject(this.headImg),this.headImg=null,GObj.disposeObject(this.labName),this.labName=null,GObj.disposeObject(this.labHp),this.labHp=null,GObj.disposeObject(this.countDownBg),this.countDownBg=null,GObj.disposeObject(this.countDownLab),this.countDownLab=null},e}(eui.ProgressBar);t.IMiniGame4PlayerHp=i,__reflect(i.prototype,"miniGame.IMiniGame4PlayerHp")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){return i.call(this)||this}return __extends(e,i),e.prototype.initSkins=function(){var e=this;if(!this.isInit){i.prototype.initSkins.call(this),this.shadowGrp=GObj.create(egret.DisplayObjectContainer),this.shadowGrp.touchEnabled=!1,this.shadowGrp.touchChildren=!1,this.mapGrp.addChild(this.shadowGrp),this.monsterGrp=GObj.create(egret.DisplayObjectContainer),this.monsterGrp.touchEnabled=!1,this.monsterGrp.touchChildren=!1,this.mapGrp.addChild(this.monsterGrp),this.skillGrp=GObj.create(egret.DisplayObjectContainer),this.skillGrp.touchEnabled=!1,this.skillGrp.touchChildren=!1,this.mapGrp.addChild(this.skillGrp),this.effGrp=GObj.create(egret.DisplayObjectContainer),this.effGrp.touchEnabled=!1,this.effGrp.touchChildren=!1,this.mapGrp.addChild(this.effGrp),this.hurtGrp=GObj.create(egret.DisplayObjectContainer),this.hurtGrp.touchEnabled=!1,this.hurtGrp.touchChildren=!1,this.mapGrp.addChild(this.hurtGrp),this.trailing=GObj.create(t.IImageTrailing),this.monsterGrp.addChild(this.trailing),this.player=GObj.create(t.IMiniGame4Player),this.cameraFollow=this.player,this.monsterGrp.addChild(this.player),this.hitImg=GObj.create(t.ImageOutside);
var s=egret.Rectangle.create();s.setTo(2,2,6,6),this.hitImg.scale9Grid=s,this.hitImg.setOutSrc("icon10"),this.hitImg.width=this.width,this.hitImg.height=this.height,this.hitImg.touchEnabled=!1,this.addChild(this.hitImg),this.combo=GObj.create(t.IBitNumMap),this.combo.setPath("num6"),this.combo.setGap(-5),this.combo.y=250+IMiniGameMain.safeHeight,this.combo.visible=!1,this.addChild(this.combo),this.bossBlood=GObj.create(t.IMiniGame4Blood),this.bossBlood.x=this.width/2,this.bossBlood.y=180+IMiniGameMain.safeHeight,this.bossBlood.visible=!1,this.addChild(this.bossBlood),this.playerBlood=GObj.create(t.IMiniGame4PlayerHp),this.playerBlood.x=0,this.playerBlood.y=10+IMiniGameMain.safeHeight,this.addChild(this.playerBlood),this.rocker=GObj.create(t.IMiniGameRocker),this.rocker.setCallBack(this,function(){e.rocker.x=(e.width-e.rocker.width)/2,e.rocker.y=e.height-e.rocker.height-80}),this.addChild(this.rocker),this.skillView=GObj.create(t.IMiniGame4SkillView),this.skillView.x=20,this.skillView.y=this.height,this.skillView.setCallBack(this.createBigSkill,this),this.addChild(this.skillView),this.bossMovie=GObj.create(t.IMovie),this.bossMovie.isLast=!0,this.addChild(this.bossMovie),this.addChild(this.natureInfo)}},e.prototype.reSet=function(){i.prototype.reSet.call(this),this.attAdd={},this.hitPlayerFrame=0,this.monsterFrame=0,this.skillFrame=0,this.comboFrame=20,this.createMonsterFrame=30,this.frameDown50=0,this.showAll=!1,this.isCreateBoss=!1,this.isShowGuide=!1,this.isStop=!1,this.kills=0,this.curBigSkillId=void 0,this.curMonsterIdx=0,this.atkGap=99,this.thrunGap=99,this.frameNumRate=1,this.frameRate=IMiniGameMain.sysFrame(),this.avatarGap=this.frameRate,this.boss=null,this.gameOver=!1,this.stop(),this.combo&&(this.combo.visible=!1),this.bossBlood&&(this.bossBlood.visible=!1)},e.prototype.stop=function(){i.prototype.stop.call(this),this.trailing&&this.trailing.stop(),this.skillView&&this.skillView.closeHide(),this.bossMovie&&(egret.Tween.removeTweens(this.bossMovie),this.bossMovie.visible=!1),this.backPoolAllObject()},e.prototype.setData=function(t){this.initSkins(),this.curIdx=0,this.data=t,this.updateView()},e.prototype.updateView=function(){this.reSet(),this.curData=this.data.passes[this.curIdx],t.IMiniGame4.setDefaultData(this.curData),this.skillSelId=this.curData.skillSel.map(function(t){return t}),this.monsterMax=this.curData.monsterMax,this.loadMapImg(this.curData.mapId,this.curData.map||t.IMiniGame4Consts.map),this.initPlayerInfo(),t.IMiniGame4Consts.showTrailing&&this.trailing.start(),!this.curIdx&&IMiniGameMain.reqSocket(1,this.data.stageId),1==this.data.stageId&&this.player.showChat(t.IMiniGame4Consts.playerChat),i.prototype.start.call(this)},e.prototype.initPlayerInfo=function(){var t=this.player,i=this.curData;t.setData(i.player),t.x=this.mapGrp.width/2,t.y=this.mapGrp.height/2,this.shadowGrp.addChild(t.getShadow()),this.setMoveArea(t),this.setCamera(),this.playerBlood.initInfo(i.player.model,App.player.playerVo.name,i.time),this.playerBlood.setData(t.hp,this.player.maxHp);var e=this.getBigSkillById(i.bigSkillId);e&&(this.curBigSkillId=e.idx,this.skillSelBack(e,-1,0,0,1e3*(i.bigSkillShowGap||3))),this.hitImg.alpha=0},e.prototype.run=function(){return i.prototype.run.call(this),this.curData?(this.updatePlayer(),this.updateHitPlayer(),this.partnerRun(),this.monsterRun(),this.checkCreateMonster(),this.skillRun(),this.checkCreateSkill(),this.bigSkillRun(),this.trailing.run(),this.skillView.run(),this.hurtRun(),this.hitEffRun(),this.runDiedEff(),this.comboRun(),this.dorpItemRun(),this.updateAvatarLevel(),!1):void 0},e.prototype.checkNature=function(){if(this.isStop)return!1;var e=this.sysFrame,s=this.frameRate,h=GApp.timer-this.lastTime,a=i.prototype.checkNature.call(this);if(!a)return a;this.playerBlood.setTime(),this.checkDropSkill(),this.checkBossMovie(),this.player.isDie()&&this.setResult(IMiniGameResultType.type_0),this.gameOver&&(this.bossBlood.visible=!1,this.checkNextStage()),this.playerBlood.countDown<0&&this.setResult(IMiniGameResultType.type_0);var n=IMiniGameMain.sysFrame(),o=Math.min(n,e),r=Math.round(1e3*o/h);50>r?this.frameDown50++>5&&(this.frameDown50=0,this.trailing.stop()):this.frameDown50=0;var l=Math.max(r,.5*n)/n;return l=+l.toFixed(2),(s&&r-s>=10||s>r&&this.frameNumRate>l)&&(this.frameNumRate=l),this.natureInfo.visible&&(this.natureInfo.text="设备fps："+e+"\n设置fps："+n+"\n实际fps："+r+"\n运行比例："+this.frameNumRate+"\n小怪数："+this.getSceneInByClass(t.IMiniGame4Monster).length+"\n技能数："+this.getSceneInByClass(t.IMiniGame4Skill).length+" | "+this.getSceneInByClass(t.IMiniGame4BigSkill).length+"\n击中特效："+this.getSceneInByClass(t.IMovie).length+" | "+this.getSceneInByClass(t.IMovie,"dorpItems").length+"\n伤害数："+this.getSceneInByClass(t.IminiGame4Hurt).length),this.natureInfo.y=this.height-this.natureInfo.height-10,a},e.prototype.updatePlayer=function(){this.player&&(this.player.setMove(this.rocker.isMove),this.player.setAngle(this.rocker.angle),this.player.setDirection(this.rocker.dir),this.player.run(),this.rocker.isMove&&(this.setCamera(),this.player.hideChat()))},e.prototype.updatePlayerSpeed=function(){if(this.player){var i=this.curData.player,e=i.speed*(1+this.getAttAdd(4));this.player.setSpeed(e);for(var s=this.getSceneInByClass(t.IMiniGame4Player),h=0,a=s;h<a.length;h++){var n=a[h];n.setSpeed(e)}}},e.prototype.updateHitPlayer=function(){return--this.hitPlayerFrame<0?void(this.hitImg.alpha=0):(this.hitImg.alpha<=.3&&(this.hitImg.alpha=1),void(this.hitImg.alpha-=.02))},e.prototype.updateBigSkill=function(t){var i=this.getBigSkillById(t);i&&this.skillView.updateObjById(this.curBigSkillId,i)&&(this.curBigSkillId=t)},e.prototype.createPartner=function(i){var e=t.IMiniGame4Consts.partner[i.partnerId],s=this.curData.player.speed*(1+this.getAttAdd(4)),h=this.getPoolByClass(t.IMiniGame4Player);h.setData(e),h.setSpeed(s),h.showUpGrade(t.IMiniGame4Consts.partnerShow),this.setMoveArea(h),this.shadowGrp.addChild(h.getShadow()),this.monsterGrp.addChild(h),this.pushSceneInByObject(h);var a=this.getSceneInByClass(t.IMiniGame4Player),n=a.length,o=i.radius,r=i.partnerAngle;if(null==r){r=Math.floor(360/n);for(var l=0;n>l;l++)a[l].x=this.player.x+o*GMath.cos(r*l),a[l].y=this.player.y+o*GMath.sin(r*l)}else h.x=this.player.x+o*GMath.cos(r),h.y=this.player.y+o*GMath.sin(r)},e.prototype.partnerRun=function(){for(var i,e=this.getSceneInByClass(t.IMiniGame4Player),s=0,h=e;s<h.length;s++){var a=h[s];if(a.setMove(this.rocker.isMove),a.setAngle(this.rocker.angle),a.setDirection(this.rocker.dir),a.run(),--a.curCd<=0){if(i=this.getSkillById(a.skillIdx),!i)continue;a.setCd(i.skillGap),this.skillAddToScene(i.skillNum,i,a,0)}}},e.prototype.getMonsterById=function(i){return this.curData.monsters[i]||t.IMiniGame4Consts.monsters[i]||t.IMiniGame4Consts.monsters[0]},e.prototype.checkCreateMonster=function(){this.isStop||(this.bossAddToScene(),this.monsterAddToScene())},e.prototype.bossAddToScene=function(){var i;this.isCreateBoss&&!this.boss&&(this.isCreateBoss=!1,this.curData.monsterMaxBoss>=0&&(this.monsterMax=this.curData.monsterMaxBoss),i=this.getPoolByClass(t.IMiniGame4Monster),i.setData(this.curData.boss),i.isBoss=!0,this.setMonsterPoint(i),i.setTarget(this.player),this.boss=i,this.monsterGrp.addChild(i),this.pushSceneInByObject(i),this.bossBlood.setData(i.hp,i.maxHp),this.bossBlood.visible=!0)},e.prototype.monsterAddToScene=function(){if(!(--this.createMonsterFrame>0)){this.createMonsterFrame=this.curData.monsterFrame;var i=this.getSceneInByClass(t.IMiniGame4Monster);if(!(i.length>=this.monsterMax))for(var e,s=this.curData.monsterNum,h=GMath.randomInt(0,this.curData.monsters.length-1),a=this.getMonsterById(h),n=0;s>n&&!(i.length>=this.monsterMax);n++)e=this.getPoolByClass(t.IMiniGame4Monster),e.setData(a),this.setMonsterPoint(e),e.setTarget(this.player),this.monsterGrp.addChild(e),this.shadowGrp.addChild(e.getShadow()),this.pushSceneInByObject(e),0==i.length&&(i=this.getSceneInByClass(t.IMiniGame4Monster))}},e.prototype.setMonsterPoint=function(i){var e=this.curData,s=e.angles||t.IMiniGame4Consts.angles,h=e.distanceMin||t.IMiniGame4Consts.distanceMin,a=e.distanceAdd||t.IMiniGame4Consts.distanceAdd,n=GMath.randomInt(s[0],s[1]),o=h||this.width/2,r=h||this.height/2,l=o+(a||o),p=r+(a||r),c=GMath.randomInt(o,l),u=GMath.randomInt(r,p);i.isBoss&&(n=270,c=this.width/2,u=this.height/3),i.x=this.player.x+c*GMath.cos(n),i.y=this.player.y+u*GMath.sin(n)},e.prototype.monsterRun=function(){var i=this.getSceneInByClass(t.IMiniGame4Monster);if(0!=i.length){for(var e,s=Math.ceil(this.frameNumRate*i.length),h=this.monsterFrame;s>0&&(h>=i.length&&(h=0),e=i[h]);)e.canRemove()||this.isStop?(e.isBoss?this.isStop||(this.gameOver=!0):this.addDorpItem(e),e.removeMe(),i.splice(h,1),this.backPoolByObject(e),h--):(e.run(),e.createAtk&&(this.monsterAtk(e),e.createAtk=!1),this.showOrHide(e)),h++,s--;this.monsterFrame=h}},e.prototype.updateAvatarLevel=function(){if(!(--this.avatarGap>0)){this.avatarGap=20;var t=this.monsterGrp.$children;t&&t.sort(function(t,i){return t.y-i.y})}},e.prototype.getSkillById=function(i){return this.curData.skills[i]||t.IMiniGame4Consts.skills[i]},e.prototype.getBigSkillById=function(i){return this.curData.bigSkills[i]||t.IMiniGame4Consts.bigSkills[i]},e.prototype.getPassiveSkillById=function(i){return this.curData.passiveSkills[i]||t.IMiniGame4Consts.passiveSkill[i]},e.prototype.checkCreateSkill=function(){if(!(this.isStop||--this.player.curCd>0)){this.player.curCd=20;var i=this.getSceneInByClass(t.IMiniGame4Monster);if(0!=i.length){var e=this.getSceneInByClass(t.IMiniGame4Skill);if(!(e.length>=i.length)){var s=this.getSkillById(this.player.skillIdx);if(s){this.player.setCd(Math.ceil(s.skillGap*(1-this.getAttAdd(5))));var h=Math.ceil(s.skillNum*(1+this.getAttAdd(6)));this.skillAddToScene(h,s,this.player,this.getAttAdd(3)),++this.atkGap>=12&&(this.atkGap=0,IMiniGameMain.playEff(t.IMiniGame4Consts.minigame4_attack))}}}}},e.prototype.skillAddToScene=function(i,e,s,h,a){for(var n,o,r=0;i>r&&(o=this.getTarget1(null,!0)||a,o);r++)n=this.getPoolByClass(t.IMiniGame4Skill),n.setSkillInfo(e,null,h||0),n.setTarget(o),n.setPlayer(s),this.trailing.addTarget(n),this.skillGrp.addChild(n),this.pushSceneInByObject(n)},e.prototype.monsterAtk=function(i){var e=this.getPoolByClass(t.IMiniGame4Skill),s=i.getSkill();e.setSkillInfo(t.IMiniGame4Consts.skills[s],i.getHurt()),e.setTarget(this.player),e.setPlayer(i),this.trailing.addTarget(e),this.skillGrp.addChild(e),this.pushSceneInByObject(e)},e.prototype.skillRun=function(){var i=this.getSceneInByClass(t.IMiniGame4Skill);if(0!=i.length){for(var e,s,h=Math.ceil(this.frameNumRate*i.length),a=this.skillFrame;h>0&&(a>=i.length&&(a=0),e=i[a]);)e.isHit()&&(this.hurtAddToScene(e,e.hurt,e.critHurt),this.hitEffAddToScene(e,e.getHitModel()),s=e.getTarget(),this.setHpBlood(s),s.isPlayer||(s.isDie()?this.addDiedEff(s):this.addThunderEff(s)),s.isPlayer&&(this.hitPlayerFrame=IMiniGameMain.sysFrame()/2)),!e.isRunning()||this.isStop?(e.parent&&e.parent.removeChild(e),i.splice(a,1),this.trailing.rmTarget(e),this.backPoolByObject(e),a--):(e.checkTarget()||e.setTarget(this.getTarget1(null,!1)),e.run(),this.showOrHide(e)),a++,h--;this.skillFrame=a}},e.prototype.getTarget1=function(i,e){if(!i){if(e&&this.boss&&this.boss.parent&&this.boss.checkSelected())return this.boss;i=this.getSceneInByClass(t.IMiniGame4Monster)}for(var s,h,a=999999,n=0,o=i.length-1;o>=n;n++,o--){if(h=i[n],h&&h.checkSelected()){if(h.distance<t.IMiniGame4Consts.monsterGap)return h;a>h.distance&&(a=h.distance,s=h)}if(n>=o)break;if(h=i[o],h&&h.checkSelected()){if(h.distance<t.IMiniGame4Consts.monsterGap)return h;a>h.distance&&(a=h.distance,s=h)}}return!s&&this.boss&&this.boss.parent&&this.boss.checkSelected()?this.boss:s},e.prototype.getTarget2=function(i,e,s){var h=[],a=this.getSceneInByClass(t.IMiniGame4Monster);s||(s=this.player);var n,o,r,l,p,c,u;i>0&&360>i&&(n=s.getAngle(),o=s.x,r=s.y,l=n-i/2+180,p=n+i/2+180);for(var d,m,g=0,f=a.length-1;f>=g&&(d=a[g],m=s.isPlayer?d.distance:GMath.distance(s.x,s.y,d.x,d.y),!d.isDie()&&e>=m&&(u=!0,null!=n&&(c=GMath.angle(o,r,d.x,d.y)+180,l>c&&(c+=360),u=p>c&&c>=l),u&&h.push(d)),!(g>=f));g++,f--)d=a[f],m=s.isPlayer?d.distance:GMath.distance(s.x,s.y,d.x,d.y),!d.isDie()&&e>=m&&(u=!0,null!=n&&(c=GMath.angle(o,r,d.x,d.y)+180,l>c&&(c+=360),u=p>c&&c>=l),u&&h.push(d));return h},e.prototype.createBigSkill=function(i){var e=this.getBigSkillById(i);if(e){if(e.skillId>=0)return void this.skillAddToScene(e.times,this.getSkillById(e.skillId),this.player,0,this.player);var s=this.getPoolByClass(t.IMiniGame4BigSkill);s.x=this.player.x,s.y=this.player.y,s.setData(e),this.pushSceneInByObject(s),this.skillGrp.addChildAt(s,0)}},e.prototype.bigSkillRun=function(){var i=this.getSceneInByClass(t.IMiniGame4BigSkill);if(0!=i.length)for(var e,s=0;s<i.length;s++)e=i[s],e&&(e.x=this.player.x,e.y=this.player.y,e.run(),e.isKeyFrame&&(e.isKeyFrame=!1,this.setBigSkillHurt(e.data)),(e.isOver||this.isStop)&&(e.removeMe(),i.splice(s,1),this.backPoolByObject(e),s--))},e.prototype.setBigSkillHurt=function(i){var e;if(e=i.radius>0?this.getTarget2(i.angle||360,i.radius):this.getSceneInByClass(t.IMiniGame4Monster))for(var s,h=GMath.randomInt(i.hurt[0],i.hurt[1])||Math.pow(10,10)-1,a=0,n=0,o=0,r=e;o<r.length;o++){var l=r[o];l.isDie()||(l.setHit(h),l.isBoss&&(s=GMath.randomInt(180,360),a=l.scaleX*l.width*GMath.cos(s)*.3,n=l.scaleY*l.height*GMath.sin(s)*.6),this.hurtAddToScene(l,h,!0,a,n),this.hitEffAddToScene(l,i.hitmodel,a,n),this.setHpBlood(l))}for(var p,c=this.getSceneInByClass(t.IMiniGame4Skill),u=0,d=c;u<d.length;u++){var m=d[u];m&&(p=m.getTarget(),p&&p.isPlayer&&m.setTarget(null))}},e.prototype.hitEffAddToScene=function(i,e,s,h){var a=this.getPoolByClass(t.IMovie);a.x=i.x+(s||0),a.y=i.y+(h||0),a.start(e,1),this.pushSceneInByObject(a),this.effGrp.addChild(a),this.kills++},e.prototype.hitEffRun=function(){var i=this.getSceneInByClass(t.IMovie);if(0!=i.length)for(var e,s=0;s<i.length;s++)e=i[s],e&&(e.run(),this.showOrHide(e),(e.isOver||this.isStop)&&(e.removeMe(),i.splice(s,1),this.backPoolByObject(e),s--))},e.prototype.addThunderEff=function(i){var e=this.getAttAdd(1);if(e&&(++this.thrunGap,!(Math.random()>e))){var s=this.getPassiveSkillById(1);if(s){var h=this.getPoolByClass(t.IMovie),a=0,n=0;if(i.isBoss){var o=GMath.randomInt(180,360);a=i.scaleX*i.width*GMath.cos(o)*.3,n=i.scaleY*i.height*GMath.sin(o)*.7}h.x=i.$getX()+a,h.y=i.$getY()+n,h.start(s.model,1),this.pushSceneInByObject(h),this.effGrp.addChild(h);var r=GMath.randomInt(s.hurt[0],s.hurt[1])||1;i.setHit(r),this.hurtAddToScene(i,r,!1,a,n),this.hitEffAddToScene(i,s.hitmodel,a,n),this.setHpBlood(i),this.thrunGap>=12&&(IMiniGameMain.playEff(t.IMiniGame4Consts.minigame4_pSkill1),this.thrunGap=0)}}},e.prototype.checkDiedEff=function(){return this.diedEff||(this.diedEff=GObj.create(t.IMovie),this.effGrp.addChildAt(this.diedEff,0)),0==this.diedEff.isOver},e.prototype.addDiedEff=function(i){if(!this.checkDiedEff()){var e=this.getAttAdd(2);if(e&&!(Math.random()>e)){var s=this.getPassiveSkillById(2);if(s){this.diedEff.x=i.$getX(),this.diedEff.y=i.$getY(),this.diedEff.start(s.model,1);var h=this.getTarget2(360,s.radius,i);if(h)for(var a=GMath.randomInt(s.hurt[0],s.hurt[1])||1,n=0,o=h;n<o.length;n++){var r=o[n];r.isDie()||(r.setHit(a),this.hurtAddToScene(r,a,!0),this.hitEffAddToScene(r,s.hitmodel),this.setHpBlood(r))}IMiniGameMain.playEff(t.IMiniGame4Consts.minigame4_pSkill2)}}}},e.prototype.runDiedEff=function(){this.checkDiedEff()&&this.diedEff.run()},e.prototype.hurtAddToScene=function(i,e,s,h,a){var n=this.getPoolByClass(t.IminiGame4Hurt);n.x=i.x+(h||0),n.y=i.y+(a||0),n.setHurt(e,s),this.pushSceneInByObject(n),this.hurtGrp.addChild(n)},e.prototype.hurtRun=function(){var i=this.getSceneInByClass(t.IminiGame4Hurt);if(0!=i.length)for(var e,s=0;s<i.length;s++)e=i[s],e&&(e.run(),this.showOrHide(e),(!e.isRun||this.isStop)&&(e.removeMe(),i.splice(s,1),this.backPoolByObject(e),s--))},e.prototype.setHpBlood=function(t){t.isBoss&&this.bossBlood.setData(this.boss.hp,this.boss.maxHp),t.isPlayer&&this.playerBlood.setData(this.player.hp,this.player.maxHp)},e.prototype.checkDropSkill=function(){if(!this.isStop)for(var i,e=this.playerBlood.getCurTime(),s=this.curData.skillDorp,h=0,a=s;h<a.length;h++){var n=a[h];0!=n&&n==e&&(i=this.getPoolByClass(t.IMovie),i.start(t.IMiniGame4Consts.skillDorpMovie),this.pushSceneInByObject(i,"dorpItems"))}},e.prototype.addDorpItem=function(i){var e=this,s=this.getSceneInByClass(t.IMovie,"dorpItems");if(0!=s.length)for(var h=0,a=s;h<a.length;h++){var n=a[h];if(!n.parent){egret.Tween.removeTweens(n),n.x=i.x,n.y=i.y;var o=this.player,r=GMath.randomInt(0,360),l=o.x+200*GMath.cos(r),p=o.y+200*GMath.sin(r),c=o.ax,u=o.ay,d=o.aw,m=o.ah;(c>l||l>d-c||u>p||p>m-u)&&(l=this.player.x,p=this.player.y),n.scaleX=.5,n.scaleY=.5,egret.Tween.get(n).to({x:l,y:p-30,scaleX:1.4,scaleY:1.4},500,egret.Ease.circOut).to({x:l,y:p,scaleX:1,scaleY:1},300,egret.Ease.circIn).call(function(){if(1==e.data.stageId&&!e.isShowGuide){var i=e.getSceneInByClass(t.IMovie,"dorpItems")[0];if(i&&i.parent){e.isShowGuide=!0;var s=IMiniGameMain.getGuideView();s.playEffct(i.x,i.y),e.effGrp.addChild(s)}}},this),this.effGrp.addChild(n);break}}},e.prototype.dorpItemRun=function(){var i=this.getSceneInByClass(t.IMovie,"dorpItems");if(0!=i.length){var e,s,h,a=this.player;this.rocker.isMove&&(s=a.width/2*a.scaleX*.7,h=a.height*a.scaleY*.7);for(var n=0;n<i.length;n++)if(e=i[n],e&&e.parent&&(e.run(),this.showOrHide(e),this.isStop||this.rocker.isMove&&e.x>=a.x-s&&e.x<=a.x+s&&e.y>=a.y-h&&e.y<=a.y))return e.removeMe(),i.splice(n,1),this.isStop||this.showSkillSel(),this.backPoolByObject(e),n--,void(this.isShowGuide&&IMiniGameMain.rmGuideView())}},e.prototype.setAttAdd=function(t,i){var e=this.attAdd[t]||0;e+=i/100,this.attAdd[t]=e},e.prototype.getAttAdd=function(t){return this.attAdd[t]||0},e.prototype.showSkillSel=function(){if(IMiniGameMain.playEff(t.IMiniGame4Consts.minigame4_item),this.skillSel||(this.skillSel=GObj.create(t.IMiniGame4SkillSel),this.skillSel.setCallBack(this.skillSelBack,this)),!this.skillSel.parent){var e,s,h=[],a=Math.min(this.skillSelId.length,3);if(0!=a){for(var n=0;a>n;n++)switch(e=this.skillSelId[n].split("_"),s=+e[1],+e[0]){case 1:h.push(this.getSkillById(s));break;case 2:h.push(this.getBigSkillById(s));break;case 3:h.push(this.getPassiveSkillById(s))}IMiniGameMain.addToStage(this.skillSel),this.skillSel.setData(h),i.prototype.stop.call(this)}}},e.prototype.skillSelBack=function(e,s,h,a,n){i.prototype.start.call(this),s>=0&&this.skillSelId.splice(s,1),this.skillSelItem||(this.skillSelItem=GObj.create(t.IMiniGame4SkillMove)),this.skillSelItem.visible=s>=0,egret.Tween.removeTweens(this.skillSelItem),this.skillSelItem.setData(e);var o=this.skillView,r=2==e.auto,l=2==e.type&&!r;if(n=n||600,l){this.skillSelItem.x=h,this.skillSelItem.y=a,this.addChild(this.skillSelItem);var p=this.skillView.getSkillNum()+1.5,c=(this.skillSelItem.height||80)+10;egret.Tween.get(this.skillSelItem).to({x:o.x,y:o.y-c*p},n).call(this.skillSelOver,this)}else{var u=this.monsterGrp.globalToLocal(h,a);this.skillSelItem.x=u.x,this.skillSelItem.y=u.y,this.monsterGrp.addChild(this.skillSelItem),egret.Tween.get(this.skillSelItem).to({x:this.player.x,y:this.player.y-this.player.height/2,alpha:.3,scaleX:.2,scaleY:.2},n).call(this.skillSelOver,this)}},e.prototype.skillSelOver=function(){if(!this.isDestory){this.skillSelItem.stop();var i=this.skillSelItem.data;switch(i.type){case 1:this.player.showUpGrade();break;case 2:this.skillView.setData(this.skillSelItem.data);break;case 3:var e=i;switch(e.kind){case 7:this.player.skillIdx<e.maxId&&(this.player.skillIdx++,this.player.setCd(10));break;case 8:this.createPartner(e);break;case 9:return this.playerBlood.updateHead(e.model),this.player.updatePart(e.model),this.updateBigSkill(e.bigSkillId),this.getSkillById(e.skillId)&&(this.player.skillIdx=e.skillId,this.player.setCd(10)),void this.player.showUpGrade(t.IMiniGame4Consts.skinChange);default:this.setAttAdd(e.kind,e.value),4==e.kind&&this.updatePlayerSpeed()}this.player.showUpGrade()}}},e.prototype.comboRun=function(){--this.comboFrame>0||this.isStop||(this.comboFrame=Math.ceil(IMiniGameMain.sysFrame()/10),this.combo.setString("LX"+this.kills),this.combo.x=this.width-this.combo.width-20,this.combo.visible=this.kills>0)},e.prototype.checkBossMovie=function(){this.isCreateBoss||this.playerBlood.getCurTime()==this.curData.bossTime&&(this.bossMovie.visible=!1,this.bossMovie.setLoadCompleteBack(this.showBossMovie,this),this.bossMovie.start(t.IMiniGame4Consts.bossMovie,1),IMiniGameMain.playEff(t.IMiniGame4Consts.minigame4_boss),this.bossMovie.autoRun(),IMiniGameMain.reqSocket(2))},e.prototype.showBossMovie=function(){var t=this;this.bossMovie.visible=!0,this.bossMovie.x=this.width+this.bossMovie.width,this.bossMovie.y=this.height/3;var i=(this.width-this.bossMovie.width)/2;egret.Tween.removeTweens(this.bossMovie),egret.Tween.get(this.bossMovie).to({x:i},500).wait(1500).call(function(){t.isCreateBoss=!0},this).to({x:-this.bossMovie.width},500).call(function(){t.bossMovie&&(t.bossMovie.visible=!1,t.bossMovie.stop())},this)},e.prototype.checkNextStage=function(){var t=this.data.passes[this.curIdx+1],i=IMiniGameResultType.type_1;t?(this.curIdx++,i=IMiniGameResultType.type_5):IMiniGameMain.reqSocket(3),this.setResult(i,t&&t.passId)},e.prototype.setResult=function(i,e){this.isStop=!0,i?IMiniGameMain.playEff(t.IMiniGame4Consts.minigame4_win):IMiniGameMain.playEff(t.IMiniGame4Consts.minigame4_die),t.IMiniGameResult.showResult(i,this.resultCallBack,this,3,e)},e.prototype.resultCallBack=function(t){switch(t){case IMiniGameResultType.type_0:this.reSet(),this.updateView();break;case IMiniGameResultType.type_1:var i=this.parent;i&&i.outCloseClick();break;case IMiniGameResultType.type_5:this.updateView()}},e.prototype.dispose=function(){this.isDestory||(this.removeEvent(),this.bossMovie&&egret.Tween.removeTweens(this.bossMovie),this.skillSelItem&&egret.Tween.removeTweens(this.skillSelItem),GObj.disposeObject(this.shadowGrp),this.shadowGrp=null,GObj.disposeObject(this.monsterGrp),this.monsterGrp=null,GObj.disposeObject(this.effGrp),this.effGrp=null,GObj.disposeObject(this.hurtGrp),this.hurtGrp=null,GObj.disposeObject(this.skillGrp),this.skillGrp=null,GObj.disposeObject(this.trailing),this.trailing=null,GObj.disposeObject(this.skillView),this.skillView=null,GObj.disposeObject(this.boss),this.boss=null,GObj.disposeObject(this.player),this.player=null,GObj.disposeObject(this.bossMovie),this.bossMovie=null,egret.Rectangle.release(this.hitImg.scale9Grid),this.hitImg.scale9Grid=null,GObj.disposeObject(this.hitImg),this.hitImg=null,GObj.disposeObject(this.combo),this.combo=null,GObj.disposeObject(this.bossBlood),this.bossBlood=null,GObj.disposeObject(this.playerBlood),this.playerBlood=null,GObj.disposeObject(this.rocker),this.rocker=null,GObj.disposeObject(this.diedEff),this.diedEff=null,GObj.disposeObject(this.skillSel),this.skillSel=null,GObj.disposeObject(this.skillSelItem),this.skillSelItem=null,this.attAdd=null,this.sideIdx=null,this.data=null,this.curData=null,this.skillSelId=null,i.prototype.dispose.call(this))},e}(t.IMiniGameSecne);t.IMiniGame4Scene=i,__reflect(i.prototype,"miniGame.IMiniGame4Scene")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.exact=!0,t.scaleZ=1,t.touchEnabled=!1,t.touchChildren=!1,t.speed=6,t.lockGap=0,t.distance=999,t.createImg(),t}return __extends(e,i),e.prototype.getAngle=function(){return this.angle+180},e.prototype.isRunning=function(){return this.isRun},e.prototype.setSkillInfo=function(t,i,e){this.reSet(),this.data=t,this.speed=t.speed,this.autoRoation=t.rotation||0,this.scaleX=this.scaleY=t.scaleXY||1,i=i||t.hurt,this.hurt=GMath.randomInt(i[0],i[1]);var s=(i[1]-i[0])/10;this.critHurt=this.hurt>=i[0]+8*s,e>0&&(this.hurt=Math.ceil(this.hurt*(1+e))),this.img.setOutSrc(t.model)},e.prototype.createImg=function(){var i=this;this.width=0,this.height=0,this.img=GObj.create(t.ImageOutside),this.img.loadCompleteCall(function(){i.img.anchorOffsetX=i.img.iconWidth/2,i.img.anchorOffsetY=i.img.iconHeight/2},this),this.addChild(this.img)},e.prototype.setTarget=function(t){if(this.hitTarget=null,t)t.setSelected(),this.target=t,this.setSkillPoint();else if(this.player.isPlayer){this.target=this.player;var i=this.target.scaleX*this.target.width,e=this.target.scaleY*this.target.height,s=GMath.randomInt(0,360);this.px=i*GMath.cos(s),this.py=e*GMath.sin(s)}else this.isRun=!1},e.prototype.checkTarget=function(){return this.target?this.target==this.player?!1:!this.target.isDie():!1},e.prototype.setPlayer=function(t){this.player=t,this.x=t.x,this.y=t.y,this.setSkillPoint()},e.prototype.setSkillPoint=function(){if(this.player&&this.target){var t=this.target.scaleX*this.target.width*.3;this.px=GMath.randomInt(-t,t);var i=this.target.scaleY*this.target.height;if(this.py=GMath.randomInt(0,.7*i),!this.isRun)switch(this.isRun=!0,this.data.track){default:case 1:this.trackPathSet1();break;case 2:this.trackPathSet2();break;case 3:this.trackPathSet3();break;case 4:this.trackPathSet4()}}},e.prototype.run=function(){if(this.isRun)switch(this.data.track){default:case 1:this.trackPath1();break;case 2:this.trackPath2();break;case 3:this.trackPath3();break;case 4:this.trackPath4()}},e.prototype.updateDistance=function(){var t=this.x-this.target.x+this.px,i=this.y-this.target.y+this.py;this.distance=Math.sqrt(Math.pow(t,2)+Math.pow(i,2))},e.prototype.lockTarget=function(){--this.lockGap>0||(this.lockGap=Math.ceil(egret.ticker.$frameRate/3),this.angleTarget=GMath.angle(this.x,this.y,this.target.x-this.px,this.target.y-this.py))},e.prototype.setAngle=function(t){t!=this.angle&&(this.angle=Math.floor((t+360)%360),this.autoRoation||(this.rotation=t+90),this.speedx=this.speed*GMath.cos(t),this.speedy=this.speed*GMath.sin(t))},e.prototype.updateAngle=function(){this.autoRoation&&(this.rotation+=this.autoRoation);var t=this.angleTarget-this.angle,i=12;if(this.player==this.target||Math.abs(t)>2*i){var e=t/Math.abs(t);(t>180||-180>t)&&(e=-e),t=this.angle+Math.ceil(i*e)}else t=this.angleTarget;this.setAngle(t)},e.prototype.trackPath1=function(){if(this.isRun&&(this.lockTarget(),this.scaleX<1&&(this.scaleX+=this.data.scaleAdd||.02,this.scaleY=this.scaleX,this.scaleZ=this.scaleX),this.updateAngle(),this.x+=this.speedx*this.scaleZ||0,this.y+=this.speedy*this.scaleZ||0,this.updateDistance(),this.distance<3*this.speed)){if(this.target==this.player)return;this.isRun=!1,this.hitTarget=this.target,this.target.hit(),this.target.setHit(this.hurt)}},e.prototype.trackPathSet1=function(){var t=GMath.angle(this.x,this.y,this.target.x-this.px,this.target.y-this.py);this.rotation=t+90;var i=20;this.x+=i*GMath.cos(t)*this.player.scaleX,this.y+=(i*GMath.sin(t)-this.player.getActPosY())*this.player.scaleY,this.lockTarget(),this.setAngle(t),this.scaleZ=1},e.prototype.trackPath2=function(){if(this.isRun){if(this.track2Over)return void this.trackPath1();this.updateAngle(),this.scaleX<1&&(this.scaleX+=this.data.scaleAdd||.002,this.scaleY=this.scaleX,this.scaleZ=this.scaleX),this.x+=this.speedx*this.scaleZ,this.y+=this.speedy*this.scaleZ,this.angle2-=this.speed,this.angle2<=0&&(this.track2Over=!0)}},e.prototype.trackPathSet2=function(){this.lockTarget(),this.angle2=180;var t=this.angleTarget-this.angle2;this.y-=this.player.getActPosY()*this.player.scaleY,this.x+=100*GMath.cos(t)*this.player.scaleX,this.y+=100*GMath.sin(t)*this.player.scaleY,this.setAngle(t),this.scaleZ=1,this.track2Over=!1},e.prototype.trackPath3=function(){if(this.isRun){if(this.track3Over)return void this.trackPath1();this.x+=this.speedx*this.scaleZ,this.y+=this.speedy*this.scaleZ,this.y<this.p3y&&(this.track3Over=!0)}},e.prototype.trackPathSet3=function(){var t=this.player.getAngle();t>77.5&&90>=t?t=60:t>90&&112.5>t&&(t=120),this.x=this.x+50*GMath.cos(t+180)*this.player.scaleX,this.y=this.y-50*this.player.scaleY,this.p3y=this.y-60,this.setAngle(GMath.randomInt(260,280)),this.scaleZ=1,this.track3Over=!1},e.prototype.trackPath4=function(){this.trackPath1(),this.speedx>0?this.img.scaleX=-1:this.img.scaleX=1,this.isRun||(this.isRun=!0,this.target=null)},e.prototype.trackPathSet4=function(){this.trackPathSet2(),this.showTrailing=null!=this.data.trailing&&void 0!=this.data.trailing,this.showTrailing&&(this.imageSrc=this.data.trailing,this.leng=this.data.trailingL,this.imageW=this.data.trailingW)},e.prototype.isHit=function(){return null!=this.hitTarget},e.prototype.getTarget=function(){return this.target||this.hitTarget},e.prototype.getHitModel=function(){return this.data?this.data.hitmodel||"":""},e.prototype.setScleaZ=function(t){this.z=this.y-t,this.updateZ()},e.prototype.updateZ=function(){if(!isNaN(this.z)){var t=this.z*(this.z<0?IMiniGameConfig.scaleZLess:IMiniGameConfig.scaleZLarge);this.scaleZ=1+t,this.scaleZ<0?this.scaleZ=.1:this.scaleZ>2&&(this.scaleZ=2),this.scaleX=this.scaleZ,this.scaleY=this.scaleZ}},e.prototype.track=function(){return this.data?this.data.track:0},e.prototype.removeMe=function(){this.parent&&this.parent.removeChild(this),this.showTrailing=!1},e.prototype.reSet=function(){this.showTrailing=!1,this.isRun=!1,this.rotation=0,this.lockGap=0,this.hitTarget=null,this.angle=null,this.target=null,this.player=null,this.data=null,this.px=0,this.py=0,this.distance=9999,this.autoRoation=0},e.prototype.dispose=function(){this.reSet(),GObj.disposeObject(this.img),this.img=null},e}(egret.DisplayObjectContainer);t.IMiniGame4Skill=i,__reflect(i.prototype,"miniGame.IMiniGame4Skill",["ITrailingVo","egret.DisplayObject"])}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function s(){return i.call(this)||this}return __extends(s,i),s.prototype.initSkins=function(){var i=this;if(!this.bgMask){this.width=StageManager.stageWidth,this.height=StageManager.stageHeight,this.bgMask=GObj.create(eui.Rect),this.bgMask.width=this.width,this.bgMask.height=this.height,this.bgMask.fillColor=0,this.bgMask.fillAlpha=.7,this.bgMask.touchChildren=!1,this.addChild(this.bgMask),this.bgGrp=GObj.create(eui.Group),this.bgGrp.width=this.width,this.bgGrp.height=this.height,this.bgGrp.anchorOffsetX=this.width/2,this.bgGrp.anchorOffsetY=this.height/2,this.bgGrp.horizontalCenter=0,this.bgGrp.verticalCenter=0,this.addChild(this.bgGrp),this.bgImg=GObj.create(t.ImageOutside),this.bgImg.horizontalCenter=0,this.bgImg.verticalCenter=0,this.bgImg.loadCompleteCall(function(){i.bgImg.anchorOffsetX=i.bgImg.iconWidth/2,i.bgImg.anchorOffsetY=i.bgImg.iconHeight/2},this),this.bgImg.setOutSrc("sel_2"),this.bgGrp.addChild(this.bgImg),this.nameBg=GObj.create(t.ImageOutside),this.nameBg.horizontalCenter=0,this.nameBg.verticalCenter=-300,this.nameBg.setOutSrc("sel_1"),this.bgGrp.addChild(this.nameBg),this.grp=GObj.create(eui.Group),this.grp.horizontalCenter=0,this.grp.verticalCenter=0,this.bgGrp.addChild(this.grp);var e=GObj.create(eui.HorizontalLayout);e.gap=0,e.paddingLeft=10,e.paddingTop=10,this.grp.layout=e,this.skills=[]}},s.prototype.setData=function(t){var i=this;this.initSkins(),this.grp.removeChildren(),this.grp.width=void 0,EnterFrameManager.instance.unRegisteRender(this.run,this),egret.Tween.removeTweens(this.bgGrp),this.bgGrp.scaleX=0,this.bgGrp.scaleY=0,egret.Tween.get(this.bgGrp).to({scaleX:1,scaleY:1},200).call(function(){i.bgMask&&i.updateView(t)},this)},s.prototype.closeHide=function(){egret.Tween.removeTweens(this.bgGrp),egret.Tween.removeTweens(this.bgImg),this.parent&&this.parent.removeChild(this),EnterFrameManager.instance.unRegisteRender(this.run,this)},s.prototype.updateView=function(t){for(var i,s=0;s<t.length;s++)i=this.skills[s],i||(i=GObj.create(e),i.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelectClick,this),this.skills[s]=i),i.setData(t[s],s),this.grp.addChild(i);egret.Tween.removeTweens(this.bgImg),this.bgImg.rotation=0,egret.Tween.get(this.bgImg,{loop:!0}).to({rotation:180},1e4).to({rotation:360},1e4),EnterFrameManager.instance.registeRender(this.run,this)},s.prototype.onSelectClick=function(t){var i=t.target;i&&i.data&&this.callBack&&this.callBack.call(this.thisObj,i.data,i.idx,t.stageX,t.stageY),this.closeHide()
},s.prototype.run=function(){for(var t=0,i=this.skills;t<i.length;t++){var e=i[t];e&&e.run()}},s.prototype.setCallBack=function(t,i){this.callBack=t,this.thisObj=i},s.prototype.dispose=function(){if(this.bgMask){this.closeHide(),GObj.disposeObject(this.bgMask),this.bgMask=null,GObj.disposeObject(this.bgImg),this.bgImg=null,GObj.disposeObject(this.nameBg),this.nameBg=null,GObj.disposeObject(this.grp),this.grp=null;for(var t=0,i=this.skills;t<i.length;t++){var e=i[t];GObj.disposeObject(e)}this.skills=null,this.callBack=null,this.thisObj=null}},s}(eui.Component);t.IMiniGame4SkillSel=i,__reflect(i.prototype,"miniGame.IMiniGame4SkillSel");var e=function(i){function e(){return i.call(this)||this}return __extends(e,i),e.prototype.initSkins=function(){var i=this;this.bgImg||(this.touchChildren=!1,this.bgImg=GObj.create(t.ImageOutside),this.addChild(this.bgImg),this.skillImg=GObj.create(t.ImageOutside),this.skillImg.horizontalCenter=0,this.addChild(this.skillImg),this.recommend=GObj.create(t.ImageOutside),this.recommend.top=0,this.recommend.x=10,this.recommend.setOutSrc("sel_4"),this.addChild(this.recommend),this.movie=GObj.create(t.IMovie),this.addChild(this.movie),this.skillName=GObj.create(eui.Label),this.skillName.horizontalCenter=0,this.skillName.size=22,this.skillName.textColor=9922151,this.addChild(this.skillName),this.skillInfo=GObj.create(eui.Label),this.skillInfo.horizontalCenter=0,this.skillInfo.size=16,this.skillInfo.textColor=6310246,this.skillInfo.lineSpacing=3,this.skillInfo.textAlign=egret.HorizontalAlign.CENTER,this.addChild(this.skillInfo),this.bgImg.loadCompleteCall(function(){i.width=i.bgImg.iconWidth,i.height=i.bgImg.iconHeight,i.skillImg.top=30,i.movie.x=i.width/2,i.movie.y=80,i.skillName.verticalCenter=5,i.skillInfo.verticalCenter=50,i.skillInfo.width=.8*i.width},this),this.bgImg.setOutSrc("sel_3"))},e.prototype.setData=function(i,e){this.initSkins(),this.idx=e,this.data=i,this.skillImg.setOutSrc(i.icon),this.skillName.text=i.name,this.skillInfo.text=i.desc,this.movie.start(t.IMiniGame4Consts.selectSkillMovie),this.movie.scaleX=2==i.type?1:.6,this.movie.scaleY=this.movie.scaleX,this.recommend.visible=2==i.type,egret.Tween.removeTweens(this),this.scaleY=0,egret.Tween.get(this).wait(200*e).to({scaleX:1,scaleY:1},200)},e.prototype.run=function(){this.movie&&this.movie.run()},e.prototype.dispose=function(){this.bgImg&&(egret.Tween.removeTweens(this),GObj.disposeObject(this.bgImg),this.bgImg=null,GObj.disposeObject(this.movie),this.movie=null,GObj.disposeObject(this.skillImg),this.skillImg=null,GObj.disposeObject(this.skillName),this.skillName=null,GObj.disposeObject(this.skillInfo),this.skillInfo=null,GObj.disposeObject(this.recommend),this.recommend=null,this.data=null,this.idx=null)},e}(eui.Component);__reflect(e.prototype,"IMiniGame4SkillSelItem");var s=function(i){function e(){return null!==i&&i.apply(this,arguments)||this}return __extends(e,i),e.prototype.initSkins=function(){var i=this;this.img||(this.img=GObj.create(t.ImageOutside),this.addChild(this.img),this.movie=GObj.create(t.IMovie),this.addChild(this.movie),this.img.loadCompleteCall(function(){i.width=i.img.iconWidth,i.height=i.img.iconHeight,i.movie.x=i.width/2,i.movie.y=i.height/2},this))},e.prototype.setData=function(i){this.initSkins(),this.alpha=1,this.scaleX=1,this.scaleY=1,this.data=i,this.img.setOutSrc(i.icon),this.movie.start(t.IMiniGame4Consts.selectSkillMovie),this.movie.autoRun()},e.prototype.stop=function(){this.img&&(this.movie.stop(),this.parent&&this.parent.removeChild(this))},e.prototype.dispose=function(){this.img&&(this.stop(),GObj.disposeObject(this.img),this.img=null,GObj.disposeObject(this.movie),this.movie=null,this.data=null)},e}(egret.DisplayObjectContainer);t.IMiniGame4SkillMove=s,__reflect(s.prototype,"miniGame.IMiniGame4SkillMove")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function s(){return i.call(this)||this}return __extends(s,i),s.prototype.initSkins=function(){if(!this.skillGrp){this.height=0,this.skillGrp=GObj.create(eui.Group),this.skillGrp.width=150,this.skillGrp.left=0,this.skillGrp.bottom=0,this.addChild(this.skillGrp);var t=GObj.create(eui.VerticalLayout);t.horizontalAlign=egret.HorizontalAlign.CENTER,t.gap=10,this.skillGrp.layout=t,this.skills={}}},s.prototype.onSkillClick=function(i){var e=i.target;return e.unlock?e.isComplete?(this.callBack&&this.callBack.call(this.thisObj,e.data.idx),e.start(),void IMiniGameMain.playEff(t.IMiniGame4Consts.minigame4_bigSkill)):void App.msgtip.show(IMiniGameMain.getString(IMiniGameLanguage.l4_2)):void App.msgtip.show(IMiniGameMain.getString(IMiniGameLanguage.l4_1))},s.prototype.setData=function(t){this.initSkins();var i=this.createSkill(t.idx);i.setData(t),2!=t.auto&&!i.parent&&this.skillGrp.addChildAt(i,0)},s.prototype.getSkillNum=function(){return this.skillGrp?this.skillGrp.numChildren:0},s.prototype.updateObjById=function(t,i){if(!this.skills)return this.setData(i),!0;if(this.skills[t])this.skills[t].updateInfo(i),this.skills[i.idx]=this.skills[t],delete this.skills[t];else{var e=this.createSkill(i.idx);e.setData(i)}return!0},s.prototype.createSkill=function(t){if(this.skills[t])return this.skills[t];var i=GObj.create(e);return i.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSkillClick,this),this.skills[t]=i,i},s.prototype.setCallBack=function(t,i){this.callBack=t,this.thisObj=i},s.prototype.closeHide=function(){for(var t in this.skills)this.skills[t].removeMe()},s.prototype.run=function(){if(this.skillGrp)for(var t in this.skills)this.skills[t]&&this.skills[t].unlock&&this.skills[t].run()},s.prototype.dispose=function(){if(this.skillGrp){GObj.disposeObject(this.skillGrp),this.skillGrp=null;for(var t in this.skills)this.skills[t]&&(this.skills[t].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSkillClick,this),GObj.disposeObject(this.skills[t]));this.skills=null,this.callBack=null,this.thisObj=null}},s}(eui.Component);t.IMiniGame4SkillView=i,__reflect(i.prototype,"miniGame.IMiniGame4SkillView");var e=function(i){function e(){var t=i.call(this)||this;return t.unlock=!1,t}return __extends(e,i),e.prototype.initSkins=function(){var i=this;this.img||(this.isComplete=!0,this.touchChildren=!1,this.grp=GObj.create(eui.Group),this.addChild(this.grp),this.img=GObj.create(t.ImageOutside),this.img.horizontalCenter=0,this.img.verticalCenter=0,this.grp.addChild(this.img),this.shape=GObj.create(egret.Shape),this.grp.addChild(this.shape),this.numMap=GObj.create(t.IBitNumMap),this.numMap.setPath("num2"),this.numMap.setGap(-2),this.numMap.horizontalCenter=0,this.numMap.verticalCenter=0,this.grp.addChild(this.numMap),this.movie=GObj.create(t.IMovie),this.grp.addChild(this.movie),this.radius=0,this.img.loadCompleteCall(function(){i.width=i.img.iconWidth,i.height=i.img.iconHeight,i.grp.width=i.width,i.grp.height=i.height,i.grp.anchorOffsetX=i.width/2,i.grp.anchorOffsetY=i.height/2,i.shape.x=i.width/2,i.shape.y=i.height/2,i.movie.x=i.width/2,i.movie.y=i.height/2,i.radius=i.width/2},this),this.skinName=this.getSkin())},e.prototype.getSkin=function(){var t=GObj.create(eui.Skin);return t.skinParts=["mcDisplay"],t.grp=this.grp,t.elementsContent=[this.grp],t.states=[new eui.State("up",[]),new eui.State("down",[new eui.SetProperty("grp","scaleX",.92),new eui.SetProperty("grp","scaleY",.92)]),new eui.State("disabled",[])],t},e.prototype.setData=function(t){this.initSkins(),this.stop(),this.unlock=!0,this.updateInfo(t)},e.prototype.updateInfo=function(t){this.data=t,this.time=t.cd+1,this.ea=360/this.time/IMiniGameMain.sysFrame(),this.img.setOutSrc(t.icon)},e.prototype.start=function(){this.data&&(this.stop(),this.movie.stop(),this.isComplete=!1,this.numMap.visible=!0,this.cd=0,this.frame=0,this.angle=0,this.tempAngle=0,this.run())},e.prototype.stop=function(){this.img&&(this.movie.start(t.IMiniGame4Consts.canUseSkillMovie),this.isComplete=!0,this.numMap.visible=!1,this.shape.graphics.clear())},e.prototype.run=function(){this.unlock&&(this.isComplete?this.data.auto?this.dispatchEvent(new egret.Event(egret.TouchEvent.TOUCH_TAP)):this.movie.run():(2!=this.data.auto&&this.updateDraw(),this.updateTime()))},e.prototype.removeMe=function(){this.parent&&this.parent.removeChild(this),this.stop(),this.unlock=!1},e.prototype.updateTime=function(){return--this.frame>=0?void 0:(this.frame=IMiniGameMain.sysFrame(),this.cd++,this.numMap.setNumber(this.time-this.cd),this.time<=this.cd?void this.stop():void 0)},e.prototype.updateDraw=function(){this.tempAngle+=this.ea,this.tempAngle<1||(this.angle+=this.tempAngle,this.angle>=359&&(this.angle=359),this.tempAngle=0,this.draw())},e.prototype.draw=function(){var t=3*Math.PI/2,i=t+2*Math.PI*this.angle/360+Math.PI/180,e=this.shape.graphics;e.clear(),e.beginFill(0,.5),e.moveTo(0,0),e.lineTo(this.radius,0),e.drawArc(0,0,this.radius,t,i,!0),e.lineTo(0,0),e.endFill()},e.prototype.dispose=function(){this.img&&(this.stop(),GObj.disposeObject(this.grp),this.grp=null,GObj.disposeObject(this.img),this.img=null,GObj.disposeObject(this.numMap),this.numMap=null,GObj.disposeObject(this.shape),this.shape=null,GObj.disposeObject(this.movie),this.movie=null,this.shape=null,this.data=null)},e}(eui.Button);__reflect(e.prototype,"IMiniGame4SkillIcon")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){return i.call(this)||this}return __extends(e,i),e.prototype.initSkins=function(){this.isInit||(this.isInit=!0,this.horizontalCenter=0,this.verticalCenter=0,this.width=StageManager.stageWidth,this.height=StageManager.stageHeight,this.gameView=GObj.create(t.IMiniGame4Scene),this.addChild(this.gameView),this.exitBtn=GObj.create(t.IBaseBtn),this.exitBtn.icon=IMiniGameMain.getIcon("exit_btn",FileConst.png,"chapter"),this.exitBtn.right=20,this.exitBtn.top=100+IMiniGameMain.safeHeight,this.addChild(this.exitBtn),this.initEvent())},e.prototype.initEvent=function(){this.exitBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCloseClick,this)},e.prototype.removeEvent=function(){this.exitBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onCloseClick,this)},e.prototype.onCloseClick=function(t){i.prototype.onCloseClick.call(this,t),this.gameView&&this.gameView.stop()},e.prototype.setData=function(i){this.initSkins(),this.gameView.setData(i),IMiniGameMain.playBgm(t.IMiniGame4Consts.minigame4_bgm)},e.prototype.dispose=function(){this.removeEvent(),this.exitBtn&&egret.Tween.removeTweens(this.exitBtn),GObj.disposeObject(this.exitBtn),this.exitBtn=null,GObj.disposeObject(this.gameView),this.gameView=null,i.prototype.dispose.call(this)},e}(t.IBaseView);t.IMiniGame4View=i,__reflect(i.prototype,"miniGame.IMiniGame4View")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(){function t(t){this.m_width=t.width,this.m_height=t.height,this.m_cameraOffsetX=0,this.m_cameraOffsetY=0}return t.prototype.init=function(t){this.m_container=t,this.m_zoomX=this.m_container.x,this.m_zoomY=this.m_container.y},t.prototype.setAnchor=function(t,i){null!=this.m_container&&(this.m_container.anchorOffsetX=this.m_container.width*t,this.m_container.anchorOffsetY=this.m_container.height*i,this.m_container.x=this.m_container.anchorOffsetX,this.m_container.y=this.m_container.anchorOffsetY,this.m_zoomX=this.m_container.anchorOffsetX,this.m_zoomY=this.m_container.anchorOffsetY)},t.prototype.setZoom=function(t){void 0===t&&(t=1),null!=this.m_container&&(this.m_container.scaleX=this.m_container.width/this.m_width/t,this.m_container.scaleY=this.m_container.height/this.m_height/t)},t.prototype.setRotation=function(t){null!=this.m_container&&(this.m_container.rotation=t)},t.prototype.follow=function(t){null!=this.m_container&&(this.m_follower=t,this.m_zoomX=this.m_follower.x,this.m_zoomY=this.m_follower.y,this.setAnchor(this.m_follower.x/this.m_container.width,this.m_follower.y/this.m_container.height))},t.prototype.CameraMoveX=function(t){this.m_cameraOffsetX=t,this.CameraUpdate(),this.m_cameraOffsetX=0},t.prototype.CameraMoveY=function(t){this.m_cameraOffsetY=t,this.CameraUpdate(),this.m_cameraOffsetY=0},t.prototype.CameraUpdate=function(){for(var t=0;t<this.m_container.numChildren;t++)null!=this.m_follower?this.m_follower!=this.m_container.getChildAt(t)&&(this.m_container.getChildAt(t).x-=this.m_cameraOffsetX,this.m_container.getChildAt(t).y-=this.m_cameraOffsetY):(this.m_container.getChildAt(t).x-=this.m_cameraOffsetX,this.m_container.getChildAt(t).y-=this.m_cameraOffsetY)},t}();t.Camera=i,__reflect(i.prototype,"miniGame.Camera")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(t){return i.call(this,t)||this}return __extends(e,i),e.prototype.getGameView=function(){return this.gameView||(this.gameView=GObj.create(t.IMiniGame5View)),this.gameView.setData(this.configData.config,this.getCurGameData()),this.gameView},e.prototype.dispose=function(){i.prototype.dispose.call(this)},e}(t.IMiniGameBaseCtr);t.IMiniGame5=i,__reflect(i.prototype,"miniGame.IMiniGame5")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(t){function i(){return t.call(this)||this}return __extends(i,t),i.prototype.setFun=function(t,i){this.fun=t,this.caller=i},i.prototype.actionOver=function(i){if(t.prototype.actionOver.call(this,i),i==AvatarConsts.ACTION_DIE&&(this.unAutoRun(),this.parent&&this.parent.parent&&this.parent.parent.removeChild(this.parent)),this.parent){var e=this.parent;if(4==e.type){if(i==AvatarConsts.ACTION_ATTACK_I||i==AvatarConsts.ACTION_ATTACK_II){var s=Math.floor(2*Math.random())+1;switch(s){case 1:this.setAction(AvatarConsts.ACTION_ATTACK_I);break;case 2:this.setAction(AvatarConsts.ACTION_ATTACK_II);break;default:this.setAction(AvatarConsts.ACTION_ATTACK_I)}}i==AvatarConsts.ACTION_DIE&&(this.caller&&this.fun&&this.fun.call(this.caller),this.caller=this.fun=null)}}},i.prototype.dispose=function(){t.prototype.dispose.call(this),GObj.disposeObject(this.caller),this.caller=null,GObj.disposeObject(this.fun),this.fun=null},i}(t.IAvatarView);t.IMiniGame5Avatar=i,__reflect(i.prototype,"miniGame.IMiniGame5Avatar")}(miniGame||(miniGame={}));var miniGame;!function(t){t.IMiniGame5Consts={ZHANLINGUP_UI:"zhanliup_ui",SHOUJI:"ui_shouji",PLAY_MODEL_SIZE:1,TIME_TWEEN:3,HEGIHT_MAN:100,WIDTH_MAN:100,ACT_TIME:1e3,FLY_SPEED:80,LEFT_DISTANCE:20,RIGHT_DISTANCE:60},t.test5Data={stageId:1,show:1,passes:[],widthN:3,hegihtN:5,stageitem:[]}}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(e){var s=i.call(this)||this;return s.exact=!0,s.height=t.IMiniGame5Consts.HEGIHT_MAN,s.width=t.IMiniGame5Consts.WIDTH_MAN,s.data=e,s}return __extends(e,i),e.prototype.initSkin=function(){this.avatar=GObj.create(t.IMiniGame5Avatar),this.avatar.setDirection(0),this.avatar.x=this.width/2,this.avatar.y=this.height,this.standBy(),this.addChild(this.avatar),this.avatar.updatePart(this.data),this.avatar.autoRun(),this.hpNumber=GObj.create(t.IBitNumMap),4==this._type?(this.hpNumber.top=-15,this.hpNumber.right=-10):(this.hpNumber.top=10,this.hpNumber.right=5),this.hpNumber.setGap(-3),this.hpNumber.setPath("num4"),this.addChild(this.hpNumber)},Object.defineProperty(e.prototype,"type",{get:function(){return this._type},set:function(t){this._type=t,this.initSkin()},enumerable:!0,configurable:!0}),e.prototype.standBy=function(){this.avatar.setAction(AvatarConsts.ACTION_STAND)},e.prototype.attack=function(){if(4==this._type){var t=Math.floor(2*Math.random())+1;switch(t){case 1:this.avatar.setAction(AvatarConsts.ACTION_ATTACK_I);break;case 2:this.avatar.setAction(AvatarConsts.ACTION_ATTACK_II);break;default:this.avatar.setAction(AvatarConsts.ACTION_ATTACK_I)}}this.avatar.setAction(AvatarConsts.ACTION_ATTACK_I),this.avatar.run()},e.prototype.die=function(){this.avatar.setAction(AvatarConsts.ACTION_DIE),this.avatar.run()},e.prototype.showHp=function(t,i){this.hpNumber.setNumber(t,i)},e.prototype.dispose=function(){GObj.disposeObject(this.avatar),this.avatar=null,GObj.disposeObject(this.data),this.data=null,GObj.disposeObject(this.hpNumber),this.hpNumber=null,GObj.disposeObject(this.hp),this.hp=null,GObj.disposeObject(this._type),this._type=null},e}(eui.Group);t.IMiniGame5Enemy=i,__reflect(i.prototype,"miniGame.IMiniGame5Enemy")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(t){var e=i.call(this)||this;return e.exact=!0,e.data=t,e.initSkin(),e}return __extends(e,i),e.prototype.initSkin=function(){this.height=t.IMiniGame5Consts.HEGIHT_MAN,this.width=t.IMiniGame5Consts.WIDTH_MAN,this.hpNumber=GObj.create(t.IBitNumMap),this.hpNumber.setGap(-3),this.hpNumber.setPath("num3"),this.addChild(this.hpNumber),this.img=GObj.create(t.ImageOutside),this.img.bottom=0,this.img.horizontalCenter=0,this.hpNumber.top=20,this.hpNumber.right=10,this.img.setOutSrc("items/"+this.data),this.addChild(this.img)},e.prototype.showHp=function(t,i){this.hpNumber.setNumber(t,i)},e.prototype.dispose=function(){GObj.disposeObject(this.data),this.data=null,GObj.disposeObject(this.hpNumber),this.hpNumber=null,GObj.disposeObject(this.hp),this.hp=null,GObj.disposeObject(this.img),this.img=null},e}(eui.Group);t.IMiniGame5Goods=i,__reflect(i.prototype,"miniGame.IMiniGame5Goods")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(t){var e=i.call(this)||this;return e.data=t,e.initSkin(),e}return __extends(e,i),e.prototype.initSkin=function(){var i=this;this.rotation=this.data.rotation,this.width=this.data.width,this.x=this.data.x,this.y=this.data.y,this.shape=GObj.create(t.ImageOutside),this.colorImg=GObj.create(t.ImageOutside),this.shape.loadCompleteCall(function(){i.colorImg.width=i.shape.width,i.height=i.colorImg.height=i.shape.height},this),this.shape.setOutSrc("line"+this.rotation,FileConst.png),this.shape.touchEnabled=!0,this.addChild(this.shape),this.colorImg.fillMode="repeat",this.colorImg.y=this.shape.y,this.colorImg.x=this.shape.x,this.colorImg.setOutSrc("color",FileConst.png),this.colorImg.visible=!1,this.addChild(this.colorImg)},e.prototype.addColor=function(){this.colorImg.visible=!0,this.colorImg.alpha=1,egret.Tween.get(this.colorImg,{loop:!0}).to({alpha:.3},300).to({alpha:1},300)},e.prototype.dispose=function(){this.colorImg&&egret.Tween.removeTweens(this.colorImg),GObj.disposeObject(this.colorImg),this.colorImg=null,GObj.disposeObject(this.data),this.data=null,GObj.disposeObject(this.shape),this.shape=null},e}(eui.Component);t.IMiniGame5LineItem=i,__reflect(i.prototype,"miniGame.IMiniGame5LineItem")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.exact=!0,t.initSkin(),t}return __extends(e,i),e.prototype.initSkin=function(){this.height=t.IMiniGame5Consts.HEGIHT_MAN,this.width=t.IMiniGame5Consts.WIDTH_MAN,this.avatar=GObj.create(t.IMiniGame5PlayerAvatar),this.avatar.setDirection(0),this.addChild(this.avatar),this.standBy(),this.avatar.x=15,this.avatar.y=this.height,this.avatar.autoRun(),this.hpNumber=GObj.create(t.IBitNumMap),this.hpNumber.top=15,this.hpNumber.left=-20,this.hpNumber.setGap(-3),this.hpNumber.setPath("num3"),this.addChild(this.hpNumber),this.beginPos=GObj.create(egret.Point),this.anchorPos=GObj.create(egret.Point),this.endPos=GObj.create(egret.Point),this.can=[];for(var i,e=0;4>e;e++)i=GObj.create(t.IAvatarView),i.alpha=1-(e+2)/10,i.visible=!1,i.setAction(AvatarConsts.ACTION_STAND),i.autoRun(),this.addChild(i),this.can.push(i)},Object.defineProperty(e.prototype,"data",{set:function(t){this.avatar.updatePart(t);for(var i=0;i<this.can.length;i++)this.can[i].updatePart(t)},enumerable:!0,configurable:!0}),e.prototype.setHp=function(t){t&&(1==t?(this.hpNumber.top=15,this.hpNumber.left=-20):this.hpNumber.left=20)},e.prototype.standBy=function(){this.avatar.autoRun(),this.avatar.setAction(AvatarConsts.ACTION_STAND)},e.prototype.attack=function(){var t=Math.floor(3*Math.random())+1;switch(t){case 1:this.avatar.setAction(AvatarConsts.ACTION_ATTACK_I);break;case 2:this.avatar.setAction(AvatarConsts.ACTION_ATTACK_II);break;case 3:this.avatar.setAction(AvatarConsts.ACTION_ATTACK_III);break;default:this.avatar.setAction(AvatarConsts.ACTION_ATTACK_I)}},e.prototype.jump=function(){this.avatar.setAction(AvatarConsts.ACTION_JUMP)},e.prototype.walk=function(){this.avatar.setAction(AvatarConsts.ACTION_WALK)},e.prototype.die=function(){this.avatar.setAction(AvatarConsts.ACTION_DIE)},e.prototype.showHp=function(t,i){this.hpNumber.setNumber(t,i)},e.prototype.show=function(t,i){var e,s;if(0==t)e=i>0?"up":"down";else if(0==i)e=t>0?"left":"right";else if(0>t){var h=Math.abs(i/t);s=Math.abs(180*Math.atan(h)/Math.PI),e=i>0?"right_up":"right_down"}else{var h=Math.abs(i/t);s=Math.abs(180*Math.atan(h)/Math.PI),e=i>0?"left_up":"left_down"}for(var a=0;a<this.can.length;a++)switch(this.can[a].scaleX=this.avatar.scaleX,this.can[a].visible=!0,e){case"up":this.can[a].x=this.avatar.x,this.can[a].y=this.avatar.y+20*(a+1);break;case"down":this.can[a].x=this.avatar.x,this.can[a].y=this.avatar.y-20*(a+1);break;case"left":this.can[a].x=this.avatar.x+20*(a+1),this.can[a].y=this.avatar.y;break;case"right":this.can[a].x=this.avatar.x-20*(a+1),this.can[a].y=this.avatar.y;break;case"right_up":this.can[a].x=this.avatar.x-Math.abs(20*Math.cos(s)*(a+1)),this.can[a].y=this.avatar.y+Math.abs(20*Math.sin(s)*(a+1));break;case"right_down":this.can[a].x=this.avatar.x-Math.abs(20*Math.cos(s)*(a+1)),this.can[a].y=this.avatar.y-Math.abs(20*Math.sin(s)*(a+1));break;case"left_up":this.can[a].x=this.avatar.x+Math.abs(20*Math.cos(s)*(a+1)),this.can[a].y=this.avatar.y+Math.abs(20*Math.sin(s)*(a+1));break;case"left_down":this.can[a].x=this.avatar.x+Math.abs(20*Math.cos(s)*(a+1)),this.can[a].y=this.avatar.y-Math.abs(20*Math.sin(s)*(a+1));break;default:this.can[a].x=this.avatar.x+20*Math.cos(s)*(a+1),this.can[a].y=this.avatar.y+20*Math.sin(s)*(a+1)}},e.prototype.hide=function(){for(var t=0;t<this.can.length;t++)this.can[t].visible=!1},e.prototype.playerMove=function(t,i,e,s){return this.lineArr=i,e?this.callBack=e:this.callBack=null,s?this.thisObj=s:this.thisObj=null,this.y==t.y&&t.x+t.width/2-90<this.x&&this.x<t.x+t.width/2+90?void(this.thisObj&&this.callBack&&this.callBack.call(this.thisObj,t)):(this.x<t.x?this.avatar.scaleX=1:this.avatar.scaleX=-1,void(this.y==t.y?this.horizontalMovement(t):this.x>t.x?this.y>t.y?this.test4(t):this.test2(t):this.y>t.y?this.test1(t):this.test3(t)))},e.prototype.test1=function(i){var e=this;egret.Tween.removeTweens(this);var s=t.IMiniGame5Consts.RIGHT_DISTANCE+t.IMiniGame5Consts.LEFT_DISTANCE;this.x%180<=t.IMiniGame5Consts.LEFT_DISTANCE?(this.walk(),egret.Tween.get(this).to({x:this.x+180-s},(180-s)*t.IMiniGame5Consts.TIME_TWEEN).call(function(){e.jump(),egret.Tween.get(e).to({y:i.y},Math.abs(e.y-i.y)*t.IMiniGame5Consts.TIME_TWEEN).call(function(){egret.Tween.get(e).to({x:e.x+s},Math.abs(s)*t.IMiniGame5Consts.TIME_TWEEN).call(function(){e.thisObj&&e.callBack&&e.callBack.call(e.thisObj,i)})})})):(this.jump(),egret.Tween.get(this).to({y:i.y},Math.abs(this.y-i.y)*t.IMiniGame5Consts.TIME_TWEEN).call(function(){egret.Tween.get(e).to({x:e.x+s},Math.abs(s)*t.IMiniGame5Consts.TIME_TWEEN).call(function(){e.thisObj&&e.callBack&&e.callBack.call(e.thisObj,i)})}))},e.prototype.test2=function(i){var e=this;egret.Tween.removeTweens(this);var s=t.IMiniGame5Consts.LEFT_DISTANCE+t.IMiniGame5Consts.RIGHT_DISTANCE;this.x%180>t.IMiniGame5Consts.LEFT_DISTANCE?(this.walk(),egret.Tween.get(this).to({x:this.x-180+s},(180-s)*t.IMiniGame5Consts.TIME_TWEEN).call(function(){e.jump(),egret.Tween.get(e).to({y:i.y},Math.abs(e.y-i.y)*t.IMiniGame5Consts.TIME_TWEEN).call(function(){egret.Tween.get(e).to({x:e.x-s},Math.abs(s)*t.IMiniGame5Consts.TIME_TWEEN).call(function(){e.thisObj&&e.callBack&&e.callBack.call(e.thisObj,i)})})})):egret.Tween.get(this).to({x:this.x-s},Math.abs(s)*t.IMiniGame5Consts.TIME_TWEEN).call(function(){e.jump(),egret.Tween.get(e).to({y:i.y},Math.abs(i.y-e.y)*t.IMiniGame5Consts.TIME_TWEEN).call(function(){e.thisObj&&e.callBack&&e.callBack.call(e.thisObj,i)})})},e.prototype.test3=function(i){var e=this;egret.Tween.removeTweens(this);var s=t.IMiniGame5Consts.RIGHT_DISTANCE+t.IMiniGame5Consts.LEFT_DISTANCE;this.x%180<=t.IMiniGame5Consts.LEFT_DISTANCE?(this.walk(),egret.Tween.get(this).to({x:this.x+180-s},(180-s)*t.IMiniGame5Consts.TIME_TWEEN).call(function(){e.jump(),egret.Tween.get(e).to({y:i.y},Math.abs(e.y-i.y)*t.IMiniGame5Consts.TIME_TWEEN).call(function(){egret.Tween.get(e).to({x:e.x+s},Math.abs(s)*t.IMiniGame5Consts.TIME_TWEEN).call(function(){e.thisObj&&e.callBack&&e.callBack.call(e.thisObj,i)})})})):egret.Tween.get(this).to({x:this.x+s},Math.abs(s)*t.IMiniGame5Consts.TIME_TWEEN).call(function(){e.jump(),egret.Tween.get(e).to({y:i.y},Math.abs(i.y-e.y)*t.IMiniGame5Consts.TIME_TWEEN).call(function(){e.thisObj&&e.callBack&&e.callBack.call(e.thisObj,i)})})},e.prototype.test4=function(i){var e=this;egret.Tween.removeTweens(this);var s=t.IMiniGame5Consts.LEFT_DISTANCE+t.IMiniGame5Consts.RIGHT_DISTANCE;this.x%180>t.IMiniGame5Consts.LEFT_DISTANCE?(this.walk(),egret.Tween.get(this).to({x:this.x-180+s},(180-s)*t.IMiniGame5Consts.TIME_TWEEN).call(function(){e.jump(),egret.Tween.get(e).to({y:i.y},Math.abs(e.y-i.y)*t.IMiniGame5Consts.TIME_TWEEN).call(function(){egret.Tween.get(e).to({x:e.x-s},Math.abs(s)*t.IMiniGame5Consts.TIME_TWEEN).call(function(){e.thisObj&&e.callBack&&e.callBack.call(e.thisObj,i)})})})):(this.jump(),egret.Tween.get(this).to({y:i.y},Math.abs(this.y-i.y)*t.IMiniGame5Consts.TIME_TWEEN).call(function(){egret.Tween.get(e).to({x:e.x-s},Math.abs(s)*t.IMiniGame5Consts.TIME_TWEEN).call(function(){e.thisObj&&e.callBack&&e.callBack.call(e.thisObj,i)})}))},e.prototype.horizontalMovement=function(i){var e=this;this.walk();var s=0;this.x>i.x?(s=this.x-i.x-(180-i.x%180)+t.IMiniGame5Consts.RIGHT_DISTANCE,egret.Tween.get(this).to({x:this.x-s},s*t.IMiniGame5Consts.TIME_TWEEN).call(function(){e.thisObj&&e.callBack&&e.callBack.call(e.thisObj,i)})):(s=i.x-i.x%180+t.IMiniGame5Consts.LEFT_DISTANCE-this.x,egret.Tween.get(this).to({x:i.x-t.IMiniGame5Consts.LEFT_DISTANCE},s*t.IMiniGame5Consts.TIME_TWEEN).call(function(){e.thisObj&&e.callBack&&e.callBack.call(e.thisObj,i)}))},e.prototype.dispose=function(){if(GObj.disposeObject(this.endPos),this.endPos=null,GObj.disposeObject(this.beginPos),this.beginPos=null,GObj.disposeObject(this.avatar),this.avatar=null,GObj.disposeObject(this.hpNumber),this.hpNumber=null,this.callBack=null,this.thisObj=null,GObj.disposeObject(this.anchorPos),this.anchorPos=null,this.lineArr)for(var t=0;t<this.lineArr.length;t++)GObj.disposeObject(this.lineArr[t]),this.lineArr[t]=null;if(GObj.disposeObject(this.lineArr),this.lineArr=null,this.can)for(var t=0;t<this.can.length;t++)GObj.disposeObject(this.can[t]),this.can[t]=null;GObj.disposeObject(this.can),this.can=null,GObj.disposeObject(this.hp),this.hp=null},e}(eui.Group);t.IMiniGame5Player=i,__reflect(i.prototype,"miniGame.IMiniGame5Player")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(t){function i(){return t.call(this)||this}return __extends(i,t),i.prototype.setFun=function(t,i){this.fun=t,this.caller=i},i.prototype.actionOver=function(i){t.prototype.actionOver.call(this,i),i==AvatarConsts.ACTION_DIE&&(this.caller&&this.fun&&this.fun.call(this.caller),this.caller=this.fun=null,this.unAutoRun());var e=i==AvatarConsts.ACTION_ATTACK_I||i==AvatarConsts.ACTION_ATTACK_II||i==AvatarConsts.ACTION_ATTACK_III;if(e&&e){var s=Math.floor(3*Math.random())+1;switch(s){case 1:this.setAction(AvatarConsts.ACTION_ATTACK_I);break;case 2:this.setAction(AvatarConsts.ACTION_ATTACK_II);break;case 3:this.setAction(AvatarConsts.ACTION_ATTACK_III);break;default:this.setAction(AvatarConsts.ACTION_ATTACK_I)}}},i.prototype.dispose=function(){t.prototype.dispose.call(this),GObj.disposeObject(this.caller),this.caller=null,GObj.disposeObject(this.fun),this.fun=null},i}(t.IAvatarView);t.IMiniGame5PlayerAvatar=i,__reflect(i.prototype,"miniGame.IMiniGame5PlayerAvatar")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.initLocalVariable(),t}return __extends(e,i),e.prototype.setData=function(i,e){this.configData=i,this.stageData=e,this.stageData&&this.configData&&(IMiniGameMain.playBgm(this.configData.minigame5_bgm),this.stageData.hegihtN=this.stageData.hegihtN?this.stageData.hegihtN:5,this.stageData.widthN=this.stageData.widthN?this.stageData.widthN:3,t.IMiniGame5Consts.ACT_TIME=this.configData.ACT_TIME?this.configData.ACT_TIME:t.IMiniGame5Consts.ACT_TIME,t.IMiniGame5Consts.FLY_SPEED=this.configData.FLY_SPEED?this.configData.FLY_SPEED:t.IMiniGame5Consts.FLY_SPEED,this.initSkins(),this.updateView())},e.prototype.initLocalVariable=function(){this.controlLineArr=[],this.lineArr=[],this.enemyArr=[],this.goodsArr=[],this.mapVo={}},e.prototype.initSkins=function(){this.isInit||(this.isInit=!0,this.horizontalCenter=this.verticalCenter=0,this.width=540,this.height=960,this.gameBg=GObj.create(t.ImageOutside),this.gameBg.verticalCenter=this.gameBg.horizontalCenter=0,this.gameBg.setOutSrc("gameBg",FileConst.jpg),this.addChild(this.gameBg),this.lineGroup=GObj.create(eui.Group),this.lineGroup.width=this.width,this.lineGroup.height=this.height,this.lineGroup.horizontalCenter=this.lineGroup.verticalCenter=0,this.addChild(this.lineGroup),this.eraser=GObj.create(t.ImageOutside),this.eraser.visible=!1,this.eraser.setOutSrc("eraser",FileConst.png),this.addChild(this.eraser),this.exitBtn=GObj.create(t.IBaseBtn),this.exitBtn.icon=IMiniGameMain.getIcon("exit_btn",FileConst.png,"chapter"),this.exitBtn.right=10,this.exitBtn.top=10,this.addChild(this.exitBtn),this.exitBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCloseClick,this))},e.prototype.updateView=function(){var i=this;this.initPlayer(),this.initMap(),this.isFight=!1,this.getNewItem(this.player.x-t.IMiniGame5Consts.LEFT_DISTANCE,this.player.y+this.player.height),IMiniGameMain.reqSocket(1,this.stageData.stageId),this.stageData&&1==this.stageData.stageId&&ClockManager.setTimeout(function(){IMiniGameMain.getGuideView().playEffct(i.player.x-t.IMiniGame5Consts.LEFT_DISTANCE+180,i.player.y),i.addChild(IMiniGameMain.getGuideView())},this,300)},e.prototype.initMap=function(){if(this.lineArr)for(var i=0;i<this.lineArr.length;i++)this.lineArr[i]&&(GObj.disposeObject(this.lineArr[i]),this.lineArr[i]=null);if(this.lineArr=[],this.controlLineArr)for(var i=0;i<this.controlLineArr.length;i++)this.controlLineArr[i]&&(GObj.disposeObject(this.controlLineArr[i]),this.controlLineArr[i]=null);if(this.controlLineArr=[],this.stageData&&this.stageData&&this.stageData.hegihtN&&this.stageData.widthN){for(var e=int(this.height/this.stageData.hegihtN),s=int(this.width/this.stageData.widthN),h={x:0,y:0,rotation:0,width:1},a=void 0,i=1;i<this.stageData.hegihtN;i++)for(var n=0;n<this.stageData.widthN;n++)h.y=i*e,h.x=n*s,h.rotation=0,h.width=s,a=GObj.create(t.IMiniGame5LineItem,h),this.lineGroup.addChild(a),this.lineArr.push(a);for(var i=1;i<this.stageData.widthN;i++)for(var n=0;n<this.stageData.hegihtN;n++)h.x=i*s,h.y=n*e,h.rotation=90,h.width=e,a=GObj.create(t.IMiniGame5LineItem,h),this.lineGroup.addChild(a),this.lineArr.push(a)}},e.prototype.removeEvent=function(){this.exitBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onCloseClick,this)},e.prototype.initPlayer=function(){var i=this;this.bossImg||(this.bossImg=GObj.create(t.ImageOutside),this.bossImg.loadCompleteCall(function(){i.bossImg.scaleY=176/i.bossImg.height},null),this.bossImg.setOutSrc("bing",FileConst.png),this.addChild(this.bossImg)),egret.Tween.removeTweens(this.bossImg);for(var e=0;e<this.enemyArr.length;e++)this.enemyArr[e]&&(GObj.disposeObject(this.enemyArr[e]),this.enemyArr[e]=null);this.enemyArr=[];for(var e=0;e<this.goodsArr.length;e++)this.goodsArr[e]&&(GObj.disposeObject(this.goodsArr[e]),this.goodsArr[e]=null);this.goodsArr=[];for(var s,h,a,n,o=this.height/this.stageData.hegihtN,r=this.width/this.stageData.widthN,l=this.stageData.stageitem,p=0;p<l.length;p++)switch(a=int((l[p].gridnumber-1)/this.stageData.widthN)+1,n=l[p].gridnumber%this.stageData.widthN,n=n?n:this.stageData.widthN,l[p].elementtype){case 1:this.player||(this.player=GObj.create(t.IMiniGame5Player)),this.player.data=l[p].resname,n=n?n:this.stageData.widthN,this.player.x=(n-1)*r+t.IMiniGame5Consts.LEFT_DISTANCE,this.player.y=a*o-this.player.height,this.player.hp=l[p].hp,this.player.showHp(this.player.hp);
var c=n*r-this.player.width/2-r/2,u=a*o-this.player.height;GObj.disposeObject(this.mapVo),this.mapVo={},this.mapVo[String(c)+String(u)]=1,this.player.standBy(),this.addChildAt(this.player,5);break;case 2:h=GObj.create(t.IMiniGame5Goods,l[p].resname),h.hp=l[p].hp,h.x=n*r-h.width/2-r/2,h.y=a*o-h.height,h.img.scaleX=l[p].scale?l[p].scale:1,h.img.scaleY=Math.abs(l[p].scale),h.showHp(l[p].hp),this.addChild(h),this.goodsArr.push(h);break;case 3:case 4:s=GObj.create(t.IMiniGame5Enemy,l[p].resname),s.hp=l[p].hp,s.x=n*r-s.width/2-r/2,s.y=a*o-s.height,s.type=l[p].elementtype,4==l[p].elementtype&&(this.bossImg.x=(n-1)*r,this.bossImg.y=(a-1)*o+16,this.bossImg.alpha=1,n==this.stageData.widthN?this.bossImg.scaleX=1:this.bossImg.scaleX=168/180,egret.Tween.get(this.bossImg,{loop:!0}).to({alpha:.3},300).to({alpha:1},300)),s.avatar.scaleX=l[p].scale?l[p].scale:1,s.avatar.scaleY=Math.abs(l[p].scale),s.showHp(l[p].hp),this.addChild(s),this.enemyArr.push(s);break;default:continue}},e.prototype.getNewItem=function(t,i,e){var s,h=this.height/this.stageData.hegihtN,a=this.width/this.stageData.widthN,n=[];s=90==e?[{x:t-a,y:i,r:90},{x:t-a,y:i,r:0},{x:t-a,y:i+h,r:0},{x:t,y:i,r:0},{x:t,y:i+h,r:0},{x:t+a,y:i,r:90}]:0==e?[{x:t,y:i-h,r:0},{x:t,y:i-h,r:90},{x:t+a,y:i-h,r:90},{x:t,y:i,r:90},{x:t+a,y:i,r:90},{x:t,y:i+h,r:0}]:[{x:t,y:i,r:0},{x:t,y:i-h,r:90},{x:t,y:i-h,r:0},{x:t+a,y:i-h,r:90}];for(var o in s)for(var r=0;r<this.lineArr.length;r++)if(this.lineArr[r]&&this.lineArr[r].x==s[o].x&&this.lineArr[r].y==s[o].y&&this.lineArr[r].rotation==s[o].r){n.push(this.lineArr[r]);break}for(var l=0;l<n.length;l++)-1==this.controlLineArr.indexOf(n[l])&&(n[l].colorImg.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onLine_1,this),this.controlLineArr.push(n[l]));for(var p=0;p<this.controlLineArr.length;p++)this.controlLineArr[p]&&(this.controlLineArr[p].alpha=1,egret.Tween.removeTweens(this.controlLineArr[p]),this.controlLineArr[p].addColor())},e.prototype.onLine_1=function(t){var i=this;if(IMiniGameMain.rmGuideView(),!this.isFight){this.isFight=!0;var e=t.target;e.parent&&(this.eraser.visible=!0,90==e.parent.rotation?(this.eraser.x=e.parent.x-this.eraser.width/2,this.eraser.y=e.parent.y,egret.Tween.get(this.eraser).to({y:this.eraser.y+192-this.eraser.height},500).call(function(){i.eraser.visible=!1,i.onLine_2(e.parent)})):0==e.parent.rotation&&(this.eraser.x=e.parent.x,this.eraser.y=e.parent.y-this.eraser.height/2,egret.Tween.get(this.eraser).to({x:this.eraser.x+180-this.eraser.width},500).call(function(){i.eraser.visible=!1,i.onLine_2(e.parent)})))}},e.prototype.onLine_2=function(t){t.visible=!1;var i=this.lineArr.indexOf(t);-1!=i&&(GObj.disposeObject(this.lineArr[i]),this.lineArr[i]=null);var e=this.controlLineArr.indexOf(t);-1!=e&&(GObj.disposeObject(this.controlLineArr[e]),this.controlLineArr[e]=null),this.playerHandler_new(t.x,t.y,t.rotation),this.getNewItem(t.x,t.y,t.rotation)},e.prototype.playerHandler_new=function(i,e,s){var h,a=this.height/this.stageData.hegihtN,n=this.width/this.stageData.widthN;if(0==s){var o=i+40,r=e+a-100,l=String(o)+String(r),p=i+40,c=e-100,u=String(p)+String(c);if(this.mapVo.hasOwnProperty(l)&&this.mapVo.hasOwnProperty(u)){var d=int(i/180),m=int(this.player.x/180);h="up";var g=d==m&&e-this.player.y<192&&e-this.player.y>0;if(!g)return void(this.isFight=!1)}else h=this.mapVo.hasOwnProperty(l)?"up":"down"}else{var o=i-140,r=e+a-100,f=String(o)+String(r);h=this.mapVo.hasOwnProperty(f)?"right":"left"}var b,y=-999,G=-999;switch(h){case"up":y=i+n/2-t.IMiniGame5Consts.WIDTH_MAN/2,G=e-t.IMiniGame5Consts.HEGIHT_MAN;break;case"down":y=i+n/2-t.IMiniGame5Consts.WIDTH_MAN/2,G=e-t.IMiniGame5Consts.HEGIHT_MAN+a;break;case"left":y=i-t.IMiniGame5Consts.WIDTH_MAN/2-n/2,G=e-t.IMiniGame5Consts.HEGIHT_MAN+a;break;case"right":y=i+n/2-t.IMiniGame5Consts.WIDTH_MAN/2,G=e-t.IMiniGame5Consts.HEGIHT_MAN+a}for(var v=0;v<this.enemyArr.length;v++)if(this.enemyArr[v]&&this.enemyArr[v].x==y&&this.enemyArr[v].y==G){b=this.enemyArr[v];break}for(var v=0;v<this.goodsArr.length;v++)if(this.goodsArr[v]&&this.goodsArr[v].x==y&&this.goodsArr[v].y==G){b=this.goodsArr[v];break}if(!b){if("down"==h||"up"==h){for(var c=void 0,I=(this.height-e)/192-1,v=0;I>v;v++)if(this.existMap(i,e+192*(v+1),s)){c=e+192*(v+1);break}c||(c=this.height),this.playerDown(c)}return void(this.isFight=!1)}var O=String(b.x)+String(b.y);this.mapVo[O]=1;var C=!0,M=int(b.x/180),k=int(this.player.x/180);if(("down"==h||"up"==h)&&(e+192==960||this.existMap(i,e+192,s)||(C=!1)),b instanceof t.IMiniGame5Enemy&&4==b.type&&IMiniGameMain.reqSocket(2),Math.abs(M-k)<=1&&Math.abs(b.y-this.player.y)<=192&&C){if(int(b.x/180)==int(this.player.x/180)&&90==s)this.normalFly(h,b,i,e,s);else if(int(b.y/192)==int(this.player.y/192)&&0==s)this.normalFly(h,b,i,e,s);else if("up"==h&&b.y>this.player.y)this.normalFly(h,b,i,e,s);else{if(!("down"==h&&b.y<this.player.y))return void this.normalJump(h,b,i,e,s);this.normalFly(h,b,i,e,s)}this.normalFly(h,b,i,e,s)}else this.normalFly(h,b,i,e,s)},e.prototype.normalJump=function(i,e,s,h,a){var n=this;if("up"==i)egret.Tween.get(e).to({y:this.player.y},192*t.IMiniGame5Consts.TIME_TWEEN).call(this.player.playerMove,this.player,[e,this.lineArr,this.fight,this]);else if("down"==i){var o=int(this.player.x/180)+1,r=int(e.x/180)+1;o==r?egret.Tween.get(this.player).to({y:this.player.y+192},192*t.IMiniGame5Consts.TIME_TWEEN).call(function(){n.player.playerMove(e,n.lineArr,n.fight,n)}):this.player.playerMove(e,this.lineArr,this.fight,this)}else"left"==i?this.player.playerMove(e,this.lineArr,this.fight,this):"right"==i&&this.player.playerMove(e,this.lineArr,this.fight,this)},e.prototype.normalFly=function(i,e,s,h,a){var n,o=this;if(this.player.x>e.x?(this.player.avatar.scaleX=-1,this.player.setHp(),n=180*int(e.x/180)+180-t.IMiniGame5Consts.RIGHT_DISTANCE):(this.player.avatar.scaleX=-1,this.player.setHp(),n=180*int(e.x/180)+t.IMiniGame5Consts.LEFT_DISTANCE),"up"==i){for(var r,l=(this.height-h)/192-1,p=0;l>p;p++)if(this.existMap(s,h+192*(p+1),a)){r=h+192*(p+1);break}r||(r=this.height);var c=int((r-h)/2)+e.y,u=int((r-h)/4)+e.y;egret.Tween.get(e).to({y:u},Math.abs(r-h)/100*t.IMiniGame5Consts.FLY_SPEED).call(function(){var i=(c/100*t.IMiniGame5Consts.FLY_SPEED+int(Math.sqrt((o.player.y-c)*(o.player.y-c)+(o.player.x-n)*(o.player.x-n))))/2;egret.Tween.get(e).to({y:c},i/100*t.IMiniGame5Consts.FLY_SPEED),o.player.show(o.player.x-n,o.player.y-c),egret.Tween.get(o.player).to({y:c,x:n},i/100*t.IMiniGame5Consts.FLY_SPEED).call(o.fight,o,[e,o.playerDown,o,r])})}else{this.player.show(this.player.x-n,this.player.y-e.y);var d=int(Math.sqrt((this.player.y-e.y)*(this.player.y-e.y)+(this.player.x-n)*(this.player.x-n)));egret.Tween.get(this.player).to({y:e.y,x:n},d/100*t.IMiniGame5Consts.FLY_SPEED).call(this.fight,this,[e])}},e.prototype.playerDown=function(i){var e=this;this.player.show(0,this.player.y-i);var s=Math.abs(i-this.player.y);egret.Tween.get(this.player).to({y:i-this.player.height},s/100*t.IMiniGame5Consts.FLY_SPEED).call(function(){e.player.hide()})},e.prototype.fight=function(i,e,s,h){if(this.player.hide(),i)if(i instanceof t.IMiniGame5Enemy)this.player.x<i.x?(this.player.avatar.scaleX=1,i.avatar.scaleX=-Math.abs(i.avatar.scaleX),this.player.setHp(1)):(this.player.avatar.scaleX=-1,this.player.setHp(-1),i.avatar.scaleX=Math.abs(i.avatar.scaleX)),i.attack(),IMiniGameMain.playEff(this.configData.minigame5_attack),this.player.attack(),ClockManager.setTimeout(this.stopFight,this,t.IMiniGame5Consts.ACT_TIME,i,e,s,h);else if(i instanceof t.IMiniGame5Goods){this.player.hp=this.player.hp+i.hp,this.upgradeing(),IMiniGameMain.playEff(this.configData.minigame5_baowu);var a=this.goodsArr.indexOf(i);-1!=a&&(GObj.disposeObject(this.goodsArr[a]),this.goodsArr[a]=null),e&&s&&e.call(s,h),this.player.showHp(this.player.hp),this.player.standBy(),this.isFight=!1}},e.prototype.stopFight=function(i,e,s,h){var a=this;if(i&&this.player){if(this.player.hp>i.hp){this.player.hp=this.player.hp+i.hp,this.player.showHp(this.player.hp),this.player.standBy(),e&&s&&e.call(s,h),4==i.type&&(IMiniGameMain.reqSocket(3),i.avatar.setFun(function(){t.IMiniGameResult.showResult(IMiniGameResultType.type_1,a.onCloseClick,a)},this),IMiniGameMain.playEff(this.configData.minigame5_win));var n;n=this.player.x>i.x?-20:20,egret.Tween.get(i).to({x:i.x+n},100).call(function(){0>n?a.attacked(i.x+n+i.width,i.y+i.height/3*2):a.attacked(i.x+n,i.y+i.height/3*2),i.die()})}else this.player.avatar.setFun(function(){i.parent&&i.parent.removeChild(i),a.player.parent&&a.player.parent.removeChild(a.player),t.IMiniGameResult.showResult(IMiniGameResultType.type_0,a.updateView,a)},this),this.player.die(),IMiniGameMain.playEff(this.configData.minigame5_die);ClockManager.setTimeout(function(){if(a.enemyArr){a.isFight=!1;var t=a.enemyArr.indexOf(i);-1!=t&&(GObj.disposeObject(a.enemyArr[t]),a.enemyArr[t]=null)}},this,t.IMiniGame5Consts.ACT_TIME)}},e.prototype.clearTween=function(){egret.Tween.removeTweens(this.bossImg),egret.Tween.removeTweens(this.player);for(var t=0;t<this.enemyArr.length;t++)this.enemyArr[t]&&egret.Tween.removeTweens(this.enemyArr[t]);for(var t=0;t<this.goodsArr.length;t++)this.goodsArr[t]&&egret.Tween.removeTweens(this.goodsArr[t])},e.prototype.upgradeing=function(){this.upGradeEff||(this.upGradeEff=GObj.create(t.IMovie),this.addChild(this.upGradeEff)),this.upGradeEff.x=this.player.x+this.player.avatar.x,this.upGradeEff.y=this.player.y+this.player.avatar.y,this.upGradeEff.start(t.IMiniGame5Consts.ZHANLINGUP_UI,1),this.upGradeEff.autoRun()},e.prototype.attacked=function(i,e){this.attackEff||(this.attackEff=GObj.create(t.IMovie),this.attackEff.scaleX=this.attackEff.scaleY=.5,this.addChild(this.attackEff)),this.attackEff.x=i,this.attackEff.y=e,this.attackEff.start(t.IMiniGame5Consts.SHOUJI,1),this.attackEff.autoRun()},e.prototype.onCloseClick=function(){this.parent&&(this.clearTween(),this.player.hide(),i.prototype.onCloseClick.call(this))},e.prototype.existMap=function(t,i,e){for(var s=!1,h=0;h<this.lineArr.length;h++)if(this.lineArr[h]&&this.lineArr[h].rotation==e&&this.lineArr[h].x==t&&this.lineArr[h].y==i)return s=!0;return s},e.prototype.dispose=function(){if(!this.isDestory){if(this.isDestory=!0,this.clearTween(),this.removeEvent(),GObj.disposeObject(this.mapVo),this.mapVo=null,GObj.disposeObject(this.stageData),this.stageData=null,GObj.disposeObject(this.gameBg),this.gameBg=null,GObj.disposeObject(this.lineGroup),this.lineGroup=null,this.lineArr)for(var t=0;t<this.lineArr.length;t++)GObj.disposeObject(this.lineArr[t]),this.lineArr[t]=null;if(GObj.disposeObject(this.lineArr),this.lineArr=null,this.controlLineArr)for(var t=0;t<this.controlLineArr.length;t++)GObj.disposeObject(this.controlLineArr[t]),this.controlLineArr[t]=null;if(GObj.disposeObject(this.controlLineArr),this.controlLineArr=null,this.goodsArr)for(var t=0;t<this.goodsArr.length;t++)GObj.disposeObject(this.goodsArr[t]),this.goodsArr[t]=null;if(GObj.disposeObject(this.goodsArr),this.goodsArr=null,this.enemyArr)for(var t=0;t<this.enemyArr.length;t++)GObj.disposeObject(this.enemyArr[t]),this.enemyArr[t]=null;GObj.disposeObject(this.upGradeEff),this.upGradeEff=null,GObj.disposeObject(this.attackEff),this.attackEff=null,GObj.disposeObject(this.enemyArr),this.enemyArr=null,GObj.disposeObject(this.player),this.player=null,GObj.disposeObject(this.isFight),this.isFight=null,GObj.disposeObject(this.bossImg),this.bossImg=null,GObj.disposeObject(this.exitBtn),this.exitBtn=null,GObj.disposeObject(this.eraser),this.eraser=null,i.prototype.dispose.call(this)}},e}(t.IBaseView);t.IMiniGame5View=i,__reflect(i.prototype,"miniGame.IMiniGame5View")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(t){return i.call(this,t)||this}return __extends(e,i),e.prototype.getGameView=function(){return this.gameView||(this.gameView=GObj.create(t.IMiniGame6View)),this.gameView.setData(this.getCurGameData()),this.gameView},e.prototype.loadConfigComplete=function(e){if(e)for(var s in e.config)t.IMiniGame6Consts[s]=e.config[s];i.prototype.loadConfigComplete.call(this,e)},e.prototype.getCurGameData=function(e,s){var h=i.prototype.getCurGameData.call(this);return h||(h=t.testData6),h},e.setDefaultData=function(t){for(var i in t.monsters)e.setDefaultMonster(t.monsters[i])},e.setDefaultMonster=function(i){var e=t.IMiniGame6Consts.monsters[i.idx]||{};for(var s in e)void 0==i[s]&&(i[s]=e[s])},e}(t.IMiniGameBaseCtr);t.IMiniGame6=i,__reflect(i.prototype,"miniGame.IMiniGame6")}(miniGame||(miniGame={}));var miniGame;!function(t){t.testData6={stageId:1,show:1,passes:[]},t.IMiniGame6Consts={maxWeapon:30,speed:8,rotation:2,shapeFrame:10,getFrame:5,dropSpeed:15,descTime:300,addRadius:1,dropWeaponModel:[1,5],scaleScene:.01,ui_time_bg:"time_bg",ui_desc:["desc_1","desc_2"],ui_desc3:"desc_3",ui_shield_1:"shield_1",ui_shield_2:"shield_2",up_effect:"zhanliup_ui",hit_effect:"ui_pz",die_effect:"ui_siwang",minigame_bgm:"bgm_login",minigame_win:"rolling_1",minigame_lose:"minigame_lose",minigame_up:"game3_minigame_gain",minigame_die:"minigame1_die",minigame_hit:"minigame6_hit",monsters:{0:{model:"monster_qiangyinglishi",hp:1,scaleXY:.5,speed:1.5,hitTimes:1,skillIdx:0}},map:[2304,1536,9,6,1,1],patrols:[0,0,2304,1536]}}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return __extends(i,t),i}(t.IMovie);t.IMiniGame6Hit=i,__reflect(i.prototype,"miniGame.IMiniGame6Hit")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.isMonster=!0,t}return __extends(e,i),e.prototype.setData=function(e){i.prototype.setData.call(this,e),this.patrolFrame=this.data.timeGap,this.targetFrame=this.data.timeGap;var s=this.data.patrols;s&&0!=s.length||(s=t.IMiniGame6Consts.patrols),this.x=null!=e.posX?e.posX:s[0]+this.hitRadius,this.y=null!=e.posY?e.posY:s[1]+this.hitRadius},e.prototype.reSet=function(){i.prototype.reSet.call(this),this.targetObj=null,this.pointer&&this.pointer.parent&&this.pointer.parent.removeChild(this.pointer)},e.prototype.patrolPath=function(){if(!this._isMove&&!(this.targetObj||--this.patrolFrame>0)){this.setMove(!0),this.patrolFrame=this.data.timeGap;var i=this.data.patrols;i&&0!=i.length||(i=t.IMiniGame6Consts.patrols);var e=this.hitRadius||10,s=GMath.randomInt(i[0]+e,i[2]+e),h=GMath.randomInt(i[1]-e,i[3]-e),a=GMath.angle(this.x,this.y,s,h);this.setAngle(a);var n=GMath.distance(this.x,this.y,s,h);this.targetFrame=Math.ceil(n/(this.speed||1))}},e.prototype.lockTarget=function(){if(this.targetObj){this.setMove(!0);var t=GMath.angle(this.x,this.y,this.targetObj.x,this.targetObj.y);this.setAngle(t),this.targetFrame=1/0}},e.prototype.checkMove=function(){this._isMove&&--this.targetFrame<=0&&this.setMove(!1)},e.prototype.move=function(){if(this._isMove){var t=this.x+(this.speedx||0),e=this.y+(this.speedy||0);(t<this.sx||t>this.ex||e<this.sy||e>this.ey)&&(this.targetFrame=0),i.prototype.move.call(this)}},e.prototype.checkTargetHit=function(t){var i=this.targetDis(t),e=this.checkHit(t,i);if(e){var s=GMath.angle(this.x,this.y,t.x,t.y);return this.targetObj||(this.setAngle(s+180),this.hitMove()),t.targetObj||(t.setAngle(s),t.hitMove()),!0}return!1},e.prototype.showHidePointer=function(i){return this.pointer||(this.pointer=GObj.create(t.IMiniGame6Pointer)),this.pointer.visible=i,this.pointer},e.prototype.setPointer=function(t,i,e){this.pointer&&(this.pointer.setPointer(t,i,e),this.pointer.setWeaponNum(this.weaponNum()))},e.prototype.checkGo=function(i){if(i.isDef())return this.targetObj&&(this.targetFrame=this.data.timeGap),i.lockObj=null,void(this.targetObj=null);if(!i.lockObj){this.targetObj=null;var e=t.IMiniGame6Consts.patrols;this.data&&this.data.patrols&&this.data.patrols.length&&(e=this.data.patrols),i.x>e[0]&&i.x<e[2]&&i.y>e[1]&&i.y<e[3]&&(i.lockObj=this,this.targetObj=i)}},e.prototype.run=function(){this.isRun&&(i.prototype.run.call(this),this.patrolPath(),this.lockTarget(),this.checkMove())},e.prototype.dispose=function(){i.prototype.dispose.call(this),GObj.disposeObject(this.pointer),this.pointer=null,this.targetObj=null},e}(t.IMiniGame6Avatar);t.IMiniGame6Monster=i,__reflect(i.prototype,"miniGame.IMiniGame6Monster")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var e=i.call(this)||this;return e.touchEnabled=!1,e.touchChildren=!1,e.pointerLab=GObj.create(eui.Label),e.pointerLab.size=30,e.pointerLab.textAlign=egret.HorizontalAlign.CENTER,e.pointerLab.verticalAlign=egret.VerticalAlign.MIDDLE,e.pointer=GObj.create(t.ImageOutside),e.pointer.loadCompleteCall(function(){var t=Math.min(e.pointer.iconWidth,e.pointer.iconHeight);e.pointer.anchorOffsetX=t/2,e.pointer.anchorOffsetY=t/2,e.width=t,e.height=t,e.anchorOffsetX=t/2,e.anchorOffsetY=t/2,e.pointer.x=t/2,e.pointer.y=t/2,e.pointerLab.width=t,e.pointerLab.height=t},e),e.pointer.setOutSrc("pointer"),e.addChild(e.pointer),e.addChild(e.pointerLab),e}return __extends(e,i),e.prototype.setPointer=function(t,i,e){this.pointer&&(this.x=t,this.y=i,this.pointer.rotation=e||0)},e.prototype.setWeaponNum=function(t){this.pointerLab.text=t+""},e.prototype.dispose=function(){GObj.disposeObject(this.pointerLab),this.pointerLab=null,GObj.disposeObject(this.pointer),this.pointer=null},e}(egret.DisplayObjectContainer);t.IMiniGame6Pointer=i,__reflect(i.prototype,"miniGame.IMiniGame6Pointer")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.once(egret.Event.ADDED_TO_STAGE,t.initSkin,t),t}return __extends(e,i),e.prototype.initSkin=function(){var i=this;this.isInit||(this.isInit=!0,this.angle=90,this.rateVal=10,this.bg=GObj.create(t.ImageOutside),this.bg.touchEnabled=!1,this.bg.loadCompleteCall(function(){i.width=i.bg.iconWidth,i.height=i.bg.iconHeight,i.startX=i.width/2,i.startY=i.height/2,i.setArrowPoint()},this),this.bg.setOutSrc("rocker"),this.addChild(this.bg),this.rockerRect=GObj.create(eui.Rect),this.rockerRect.fillAlpha=.001,this.rocker=GObj.create(t.ImageOutside),this.rocker.touchEnabled=!1,this.rocker.loadCompleteCall(function(){i.rockerRect.width=3*i.rocker.iconWidth,i.rockerRect.height=3*i.rocker.iconHeight,i.rockerRect.anchorOffsetX=i.rockerRect.width/2,i.rockerRect.anchorOffsetY=i.rockerRect.height/2,i.rocker.anchorOffsetX=i.rocker.iconWidth/2,i.rocker.anchorOffsetY=i.rocker.iconHeight/2},this),this.rocker.setOutSrc("rockerPoint"),this.addChild(this.rocker),this.addChild(this.rockerRect),this.arrow=GObj.create(t.ImageOutside),this.arrow.touchEnabled=!1,this.arrow.loadCompleteCall(this.setArrowPoint,this),this.arrow.setOutSrc("rocketArrow"),this.addChild(this.arrow),this.addEvent())},e.prototype.setArrowPoint=function(){this.arrow&&this.bg&&this.arrow.iconWidth&&this.bg.iconWidth&&(this.arrow.anchorOffsetX=this.arrow.iconWidth/2,this.arrow.anchorOffsetY=this.bg.iconHeight/2+this.arrow.iconHeight/2+10,this.arrow.x=this.startX,this.arrow.y=this.startY,this.arrow.rotation=180,this.onEndClick(),this.callBack&&this.callBack.call(this.parentObj))},e.prototype.addEvent=function(){this.rockerRect.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBeginClick,this)},e.prototype.removeEvent=function(){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.initSkin,this),this.rockerRect.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBeginClick,this),this.rockerRect.removeEventListener(egret.TouchEvent.TOUCH_END,this.onEndClick,this),this.parentObj&&(this.parentObj.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onMoveClick,this),this.parentObj.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMoveClick,this))},e.prototype.onBeginClick=function(){this.isMove||(this.parentObj||(this.parentObj=this.parent),this.isMove=!0,this.rockerRect.addEventListener(egret.TouchEvent.TOUCH_END,this.onEndClick,this),this.parentObj.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onEndClick,this),this.parentObj.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMoveClick,this),this.tempPoint||(this.tempPoint=GObj.create(egret.Point)))},e.prototype.onMoveClick=function(t){this.globalToLocal(t.stageX,t.stageY,this.tempPoint);var i=GMath.distance(this.tempPoint.x,this.tempPoint.y,this.startX,this.startY);if(!(i<this.rateVal)){this.rockerRect.x=this.tempPoint.x,this.rockerRect.y=this.tempPoint.y;var e=this.width/2;if(i=GMath.distance(this.tempPoint.x,this.tempPoint.y,e,this.height/2),i>e){var s=GMath.towardSource(this.width/2,this.height/2,this.tempPoint.x,this.tempPoint.y,e);this.tempPoint.x=s.x,this.tempPoint.y=s.y,this.startX=this.width/2,this.startY=this.height/2}this.rocker.x=this.tempPoint.x,this.rocker.y=this.tempPoint.y,this.getRocker(),this.startX=this.rocker.x,this.startY=this.rocker.y}},e.prototype.onEndClick=function(){this.parentObj&&(this.rockerRect.removeEventListener(egret.TouchEvent.TOUCH_END,this.onEndClick,this),this.parentObj.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onEndClick,this),this.parentObj.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMoveClick,this)),this.isMove=!1,this.startX=this.width/2,this.startY=this.height/2,this.rockerRect.x=this.startX,this.rockerRect.y=this.startY,this.rocker.x=this.startX,this.rocker.y=this.startY},e.prototype.getRocker=function(){var t=this.startX,i=this.startY,e=this.rocker.x,s=this.rocker.y,h=GMath.angle(t,i,e,s);this.arrow.rotation=h+90,this.angle=h},e.prototype.setCallBack=function(t,i){this.callBack=i,this.parentObj=t},e.prototype.dispose=function(){this.removeEvent(),GObj.disposeObject(this.bg),this.bg=null,GObj.disposeObject(this.rocker),this.rocker=null,GObj.disposeObject(this.rockerRect),this.rockerRect=null,GObj.disposeObject(this.arrow),this.arrow=null,this.callBack=null,this.parentObj=null},e}(eui.Group);t.IMiniGame6Rocker=i,__reflect(i.prototype,"miniGame.IMiniGame6Rocker")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){return i.call(this)||this}return __extends(e,i),e.prototype.initSkins=function(){var e=this;this.isInit||(i.prototype.initSkins.call(this),this.monstersPool=[],this.monstersIn=[],this.weaponsPool=[],this.weaponsIn=[],this.hitEffPool=[],this.hitEffIn=[],this.hitBodyObj={},this.dieEffPool=[],this.dieEffIn=[],this.natureInfo.visible=!1,this.weaponGrp=GObj.create(egret.DisplayObjectContainer),this.weaponGrp.touchEnabled=!1,this.weaponGrp.touchChildren=!1,this.mapGrp.addChild(this.weaponGrp),this.avatarGrp=GObj.create(egret.DisplayObjectContainer),this.avatarGrp.touchEnabled=!1,this.avatarGrp.touchChildren=!1,this.mapGrp.addChild(this.avatarGrp),this.effGrp=GObj.create(egret.DisplayObjectContainer),this.effGrp.touchEnabled=!1,this.effGrp.touchChildren=!1,this.mapGrp.addChild(this.effGrp),this.uiGrp=GObj.create(eui.Group),this.uiGrp.touchEnabled=!1,this.uiGrp.touchChildren=!1,this.uiGrp.width=this.width,this.uiGrp.height=this.height,this.addChild(this.uiGrp),this.player=GObj.create(t.IMiniGame6Avatar),this.cameraFollow=this.player,this.rocker=GObj.create(t.IMiniGame6Rocker),this.rocker.setCallBack(this,function(){e.rocker.x=(e.width-e.rocker.width)/2,e.rocker.y=e.height-e.rocker.height-80}),this.addChild(this.rocker),this.timeBgImg=GObj.create(t.ImageOutside),this.timeBgImg.horizontalCenter=0,this.timeBgImg.top=94,this.timeBgImg.setOutSrc(t.IMiniGame6Consts.ui_time_bg),this.uiGrp.addChild(this.timeBgImg),this.timeMap=GObj.create(t.IBitNumMap),this.timeMap.horizontalCenter=0,this.timeMap.top=100,this.timeMap.setGap(4),this.timeMap.setPath("num8"),this.uiGrp.addChild(this.timeMap),this.descImg=GObj.create(t.ImageOutside),this.descImg.horizontalCenter=0,this.descImg.top=200+IMiniGameMain.safeHeight,this.uiGrp.addChild(this.descImg),this.showEff=GObj.create(t.IMovie),this.showEff.setCompleteBack(this.gameUp,this))},e.prototype.reSet=function(){i.prototype.reSet.call(this),this.stop(),this.scaleFrame=.005,this.fightFrame=10,this.isOver=!1,this.descindex=0,this.hitBodyObj={},this.allBackPool(),this.showEff&&this.showEff.parent&&this.showEff.parent.removeChild(this.showEff)},e.prototype.removeFromStage=function(){this.reSet()},e.prototype.setData=function(t){this.initSkins(),this.reSet(),this.curIdx=0,this.data=t,this.updateView()},e.prototype.updateView=function(){this.curData=this.data.passes[this.curIdx],this.time=this.curData.time+1,t.IMiniGame6.setDefaultData(this.curData),this.loadMapImg(this.curData.mapId,this.curData.map||t.IMiniGame6Consts.map),this.initMonsters(),this.initPlayer(),this.dropWeapons(),!this.curIdx&&IMiniGameMain.reqSocket(1,this.data.stageId),this.setCamera(),this.start(),this.timeRun(),this.rocker.visible=!0},e.prototype.initPlayer=function(){var t=this.curData.player;this.player.setData(t),this.avatarAddWeapon(this.player,t.weaponNum),this.player.x=null!=t.posX?t.posX:this.mapGrp.width/2,this.player.y=null!=t.posY?t.posY:this.mapGrp.height/2,this.setMoveArea(this.player),this.player.initOver(),this.avatarGrp.addChild(this.player)},e.prototype.initMonsters=function(){for(var t,i=this.curData.monsters,e=0,s=i;e<s.length;e++){var h=s[e];t=this.getMonsterFromPool(),t.setData(h),this.avatarAddWeapon(t,h.weaponNum),this.setMoveArea(t),t.initOver(),this.monstersIn.push(t),this.avatarGrp.addChild(t)}},e.prototype.run=function(){this.isRunning&&(this.playerRun(),this.monsterRun(),this.wenponsRun(),this.checkAvatarHit(),this.timeRun(),this.uiRun(),this.hitEffRun(),this.dieEffRun())},e.prototype.playerRun=function(){if(this.player&&!this.player.isDie()){this.player.setMove(this.rocker.isMove),this.player.setAngle(this.rocker.angle),this.player.run();var i=this.player.weaponNum(),e=Math.max(this.minScale,1-i*t.IMiniGame6Consts.scaleScene||0);this.rocker.isMove?(this.setScale(e),this.setCamera()):this.setScale(e+.2)}},e.prototype.monsterRun=function(){if(0!=this.monstersIn.length){for(var i,e=0;e<this.monstersIn.length&&(i=this.monstersIn[e],i);e++)i.isDie()?(IMiniGameMain.playEff(t.IMiniGame6Consts.minigame_die),IMiniGameMain.reqSocket(2),this.monstersIn.splice(e,1),this.createDieEff(i),this.monsterBackPool(i),this.player.checkLockObj(i),e--):(i.run(),this.setPointer(i),this.showOrHide(i));0==this.monstersIn.length&&(this.isOver=!0,this.rocker.visible=!1,this.showEff.x=this.player.width/2,this.showEff.y=this.player.height/2,this.showEff.start(t.IMiniGame6Consts.up_effect,1),this.player.addChild(this.showEff),this.showEff.autoRun(),IMiniGameMain.playEff(t.IMiniGame6Consts.minigame_up))}},e.prototype.setPointer=function(t){var i,e;t.x+t.hitRadius<this.cameraX?i=this.cameraX:t.x-t.hitRadius>this.cameraX+this.width&&(i=this.cameraX+this.width),t.y+t.hitRadius<this.cameraY?e=this.cameraY:t.y-t.hitRadius>this.cameraY+this.height&&(e=this.cameraY+this.height);var s=void 0!=i||void 0!=e,h=t.showHidePointer(s);if(s){this.uiGrp.addChild(h);var a=this.player;if(void 0!=i&&void 0!=e){var n=Math.abs((t.y-a.y)/(t.x-a.x)),o=Math.abs((this.cameraY-a.y)/(this.cameraX-a.x));o>n?e=void 0:i=void 0}void 0!=i?(i+=(i>a.x?-1.1:1.1)*(h.anchorOffsetX||10),e=a.y+(i-a.x)*(t.y-a.y)/(t.x-a.x)):null!=e&&(e+=(e>a.y?-1.1:1.1)*(h.anchorOffsetY||10),i=a.x+(e-a.y)*(t.x-a.x)/(t.y-a.y)),i=Math.floor(i-this.cameraX),e=Math.floor(e-this.cameraY);var r=GMath.angle(a.x,a.y,t.x,t.y);t.setPointer(i,e,r)}},e.prototype.timeRun=function(){if(this.checkNature()&&!this.isOver){var t=--this.time;if(0>t)return void this.gameOver(!0);var i=int(t/60),e=t%60;this.timeMap.setString(IMiniGameMain.getString(IMiniGameLanguage.c_24,this.timeS(i),this.timeS(e)))}},e.prototype.timeS=function(t){return t>=10?toChars(t):"0"+t},e.prototype.uiRun=function(){var i=this,e=t.IMiniGame6Consts.ui_desc[this.descindex];if(e&&!this.descTime&&(this.descImg.loadCompleteCall(function(){var t=i.width/i.descImg.iconWidth;t=Math.min(t,1),i.descImg.scaleX=t,i.descImg.scaleY=t},this),this.descImg.setOutSrc(e),this.descTime=t.IMiniGame6Consts.descTime),this.descTime--,this.descTime>0){var s=Math.min(this.descTime/60,1);this.descImg.alpha=s}else this.descImg.alpha=0,this.descindex++},e.prototype.getMonsterFromPool=function(){var i=this.monstersPool.pop();return i||(i=GObj.create(t.IMiniGame6Monster)),i},e.prototype.monsterBackPool=function(t){t&&(t.parent&&t.parent.removeChild(t),-1==this.monstersPool.indexOf(t)&&(t.reSet(),this.monstersPool.push(t)))},e.prototype.avatarBackWeapon=function(t){if(t)for(var i=t.getWeapon();i.length>0;)this.weaponBackPool(i.pop())},e.prototype.avatarAddWeapon=function(t,i){for(var e=0;i>e;e++)t.addWeapon(this.getWeapon());t.setRadius()},e.prototype.dropWeapons=function(){var i=this.curData.dorpWeapons,e=this.curData.dropWeaponModel||t.IMiniGame6Consts.dropWeaponModel;if(i>0)for(var s,h,a=0;i>a;a++)s=this.getWeapon(),h=GMath.randomInt(e[0],e[1]),s.setData("weapon_"+h),this.setDropWeapon(s),this.weaponsIn.push(s),this.weaponGrp.addChild(s)},e.prototype.getWeapon=function(){var i=this.weaponsPool.pop();return i||(i=GObj.create(t.IMiniGame6Weapon)),i},e.prototype.wenponsRun=function(){for(var t,i=0;i<this.weaponsIn.length;i++)t=this.weaponsIn[i],t&&(this.playerGetWeapon(t),t.owner?(this.weaponsIn.splice(i,1),i--):(t.run(),this.showOrHide(t)))},e.prototype.playerGetWeapon=function(t){if(!this.checkGetWeapon(this.player,t))for(var i=0,e=this.monstersIn;i<e.length;i++){var s=e[i];if(this.checkGetWeapon(s,t))return}},e.prototype.checkGetWeapon=function(t,i){if(t.canGetWeapon()){var e=GMath.distance(t.x,t.y,i.x,i.y);if(e<=1.2*t.hitRadius&&!i.isOff){var s=GMath.angle(t.x,t.y,i.x,i.y);return t.addWeapon(i,e,s),t.setRadius(),!0}}return!1},e.prototype.weaponBackPool=function(t){t&&(t.parent&&t.parent.removeChild(t),-1==this.weaponsPool.indexOf(t)&&(t.reSet(),this.weaponsPool.push(t)))},e.prototype.checkAvatarHit=function(){if(!this.player.isDie()){var t,i,e,s=this.monstersIn,h=this.player,a=s.length;for(t=0;a>t;t++)for(e=s[t],h.checkTargetHit(e)&&(this.createHitEff(h,e),this.fightHandle(e)),e.checkGo(h),i=t+1;a>i;i++)e.checkTargetHit(s[i])&&this.createHitEff(e,s[i])}},e.prototype.fightHandle=function(i){if(!(--this.fightFrame>0)){this.fightFrame=3;var e=this.player;if(!(e.isDie()||e.isDef()||i.isDef())){for(var s=GMath.randomInt(1,1),h=i.weaponNum()<e.weaponNum(),a=h?i.dorpWeapon(s):e.dorpWeapon(s),n=0,o=a;n<o.length;n++){var r=o[n];-1==this.weaponsIn.indexOf(r)&&this.weaponsIn.push(r),r.setOffSet(),this.setWeaponPoint(r),this.weaponGrp.addChild(r)}i.weaponNum()>0?i.setRadius():i.setDie(),e.weaponNum()>0?e.setRadius():(IMiniGameMain.playEff(t.IMiniGame6Consts.minigame_die),this.createDieEff(this.player),this.player.setDie(),this.player.parent&&this.player.parent.removeChild(this.player))}}},e.prototype.setWeaponPoint=function(t){var i=t.owner;if(i){var e=1.2*i.hitRadius,s=GMath.randomInt(e,3*e),h=GMath.randomInt(0,360);t.x=i.x+e*GMath.cos(h),t.y=i.y+e*GMath.sin(h),t.owner=null,t.setOffData(s-e,h)}},e.prototype.setDropWeapon=function(t){var i=this.player,e=1.5*i.hitRadius,s=this.curData,h=s.dorpWeaponDis||Math.max(this.width,this.height)/2,a=GMath.randomInt(e,h),n=GMath.randomInt(0,360);t.x=i.x+e*GMath.cos(n),t.y=i.y+e*GMath.sin(n),t.owner=null,t.setOffData(a-e,n)},e.prototype.hitEffRun=function(){for(var t,i=0;i<this.hitEffIn.length;i++)t=this.hitEffIn[i],t.isOver?(this.hitEffIn.splice(i,1),i--,this.backHitEff(t)):t.run()},e.prototype.createHitEff=function(i,e){var s=i.hashCode+"_"+e.hashCode;if(!this.hitBodyObj[s]){this.hitBodyObj[s]=!0;var h=this.getHitEff();h.key=s,h.x=(i.x+e.x)/2,h.y=(i.y+e.y)/2,h.start(t.IMiniGame6Consts.hit_effect,1),this.hitEffIn.push(h),this.effGrp.addChild(h),IMiniGameMain.playEff(t.IMiniGame6Consts.minigame_hit)}},e.prototype.getHitEff=function(){var i=this.hitEffPool.pop();return i||(i=GObj.create(t.IMiniGame6Hit)),i},e.prototype.backHitEff=function(t){t&&(t.parent&&t.parent.removeChild(t),delete this.hitBodyObj[t.key],-1==this.hitEffPool.indexOf(t)&&this.hitEffPool.push(t))},e.prototype.dieEffRun=function(){for(var t,i=0;i<this.dieEffIn.length;i++)t=this.dieEffIn[i],t.isOver?(this.dieEffIn.splice(i,1),this.backDieEff(t),i--):t.run();0==this.dieEffIn.length&&this.player.isDie()&&this.gameOver(!0)},e.prototype.createDieEff=function(i){var e=this.getDieEff();e.start(t.IMiniGame6Consts.die_effect,1),e.x=i.x,e.y=i.y,this.dieEffIn.push(e),this.effGrp.addChild(e)
},e.prototype.getDieEff=function(){var i=this.dieEffPool.pop();return i||(i=GObj.create(t.IMovie)),i},e.prototype.backDieEff=function(t){t&&(t.parent&&t.parent.removeChild(t),-1==this.dieEffPool.indexOf(t)&&this.dieEffPool.push(t))},e.prototype.gameOver=function(t){this.isRunning&&(this.stop(),t?this.setResult(IMiniGameResultType.type_0):this.checkNextStage())},e.prototype.checkNextStage=function(){var t=this.data.passes[this.curIdx+1],i=IMiniGameResultType.type_1;t?(this.curIdx++,i=IMiniGameResultType.type_5):IMiniGameMain.reqSocket(3),this.setResult(i,t&&t.passId)},e.prototype.setResult=function(i,e){i?IMiniGameMain.playEff(t.IMiniGame6Consts.minigame_win):IMiniGameMain.playEff(t.IMiniGame6Consts.minigame_lose),t.IMiniGameResult.showResult(i,this.resultCallBack,this,3,e)},e.prototype.resultCallBack=function(t){switch(t){case IMiniGameResultType.type_0:this.reSet(),this.updateView();break;case IMiniGameResultType.type_1:var i=this.parent;i&&i.outCloseClick();break;case IMiniGameResultType.type_5:this.updateView()}},e.prototype.gameUp=function(){var t=this,i=this.curData.player_up;if(i){this.player.setData(i);var e=this.player.weaponNum();this.avatarBackWeapon(this.player),this.avatarAddWeapon(this.player,e),this.player.initOver()}this.player.isOver=!0,ClockManager.setTimeout(function(){t.gameOver(!1)},this,2e3)},e.prototype.clean=function(){this.allBackPool(),this.clearOne(this.monstersPool),this.clearOne(this.monstersIn),this.clearOne(this.weaponsPool),this.clearOne(this.weaponsIn),this.clearOne(this.hitEffPool),this.clearOne(this.hitEffIn),this.clearOne(this.dieEffPool),this.clearOne(this.dieEffIn),this.monstersPool=null,this.monstersIn=null,this.weaponsPool=null,this.weaponsIn=null,this.hitEffPool=null,this.hitEffIn=null,this.hitBodyObj=null},e.prototype.clearOne=function(t){if(t)for(var i=t.length,e=0;i>e;e++)GObj.disposeObject(t[e])},e.prototype.allBackPool=function(){var t;if(this.monstersIn){for(var i=0,e=this.monstersIn;i<e.length;i++)t=e[i],this.monsterBackPool(t);this.monstersIn=[]}if(this.monstersPool)for(var s=0,h=this.monstersPool;s<h.length;s++)t=h[s],this.avatarBackWeapon(t);if(this.weaponsIn){for(var a=0,n=this.weaponsIn;a<n.length;a++)t=n[a],this.weaponBackPool(t);this.weaponsIn=[]}if(this.avatarBackWeapon(this.player),this.hitEffIn){for(var o=0,r=this.hitEffIn;o<r.length;o++)t=r[o],this.backHitEff(t);this.hitEffIn=[]}if(this.dieEffIn){for(var l=0,p=this.dieEffIn;l<p.length;l++)t=p[l],this.backHitEff(t);this.dieEffIn=[]}},e.prototype.dispose=function(){this.isDestory||(this.removeEvent(),this.clean(),GObj.disposeObject(this.weaponGrp),this.weaponGrp=null,GObj.disposeObject(this.avatarGrp),this.avatarGrp=null,GObj.disposeObject(this.effGrp),this.effGrp=null,GObj.disposeObject(this.timeMap),this.timeMap=null,GObj.disposeObject(this.timeBgImg),this.timeBgImg=null,GObj.disposeObject(this.descImg),this.descImg=null,GObj.disposeObject(this.player),this.player=null,GObj.disposeObject(this.rocker),this.rocker=null,GObj.disposeObject(this.showEff),this.showEff=null,this.data=null,this.curData=null,this.curIdx=null,this.fightFrame=null,i.prototype.dispose.call(this))},e}(t.IMiniGameSecne);t.IMiniGame6Secne=i,__reflect(i.prototype,"miniGame.IMiniGame6Secne")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.initSkins(),t}return __extends(e,i),e.prototype.initSkins=function(){this.width=0,this.height=0,this.touchEnabled=!1,this.touchChildren=!1,this.shield1=GObj.create(t.ImageOutside),this.shield1.horizontalCenter=0,this.shield1.verticalCenter=0,this.shield1.setOutSrc(t.IMiniGame6Consts.ui_shield_1),this.addChild(this.shield1),this.shield2=GObj.create(t.ImageOutside),this.shield2.horizontalCenter=0,this.shield2.verticalCenter=0,this.shield2.setOutSrc(t.IMiniGame6Consts.ui_shield_2),this.shield2.scaleX,this.addChild(this.shield2),this.descImg=GObj.create(t.ImageOutside),this.descImg.horizontalCenter=0,this.descImg.verticalCenter=-50,this.descImg.setOutSrc(t.IMiniGame6Consts.ui_desc3),this.addChild(this.descImg),this.shield1.scaleX=this.shield1.scaleY=.4,this.shield2.scaleX=this.shield2.scaleY=.6,this.reSet()},e.prototype.reSet=function(){this.descframe=60},e.prototype.setScale=function(){this.frame>0||!this.visible||(this.frame=20,this.scale1=(GMath.randomInt(4,6)/10-this.shield1.scaleX)/this.frame,this.scale2=(GMath.randomInt(6,8)/10-this.shield2.scaleX)/this.frame)},e.prototype.offRun=function(){!this.frame||this.frame<=0||(this.shield1.scaleX+=this.scale1,this.shield1.scaleY+=this.scale1,this.shield2.scaleX+=this.scale2,this.shield2.scaleY+=this.scale2,this.frame--)},e.prototype.descRun=function(){!this.descframe||this.descframe<=0||(this.descImg.alpha=this.descframe/60,this.descframe--)},e.prototype.run=function(){this.setScale(),this.offRun(),this.descRun()},e.prototype.dispose=function(){GObj.disposeObject(this.shield1),this.shield1=null,GObj.disposeObject(this.shield2),this.shield2=null,GObj.disposeObject(this.descImg),this.descImg=null},e}(eui.Group);t.IMiniGame6Shield=i,__reflect(i.prototype,"miniGame.IMiniGame6Shield")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){return i.call(this)||this}return __extends(e,i),e.prototype.initSkins=function(){this.isInit||(this.isInit=!0,this.width=StageManager.stageWidth,this.height=StageManager.stageHeight,this.scene=GObj.create(t.IMiniGame6Secne),this.addChild(this.scene),this.exitBtn=GObj.create(t.IBaseBtn),this.exitBtn.icon=IMiniGameMain.getIcon("exit_btn",FileConst.png,"chapter"),this.exitBtn.right=20,this.exitBtn.top=100,this.addChild(this.exitBtn),this.addEvent())},e.prototype.setData=function(i){this.initSkins(),IMiniGameMain.playBgm(t.IMiniGame6Consts.minigame_bgm),this.scene.setData(i)},e.prototype.addEvent=function(){this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.exitBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCloseClick,this)},e.prototype.removeEvent=function(){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.exitBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onCloseClick,this)},e.prototype.onAddToStage=function(){this.parent!=this.stage&&IMiniGameMain.addToStage(this)},e.prototype.onCloseClick=function(t){this.scene&&this.scene.removeFromStage(),i.prototype.onCloseClick.call(this,t)},e.prototype.dispose=function(){this.isDestory||(this.isDestory=!0,this.removeEvent(),GObj.disposeObject(this.scene),this.scene=null,GObj.disposeObject(this.exitBtn),this.exitBtn=null,i.prototype.dispose.call(this))},e}(t.IBaseView);t.IMiniGame6View=i,__reflect(i.prototype,"miniGame.IMiniGame6View")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.initSkins(),t}return __extends(e,i),e.prototype.initSkins=function(){this.img=GObj.create(t.ImageOutside),this.img.loadCompleteCall(this.setOffSetXY,this),this.addChild(this.img)},e.prototype.setData=function(t){this.reSet(),this.img.setOutSrc(t)},e.prototype.reSet=function(){this.owner=null,this.isAtk=void 0,this.radius=void 0,this.roundAngle=void 0,this.shapeAngleOne=void 0,this.roundAngleOne=void 0,this.offSetX=void 0,this.offSetY=void 0,this.offSetXOne=void 0,this.offSetYOne=void 0,this.getGox=0,this.getGoy=0,this.frame=0,this.anchorOffsetX=0,this.anchorOffsetY=0,this.img.anchorOffsetX=0,this.img.anchorOffsetY=0,this.offGoFrame=-1,this.offGox=0,this.offGoy=0,this.actDis=0},e.prototype.setOwnerData=function(t,i,e){return this.isAtk=t,this.radius!=i&&(this.offSetY=void 0),this.radius=i,this.roundAngle=e,this.offSetY?void this.setShape():void this.setOffSetXY()},e.prototype.setOffSetXY=function(){return this.owner?void(this.radius&&(this.offSetX=this.img.iconWidth/2,this.offSetY=this.img.iconHeight/2+this.radius,this.actDis=this.offSetX,this.setShape())):void this.shapeOffSet()},e.prototype.setShape=function(){if(void 0!=this.isAtk&&this.offSetX){this.frame=t.IMiniGame6Consts.shapeFrame;var i=this.img.rotation;this.shapeAngle=(this.isAtk?70:0)-i,this.shapeAngleOne=+(this.shapeAngle/this.frame),i=this.rotation,0>i&&(i=360+i),this.roundAngle=this.roundAngle-i,this.roundAngleOne=+(this.roundAngle/this.frame),this.offSetXOne=+((this.offSetX-this.anchorOffsetX)/this.frame),this.offSetYOne=+((this.offSetY-this.anchorOffsetY)/this.frame),(0!=this.x||0!=this.y)&&(this.getFrame=t.IMiniGame6Consts.getFrame,0!=this.x&&(this.getGox=-this.x/this.getFrame),0!=this.y&&(this.getGoy=-this.y/this.getFrame))}},e.prototype.shapeRun=function(){this.moveRun()||this.frame<0||(this.roundAngleOne||this.shapeAngleOne||this.offSetXOne||this.offSetYOne)&&(--this.frame>=0?(this.rotation+=this.roundAngleOne,this.img.rotation+=this.shapeAngleOne,this.anchorOffsetX+=this.offSetXOne,this.anchorOffsetY+=this.offSetYOne):(this.roundAngleOne=void 0,this.shapeAngleOne=void 0,this.offSetXOne=void 0,this.offSetYOne=void 0))},e.prototype.moveRun=function(){return this.getGox||this.getGoy?(--this.getFrame>=0?(this.x+=this.getGox,this.y+=this.getGoy):(this.getGox=0,this.getGoy=0,this.x=0,this.y=0),!0):!1},e.prototype.shapeOffSet=function(){this.img.iconWidth&&(this.anchorOffsetX=this.img.iconWidth/4,this.anchorOffsetY=this.img.iconHeight/2)},e.prototype.setOffData=function(i,e){this.offGox=t.IMiniGame6Consts.dropSpeed*GMath.cos(e),this.offGoy=t.IMiniGame6Consts.dropSpeed*GMath.sin(e),this.offGoFrame=Math.ceil(i/t.IMiniGame6Consts.dropSpeed),this.isOff=!0,this.setOffSet()},e.prototype.offRun=function(){return!this.offGoFrame||this.offGoFrame<0?void(this.isOff=!1):(this.x+=this.offGox,this.y+=this.offGoy,this.rotation+=20,this.offGoFrame--,void(this.offGoFrame<=0&&(this.isOff=!1)))},e.prototype.setOffSet=function(){this.img.iconWidth&&(this.anchorOffsetX=this.img.iconWidth/2,this.anchorOffsetY=this.img.iconHeight/2)},e.prototype.getActDis=function(){return this.actDis||10},e.prototype.run=function(){this.shapeRun(),this.offRun()},e.prototype.dispose=function(){this.reSet(),GObj.disposeObject(this.img),this.img=null,this.owner=null},e}(egret.DisplayObjectContainer);t.IMiniGame6Weapon=i,__reflect(i.prototype,"miniGame.IMiniGame6Weapon")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(t){return i.call(this,t)||this}return __extends(e,i),e.prototype.getGameView=function(){return this.gameView||(this.gameView=GObj.create(t.IMiniGame7View)),this.gameView.setData(this.getCurGameData()),this.gameView},e.prototype.loadConfigComplete=function(e){if(e)for(var s in e.config)t.IMiniGame7Consts[s]=e.config[s];i.prototype.loadConfigComplete.call(this,e)},e.prototype.getCurGameData=function(e,s){var h=i.prototype.getCurGameData.call(this);return h||(h=t.testData7),h},e}(t.IMiniGameBaseCtr);t.IMiniGame7=i,__reflect(i.prototype,"miniGame.IMiniGame7")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.setCenter(!0),t.kind=1,t.updatePart("bee_1"),t.setDirection(AvatarConsts.R_R),t.setAction(AvatarConsts.ACTION_WALK),t}return __extends(e,i),e.prototype.run=function(){i.prototype.run.call(this),this.lockTarget()},e.prototype.lockTarget=function(){!this._isDie&&this.target&&0==--this.lockGap&&(this.lockGap=Math.ceil(IMiniGameMain.sysFrame()/3),this.lockAngle(),this.lockDirection(),this.setRadius())},e.prototype.lockAngle=function(){var t=GMath.angle(this.x,this.y,this.target.x,this.target.y);this.setAngle(t)},e.prototype.lockDirection=function(){var t=this.speedx<0?AvatarConsts.L_L:AvatarConsts.R_R;this.setDirection(t)},e.prototype.setRadius=function(){this.radius||(this.radius=Math.ceil(this.width/4+this.height/4)*this.scaleX)},e.prototype.targetDis=function(t){return GMath.distance(this.x,this.y,t.x,t.y)},e.prototype.checkHit=function(t,i){return i<2*this.radius+2*this.speed},e.prototype.changeAngle=function(t){t=t||GMath.randomInt(150,210),this.setAngle(t+this.angle),this.quickMove()},e.prototype.quickMove=function(){for(var t=Math.ceil(this.radius/this.speed*.3),i=0;t>i;i++)this.move()},e.prototype.checkTargetHit=function(t){if(t){var i=this.targetDis(t),e=this.checkHit(t,i);return e?this.hitObj==t?!0:(this.hitObj=t,i<=this.hitDis&&(this.hitDis=i,this.changeAngle(),t.changeAngle(this.angle+180)),!0):(this.hitObj=null,this.hitDis=999,!1)}},e.prototype.checkEnemyHit=function(i){if(this.y<i.y-i.height)return!1;var e=t.IMiniGame7Consts.scleaxy;return this.x>i.x-.5*i.width*e&&this.x<i.x+.5*i.width*e&&this.y>i.y-i.height*e&&this.y<i.y},e.prototype.move=function(){this._isMove&&(i.prototype.move.call(this),this.x<this.sx?this.x=this.sx:this.x>this.ex&&(this.x=this.ex))},e.prototype.setTatget=function(i,e){this.target=i,this.radius=0,this.lockGap=5,this._isMove=!0,this.anchorOffsetX=0,this.anchorOffsetY=0,this.sx=0,this.ex=e||540;var s=GMath.randomInt(70,100)/100*t.IMiniGame7Consts.scleaxy;this.scaleX=s,this.scaleY=s,this.speed=t.IMiniGame7Consts.speed*s},e.prototype.setStopMove=function(){this._isMove=!1},e.prototype.dispose=function(){this.target=null,i.prototype.dispose.call(this)},e}(t.IAvatarViewCtr);t.IMiniGame7Bee=i,__reflect(i.prototype,"miniGame.IMiniGame7Bee")}(miniGame||(miniGame={}));var miniGame;!function(t){t.testData7={stageId:1,show:1,passes:[]},t.IMiniGame7Consts={maxLenth:200,speed:4,beeNum:1,beeFrame:120,landGap:10,landAlpha:1,scleaxy:.65,minigame_bgm:"game7_minigame_bgm",minigame_win:"game7_minigame_win",minigame_lose:"game7_minigame_lose"}}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){return i.call(this)||this}return __extends(e,i),e.prototype.initSkins=function(){var i=this;this.isInit||(this.isInit=!0,this.horizontalCenter=0,this.verticalCenter=0,this.beePool=[],this.bee=[],this.beeNum=0,this.width=540,this.height=960,this.bgImg=GObj.create(t.ImageOutside),this.bgImg.setOutSrc("game7_bg_1",FileConst.jpg),this.bgImg.horizontalCenter=0,this.bgImg.bottom=0,this.addChild(this.bgImg),this.beeHome1=GObj.create(t.ImageOutside),this.beeHome1.loadCompleteCall(function(){i.beeHome1.anchorOffsetX=i.beeHome1.iconWidth/2},this),this.beeHome1.setOutSrc("ui_fengwo"),this.addChild(this.beeHome1),this.beeHome2=GObj.create(t.ImageOutside),this.beeHome2.loadCompleteCall(function(){i.beeHome2.anchorOffsetX=i.beeHome2.iconWidth/2},this),this.beeHome2.setOutSrc("ui_fengwo"),this.beeHome2.scaleX=-1,this.addChild(this.beeHome2),this.player=GObj.create(t.IAvatarView),this.addChild(this.player),this.beeGrp=GObj.create(egret.DisplayObjectContainer),this.beeGrp.width=this.explicitWidth,this.beeGrp.height=this.explicitHeight,this.addChild(this.beeGrp),this.timeMap=GObj.create(t.IBitNumMap),this.timeMap.horizontalCenter=0,this.timeMap.top=100,this.timeMap.setGap(-1),this.timeMap.setPath("num7"),this.addChild(this.timeMap),this.shapeArea=GObj.create(egret.Shape),this.addChild(this.shapeArea),this.shape=GObj.create(egret.Shape),this.addChild(this.shape),this.exitBtn=GObj.create(t.IBaseBtn),this.exitBtn.icon=IMiniGameMain.getIcon("exit_btn",FileConst.png,"chapter"),this.exitBtn.right=20,this.exitBtn.top=100,this.addChild(this.exitBtn),this.addEvent())},e.prototype.setData=function(i){this.initSkins(),this.data=i,this.curIdx=0,this.updateView(),IMiniGameMain.playBgm(t.IMiniGame7Consts.minigame_bgm)},e.prototype.updateView=function(){this.backBeePool(),this.shapePoints=[],this.shape.graphics.clear(),this.isGraphics=!1,this.count=0,this.beeHomeAngle=.2,this.curData=this.data.passes[this.curIdx],this.player.x=this.curData.playerx,this.player.y=this.curData.playery,this.player.scaleX=t.IMiniGame7Consts.scleaxy,this.player.scaleY=t.IMiniGame7Consts.scleaxy,this.player.updatePart(this.curData.playerModel),this.player.setAction(AvatarConsts.ACTION_STAND),this.player.setDirection(AvatarConsts.B_B),this.beeHome1.x=this.curData.beeHome1x,this.beeHome1.y=this.curData.beeHome1y,this.beeHome2.x=this.curData.beeHome2x,this.beeHome2.y=this.curData.beeHome2y,this.drawShapeArea(),this.time=10,this.timeMap.setString(IMiniGameMain.getString(IMiniGameLanguage.c_23,this.time)),this.lastTime=GApp.timer,this.isStop=!1,this.running=!0,!this.curIdx&&IMiniGameMain.reqSocket(1,this.data.stageId),this.showGuide()},e.prototype.showGuide=function(){if(1==this.data.stageId){var t=IMiniGameMain.getGuideView();t.playEffct(this.beeHome1.x,this.explicitHeight/2,1),this.addChild(t),egret.Tween.get(t,{loop:!0}).to({x:this.beeHome2.x},1500)}},e.prototype.drawShapeArea=function(){var i=this.curData.lands;if(i&&0!=i.length){var e=this.shapeArea.graphics;e.clear(),e.lineStyle(5,16711680,t.IMiniGame7Consts.landAlpha);for(var s,h,a,n,o,r=0,l=i;r<l.length;r++){var p=l[r];for(s=p[0][0],h=p[0][1],e.moveTo(s,h),o=1;o<p.length;o++)a=p[o-1][0],n=p[o-1][1],s=p[o][0],h=p[o][1],this.drawGapPoint(a,n,s,h,this.shapeArea.graphics)}e.endFill();var c=e.$renderNode.drawData[0];c&&(this.shapePoints=c.$data)}},e.prototype.drawGapPoint=function(i,e,s,h,a){var n=GMath.distance(i,e,s,h),o=t.IMiniGame7Consts.landGap;if(n>o){var r=GMath.angle(i,e,s,h);i+=o*GMath.cos(r),e+=o*GMath.sin(r),a.lineTo(i,e),this.drawGapPoint(i,e,s,h,a)}else a.lineTo(s,h)},e.prototype.addEvent=function(){this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBenginClick,this),this.exitBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCloseClick,this),EnterFrameManager.instance.registeRender(this.run,this)},e.prototype.removeEvent=function(){this.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBenginClick,this),this.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMoveClick,this),this.removeEventListener(egret.TouchEvent.TOUCH_END,this.onEndClick,this),this.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onEndClick,this),this.exitBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onCloseClick,this),EnterFrameManager.instance.unRegisteRender(this.run,this)},e.prototype.onBenginClick=function(t){if(!this.isGraphics){1==this.data.stageId&&IMiniGameMain.rmGuideView(),this.tempPoint||(this.tempPoint=GObj.create(egret.Point)),this.globalToLocal(t.stageX,t.stageY,this.tempPoint);var i=this.shape.graphics;i.lineStyle(5),i.moveTo(this.tempPoint.x,this.tempPoint.y),i.lineTo(this.tempPoint.x,this.tempPoint.y),i.endFill(),this.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMoveClick,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.onEndClick,this),this.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onEndClick,this)}},e.prototype.onMoveClick=function(i){var e=this.tempPoint.x,s=this.tempPoint.y;this.globalToLocal(i.stageX,i.stageY,this.tempPoint);var h=this.shape.graphics;this.drawGapPoint(e,s,this.tempPoint.x,this.tempPoint.y,h),h.endFill();var a=this.shape.graphics.$renderNode.drawData[0];if(a){var n=a.$data.length;n>t.IMiniGame7Consts.maxLenth&&this.onEndClick()}},e.prototype.onEndClick=function(i){this.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMoveClick,this),this.removeEventListener(egret.TouchEvent.TOUCH_END,this.onEndClick,this),this.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onEndClick,this),this.beeNum=t.IMiniGame7Consts.beeNum,this.beeFrame=0,this.isGraphics=!0,IMiniGameMain.reqSocket(2);var e=this.shape.graphics.$renderNode.drawData[0];e&&(this.shapePoints=this.shapePoints.concat(e.$data))},e.prototype.createBee=function(){if(this.isGraphics&&!(this.beeNum<=0||--this.beeFrame>0)){this.beeFrame=t.IMiniGame7Consts.beeFrame;var i,e=this.curData;i=this.getBee(),i.setTatget(this.player,this.explicitWidth),i.x=e.beeHome1x,i.y=e.beeHome1y+this.beeHome1.height/2,this.bee.push(i),this.beeGrp.addChild(i),i=this.getBee(),i.setTatget(this.player,this.explicitWidth),i.x=e.beeHome2x,i.y=e.beeHome2y+this.beeHome2.height/2,this.bee.push(i),this.beeGrp.addChild(i),this.beeNum--}},e.prototype.getBee=function(){var i=this.beePool.pop();return i||(i=GObj.create(t.IMiniGame7Bee)),i},e.prototype.backBeePool=function(){for(var t=0,i=this.bee;t<i.length;t++){var e=i[t];e.parent&&e.parent.removeChild(e),this.beePool.push(e)}this.bee=[]},e.prototype.beeHomeRun=function(){(this.beeHome1.rotation>3||this.beeHome1.rotation<-3)&&(this.beeHomeAngle*=-1),this.beeHome1.rotation+=this.beeHomeAngle,this.beeHome2.rotation-=this.beeHomeAngle},e.prototype.checkAvatarHit=function(){if(this.isGraphics){var t=this.bee,i=t.length;if(0!=i){var e,s,h,a=this.player;for(e=0;i>e;e++)if(h=t[e],h.run(),this.isStop)h.setStopMove();else{if(h.checkEnemyHit(a))return this.player.setAction(AvatarConsts.ACTION_DIE),void this.setResult(IMiniGameResultType.type_0);for(s=e+1;i>s;s++)h.checkTargetHit(t[s]);this.checkHitLine(h)}}}},e.prototype.checkHitLine=function(t){if(this.shapePoints){for(var i,e,s,h=0;h<this.shapePoints.length;h+=2)if(i=this.shapePoints[h],e=this.shapePoints[h+1],s=GMath.distance(t.x,t.y,i,e),s<=t.radius)return t.changeAngle(),t.quickMove(),!0;return!1}},e.prototype.run=function(){this.running&&(this.player.run(),this.createBee(),this.checkAvatarHit(),this.checkNature(),this.beeHomeRun())},e.prototype.checkNature=function(){if(!(GApp.timer<this.lastTime+1e3)&&(this.lastTime=GApp.timer,!this.isStop&&this.isGraphics)){if(this.time--,this.time<0)return void this.checkNextStage();this.timeMap.setString(IMiniGameMain.getString(IMiniGameLanguage.c_23,this.time))}},e.prototype.checkNextStage=function(){var t=this.data.passes[this.curIdx+1],i=IMiniGameResultType.type_1;t?(this.curIdx++,i=IMiniGameResultType.type_5):IMiniGameMain.reqSocket(3),this.setResult(i,t&&t.passId)},e.prototype.setResult=function(i,e){this.isStop=!0,IMiniGameMain.playEff(i?t.IMiniGame7Consts.minigame_win:t.IMiniGame7Consts.minigame_lose),t.IMiniGameResult.showResult(i,this.resultCallBack,this,3,e)},e.prototype.resultCallBack=function(t){switch(t){case IMiniGameResultType.type_0:this.curIdx=0,this.updateView();break;case IMiniGameResultType.type_1:this.onCloseClick();break;case IMiniGameResultType.type_5:this.updateView()}},e.prototype.dispose=function(){if(!this.isDestory){this.isDestory=!0,this.removeEvent(),GObj.disposeObject(this.exitBtn),this.exitBtn=null,GObj.disposeObject(this.bgImg),this.bgImg=null,GObj.disposeObject(this.timeMap),this.timeMap=null,this.shape&&this.shape.graphics.clear(),GObj.disposeObject(this.shape),this.shape=null,this.shapeArea&&this.shapeArea.graphics.clear(),GObj.disposeObject(this.shapeArea),this.shapeArea=null,GObj.disposeObject(this.tempPoint),this.tempPoint=null,this.backBeePool();for(var t=0,e=this.beePool;t<e.length;t++){var s=e[t];GObj.disposeObject(s)}this.bee=null,this.beePool=null,GObj.disposeObject(this.beeGrp),this.beeGrp=null,GObj.disposeObject(this.player),this.player=null,GObj.disposeObject(this.beeHome1),this.beeHome1=null,GObj.disposeObject(this.beeHome2),this.beeHome2=null,this.shapePoints=null,i.prototype.dispose.call(this)}},e}(t.IBaseView);t.IMiniGame7View=i,__reflect(i.prototype,"miniGame.IMiniGame7View")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(t){return i.call(this,t)||this}return __extends(e,i),e.prototype.getGameView=function(){return this.gameView||(this.gameView=GObj.create(t.IMiniGame8View)),this.gameView.setData(this.getCurGameData()),this.gameView},e.prototype.loadConfigComplete=function(e){if(e)for(var s in e.config)t.IMiniGame8Consts[s]=e.config[s];i.prototype.loadConfigComplete.call(this,e)},e.prototype.getCurGameData=function(e,s){var h=i.prototype.getCurGameData.call(this);return h||(h=t.testData8),h},e}(t.IMiniGameBaseCtr);t.IMiniGame8=i,__reflect(i.prototype,"miniGame.IMiniGame8")}(miniGame||(miniGame={}));var miniGame;!function(t){t.testData8={stageId:1,show:1,passes:[]},t.IMiniGame8Consts={speed:4,landGap:10,landAlpha:1,rotation:10,minigame_bgm:"game8_minigame_bgm",minigame_win:"game8_minigame_win",minigame_lose:"game8_minigame_lose",minigame_knife:"game8_minigame_knife",minigame_knife_hit:"game8_minigame_knife_hit"}}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var e=i.call(this)||this;return e.exact=!0,e.speed=t.IMiniGame8Consts.speed,e.showTrailing=!0,e.leng=e.speed,e.trailingType=1,e.createPlayer(),e}return __extends(e,i),e.prototype.createPlayer=function(){var i=this;this.player=GObj.create(t.ImageOutside),this.player.loadCompleteCall(function(){i.width=i.player.iconWidth,i.height=i.player.iconHeight,i.initSet()},this),this.player.setOutSrc("knife1"),this.addChild(this.player)},e.prototype.initSet=function(){if(this.width&&void 0!=this.sx){var t=this.width/2,i=this.height/2;this.player.anchorOffsetX=t,this.player.anchorOffsetY=i,this.player.x=t,this.player.y=i,this.radius=Math.ceil(Math.min(t/2,i/2)),this.anchorOffsetX=t,this.anchorOffsetY=i,this.sx+=this.radius,this.sy+=this.radius,this.ex-=this.radius,this.ey-=this.radius}},e.prototype.checkEnemyHit=function(t){return this.x>t.x-.5*t.width&&this.x<t.x+.5*t.width&&this.y>t.y-t.height&&this.y<t.y},e.prototype.run=function(){this.move()},e.prototype.move=function(){this._isMove&&(this.x+=this.speedx||0,this.y+=this.speedy||0,this.player.rotation+=t.IMiniGame8Consts.rotation,(this.x<this.sx||this.x>this.ex)&&(this.x=this.x<this.sx?this.sx:this.ex,this.setAngle(180-this.angle),this.move()),(this.y<this.sy||this.y>this.ey)&&(this.y=this.y<this.sy?this.sy:this.ey,this.setAngle(360-this.angle),this.move()))},e.prototype.changeAngle=function(t){if(this._isMove){var i=this.angle-t;i=Math.floor((i+360)%360),i>90&&(t=Math.floor((t+180)%360)),this.setAngle(2*t-this.angle),this.move()}},e.prototype.setAngle=function(i){i=Math.floor((i+360)%360),i%90==0&&(i+=1),i!=this.angle&&(this.angle=i,this.speedx=this.speed*GMath.cos(i),this.speedy=this.speed*GMath.sin(i),IMiniGameMain.playEff(t.IMiniGame8Consts.minigame_knife))},e.prototype.setArea=function(t,i,e,s){this.sx=t,this.ex=e,this.sy=i,this.ey=s,this.initSet()},e.prototype.setMove=function(t){this._isMove=t},e.prototype.getAngle=function(){return this.angle},e.prototype.dispose=function(){GObj.disposeObject(this.player),this.player=null},e}(egret.DisplayObjectContainer);t.IMiniGame8Knife=i,__reflect(i.prototype,"miniGame.IMiniGame8Knife",["ITrailingVo","egret.DisplayObject"])}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){return i.call(this)||this}return __extends(e,i),e.prototype.initSkins=function(){var i=this;this.isInit||(this.isInit=!0,this.horizontalCenter=0,this.verticalCenter=0,this.width=540,this.height=960,this.bgImg=GObj.create(t.ImageOutside),this.bgImg.setOutSrc("game8_bg_1",FileConst.jpg),this.bgImg.horizontalCenter=0,this.bgImg.bottom=0,this.addChild(this.bgImg),this.shapeArea=GObj.create(egret.Shape),this.addChild(this.shapeArea),this.player=GObj.create(t.IAvatarViewExt),this.player.setActOverCallBack(this.playerActionOver,this),this.addChild(this.player),this.target=GObj.create(t.IAvatarViewExt),this.target.setActOverCallBack(this.targetActionOver,this),this.addChild(this.target),this.arrow=GObj.create(t.ImageOutside),this.arrow.loadCompleteCall(function(){i.arrow.anchorOffsetY=i.arrow.iconHeight/2},this),this.arrow.setOutSrc("arrow"),this.addChild(this.arrow),this.knifeTrailing=GObj.create(t.ILinearTrailing),this.knifeTrailing.setBaseAtt(16711680,.3,1),this.addChild(this.knifeTrailing),this.knife=GObj.create(t.IMiniGame8Knife),this.knifeTrailing.addTarget(this.knife),this.addChild(this.knife),this.passMap=GObj.create(t.IBitNumMap),this.passMap.horizontalCenter=0,this.passMap.top=50,this.passMap.setPath("num2"),this.passMap.setGap(0),this.addChild(this.passMap),this.exitBtn=GObj.create(t.IBaseBtn),this.exitBtn.icon=IMiniGameMain.getIcon("exit_btn",FileConst.png,"chapter"),this.exitBtn.right=20,this.exitBtn.top=100,this.addChild(this.exitBtn),this.addEvent())},e.prototype.setData=function(i){this.initSkins(),this.data=i,this.curIdx=0,this.updateView(),IMiniGameMain.playBgm(t.IMiniGame8Consts.minigame_bgm)},e.prototype.updateView=function(){this.shapePoints=[],this.curData=this.data.passes[this.curIdx],!this.curIdx&&IMiniGameMain.reqSocket(1,this.data.stageId),this.tempPoint||(this.tempPoint=GObj.create(egret.Point)),this.player.x=this.curData.playerx,this.player.y=this.curData.playery,this.player.updatePart(this.curData.playerModel),this.player.setAction(AvatarConsts.ACTION_STAND),this.tempPoint.x=this.player.x+50,this.tempPoint.y=this.player.y,this.arrow.visible=!0,this.knife.visible=!1,this.knife.setArea(0,0,this.width,this.height),this.setArrow(this.curData.playerDir),this.target.x=this.curData.targetx,this.target.y=this.curData.targety,this.target.updatePart(this.curData.targetModel),this.target.setAction(AvatarConsts.ACTION_STAND),this.target.setDirection(this.curData.targetDir),this.drawShapeArea(),this.passMap.setString(IMiniGameMain.getString(IMiniGameLanguage.c_16,this.curData.passId)),this.running=!0,this.isEnd=!1,this.isStart=!1,this.isSend=!1,this.showGuide()},e.prototype.showGuide=function(){if(1==this.data.stageId){var t=IMiniGameMain.getGuideView(),i=this.target.y-150;t.playEffct(this.target.x,i/2,1),this.addChild(t),egret.Tween.get(t,{loop:!0}).to({y:i},1e3).to({y:i/2},1e3)}},e.prototype.drawShapeArea=function(){var i=this.curData.lands;if(i&&0!=i.length){var e=this.shapeArea.graphics;e.clear(),e.lineStyle(5,16711680,t.IMiniGame8Consts.landAlpha);for(var s,h,a,n,o,r,l=0,p=i;l<p.length;l++){var c=p[l];for(s=c[0][0],h=c[0][1],e.moveTo(s,h),r=1;r<c.length;r++)a=c[r-1][0],n=c[r-1][1],s=c[r][0],h=c[r][1],o=GMath.angle(a,n,s,h),this.drawGapPoint(a,n,s,h,o,this.shapeArea.graphics)}e.endFill();var u=e.$renderNode.drawData[0];u&&(this.shapePoints=u.$data)}},e.prototype.drawGapPoint=function(i,e,s,h,a,n){var o=GMath.distance(i,e,s,h),r=t.IMiniGame8Consts.landGap;o>r?(2*r>o&&(r=o-r),i+=r*GMath.cos(a),e+=r*GMath.sin(a),n.lineTo(i,e),this.drawGapPoint(i,e,s,h,a,n)):n.lineTo(s,h)},e.prototype.addEvent=function(){this.bgImg.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBenginClick,this),this.exitBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCloseClick,this),EnterFrameManager.instance.registeRender(this.run,this)},e.prototype.removeEvent=function(){this.bgImg.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBenginClick,this),this.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMoveClick,this),this.removeEventListener(egret.TouchEvent.TOUCH_END,this.onEndClick,this),this.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onEndClick,this),this.exitBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onCloseClick,this),EnterFrameManager.instance.unRegisteRender(this.run,this)},e.prototype.onBenginClick=function(t){this.isSend||(this.isSend=!0,1==this.data.stageId&&IMiniGameMain.rmGuideView(),this.globalToLocal(t.stageX,t.stageY,this.tempPoint),this.setArrow(),this.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMoveClick,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.onEndClick,this),this.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onEndClick,this))},e.prototype.onMoveClick=function(t){this.globalToLocal(t.stageX,t.stageY,this.tempPoint),this.setArrow()},e.prototype.onEndClick=function(t){this.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMoveClick,this),this.removeEventListener(egret.TouchEvent.TOUCH_END,this.onEndClick,this),this.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onEndClick,this),this.arrow.visible=!1,this.player.setAction(AvatarConsts.ACTION_ATTACK,1),IMiniGameMain.reqSocket(2)},e.prototype.setArrow=function(t){var i=this.playerW||120,e=this.playerH||150;t?this.angle=t==AvatarConsts.L_L?180:0:this.angle=GMath.angle(this.player.x,this.player.y-e/2,this.tempPoint.x,this.tempPoint.y),t=this.angle>90&&this.angle<270?AvatarConsts.L_L:AvatarConsts.R_R,this.player.setDirection(t),this.arrow.rotation=this.angle,this.arrow.x=this.player.x+(t==AvatarConsts.L_L?-1:1)*i/2,this.arrow.y=this.player.y-e/2,this.knife.x=this.arrow.x,this.knife.y=this.arrow.y},e.prototype.playerActionOver=function(t){t==AvatarConsts.ACTION_ATTACK?(this.isStart=!0,this.knife.visible=!0,this.knife.setAngle(this.angle),this.knife.setMove(!0),this.knifeTrailing.start(),this.player.setAction(AvatarConsts.ACTION_ATTACK_I,1)):t==AvatarConsts.ACTION_DIE?this.setResult(IMiniGameResultType.type_0):t==AvatarConsts.ACTION_STAND&&(this.playerW=this.player.width+10,this.playerH=this.player.height+10)
},e.prototype.targetActionOver=function(t){t==AvatarConsts.ACTION_DIE&&this.checkNextStage()},e.prototype.checkLineHit=function(){if(!this.isEnd&&this.isStart&&this.shapePoints)for(var t,i,e,s,h,a,n,o,r,l=this.knife,p=this.shapePoints.length,c=0;p>c;c+=2)if(t=this.shapePoints[c],i=this.shapePoints[c+1],e=GMath.distance(l.x,l.y,t,i),e<=l.radius){if(o=Number.MAX_VALUE,r=Number.MAX_VALUE,s=this.shapePoints[c+2],h=this.shapePoints[c+3],void 0!=s&&(o=GMath.distance(l.x,l.y,s,h)),a=this.shapePoints[c-2],n=this.shapePoints[c-1],void 0!=a&&(r=GMath.distance(l.x,l.y,a,n)),o>r&&(o=r,s=a,h=n),o>l.radius)continue;if(void 0!=s)return void l.changeAngle(GMath.angle(t,i,s,h))}},e.prototype.checnAvatarHit=function(){if(!this.isEnd&&this.isStart){var i=void 0;this.knife.y>this.height-2*this.knife.radius&&(i=!1),this.knife.checkEnemyHit(this.player)&&(i=!1),this.knife.checkEnemyHit(this.target)&&(i=!0),void 0!=i&&(this.isEnd=!0,this.knife.visible=!1,this.knife.setMove(!1),this.knifeTrailing.stop(),IMiniGameMain.playEff(t.IMiniGame8Consts.minigame_knife_hit),i?this.target.setAction(AvatarConsts.ACTION_DIE):this.player.setAction(AvatarConsts.ACTION_DIE))}},e.prototype.run=function(){this.running&&(this.player.run(),this.target.run(),this.knife.run(),this.knifeTrailing.run(),this.checnAvatarHit(),this.checkLineHit())},e.prototype.checkNextStage=function(){var t=this.data.passes[this.curIdx+1],i=IMiniGameResultType.type_1;t?(this.curIdx++,i=IMiniGameResultType.type_5):IMiniGameMain.reqSocket(3),this.setResult(i,t&&t.passId)},e.prototype.setResult=function(i,e){IMiniGameMain.playEff(i?t.IMiniGame8Consts.minigame_win:t.IMiniGame8Consts.minigame_lose),t.IMiniGameResult.showResult(i,this.resultCallBack,this,3,e)},e.prototype.resultCallBack=function(t){switch(t){case IMiniGameResultType.type_0:this.curIdx=0,this.updateView();break;case IMiniGameResultType.type_1:this.onCloseClick();break;case IMiniGameResultType.type_5:this.updateView()}},e.prototype.dispose=function(){this.isDestory||(this.isDestory=!0,this.removeEvent(),GObj.disposeObject(this.exitBtn),this.exitBtn=null,GObj.disposeObject(this.bgImg),this.bgImg=null,GObj.disposeObject(this.passMap),this.passMap=null,GObj.disposeObject(this.arrow),this.arrow=null,this.shapeArea&&this.shapeArea.graphics.clear(),GObj.disposeObject(this.shapeArea),this.shapeArea=null,GObj.disposeObject(this.tempPoint),this.tempPoint=null,GObj.disposeObject(this.player),this.player=null,GObj.disposeObject(this.target),this.target=null,GObj.disposeObject(this.knifeTrailing),this.knifeTrailing=null,GObj.disposeObject(this.knife),this.knife=null,this.shapePoints=null,i.prototype.dispose.call(this))},e}(t.IBaseView);t.IMiniGame8View=i,__reflect(i.prototype,"miniGame.IMiniGame8View")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(t){return i.call(this,t)||this}return __extends(e,i),e.prototype.getGameView=function(){return this.gameView||(this.gameView=GObj.create(t.IMiniGame9View)),this.gameView.setData(this.getCurGameData(),this.gameData),this.gameView},e.prototype.loadConfigComplete=function(e){if(e)for(var s in e.config)t.IMiniGame9Consts[s]=e.config[s];i.prototype.loadConfigComplete.call(this,e)},e.prototype.getCurGameData=function(e,s){var h=i.prototype.getCurGameData.call(this);return h||(h=t.test9data),h},e}(t.IMiniGameBaseCtr);t.IMiniGame9=i,__reflect(i.prototype,"miniGame.IMiniGame9")}(miniGame||(miniGame={}));var miniGame;!function(t){t.IMiniGame9Consts={IS_CAN_SKIP:!0,JOB_TITLE:"意外闯入异世界，请选择你的职业",ATT_NAME:["悟性","运气","体力","灵力"],JOB_NAME:["散仙","厨子","富豪","捕头"],PLUNDER:"[悟性 - 100,运气 - 100,体力 - 100,灵力 - 100]",PLUNDER_COLOR:2737738,LINE:"  _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _   ",COMPREHENSION:1,LUCKN:2,MANUALN:3,MANAN:4,IMINIGAME9BGM:"iminigame9bgm",IMINIGAME9BTN:"iminigame9btn",TYPEFACE:"SimHei",STARTGAME:"ui_rensheng",ZHIYE:"ui_zhiye",TIME:2e3,WORDTIME:100},t.test9data={stageId:1,show:1,passes:[],att:[[1,3,5,7],[2,4,6,8],[3,5,7,9],[4,6,8,10]],plot:[{title:"【 宗门选择 】",plotbg:"plot1",subject:["平平无奇的散修，十年来功力不涨，现在四大门派招揽弟子，你觉得去__________","厨子杀猪，你决定去______","富豪没有寿命，你决定去________","捕头抓不到人，还被欺负，你决定去___"],option:{description:["【 合欢派 】","【 青莲宗 】","【 蜀山派 】","【 逍遥门 】"],descriptionatt:["【加入宗门】|加入{}开始修行|【属性提升】|<font color='#29c64a'>悟性+1(总计{})</font>|【属性提升】|运气+3|【属性提升】|体力+5|【属性提升】|灵力+8"],valueatt:["1,1|2,3|3,5|4,8"]}},{title:"【 奇遇 】",plotbg:"plot2",subject:["合欢派，你无意得到了一颗风神丸","青莲宗,你无意得到了一颗风神丸","蜀山派，你无意得到了一颗风神丸","逍遥门，你无意得到了一颗风神丸"],option:{description:["【 上交宗门 】","【 自己服用 】"],descriptionatt:["【事件】|你选择{}|【属性提升】|悟性+100|【属性提升】|运气+300|【属性提升】|体力+5|【属性提升】|灵力+8","【测试】|你选择{}|【属性提升】|悟性+100|【属性提升】|运气+300|【属性提升】|体力+5|【属性提升】|灵力+8"],valueatt:["1,1|2,3|3,5|4,8"]}},{title:"【 渡劫 】",plotbg:"plot_last",subject:["鲸吞九天引天象异动,五类倾泻，你难承其重，奄奄一息。"],option:{description:["【 逆天改命 】"],descriptionatt:["【事件】|你决定挑战天劫。|【属性提升】|天劫的强大非凡人所能抗衡，你倒在了天劫之下。|【造化】|天地间没有绝对的死路，你看到了一线生机，可以逆天改命"]}}]}}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.attArr=[],t.labelArr=[],t.initSkins(),t}return __extends(e,i),e.prototype.setData=function(t,i,e,s,h,a){this.updateView(t,i,e,s,h,a)},e.prototype.initSkins=function(){for(var i,e,s=0;10>s;s++)i=GObj.create(eui.Label),i.left=10,i.fontFamily=t.IMiniGame9Consts.TYPEFACE,i.size=22,i.bold=!0,i.textColor=16777215,this.addChild(i),this.attArr.push(i),e=GObj.create(eui.Label),e.fontFamily=t.IMiniGame9Consts.TYPEFACE,e.size=22,e.bold=!0,e.width=380,e.lineSpacing=15,e.wordWrap=!0,e.textColor=16777215,this.addChild(e),this.labelArr.push(e)},e.prototype.updateView=function(t,i,e,s,h,a){var n=this;if(t){this.index=0;for(var o=0;o<this.labelArr.length;o++)this.labelArr[o].textFlow=IMiniGameMain.parserHtml(""),this.attArr[o].text="",this.attArr[o].alpha=this.labelArr[o].alpha=0,egret.Tween.removeTweens(this.attArr[o]),egret.Tween.removeTweens(this.labelArr[o]);for(var r,l=t.split("|"),p=function(t){r=int(t/2),t%2==0?(0==t?c.attArr[r].top=0:c.attArr[r].top=c.labelArr[r-1].top+c.labelArr[r-1].height+15,c.attArr[r].text=l[t]):(c.labelArr[r].left=c.attArr[r].left+c.attArr[r].width+10,c.labelArr[r].width=540-c.labelArr[r].left,c.labelArr[r].top=c.attArr[r].top,-1!=l[t].indexOf("{}")?0==r?c.labelArr[r].textFlow=IMiniGameMain.parserHtml(IMiniGameMain.getString(l[t],i)):e&&0!=e.length&&s?(c.labelArr[r].textFlow=IMiniGameMain.parserHtml(IMiniGameMain.getString(l[t],e[c.index],s[c.index])),c.index++):c.labelArr[r].textFlow=IMiniGameMain.parserHtml(l[t]):c.labelArr[r].textFlow=IMiniGameMain.parserHtml(l[t])),ClockManager.setTimeout(function(){n.labelArr&&n.attArr&&(egret.Tween.get(n.labelArr[int(t/2)]).to({alpha:1},400),egret.Tween.get(n.attArr[int(t/2)]).to({alpha:1},300)),t==l.length-1&&h&&a&&a.call(h)},c,600*int(t/2))},c=this,o=0;o<l.length;o++)p(o)}},e.prototype.dispose=function(){if(this.labelArr)for(var t=0;6>t;t++)egret.Tween.removeTweens(this.labelArr[t]),GObj.disposeObject(this.labelArr[t]),this.labelArr[t]=null;if(GObj.disposeObject(this.labelArr),this.labelArr=null,this.attArr)for(var t=0;6>t;t++)egret.Tween.removeTweens(this.attArr[t]),GObj.disposeObject(this.attArr[t]),this.attArr[t]=null;GObj.disposeObject(this.attArr),this.attArr=null,GObj.disposeObject(this.index),this.index=null},e}(eui.Group);t.IMiniGame9Description=i,__reflect(i.prototype,"miniGame.IMiniGame9Description")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.initSkin(),t}return __extends(e,i),e.prototype.initSkin=function(){var i=this;this.imovie=GObj.create(t.IMovie),this.itemBg=GObj.create(t.ImageOutside),this.itemBg.loadCompleteCall(function(){i.height=i.itemBg.height,i.width=i.itemBg.width,i.itemBg.horizontalCenter=i.itemBg.verticalCenter=0},this),this.itemBg.setOutSrc("jobno",FileConst.png),this.jobsLabel=GObj.create(eui.Label),this.jobsLabel.textAlign="center",this.jobsLabel.textColor=0,this.jobsLabel.size=20,this.jobsLabel.bold=!0,this.jobsLabel.fontFamily=t.IMiniGame9Consts.TYPEFACE,this.jobsLabel.horizontalCenter=this.jobsLabel.verticalCenter=0,this.addChild(this.itemBg),this.addChild(this.jobsLabel),this.imovie.x=48,this.imovie.y=23,this.addChild(this.imovie)},e.prototype.dataChanged=function(){i.prototype.dataChanged.call(this),this.selected?(this.imovie.start(t.IMiniGame9Consts.ZHIYE),this.imovie.autoRun()):this.imovie.stop(),this.itemBg.setOutSrc(this.selected?"job":"jobno",FileConst.png),this.data&&(this.jobsLabel.text=this.data.jobText)},e.prototype.dispose=function(){GObj.disposeObject(this.itemBg),this.itemBg=null,GObj.disposeObject(this.jobsLabel),this.jobsLabel=null,GObj.disposeObject(this.imovie),this.imovie=null},e}(eui.ItemRenderer);t.IMiniGame9JobsItem=i,__reflect(i.prototype,"miniGame.IMiniGame9JobsItem");var e=function(i){function e(t){var e=i.call(this)||this;return e.initSkin(t),e}return __extends(e,i),e.prototype.initSkin=function(i){var e=this;this.attLabel=GObj.create(eui.Label),this.attLabel.left=5,this.attLabel.verticalCenter=0,this.attLabel.textAlign="center",this.attLabel.textColor=0,this.attLabel.size=22,this.attLabel.bold=!0,this.attLabel.fontFamily=t.IMiniGame9Consts.TYPEFACE,this.attLabel.text=i,this.addChild(this.attLabel),this._attValue=GObj.create(eui.Label),this._attValue.right=10,this._attValue.textAlign="center",this._attValue.textColor=0,this._attValue.size=22,this._attValue.bold=!0,this._attValue.fontFamily=t.IMiniGame9Consts.TYPEFACE,this._attValue.verticalCenter=0,this.addChild(this._attValue),this.attBgImage=GObj.create(t.ImageOutside),this.attBgImage.verticalCenter=0,this.attBgImage.left=this.attLabel.left+this.attLabel.width+15,this.attBgImage.loadCompleteCall(function(){e.height=e.attBgImage.height},this),this.attBgImage.setOutSrc("attributebg",FileConst.png),this.addChild(this.attBgImage),this.attImage=[];for(var s,h=0;10>h;h++)s=GObj.create(t.ImageOutside),s.verticalCenter=0,this.addChild(s),this.attImage.push(s)},Object.defineProperty(e.prototype,"attValue",{set:function(t){this.updateView(t)},enumerable:!0,configurable:!0}),e.prototype.updateView=function(t){this._attValue.text=t+"";for(var i=0;i<this.attImage.length;i++)this.attImage[i].setOutSrc(t>i?"attribute":"noattribute",FileConst.png),this.attImage[i].left=this.attBgImage.left+20*i+8*(i+1)},e.prototype.dispose=function(){if(GObj.disposeObject(this.attLabel),this.attLabel=null,GObj.disposeObject(this._attValue),this._attValue=null,this.attImage)for(var t=0;t<this.attImage.length;t++)GObj.disposeObject(this.attImage[t]),this.attImage[t]=null;GObj.disposeObject(this.attImage),this.attImage=null,GObj.disposeObject(this.attBgImage),this.attBgImage=null},e}(eui.Group);t.IMiniGame9AttItem=e,__reflect(e.prototype,"miniGame.IMiniGame9AttItem")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function h(){var t=i.call(this)||this;return t.exact=!0,t}return __extends(h,i),h.prototype.setData=function(t,i,e){this.allData=t,this.initSkin(),this.plotindex=0,this.updateView(this.plotindex,e),this.comprehensionN=i[e][0],this.luckN=i[e][1],this.manualN=i[e][2],this.manaN=i[e][3]},h.prototype.initSkin=function(){var i=this;this.height=960,this.width=540,this.plotBg=GObj.create(t.ImageOutside),this.plotBg.setOutSrc("game9_bg_2",FileConst.jpg),this.plotBg.horizontalCenter=this.verticalCenter=0,this.addChild(this.plotBg),this.storyGroup=GObj.create(eui.Group),this.storyGroup.horizontalCenter=0,this.storyGroup.top=20,this.storyGroup.scrollEnabled=!0,this.addChild(this.storyGroup),this.storyImg=GObj.create(t.ImageOutside),this.storyGroup.addChild(this.storyImg),this.storyBg=GObj.create(t.ImageOutside),this.storyBg.horizontalCenter=0,this.problemText=GObj.create(eui.Label),this.textGroup=GObj.create(eui.Group),this.personIAvatar=GObj.create(t.IAvatarView),this.storyBg.loadCompleteCall(function(){i.storyGroup.height=i.storyImg.height=i.storyBg.height,i.storyGroup.width=i.storyImg.width=i.storyBg.width,i.storyImg.anchorOffsetY=i.storyImg.height/2,i.storyImg.anchorOffsetX=i.storyImg.width/2,i.storyImg.x=i.storyImg.anchorOffsetX,i.storyImg.y=i.storyImg.anchorOffsetY,i.problemText.top=i.storyGroup.top+i.storyGroup.height+40,i.personIAvatar.x=i.storyGroup.width/2,i.personIAvatar.y=i.storyGroup.height/2},this),this.storyBg.setOutSrc("imagebg",FileConst.png),this.storyBg.top=this.storyGroup.top,this.addChild(this.storyBg),this.title=GObj.create(eui.Label),this.title.horizontalCenter=0,this.title.size=28,this.title.textColor=0,this.title.top=20,this.title.bold=!0,this.storyGroup.addChild(this.title),this.personIAvatar.visible=!1,this.storyGroup.addChild(this.personIAvatar),this.problemText.size=28,this.problemText.fontFamily=t.IMiniGame9Consts.TYPEFACE,this.problemText.textColor=0,this.problemText.left=50,this.problemText.width=450,this.problemText.bold=!0,this.problemText.lineSpacing=15,this.problemText.wordWrap=!0,this.addChild(this.problemText),this.textGroup.width=400,this.textGroup.height=140,this.textGroup.anchorOffsetX=this.textGroup.width/2,this.textGroup.anchorOffsetY=this.textGroup.height/2,this.textGroup.x=this.problemText.left+20+this.textGroup.anchorOffsetX,this.textGroup.scaleX=this.textGroup.scaleY=this.textGroup.alpha=0,this.addChild(this.textGroup);var s;this.textArr=[];for(var h=0;4>h;h++)s=GObj.create(e),s.index=h,s.left=h%2*220,s.top=85*int(h/2),this.textArr.push(s),this.textGroup.addChild(s);this.description=GObj.create(t.IMiniGame9Description),this.description.width=this.width,this.description.height=200,this.description.bottom=0,this.description.horizontalCenter=0,this.description.visible=!1,this.addChild(this.description),this.lineText=GObj.create(eui.Label),this.lineText.size=20,this.lineText.fontFamily=t.IMiniGame9Consts.TYPEFACE,this.lineText.textColor=16777215,this.lineText.left=this.lineText.right=0,this.lineText.height=20,this.lineText.bold=!0,this.lineText.width=this.width+28,this.lineText.text=t.IMiniGame9Consts.LINE,this.lineText.visible=!1,this.addChild(this.lineText),this.ferryTextDes=GObj.create(eui.Label),this.ferryTextDes.size=23,this.ferryTextDes.fontFamily=t.IMiniGame9Consts.TYPEFACE,this.ferryTextDes.textColor=t.IMiniGame9Consts.PLUNDER_COLOR,this.ferryTextDes.height=this.ferryTextDes.size,this.ferryTextDes.bold=!0,this.ferryTextDes.text=t.IMiniGame9Consts.PLUNDER,this.ferryTextDes.visible=!1,this.addChild(this.ferryTextDes),this.ferryText=GObj.create(eui.Label),this.ferryText.size=40,this.ferryText.bold=!0,this.ferryText.fontFamily=t.IMiniGame9Consts.TYPEFACE,this.ferryText.textColor=12986665,this.ferryText.visible=!1,this.addChild(this.ferryText),this.initEvent()},h.prototype.initData=function(){this.ferryText.visible=!1,this.ferryTextDes.visible=!1,this.description.visible=!1,this.lineText.visible=!1;for(var t=0;t<this.textArr.length;t++)this.textArr[t].initEvent(),this.textArr[t].setFun(this,this.afterAnswer),this.textArr[t].setText("","");this.textGroup.scaleX=this.textGroup.scaleY=this.textGroup.alpha=0,this.storyImg.scaleX=this.storyImg.scaleY=1,this.personIAvatar.unAutoRun(),this.personIAvatar.visible=!1},h.prototype.initEvent=function(){this.ferryText.addEventListener(egret.TouchEvent.TOUCH_TAP,this.playSq,this)},h.prototype.updateView=function(i,e){if(!(this.allData.length<i+1)){this.initData();var s=this.allData[i];this.title.text=s.title,this.storyImg.setOutSrc(s.plotbg,FileConst.jpg),egret.Tween.removeTweens(this.storyImg),egret.Tween.get(this.storyImg,{loop:!0}).to({scaleX:1.2,scaleY:1.2},1e4).to({scaleX:1,scaleY:1},1e4),this.allData[i].avater&&(this.personIAvatar.visible=!0,this.personIAvatar.setDirection(0),this.personIAvatar.updatePart(this.allData[i].avater),this.personIAvatar.autoRun(),this.personIAvatar.setAction(AvatarConsts.ACTION_STAND));var h="undefined"==typeof e||e+1>s.subject.length?s.subject[0]:s.subject[e];if(i+1==this.allData.length){this.problemText.text=h,this.ferryTextDes.horizontalCenter=0,this.ferryTextDes.top=this.problemText.top+this.problemText.height+30,this.lineText.visible=!0,this.description.visible=!0,this.ferryText.top=this.ferryTextDes.top+80,this.ferryText.horizontalCenter=0,this.lineText.top=this.ferryText.top+100,this.description.top=this.lineText.top+this.lineText.height+10,this.description.setData(this.allData[this.plotindex].option.descriptionatt[0]);for(var a=0;a<s.option.description.length;a++)this.ferryText.text=s.option.description[a]}t.IMiniGame9Consts.IS_CAN_SKIP&&this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.skipView,this),this.problemText.text="",this.pro_index=0,this.isSkip=!1,this.subjectString=h,this.writePro(h,i)}},h.prototype.skipView=function(){this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.skipView,this),this.isSkip=!0,this.problemText.text="",this.problemText.text=this.subjectString,this.plotindex+1!=this.allData.length?this.showAnswerG(this.plotindex):this.showLastView()},h.prototype.showAnswerG=function(t){var i=this.allData[t];if(i){this.textGroup.y=this.problemText.top+this.problemText.height+this.textGroup.anchorOffsetY+5,egret.Tween.get(this.textGroup).to({alpha:1,scaleX:1,scaleY:1},500);for(var e=0;e<i.option.description.length;e++)i.option.tips?this.textArr[e].setText(i.option.description[e],i.option.tips[e]):this.textArr[e].setText(i.option.description[e],"")}},h.prototype.showLastView=function(){var t=this;this.ferryTextDes.visible=!0,this.ferryTextDes.alpha=0,egret.Tween.get(this.ferryTextDes).to({alpha:1},300).call(function(){t.ferryText.alpha=0,t.ferryText.visible=!0,egret.Tween.get(t.ferryText).to({alpha:1},400).call(function(){t.ferryText.scaleX=t.ferryText.scaleY=1,egret.Tween.get(t.ferryText,{loop:!0}).to({scaleX:1.2,scaleY:1.2},500).to({scaleX:1,scaleY:1},500)})})},h.prototype.writePro=function(i,e){var s=this;this.pro_index+1>i.length||ClockManager.setTimeout(function(){s.isSkip||(s.problemText.appendText(i[s.pro_index]),s.pro_index++,s.pro_index>=i.length&&(e+1!=s.allData.length?s.showAnswerG(e):s.showLastView()),s.writePro(i,e))},this,t.IMiniGame9Consts.WORDTIME)},h.prototype.afterAnswer=function(i,e){var s=this;if(!(this.allData.length<this.plotindex)){var h=[],a=[];if(this.allData[this.plotindex].option.valueatt){var n=void 0;n=e+1>this.allData[this.plotindex].option.valueatt.length?this.allData[this.plotindex].option.valueatt[0]:this.allData[this.plotindex].option.valueatt[e];for(var o=n.split("|"),r=void 0,l=0;l<o.length;l++)if(-1!=o[l].indexOf(",")){switch(r=o[l].split(","),Number(r[0])){case t.IMiniGame9Consts.COMPREHENSION:this.comprehensionN=this.comprehensionN+Number(r[1]),a.push(this.comprehensionN);break;case t.IMiniGame9Consts.LUCKN:this.luckN=this.luckN+Number(r[1]),a.push(this.luckN);break;case t.IMiniGame9Consts.MANUALN:this.manualN=this.manualN+Number(r[1]),a.push(this.manualN);break;case t.IMiniGame9Consts.MANAN:this.manaN=this.manaN+Number(r[1]),a.push(this.manaN)}h.push(Number(r[1]))}}for(var p=function(){ClockManager.setTimeout(function(){s.updateView(s.plotindex,e)},s,t.IMiniGame9Consts.TIME)},l=0;l<this.textArr.length;l++)this.textArr[l].removeEvent(),this.textArr[l].setFun(null,null);e+1>this.allData[this.plotindex].option.descriptionatt.length?this.description.setData(this.allData[this.plotindex].option.descriptionatt[0],i,h,a,this,p):this.description.setData(this.allData[this.plotindex].option.descriptionatt[e],i,h,a,this,p),this.lineText.top=this.textGroup.y+this.textGroup.height-this.textGroup.anchorOffsetY+30,this.lineText.visible=!0,this.description.top=this.lineText.top+this.lineText.height+10,this.description.visible=!0,this.plotindex++}},h.prototype.playSq=function(){var t=new egret.BlurFilter(10,10),i=new egret.BlurFilter(5,5),e=new egret.BlurFilter(0,0);this.filters=[e],egret.Tween.get(this).to({filters:[i]},500).to({filters:[t]},500),this.ferryText.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.playSq,this);var h=function(){IMiniGameMain.reqSocket(3),DispatcherManager.dispatch(IMiniGameEvent.IMiniGameExit),DispatcherManager.dispatch(IMiniGameEvent.IMiniGameChapterExit),DispatcherManager.dispatch(IMiniGameEvent.IMiniCloseTools)},a={callfun:h,caller:this},n=GObj.create(s,a);this.stage.addChild(n)},h.prototype.clearTween=function(){this.ferryTextDes&&egret.Tween.removeTweens(this.ferryTextDes),this&&egret.Tween.removeTweens(this),this.storyImg&&egret.Tween.removeTweens(this.storyImg),this.textGroup&&egret.Tween.removeTweens(this.textGroup),this.ferryText&&egret.Tween.removeTweens(this.ferryText)},h.prototype.dispose=function(){if(this.clearTween(),t.IMiniGame9Consts.IS_CAN_SKIP&&this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.skipView,this),this.ferryText.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.playSq,this),GObj.disposeObject(this.allData),this.allData=null,GObj.disposeObject(this.plotindex),this.plotindex=null,GObj.disposeObject(this.plotBg),this.plotBg=null,GObj.disposeObject(this.title),this.title=null,GObj.disposeObject(this.storyBg),this.storyBg=null,GObj.disposeObject(this.storyImg),this.storyImg=null,GObj.disposeObject(this.problemText),this.problemText=null,GObj.disposeObject(this.storyGroup),this.storyGroup=null,GObj.disposeObject(this.textGroup),this.textGroup=null,GObj.disposeObject(this.description),this.description=null,GObj.disposeObject(this.comprehensionN),this.comprehensionN=null,GObj.disposeObject(this.luckN),this.luckN=null,GObj.disposeObject(this.manualN),this.manualN=null,GObj.disposeObject(this.manaN),this.manaN=null,GObj.disposeObject(this.lineText),this.lineText=null,this.textArr)for(var i=0;i<this.textArr.length;i++)GObj.disposeObject(this.textArr[i]),this.textArr[i]=null;GObj.disposeObject(this.textArr),this.textArr=null,GObj.disposeObject(this.ferryText),this.ferryText=null,GObj.disposeObject(this.ferryTextDes),this.ferryTextDes=null,GObj.disposeObject(this.personIAvatar),this.personIAvatar=null,GObj.disposeObject(this.pro_index),this.pro_index=null},h}(eui.Component);t.IMiniGame9PlotView=i,__reflect(i.prototype,"miniGame.IMiniGame9PlotView");var e=function(i){function e(){var t=i.call(this)||this;return t.initSkin(),t}return __extends(e,i),e.prototype.initSkin=function(){this.answerItem=GObj.create(eui.Label),this.answerItem.verticalCenter=0,this.answerItem.size=28,this.answerItem.bold=!0,this.answerItem.fontFamily=t.IMiniGame9Consts.TYPEFACE,this.answerItem.textColor=16777215,this.answerItem.horizontalCenter=0,this.addChild(this.answerItem),this.tipsText=GObj.create(eui.Label),this.tipsText.size=18,this.tipsText.bold=!0,this.tipsText.fontFamily=t.IMiniGame9Consts.TYPEFACE,this.tipsText.textColor=16777215,this.tipsText.horizontalCenter=0,this.addChild(this.tipsText),this.skinName=this.getSkin()},Object.defineProperty(e.prototype,"index",{set:function(t){this._index=t},enumerable:!0,configurable:!0}),e.prototype.initEvent=function(){this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},e.prototype.removeEvent=function(){this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},e.prototype.setFun=function(t,i){this.thisObj=t,this.fun=i},e.prototype.setText=function(t,i){this.answerItem.text=t,this.tipsText.textColor=this.answerItem.textColor=16777215,this.tipsText.top=this.answerItem.y+this.answerItem.height+15,this.tipsText.text=i,this.width=this.answerItem.width,this.height=this.tipsText.height+this.answerItem.height+15,this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height/2},e.prototype.getSkin=function(){var t=GObj.create(eui.Skin);return t.skinParts=["mcDisplay"],t.label=this.answerItem,t.label_2=this.tipsText,t.elementsContent=[this.answerItem],t.states=[new eui.State("up",[]),new eui.State("down",[new eui.SetProperty("label","scaleX",.92),new eui.SetProperty("label","scaleY",.92),new eui.SetProperty("label_2","scaleX",.92),new eui.SetProperty("label_2","scaleY",.92)]),new eui.State("disabled",[])],t},e.prototype.onClick=function(){IMiniGameMain.playEff(t.IMiniGame9Consts.IMINIGAME9BTN),this.tipsText.textColor=this.answerItem.textColor=12986665,this.thisObj&&this.fun&&this.fun.call(this.thisObj,this.answerItem.text,this._index)},e.prototype.dispose=function(){this.removeEvent(),GObj.disposeObject(this.answerItem),this.answerItem=null,GObj.disposeObject(this.tipsText),this.tipsText=null,this.thisObj=null,this.fun=null},e}(eui.Button);t.IMiniGame9AnswerItem=e,__reflect(e.prototype,"miniGame.IMiniGame9AnswerItem");var s=function(t){function i(i){var e=t.call(this)||this;return e.exact=!0,e.initSkin(i),e}return __extends(i,t),i.prototype.initSkin=function(t){var i=this;this.horizontalCenter=this.verticalCenter=0,this.width=StageManager.stageWidth,this.height=StageManager.stageHeight,this.square=GObj.create(egret.Shape),this.square.graphics.lineStyle(0,0),this.square.graphics.beginFill(0),this.square.graphics.moveTo(0,0),this.square.graphics.lineTo(0,this.height/2+150),this.square.graphics.curveTo(this.width/2,this.height/2-50,this.width,this.height/2+150),this.square.graphics.lineTo(this.width,0),this.square.graphics.lineTo(0,0),this.square.x=0,this.square.y=0,this.square.visible=!0,this.square.graphics.endFill(),this.square.touchEnabled=!0,this.addChild(this.square),this.square_2=GObj.create(egret.Shape),this.square_2.graphics.lineStyle(0,0),this.square_2.graphics.beginFill(0),this.square_2.graphics.moveTo(0,this.height/2-150),this.square_2.graphics.curveTo(this.width/2,this.height/2+50,this.width,this.height/2-150),this.square_2.graphics.lineTo(this.width,this.height),this.square_2.graphics.lineTo(0,this.height),this.square_2.graphics.lineTo(0,this.height/2-150),this.square_2.anchorOffsetY=this.height,this.square_2.x=0,this.square_2.visible=!1,this.square_2.y=this.height,this.square_2.graphics.endFill(),this.square_2.touchEnabled=!0,this.addChild(this.square_2),this.square.visible=this.square_2.visible=!0,this.square.scaleY=this.square_2.scaleY=0,egret.Tween.get(this.square).to({scaleY:1},3e3).to({scaleY:0},3e3),egret.Tween.get(this.square_2).to({scaleY:1},3e3).call(function(){t&&t.callfun&&t.caller&&t.callfun.call(t.caller)}).to({scaleY:0},3e3).call(function(){i.parent&&i.parent.removeChild(i),GObj.disposeObject(i)})},i.prototype.dispose=function(){egret.Tween.removeTweens(this.square),egret.Tween.removeTweens(this.square_2),GObj.disposeObject(this.square),this.square=null,GObj.disposeObject(this.square_2),this.square_2=null},i}(eui.Component);t.IMiniGame9AShowView=s,__reflect(s.prototype,"miniGame.IMiniGame9AShowView")}(miniGame||(miniGame={}));var miniGame;!function(t){var i=function(i){function s(){var t=i.call(this)||this;return t.once(egret.Event.ADDED_TO_STAGE,t.addToStageComplete,t),t}return __extends(s,i),s.prototype.addToStageComplete=function(){this.initEvent()},s.prototype.updateOut=function(t){var i=this;this.exitBtn&&t.isMust&&(IMiniGameConfig.countDownExit>0?(this.exitBtn.visible=!1,ClockManager.setTimeout(function(){i.exitBtn&&(i.exitBtn.visible=!0)},this,IMiniGameConfig.countDownExit)):IMiniGameConfig.countDownExit<0&&(this.exitBtn.visible=!1))},s.prototype.initSkins=function(){var i=this;if(!this.isInit){this.isInit=!0,this.touchMask=GObj.create(eui.Rect),this.touchMask.height=StageManager.stageHeight+600,this.touchMask.width=StageManager.stageWidth,this.touchMask.fillColor=0,this.touchMask.horizontalCenter=0,this.touchMask.verticalCenter=0,this.touchMask.alpha=.1,this.addChild(this.touchMask),this.horizontalCenter=0,this.verticalCenter=0,this.width=540,this.height=960,this.bgImg=GObj.create(t.ImageOutside),this.bgImg.setOutSrc("game9_bg_1",FileConst.jpg),this.bgImg.horizontalCenter=0,this.bgImg.verticalCenter=0,this.addChild(this.bgImg),this.titleBg=GObj.create(t.ImageOutside),this.titleBg.setOutSrc("title",FileConst.png),this.titleBg.horizontalCenter=0,this.titleBg.top=30,this.addChild(this.titleBg),this.personImage||(this.personImage=GObj.create(BonesDisplay),this.personImage.touchEnabled=!1,this.personImage.source=IMiniGameMain.getBone("bones_tex"),this.personImage.play(null,0),this.personImage.x=this.width/2,this.personImage.y=this.height/2,this.personImage.scaleX=this.personImage.scaleY=.8,this.addChild(this.personImage),egret.Tween.get(this.personImage,{loop:!0}).to({y:this.personImage.y-3},500).to({y:this.personImage.y},500).to({y:this.personImage.y+3},500).to({y:this.personImage.y},500)),this.startBtn=GObj.create(e),this.startBtn.horizontalCenter=0,this.startBtn.bottom=100,this.addChild(this.startBtn),this.jobsGroup=GObj.create(eui.Group),this.jobsGroup.horizontalCenter=0,this.jobsGroup.verticalCenter=120,this.addChild(this.jobsGroup),this.groupBg=GObj.create(t.ImageOutside),this.groupBg.loadCompleteCall(function(){i.jobsGroup.width=i.groupBg.width,i.jobsGroup.height=i.groupBg.height},this),this.groupBg.setOutSrc("parchment",FileConst.png),this.groupBg.horizontalCenter=0,this.groupBg.verticalCenter=0,this.jobsGroup.addChild(this.groupBg),this.groupTitle=GObj.create(eui.Label),this.groupTitle.text=t.IMiniGame9Consts.JOB_TITLE,this.groupTitle.horizontalCenter=0,this.groupTitle.top=30,this.groupTitle.textAlign="center",this.groupTitle.textColor=0,this.groupTitle.size=28,this.groupTitle.fontFamily=t.IMiniGame9Consts.TYPEFACE,this.jobsGroup.addChild(this.groupTitle),this.listData=GObj.create(eui.ArrayCollection),this.list=GObj.create(eui.List),this.list.width=426,this.list.height=40,this.list.horizontalCenter=0,this.list.top=80,this.list.itemRenderer=t.IMiniGame9JobsItem,this.list.dataProvider=this.listData,this.list.selectedIndex=this.curindex;var s=GObj.create(eui.HorizontalLayout);s.gap=14,this.list.layout=s,this.jobsGroup.addChild(this.list),this.attBg=GObj.create(t.ImageOutside),this.attBg.setOutSrc("attbg",FileConst.jpg),this.attBg.horizontalCenter=0,this.attBg.top=this.list.top+this.list.height-10,this.jobsGroup.addChild(this.attBg),this.attItem=[];for(var h,a=t.IMiniGame9Consts.ATT_NAME,n=0;4>n;n++)h=GObj.create(t.IMiniGame9AttItem,a[n]),h.width=400,h.horizontalCenter=0,h.top=this.list.top+this.list.height+7*(n+1)+34*n,h.attValue=this.stageData.att[this.curindex][n],this.jobsGroup.addChild(h),this.attItem.push(h);this.exitBtn=GObj.create(t.IBaseBtn),this.exitBtn.icon=IMiniGameMain.getIcon("exit_btn",FileConst.png,"chapter"),this.exitBtn.right=10,this.exitBtn.top=100,this.addChild(this.exitBtn)}},s.prototype.setData=function(i,e){this.stageData=i,this.gamedata=e,this.curindex=0,this.initSkins(),this.updateList(),IMiniGameMain.playBgm(t.IMiniGame9Consts.IMINIGAME9BGM),this.updateOut(this.gamedata),this.gameView&&this.gameView.parent&&this.gameView.parent.removeChild(this.gameView)},s.prototype.initEvent=function(){this.list.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onListClick,this),this.startBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.startGame,this),this.exitBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCloseClick,this)},s.prototype.onListClick=function(t){if(this.curindex!=t.itemIndex){this.curindex=t.itemIndex,this.updateList();for(var i=0;i<this.attItem.length;i++)this.attItem[i].attValue=this.stageData.att[this.curindex][i]}},s.prototype.updateList=function(){for(var i=[],e=0;e<t.IMiniGame9Consts.JOB_NAME.length;e++)i.push({jobText:t.IMiniGame9Consts.JOB_NAME[e]});this.listData.replaceAll(i)},s.prototype.clearTween=function(){this.personImage&&egret.Tween.removeTweens(this.personImage)},s.prototype.startGame=function(){IMiniGameMain.reqSocket(1,this.stageData.stageId),IMiniGameMain.reqSocket(2),IMiniGameMain.playEff(t.IMiniGame9Consts.IMINIGAME9BTN),this.gameView||(this.gameView=GObj.create(t.IMiniGame9PlotView)),this.gameView.setData(this.stageData.plot,this.stageData.att,this.curindex),this.addChild(this.gameView)},s.prototype.removeEvent=function(){this.exitBtn&&this.exitBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onCloseClick,this)},s.prototype.dispose=function(){if(!this.isDestory){if(this.isDestory=!0,this.clearTween(),this.removeEvent(),GObj.disposeObject(this.bgImg),this.bgImg=null,GObj.disposeObject(this.stageData),this.stageData=null,GObj.disposeObject(this.titleBg),this.titleBg=null,GObj.disposeObject(this.personImage),this.personImage=null,GObj.disposeObject(this.startBtn),this.startBtn=null,GObj.disposeObject(this.jobsGroup),this.jobsGroup=null,GObj.disposeObject(this.groupBg),this.groupBg=null,GObj.disposeObject(this.groupTitle),this.groupTitle=null,GObj.disposeObject(this.list),this.list=null,GObj.disposeObject(this.listData),this.listData=null,this.attItem)for(var t=0;t<this.attItem.length;t++)GObj.disposeObject(this.attItem[t]),this.attItem[t]=null;
GObj.disposeObject(this.attItem),this.attItem=null,GObj.disposeObject(this.gameView),this.gameView=null,GObj.disposeObject(this.curindex),this.curindex=null,GObj.disposeObject(this.exitBtn),this.exitBtn=null,GObj.disposeObject(this.attBg),this.attBg=null,GObj.disposeObject(this.touchMask),this.touchMask=null,i.prototype.dispose.call(this)}},s}(t.IBaseView);t.IMiniGame9View=i,__reflect(i.prototype,"miniGame.IMiniGame9View");var e=function(i){function e(){var t=i.call(this)||this;return t.initSkin(),t}return __extends(e,i),e.prototype.initSkin=function(){this.startgame=GObj.create(t.IMovie),this.startgame.x=this.startgame.y=0,this.startgame.start(t.IMiniGame9Consts.STARTGAME),this.startgame.autoRun(),this.addChild(this.startgame),this.skinName=this.getSkin()},e.prototype.getSkin=function(){var t=GObj.create(eui.Skin);return t.skinParts=["mcDisplay"],t.movie=this.startgame,t.elementsContent=[this.startgame],t.states=[new eui.State("up",[]),new eui.State("down",[new eui.SetProperty("movie","scaleX",.92),new eui.SetProperty("movie","scaleY",.92)]),new eui.State("disabled",[])],t},e.prototype.dispose=function(){GObj.disposeObject(this.startgame),this.startgame=null},e}(eui.Button);t.IMiniGame9Btn=e,__reflect(e.prototype,"miniGame.IMiniGame9Btn")}(miniGame||(miniGame={}));